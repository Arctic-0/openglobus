precision highp float;

#define MAX_POINT_LIGHTS 1
	
uniform sampler2D uSampler;
 
uniform int pointLightsQuantity;
uniform vec3 pointLightsPositions[MAX_POINT_LIGHTS];
uniform vec3 pointLightsParamsv[MAX_POINT_LIGHTS * 3];
uniform float pointLightsParamsf[MAX_POINT_LIGHTS];

//uniform float fNightScale;
//uniform vec3 v3LightPosition;
//uniform sampler2D tDiffuse;
//uniform sampler2D tDiffuseNight;

varying vec3 vTransformedNormal;
varying vec4 vPosition;
varying vec3 c0;
varying vec3 c1;
varying vec2 vUv;

void main(void) {

    vec3 lightWeighting;
	vec3 lightDirection;
	vec3 normal;
	vec3 eyeDirection;
	vec3 reflectionDirection;
	float specularLightWeighting;
	float diffuseLightWeighting;


	//i=0
    lightDirection = normalize(pointLightsPositions[0] - vPosition.xyz);
	//float distance = length(dir);
	//float attenuation = 1.0/(1.0+0.1*distance+0.01*distance*distance);
    normal = normalize(vTransformedNormal);
    eyeDirection = normalize(-vPosition.xyz);
    reflectionDirection = reflect(-lightDirection, normal);	
	specularLightWeighting = pow(max(dot(reflectionDirection, eyeDirection), 0.0), pointLightsParamsf[0]);
    diffuseLightWeighting = max(dot(normal, lightDirection), 0.0);
    lightWeighting = pointLightsParamsv[0] + pointLightsParamsv[1] * diffuseLightWeighting + pointLightsParamsv[2] * specularLightWeighting;

    //vec4 cc = texture2D( uSampler, vTextureCoord.st );
	//cc.a = 0.5 + length(cc.rgb);
    //gl_FragColor = vec4(lightWeighting, uColor.a) * cc * uColor;


	vec3 diffuseTex = texture2D( uSampler, vUv ).xyz;
	//vec3 diffuseNightTex = texture2D( tDiffuseNight, vUv ).xyz;

	vec3 day = diffuseTex * c0;
	vec3 night = vec3(0.0);//fNightScale * diffuseNightTex * diffuseNightTex * diffuseNightTex * (1.0 - c0);

	gl_FragColor = vec4(c1, 1.0) + vec4(day + night, 1.0);
}