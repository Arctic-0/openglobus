precision mediump float;
precision lowp int;

#define MAX_TEX 8

varying vec2 vTextureCoord;

uniform int numTex;
uniform sampler2D uSamplerArr[MAX_TEX];
uniform vec4 tcolorArr[MAX_TEX];
uniform lowp vec3 texBiasArr[MAX_TEX];

void main(void) 
{
	lowp vec4 res = texture2D(uSamplerArr[0], texBiasArr[0].z * (vTextureCoord + vec2(texBiasArr[0].x, texBiasArr[0].y)));

		for( int i = 1; i < MAX_TEX; i++ ) 
		{
			if( i < numTex) 
			{
				lowp vec4 ti = texture2D(uSamplerArr[i], texBiasArr[i].z * (vTextureCoord + texBiasArr[i].xy));
				res = mix(res, ti, tcolorArr[i].w * ti.a * smoothstep(0.35, 0.5, distance( ti.rgb, tcolorArr[i].xyz )));
			}
			else
			{
				break;
			}
		}
	gl_FragColor = res;
}