var COMPILED=!0,goog=goog||{};goog.global=this;goog.isDef=function(c){return void 0!==c};goog.exportPath_=function(c,d,e){c=c.split(".");e=e||goog.global;c[0]in e||!e.execScript||e.execScript("var "+c[0]);for(var f;c.length&&(f=c.shift());)!c.length&&goog.isDef(d)?e[f]=d:e=e[f]?e[f]:e[f]={}};
goog.define=function(c,d){var e=d;COMPILED||(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,c)?e=goog.global.CLOSURE_UNCOMPILED_DEFINES[c]:goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,c)&&(e=goog.global.CLOSURE_DEFINES[c]));goog.exportPath_(c,e)};goog.DEBUG=!0;goog.LOCALE="en";goog.TRUSTED_SITE=!0;goog.STRICT_MODE_COMPATIBLE=!1;goog.DISALLOW_TEST_ONLY_CODE=COMPILED&&!goog.DEBUG;
goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING=!1;goog.provide=function(c){if(!COMPILED&&goog.isProvided_(c))throw Error('Namespace "'+c+'" already declared.');goog.constructNamespace_(c)};goog.constructNamespace_=function(c,d){if(!COMPILED){delete goog.implicitNamespaces_[c];for(var e=c;(e=e.substring(0,e.lastIndexOf(".")))&&!goog.getObjectByName(e);)goog.implicitNamespaces_[e]=!0}goog.exportPath_(c,d)};goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/;
goog.module=function(c){if(!goog.isString(c)||!c||-1==c.search(goog.VALID_MODULE_RE_))throw Error("Invalid module identifier");if(!goog.isInModuleLoader_())throw Error("Module "+c+" has been loaded incorrectly.");if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");goog.moduleLoaderState_.moduleName=c;if(!COMPILED){if(goog.isProvided_(c))throw Error('Namespace "'+c+'" already declared.');delete goog.implicitNamespaces_[c]}};goog.module.get=function(c){return goog.module.getInternal_(c)};
goog.module.getInternal_=function(c){if(!COMPILED)return goog.isProvided_(c)?c in goog.loadedModules_?goog.loadedModules_[c]:goog.getObjectByName(c):null};goog.moduleLoaderState_=null;goog.isInModuleLoader_=function(){return null!=goog.moduleLoaderState_};
goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInModuleLoader_())throw Error("goog.module.declareLegacyNamespace must be called from within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=!0};
goog.setTestOnly=function(c){if(goog.DISALLOW_TEST_ONLY_CODE)throw c=c||"",Error("Importing test-only code into non-debug environment"+(c?": "+c:"."));};goog.forwardDeclare=function(c){};COMPILED||(goog.isProvided_=function(c){return c in goog.loadedModules_||!goog.implicitNamespaces_[c]&&goog.isDefAndNotNull(goog.getObjectByName(c))},goog.implicitNamespaces_={"goog.module":!0});
goog.getObjectByName=function(c,d){for(var e=c.split("."),f=d||goog.global,g;g=e.shift();)if(goog.isDefAndNotNull(f[g]))f=f[g];else return null;return f};goog.globalize=function(c,d){var e=d||goog.global,f;for(f in c)e[f]=c[f]};goog.addDependency=function(c,d,e,f){if(goog.DEPENDENCIES_ENABLED){var g;c=c.replace(/\\/g,"/");for(var h=goog.dependencies_,k=0;g=d[k];k++)h.nameToPath[g]=c,h.pathIsModule[c]=!!f;for(f=0;d=e[f];f++)c in h.requires||(h.requires[c]={}),h.requires[c][d]=!0}};
goog.ENABLE_DEBUG_LOADER=!0;goog.logToConsole_=function(c){goog.global.console&&goog.global.console.error(c)};goog.require=function(c){if(!COMPILED){goog.ENABLE_DEBUG_LOADER&&goog.IS_OLD_IE_&&goog.maybeProcessDeferredDep_(c);if(goog.isProvided_(c))return goog.isInModuleLoader_()?goog.module.getInternal_(c):null;if(goog.ENABLE_DEBUG_LOADER){var d=goog.getPathFromDeps_(c);if(d)return goog.writeScripts_(d),null}c="goog.require could not find: "+c;goog.logToConsole_(c);throw Error(c);}};
goog.basePath="";goog.nullFunction=function(){};goog.abstractMethod=function(){throw Error("unimplemented abstract method");};goog.addSingletonGetter=function(c){c.getInstance=function(){if(c.instance_)return c.instance_;goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=c);return c.instance_=new c}};goog.instantiatedSingletons_=[];goog.LOAD_MODULE_USING_EVAL=!0;goog.SEAL_MODULE_EXPORTS=goog.DEBUG;goog.loadedModules_={};goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;
goog.DEPENDENCIES_ENABLED&&(goog.dependencies_={pathIsModule:{},nameToPath:{},requires:{},visited:{},written:{},deferred:{}},goog.inHtmlDocument_=function(){var c=goog.global.document;return null!=c&&"write"in c},goog.findBasePath_=function(){if(goog.isDef(goog.global.CLOSURE_BASE_PATH))goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_())for(var c=goog.global.document.getElementsByTagName("SCRIPT"),d=c.length-1;0<=d;--d){var e=c[d].src,f=e.lastIndexOf("?"),f=-1==f?e.length:
f;if("base.js"==e.substr(f-7,7)){goog.basePath=e.substr(0,f-7);break}}},goog.importScript_=function(c,d){(goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_)(c,d)&&(goog.dependencies_.written[c]=!0)},goog.IS_OLD_IE_=!(goog.global.atob||!goog.global.document||!goog.global.document.all),goog.importModule_=function(c){goog.importScript_("",'goog.retrieveAndExecModule_("'+c+'");')&&(goog.dependencies_.written[c]=!0)},goog.queuedModules_=[],goog.wrapModule_=function(c,d){return goog.LOAD_MODULE_USING_EVAL&&
goog.isDef(goog.global.JSON)?"goog.loadModule("+goog.global.JSON.stringify(d+"\n//# sourceURL="+c+"\n")+");":'goog.loadModule(function(exports) {"use strict";'+d+"\n;return exports});\n//# sourceURL="+c+"\n"},goog.loadQueuedModules_=function(){var c=goog.queuedModules_.length;if(0<c){var d=goog.queuedModules_;goog.queuedModules_=[];for(var e=0;e<c;e++)goog.maybeProcessDeferredPath_(d[e])}},goog.maybeProcessDeferredDep_=function(c){goog.isDeferredModule_(c)&&goog.allDepsAreAvailable_(c)&&(c=goog.getPathFromDeps_(c),
goog.maybeProcessDeferredPath_(goog.basePath+c))},goog.isDeferredModule_=function(c){return(c=goog.getPathFromDeps_(c))&&goog.dependencies_.pathIsModule[c]?goog.basePath+c in goog.dependencies_.deferred:!1},goog.allDepsAreAvailable_=function(c){if((c=goog.getPathFromDeps_(c))&&c in goog.dependencies_.requires)for(var d in goog.dependencies_.requires[c])if(!goog.isProvided_(d)&&!goog.isDeferredModule_(d))return!1;return!0},goog.maybeProcessDeferredPath_=function(c){if(c in goog.dependencies_.deferred){var d=
goog.dependencies_.deferred[c];delete goog.dependencies_.deferred[c];goog.globalEval(d)}},goog.loadModule=function(c){var d=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:void 0,declareLegacyNamespace:!1};var e;if(goog.isFunction(c))e=c.call(goog.global,{});else if(goog.isString(c))e=goog.loadModuleFromSource_.call(goog.global,c);else throw Error("Invalid module definition");var f=goog.moduleLoaderState_.moduleName;if(!goog.isString(f)||!f)throw Error('Invalid module name "'+f+'"');
goog.moduleLoaderState_.declareLegacyNamespace?goog.constructNamespace_(f,e):goog.SEAL_MODULE_EXPORTS&&Object.seal&&Object.seal(e);goog.loadedModules_[f]=e}finally{goog.moduleLoaderState_=d}},goog.loadModuleFromSource_=function(c){eval(c);return{}},goog.writeScriptSrcNode_=function(c){goog.global.document.write('<script type="text/javascript" src="'+c+'">\x3c/script>')},goog.appendScriptSrcNode_=function(c){var d=goog.global.document,e=d.createElement("script");e.type="text/javascript";e.src=c;e.defer=
!1;e.async=!1;d.head.appendChild(e)},goog.writeScriptTag_=function(c,d){if(goog.inHtmlDocument_()){var e=goog.global.document;if(!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING&&"complete"==e.readyState){if(/\bdeps.js$/.test(c))return!1;throw Error('Cannot write "'+c+'" after document load');}var f=goog.IS_OLD_IE_;void 0===d?f?(f=" onreadystatechange='goog.onScriptLoad_(this, "+ ++goog.lastNonModuleScriptIndex_+")' ",e.write('<script type="text/javascript" src="'+c+'"'+f+">\x3c/script>")):goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING?
goog.appendScriptSrcNode_(c):goog.writeScriptSrcNode_(c):e.write('<script type="text/javascript">'+d+"\x3c/script>");return!0}return!1},goog.lastNonModuleScriptIndex_=0,goog.onScriptLoad_=function(c,d){"complete"==c.readyState&&goog.lastNonModuleScriptIndex_==d&&goog.loadQueuedModules_();return!0},goog.writeScripts_=function(c){function d(c){if(!(c in g.written||c in g.visited)){g.visited[c]=!0;if(c in g.requires)for(var h in g.requires[c])if(!goog.isProvided_(h))if(h in g.nameToPath)d(g.nameToPath[h]);
else throw Error("Undefined nameToPath for "+h);c in f||(f[c]=!0,e.push(c))}}var e=[],f={},g=goog.dependencies_;d(c);for(c=0;c<e.length;c++){var h=e[c];goog.dependencies_.written[h]=!0}var k=goog.moduleLoaderState_;goog.moduleLoaderState_=null;for(c=0;c<e.length;c++)if(h=e[c])g.pathIsModule[h]?goog.importModule_(goog.basePath+h):goog.importScript_(goog.basePath+h);else throw goog.moduleLoaderState_=k,Error("Undefined script input");goog.moduleLoaderState_=k},goog.getPathFromDeps_=function(c){return c in
goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[c]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js"));goog.normalizePath_=function(c){c=c.split("/");for(var d=0;d<c.length;)"."==c[d]?c.splice(d,1):d&&".."==c[d]&&c[d-1]&&".."!=c[d-1]?c.splice(--d,2):d++;return c.join("/")};
goog.loadFileSync_=function(c){if(goog.global.CLOSURE_LOAD_FILE_SYNC)return goog.global.CLOSURE_LOAD_FILE_SYNC(c);var d=new goog.global.XMLHttpRequest;d.open("get",c,!1);d.send();return d.responseText};
goog.retrieveAndExecModule_=function(c){if(!COMPILED){var d=c;c=goog.normalizePath_(c);var e=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_,f=goog.loadFileSync_(c);if(null!=f)f=goog.wrapModule_(c,f),goog.IS_OLD_IE_?(goog.dependencies_.deferred[d]=f,goog.queuedModules_.push(d)):e(c,f);else throw Error("load of "+c+"failed");}};
goog.typeOf=function(c){var d=typeof c;if("object"==d)if(c){if(c instanceof Array)return"array";if(c instanceof Object)return d;var e=Object.prototype.toString.call(c);if("[object Window]"==e)return"object";if("[object Array]"==e||"number"==typeof c.length&&"undefined"!=typeof c.splice&&"undefined"!=typeof c.propertyIsEnumerable&&!c.propertyIsEnumerable("splice"))return"array";if("[object Function]"==e||"undefined"!=typeof c.call&&"undefined"!=typeof c.propertyIsEnumerable&&!c.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==d&&"undefined"==typeof c.call)return"object";return d};goog.isNull=function(c){return null===c};goog.isDefAndNotNull=function(c){return null!=c};goog.isArray=function(c){return"array"==goog.typeOf(c)};goog.isArrayLike=function(c){var d=goog.typeOf(c);return"array"==d||"object"==d&&"number"==typeof c.length};goog.isDateLike=function(c){return goog.isObject(c)&&"function"==typeof c.getFullYear};goog.isString=function(c){return"string"==typeof c};
goog.isBoolean=function(c){return"boolean"==typeof c};goog.isNumber=function(c){return"number"==typeof c};goog.isFunction=function(c){return"function"==goog.typeOf(c)};goog.isObject=function(c){var d=typeof c;return"object"==d&&null!=c||"function"==d};goog.getUid=function(c){return c[goog.UID_PROPERTY_]||(c[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(c){return!!c[goog.UID_PROPERTY_]};goog.removeUid=function(c){"removeAttribute"in c&&c.removeAttribute(goog.UID_PROPERTY_);try{delete c[goog.UID_PROPERTY_]}catch(d){}};
goog.UID_PROPERTY_="closure_uid_"+(1E9*Math.random()>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(c){var d=goog.typeOf(c);if("object"==d||"array"==d){if(c.clone)return c.clone();var d="array"==d?[]:{},e;for(e in c)d[e]=goog.cloneObject(c[e]);return d}return c};goog.bindNative_=function(c,d,e){return c.call.apply(c.bind,arguments)};
goog.bindJs_=function(c,d,e){if(!c)throw Error();if(2<arguments.length){var f=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(e,f);return c.apply(d,e)}}return function(){return c.apply(d,arguments)}};goog.bind=function(c,d,e){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_;return goog.bind.apply(null,arguments)};
goog.partial=function(c,d){var e=Array.prototype.slice.call(arguments,1);return function(){var d=e.slice();d.push.apply(d,arguments);return c.apply(this,d)}};goog.mixin=function(c,d){for(var e in d)c[e]=d[e]};goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date};
goog.globalEval=function(c){if(goog.global.execScript)goog.global.execScript(c,"JavaScript");else if(goog.global.eval){if(null==goog.evalWorksForGlobals_)if(goog.global.eval("var _evalTest_ = 1;"),"undefined"!=typeof goog.global._evalTest_){try{delete goog.global._evalTest_}catch(f){}goog.evalWorksForGlobals_=!0}else goog.evalWorksForGlobals_=!1;if(goog.evalWorksForGlobals_)goog.global.eval(c);else{var d=goog.global.document,e=d.createElement("SCRIPT");e.type="text/javascript";e.defer=!1;e.appendChild(d.createTextNode(c));
d.body.appendChild(e);d.body.removeChild(e)}}else throw Error("goog.globalEval not available");};goog.evalWorksForGlobals_=null;goog.getCssName=function(c,d){var e=function(c){return goog.cssNameMapping_[c]||c},f=function(c){c=c.split("-");for(var d=[],f=0;f<c.length;f++)d.push(e(c[f]));return d.join("-")},f=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?e:f:function(c){return c};return d?c+"-"+f(d):f(c)};
goog.setCssNameMapping=function(c,d){goog.cssNameMapping_=c;goog.cssNameMappingStyle_=d};!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING);goog.getMsg=function(c,d){d&&(c=c.replace(/\{\$([^}]+)}/g,function(c,f){return null!=d&&f in d?d[f]:c}));return c};goog.getMsgWithFallback=function(c,d){return c};goog.exportSymbol=function(c,d,e){goog.exportPath_(c,d,e)};goog.exportProperty=function(c,d,e){c[d]=e};
goog.inherits=function(c,d){function e(){}e.prototype=d.prototype;c.superClass_=d.prototype;c.prototype=new e;c.prototype.constructor=c;c.base=function(c,e,h){for(var k=Array(arguments.length-2),m=2;m<arguments.length;m++)k[m-2]=arguments[m];return d.prototype[e].apply(c,k)}};
goog.base=function(c,d,e){var f=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||goog.DEBUG&&!f)throw Error("arguments.caller not defined.  goog.base() cannot be used with strict mode code. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(f.superClass_){for(var g=Array(arguments.length-1),h=1;h<arguments.length;h++)g[h-1]=arguments[h];return f.superClass_.constructor.apply(c,g)}g=Array(arguments.length-2);for(h=2;h<arguments.length;h++)g[h-2]=arguments[h];for(var h=!1,k=c.constructor;k;k=
k.superClass_&&k.superClass_.constructor)if(k.prototype[d]===f)h=!0;else if(h)return k.prototype[d].apply(c,g);if(c[d]===f)return c.constructor.prototype[d].apply(c,g);throw Error("goog.base called from a method of one name to a method of a different name");};goog.scope=function(c){c.call(goog.global)};COMPILED||(goog.global.COMPILED=COMPILED);
goog.defineClass=function(c,d){var e=d.constructor,f=d.statics;e&&e!=Object.prototype.constructor||(e=function(){throw Error("cannot instantiate an interface (no constructor defined).");});e=goog.defineClass.createSealingConstructor_(e,c);c&&goog.inherits(e,c);delete d.constructor;delete d.statics;goog.defineClass.applyProperties_(e.prototype,d);null!=f&&(f instanceof Function?f(e):goog.defineClass.applyProperties_(e,f));return e};goog.defineClass.SEAL_CLASS_INSTANCES=goog.DEBUG;
goog.defineClass.createSealingConstructor_=function(c,d){if(goog.defineClass.SEAL_CLASS_INSTANCES&&Object.seal instanceof Function){if(d&&d.prototype&&d.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_])return c;var e=function(){var d=c.apply(this,arguments)||this;d[goog.UID_PROPERTY_]=d[goog.UID_PROPERTY_];this.constructor===e&&Object.seal(d);return d};return e}return c};goog.defineClass.OBJECT_PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
goog.defineClass.applyProperties_=function(c,d){for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(c[e]=d[e]);for(var f=0;f<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;f++)e=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[f],Object.prototype.hasOwnProperty.call(d,e)&&(c[e]=d[e])};goog.tagUnsealableClass=function(c){!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES&&(c.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=!0)};goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable";var og={QueueArray:function(){this._array=Array(512);this._shiftIndex=this._popIndex=256;this.length=0}};og.QueueArray.prototype.clear=function(){this._array.length=0;this._array=Array(512);this._shiftIndex=this._popIndex=256;this.length=0};og.QueueArray.prototype.push=function(c){this.length++;this._array[++this._popIndex]=c};og.QueueArray.prototype.unshift=function(c){this.length++;this._array[this._shiftIndex--]=c};og.QueueArray.prototype.pop=function(){this.length--;return this._array[this._popIndex--]};og.Events=function(){};og.Events.prototype.registerNames=function(c){for(var d=0;d<c.length;d++)this[c[d]]={active:!0,handlers:[]}};og.Events.prototype.on=function(c,d,e){this[c].handlers.push({sender:d,callback:e})};og.Events.prototype.dispatch=function(c,d){if(c&&c.active)for(var e=c.handlers,f=e.length;f--;){var g=e[f];g.callback.call(g.sender,d)}};og.layer={};og.layer.MAX_OVERLAYS=8;og.layer.MAX_REQUESTS=7;og.layer.layersCounter=0;og.layer.requestsCounter=0;og.layer.DEFAILT_Z_INDEX=0;og.layer.DEFAILT_OPACITY=1;
og.layer.Layer=function(c,d){this.name=c?c:"noname";this.planet=null;this.events=new og.Events;this.events.registerNames(["onload","onloadend","onvisibilitychanged"]);d=d||{};this.isBaseLayer=d.isBaseLayer||!1;this.numZoomLevels=d.numZoomLevels||-1;this.visibility=d.visibility||!1;this.opacity=d.opacity||og.layer.DEFAILT_OPACITY;this.transparentColor=d.transparentColor||[-1,-1,-1];this.zIndex=d.zIndex||og.layer.DEFAILT_Z_INDEX;this._attribution=d.attribution||"";this.url=d.url||"";this.id=og.layer.layersCounter++;
this.counter=0;this.pendingsQueue=new og.QueueArray};og.layer.Layer.prototype.setAttribution=function(c){this._attribution=c;this.planet.updateAttributionsList()};og.layer.Layer.prototype.clone=function(){};og.layer.Layer.prototype.setZIndex=function(c){this.zIndex=c;this.planet.updateVisibleLayers()};og.layer.Layer.prototype.abortLoading=function(){for(var c=this.pendingsQueue,d=c._shiftIndex+1;d<c._popIndex+1;d++)c._array[d]&&c._array[d].abortLoading();this.pendingsQueue.clear()};
og.layer.Layer.prototype.setVisibility=function(c){this.isBaseLayer&&c?this.planet.setBaseLayer(this):c||this.abortLoading();c!=this.visibility&&(this.events.dispatch(this.events.onvisibilitychanged,this),this.visibility=c,this.planet.updateVisibleLayers())};og.layer.Layer.prototype.getVisibility=function(){return this.visibility};og.layer.replaceTemplate=function(c,d){return c.replace(/{[^{}]+}/g,function(c){return d[c.replace(/[{}]+/g,"")]||""})};
og.layer.Layer.prototype.setUrl=function(c){this.url=c};og.layer.Layer.prototype.setName=function(c){this.name=c};og.proj={};og.Units={};og.proj.Units={DEGREES:"degrees",FEET:"ft",METERS:"m",KILOMETERS:"km"};og.proj.METERS_PER_UNIT={};og.proj.METERS_PER_UNIT[og.proj.Units.FEET]=.3048;og.proj.METERS_PER_UNIT[og.proj.Units.METERS]=1;og.proj.METERS_PER_UNIT[og.proj.Units.KILOMETERS]=1E3;og.proj.Projection=function(c){this.code=c.code;this.units=c.units;this.id=og.proj.Projection._counter++};og.proj.Projection._counter=0;og.proj.EPSG3857=new og.proj.Projection({code:"epsg:3857",units:og.Units.METERS});og.inheritance={};og.inheritance.extend=function(c,d){var e=function(){};e.prototype=d.prototype;c.prototype=new e;c.prototype.constructor=c;c.superclass=d.prototype;c.superclass.constructor=d};og.inheritance.base=function(c){arguments.callee.caller.superclass.constructor.apply(c,Array.prototype.slice.call(arguments,1))};og.quadTree={};og.quadTree.NW=0;og.quadTree.NE=1;og.quadTree.SW=2;og.quadTree.SE=3;og.quadTree.N=0;og.quadTree.E=1;og.quadTree.S=2;og.quadTree.W=3;og.quadTree.WALKTHROUGH=0;og.quadTree.RENDERING=1;og.quadTree.NOTRENDERING=2;og.quadTree.OPSIDE=[og.quadTree.S,og.quadTree.W,og.quadTree.N,og.quadTree.E];
og.quadTree.NOPS=[[og.quadTree.NE,og.quadTree.NW,og.quadTree.SE,og.quadTree.SW],[og.quadTree.SW,og.quadTree.SE,og.quadTree.NW,og.quadTree.NE],[og.quadTree.NE,og.quadTree.NW,og.quadTree.SE,og.quadTree.SW],[og.quadTree.SW,og.quadTree.SE,og.quadTree.NW,og.quadTree.NE]];og.quadTree.NOPSORD=[[0,1,0,1],[0,0,1,1],[0,1,0,1],[0,0,1,1]];og.layer.XYZ=function(c,d){og.inheritance.base(this,c,d)};og.inheritance.extend(og.layer.XYZ,og.layer.Layer);og.layer.XYZ.prototype.handleSegmentTile=function(c){c.segment._projection.id==og.proj.EPSG3857.id?og.layer.requestsCounter>=og.layer.MAX_REQUESTS&&this.counter?this.pendingsQueue.push(c):this.loadSegmentTileImage(c):c.textureNotExists()};og.layer.XYZ.prototype.GetHTTPRequestString=function(c){return og.layer.replaceTemplate(this.url,{tilex:c.tileX.toString(),tiley:c.tileY.toString(),zoom:c.zoomIndex.toString()})};
og.layer.XYZ.prototype.loadSegmentTileImage=function(c){var d=this;this.counter++;og.layer.requestsCounter++;var e=new Image;e.crossOrigin="";e.onload=function(){var e=d.events.onload;e.length&&d.events.dispatch(e,{image:this,material:c});c.applyTexture.call(c,this);d.dequeueRequest()};e.onerror=function(){c&&c.textureNotExists.call(c);d.dequeueRequest()};c.segment.materials.length?(e.src=this.GetHTTPRequestString(c.segment),c.image=e):this.dequeueRequest()};
og.layer.XYZ.prototype.dequeueRequest=function(){this.counter--;og.layer.requestsCounter--;if(this.pendingsQueue.length){if(og.layer.requestsCounter<og.layer.MAX_REQUESTS){var c;(c=this.whilePendings())&&this.loadSegmentTileImage.call(this,c)}}else 0==this.counter&&this.events.dispatch(this.events.onloadend)};
og.layer.XYZ.prototype.whilePendings=function(){for(;this.pendingsQueue.length;){var c=this.pendingsQueue.pop();if(c){if(c.segment.node.getState()!=og.quadTree.NOTRENDERING)return c;c.imageIsLoading=!1}}return null};og.shaderProgram={};og.shaderProgram.types={};og.shaderProgram.types._declarations="FLOAT DOUBLE BOOL INT UINT VEC2 VEC3 VEC4 DVEC2 DVEC3 DVEC4 BVEC2 BVEC3 BVEC4 IVEC2 IVEC3 IVEC4 UVEC2 UVEC3 UVEC4 MAT2 DMAT2 MAT3 DMAT3 MAT4 DMAT4 MAT2X3 MAT2X4 MAT3X2 MAT3X4 MAT4X2 MAT4X3 DMAT2X3 DMAT2X4 DMAT3X2 DMAT3X4 DMAT4X2 DMAT4X3 SAMPLER1D SAMPLER2D SAMPLER3D SAMPLERCUBE SAMPLER2DSHADOW SAMPLER2DXX INTXX FLOATXX".split(" ");
(function(){for(var c=0;c<og.shaderProgram.types._declarations.length;c++)og.shaderProgram.types[og.shaderProgram.types._declarations[c]]=c})();og.shaderProgram.callbacks={};og.shaderProgram.bindBuffer=function(c,d){var e=c.gl;e.bindBuffer(e.ARRAY_BUFFER,d.value);e.vertexAttribPointer(d._pName,d.value.itemSize,e.FLOAT,!1,0,0)};og.shaderProgram.callbacks.u=[];og.shaderProgram.callbacks.a=[];og.shaderProgram.callbacks.u[og.shaderProgram.types.MAT4]=function(c,d){c.gl.uniformMatrix4fv(d._pName,!1,d.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.MAT3]=function(c,d){c.gl.uniformMatrix3fv(d._pName,!1,d.value)};
og.shaderProgram.callbacks.u[og.shaderProgram.types.FLOAT]=function(c,d){c.gl.uniform1f(d._pName,d.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.INT]=function(c,d){c.gl.uniform1i(d._pName,d.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.VEC2]=function(c,d){c.gl.uniform2fv(d._pName,d.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.VEC3]=function(c,d){c.gl.uniform3fv(d._pName,d.value)};
og.shaderProgram.callbacks.u[og.shaderProgram.types.VEC4]=function(c,d){c.gl.uniform4fv(d._pName,d.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.SAMPLER2D]=function(c,d){var e=c.gl;e.activeTexture(e.TEXTURE0+c._textureID);e.bindTexture(e.TEXTURE_2D,d.value);e.uniform1i(d._pName,c._textureID);c._textureID++};
og.shaderProgram.callbacks.u[og.shaderProgram.types.SAMPLERCUBE]=function(c,d){var e=c.gl;e.activeTexture(e.TEXTURE0+c._textureID);e.bindTexture(e.TEXTURE_CUBE_MAP,d.value);e.uniform1i(d._pName,c._textureID);c._textureID++};og.shaderProgram.callbacks.u[og.shaderProgram.types.SAMPLER2DXX]=function(c,d){for(var e=c.gl,f=d.value.length,g=new Int32Array(f),h=0;h<f;h++)e.activeTexture(e.TEXTURE0+c._textureID+h),e.bindTexture(e.TEXTURE_2D,d.value[h]),g[h]=h;e.uniform1iv(d._pName,g)};
og.shaderProgram.callbacks.u[og.shaderProgram.types.INTXX]=function(c,d){pgl.uniform1iv(d._pName,d.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.FLOATXX]=function(c,d){c.gl.uniform1fv(d._pName,d.value)};og.shaderProgram.callbacks.a[og.shaderProgram.types.FLOAT]=function(c,d){c.gl.vertexAttrib1f(d._pName,d.value)};og.shaderProgram.callbacks.a[og.shaderProgram.types.VEC2]=function(c,d){c.gl.vertexAttrib2fv(d._pName,d.value)};
og.shaderProgram.callbacks.a[og.shaderProgram.types.VEC3]=function(c,d){c.gl.vertexAttrib3fv(d._pName,d.value)};og.shaderProgram.callbacks.a[og.shaderProgram.types.VEC4]=function(c,d){c.gl.vertexAttrib4fv(d._pName,d.value)};og.shaderProgram.SHADERS_URL=COMPILED?"/shaders/":"../../src/og/shaders/";og.shaderProgram.ShaderProgram=function(c,d){this.name=c;this.attributes=d.attributes;this.uniforms=d.uniforms;this._variables={};this.vertexShader=d.vertexShader;this.fragmentShader=d.fragmentShader;this._p=this.gl=null;this._textureID=0;this._attribArrays=[]};og.shaderProgram.ShaderProgram.prototype.use=function(){this.gl.useProgram(this._p)};
og.shaderProgram.ShaderProgram.prototype.set=function(c){this._textureID=0;for(var d in c)this._variables[d].value=c[d],this._variables[d]._callback(this,this._variables[d])};og.shaderProgram.ShaderProgram.prototype.apply=function(){this._textureID=0;var c=this._variables,d;for(d in c)c[d]._callback(this,c[d])};og.shaderProgram.ShaderProgram.prototype.drawIndexBuffer=function(c,d){this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,d);this.gl.drawElements(c,d.numItems,this.gl.UNSIGNED_SHORT,0)};
og.shaderProgram.ShaderProgram.prototype.drawArray=function(c,d){this.gl.drawArrays(c,0,d)};og.shaderProgram.ShaderProgram.prototype.getShaderCompileStatus=function(c,d){this.gl.shaderSource(c,d);this.gl.compileShader(c);return this.gl.getShaderParameter(c,this.gl.COMPILE_STATUS)?!0:(alert(this.gl.getShaderInfoLog(c)),!1)};og.shaderProgram.ShaderProgram.prototype.createVertexShader=function(c){var d=this.gl.createShader(this.gl.VERTEX_SHADER);return this.getShaderCompileStatus(d,c)?d:null};
og.shaderProgram.ShaderProgram.prototype.createFragmentShader=function(c){var d=this.gl.createShader(this.gl.FRAGMENT_SHADER);return this.getShaderCompileStatus(d,c)?d:null};og.shaderProgram.ShaderProgram.prototype.disableAttribArrays=function(){for(var c=this.gl,d=this._attribArrays,e=d.length;e--;)c.disableVertexAttribArray(d[e])};og.shaderProgram.ShaderProgram.prototype.enableAttribArrays=function(){for(var c=this.gl,d=this._attribArrays,e=d.length;e--;)c.enableVertexAttribArray(d[e])};
og.shaderProgram.ShaderProgram.prototype.createProgram=function(c){this.gl=c;this._p=this.gl.createProgram();c.attachShader(this._p,this.createFragmentShader(this.fragmentShader));c.attachShader(this._p,this.createVertexShader(this.vertexShader));c.linkProgram(this._p);c.getProgramParameter(this._p,c.LINK_STATUS)||alert("Could not initialise shaders.");this.use();for(var d in this.attributes)this.attributes[d]._name=d,this._variables[d]=this.attributes[d],this.attributes[d]._callback=this.attributes[d].enableArray?
og.shaderProgram.bindBuffer:og.shaderProgram.callbacks.a[this.attributes[d].type],this._p[d]=c.getAttribLocation(this._p,d),this.attributes[d].enableArray&&(this._attribArrays.push(this._p[d]),c.enableVertexAttribArray(this._p[d])),this.attributes[d]._pName=this._p[d];for(var e in this.uniforms)this.uniforms[e]._name=e,this.uniforms[e]._callback=og.shaderProgram.callbacks.u[this.uniforms[e].type],this._variables[e]=this.uniforms[e],this._p[e]=c.getUniformLocation(this._p,e),this.uniforms[e]._pName=
this._p[e]};og.Ajax={ReadyState:{Uninitialized:0,Loading:1,Loaded:2,Interactive:3,Complete:4},Status:{OK:200,Created:201,Accepted:202,NoContent:204,BadRequest:400,Forbidden:403,NotFound:404,Gone:410,ServerError:500},Method:{Get:"GET",Post:"POST"},Asynchronous:!0,Synchronous:!1};og.Ajax.defaultParams={type:og.Ajax.Method.Get,async:og.Ajax.Asynchronous,data:null,sender:null,responseType:"text"};
og.Ajax.createXMLHttp=function(){var c=null;if(void 0!=typeof XMLHttpRequest)return c=new XMLHttpRequest;if(window.ActiveXObject)for(var d=["MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"],e=0;e<d.length;e++)try{return c=new ActiveXObject(d[e])}catch(f){}};
og.Ajax.request=function(c,d){var e={},f;for(f in og.Ajax.defaultParams)e[f]=og.Ajax.defaultParams[f];for(f in d)e[f]=d[f];var g=og.Ajax.createXMLHttp();g.open(e.type,c,e.async);e.type===og.Ajax.Method.Post&&g.setRequestHeader("Content-Type","application/x-www-form-urlencoded");e.async&&(g.responseType=e.responseType);g.overrideMimeType("text/plain");g.onreadystatechange=function(){g.readyState===og.Ajax.ReadyState.Complete&&(g.status===og.Ajax.Status.OK?d.success&&d.success.call(d.sender?d.sender:
this,g.response):d.error&&d.error.call(d.sender?d.sender:this,g.response,g.status))};g.send(d.data?d.data:og.Ajax.defaultParams.data)};og.math={};og.math.Vector3=function(c,d,e){this.x=c||0;this.y=d||0;this.z=e||0};og.math.Vector3.prototype.toVector4=function(){return new og.math.Vector4(this.x,this.y,this.z,1)};og.math.Vector3.UP=new og.math.Vector3(0,1,0);og.math.Vector3.DOWN=new og.math.Vector3(0,-1,0);og.math.Vector3.RIGHT=new og.math.Vector3(1,0,0);og.math.Vector3.LEFT=new og.math.Vector3(-1,0,0);og.math.Vector3.FORWARD=new og.math.Vector3(0,0,-1);og.math.Vector3.BACKWARD=new og.math.Vector3(0,0,1);og.math.Vector3.ZERO=new og.math.Vector3;
og.math.Vector3.prototype.clone=function(){return new og.math.Vector3(this.x,this.y,this.z)};og.math.Vector3.prototype.toString=function(){return"("+this.x+","+this.y+","+this.z+")"};og.math.Vector3.prototype.isZero=function(){return!(this.x||this.y||this.z)};og.math.Vector3.add=function(c,d){var e=new og.math.Vector3(c.x,c.y,c.z);e.add(d);return e};og.math.Vector3.sub=function(c,d){var e=new og.math.Vector3(c.x,c.y,c.z);e.sub(d);return e};
og.math.Vector3.scale=function(c,d){var e=new og.math.Vector3(c.x,c.y,c.z);e.scale(d);return e};og.math.Vector3.mull=function(c,d){var e=new og.math.Vector3(c.x,c.y,c.z);e.mull(d);return e};og.math.Vector3.div=function(c,d){var e=new og.math.Vector3(c.x,c.y,c.z);e.div(d);return e};og.math.Vector3.prototype.equal=function(c){return this.x===c.x&&this.y===c.y&&this.z===c.z};og.math.Vector3.prototype.copy=function(c){this.x=c.x;this.y=c.y;this.z=c.z;return this};
og.math.Vector3.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};og.math.Vector3.prototype.getQuaternion=function(){return new og.math.Quaternion(this.x,this.y,this.z)};og.math.Vector3.prototype.length2=function(){return this.x*this.x+this.y*this.y+this.z*this.z};og.math.Vector3.prototype.add=function(c){this.x+=c.x;this.y+=c.y;this.z+=c.z;return this};og.math.Vector3.prototype.sub=function(c){this.x-=c.x;this.y-=c.y;this.z-=c.z;return this};
og.math.Vector3.prototype.scale=function(c){this.x*=c;this.y*=c;this.z*=c;return this};og.math.Vector3.prototype.scaleTo=function(c){return new og.math.Vector3(this.x*c,this.y*c,this.z*c)};og.math.Vector3.prototype.mull=function(c){this.x*=c.x;this.y*=c.y;this.z*=c.z;return this};og.math.Vector3.prototype.div=function(c){this.x/=c.x;this.y/=c.y;this.z/=c.z;return this};og.math.Vector3.prototype.dot=function(c){return c.x*this.x+c.y*this.y+c.z*this.z};
og.math.Vector3.prototype.dotArr=function(c){return c[0]*this.x+c[1]*this.y+c[2]*this.z};og.math.Vector3.prototype.cross=function(c){var d=new og.math.Vector3;d.set(this.y*c.z-this.z*c.y,this.z*c.x-this.x*c.z,this.x*c.y-this.y*c.x);return d};og.math.Vector3.noncollinear=function(c,d){return c.y*d.z-c.z*d.y||c.z*d.x-c.x*d.z||c.x*d.y-c.y*d.z};og.math.Vector3.prototype.clear=function(){this.x=this.y=this.z=0;return this};
og.math.Vector3.prototype.normal=function(){var c=new og.math.Vector3;c.copy(this);var d=1/c.length();c.x*=d;c.y*=d;c.z*=d;return c};og.math.Vector3.prototype.normalize=function(){var c=1/this.length();this.x*=c;this.y*=c;this.z*=c;return this};og.math.Vector3.prototype.toVec=function(){return[this.x,this.y,this.z]};og.math.Vector3.prototype.distance=function(c){return og.math.Vector3.sub(this,c).length()};og.math.Vector3.prototype.set=function(c,d,e){this.x=c;this.y=d;this.z=e;return this};
og.math.Vector3.prototype.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};og.math.Vector3.prototype.getNegate=function(){return new og.math.Vector3(-this.x,-this.y,-this.z)};og.math.Vector3.proj_b_to_a=function(c,d){return d.scaleTo(d.dot(c)/d.dot(d))};og.math.Vector3.prototype.projToRay=function(c,d){var e=og.math.Vector3.proj_b_to_a(og.math.Vector3.sub(this,c),d);e.add(c);return e};og.math.Vector3.prototype.angle=function(c){return og.math.Vector3.angle(this,c)};
og.math.Vector3.angle=function(c,d){return Math.acos(c.dot(d)/Math.sqrt(c.length2()*d.length2()))};og.math.Vector3.prototype.lerp=function(c,d){return new og.math.Vector3(this.x+(c.x-this.x)*d,this.y+(c.y-this.y)*d,this.z+(c.z-this.z)*d)};og.math.Vector3.lerp=function(c,d,e){return new og.math.Vector3(c.x+(d.x-c.x)*e,c.y+(d.y-c.y)*e,c.z+(d.z-c.z)*e)};og.math.Vector3.prototype.smerp=function(c,d){var e=1-d;return new og.math.Vector3(this.x*d+c.x*e,this.y*d+c.y*e,this.z*d+c.z*e)};
og.math.Vector3.LERP_DELTA=1E-6;og.math.Vector3.prototype.slerp=function(c,d){var e=new og.math.Vector3;if(0>=d)e.copy(this);else if(1<=d)e.copy(c);else{var f,g,e=this.dot(c);1-e>og.math.Vector3.LERP_DELTA?(f=Math.acos(e),g=Math.sin(f),e=Math.sin((1-d)*f)/g,f=Math.sin(d*f)/g):(e=1-d,f=d);return og.math.Vector3.add(this.scaleTo(e),c.scale(f))}};og.math.Vector3.orthoNormalize=function(c,d){c=c.normal();c.scale(d.dot(c));return d.sub(c).normalize()};og.math.GLArray="undefined"!=typeof Float32Array?Float32Array:"undefined"!=typeof WebGLFloatArray?WebGLFloatArray:Array;og.math.X=0;og.math.Y=1;og.math.Z=2;og.math.W=3;og.math.LOG2=Math.log(2);og.math.MAX=549755748352;og.math.MIN=-og.math.MAX;og.math.RADIANS=Math.PI/180;og.math.DEGREES=180/Math.PI;og.math.DEGREES_DOUBLE=2*og.math.DEGREES;og.math.RADIANS_HALF=.5*og.math.RADIANS;og.math.SQRT_HALF=Math.sqrt(.5);Math.PI=3.1415927410125732;og.math.EPSILON1=.1;og.math.EPSILON2=.01;og.math.EPSILON3=.001;
og.math.EPSILON4=1E-4;og.math.EPSILON5=1E-5;og.math.EPSILON6=1E-6;og.math.EPSILON7=1E-7;og.math.EPSILON8=1E-8;og.math.EPSILON9=1E-9;og.math.EPSILON10=1E-10;og.math.EPSILON11=1E-11;og.math.EPSILON12=1E-12;og.math.EPSILON13=1E-13;og.math.EPSILON14=1E-14;og.math.EPSILON15=1E-15;og.math.EPSILON16=1E-16;og.math.EPSILON17=1E-17;og.math.EPSILON18=1E-18;og.math.EPSILON19=1E-19;og.math.EPSILON20=1E-20;og.math.log=function(c,d){return Math.log(c)/Math.log(d)};
og.math.clamp=function(c,d,e){return Math.max(d,Math.min(c,e))};og.math.DEG2RAD=function(c){return c*og.math.RADIANS};og.math.RAD2DEG=function(c){return c*og.math.DEGREES};og.math.isPowerOfTwo=function(c){return 0==(c&c-1)};og.math.nextHighestPowerOfTwo=function(c){--c;for(var d=1;32>d;d<<=1)c|=c>>d;return c+1};og.math.mod=function(c,d){return c-d*Math.floor(c/d)};og.math.step=function(c,d){return d<c?0:1};og.math.frac=function(c){return c-floor(c)};og.math.log2=function(c){return Math.log(c)/og.math.LOG2};
og.math.exp2=function(c){return Math.pow(2,c)};og.math.slice=function(c,d,e){return c*(d-e)};og.math.lerp=function(c,d,e){return e+c*(d-e)};og.math.norm_lon=function(c){return Math.asin(Math.sin(c*og.math.RADIANS_HALF))*og.math.DEGREES_DOUBLE};og.math.bezier=function(c,d,e,f,g){var h=1-c,k=c*c,m=h*h,l=k*c;return d.scaleTo(m*h).add(e.scaleTo(3*m*c)).add(f.scaleTo(3*h*k)).add(g.scaleTo(l))};og.math.Vector4=function(c,d,e,f){this.x=c||0;this.y=d||0;this.z=e||0;this.w=f||0};og.math.Vector4.identity=new og.math.Vector4(0,0,0,1);og.math.Vector4.prototype.toVector3=function(){return new og.math.Vector3(this.x,this.y,this.z)};og.math.Vector4.prototype.clone=function(c){return new og.math.Vector4(this.x,this.y,this.z,this.w)};og.math.Vector4.prototype.equal=function(c){return this.x===c.x&&this.y===c.y&&this.z===c.z&&this.w===c.w};
og.math.Vector4.prototype.copy=function(c){this.x=c.x;this.y=c.y;this.z=c.z;this.w=c.w;return this};og.math.Vector4.prototype.toVec=function(){var c=new og.math.GLArray(4);c[0]=this.x;c[1]=this.y;c[2]=this.z;c[3]=this.w;return c};og.math.Vector4.fromVec=function(c){return new og.math.Vector4(c[0],c[1],c[2],c[3])};og.math.Vector4.prototype.set=function(c,d,e,f){this.x=c;this.y=d;this.z=e;this.w=f;return this};
og.math.Vector4.prototype.add=function(c){this.x+=c.x;this.y+=c.y;this.z+=c.z;this.w+=c.w;return this};og.math.Vector4.prototype.sub=function(c){this.x-=c.x;this.y-=c.y;this.z-=c.z;this.w-=c.w;return this};og.math.Vector4.prototype.scale=function(c){this.x*=c;this.y*=c;this.z*=c;this.w*=c;return this};og.math.Vector4.prototype.affinity=function(){var c=1/this.w;this.x*=c;this.y*=c;this.z*=c;this.w=1;return this};
og.math.Vector4.prototype.scaleTo=function(c){return new og.math.Vector4(this.x*c,this.y*c,this.z*c,this.w*c)};og.math.Vector4.prototype.getStep=function(c){return new og.math.Vector4(this.x<c?0:1,this.y<c?0:1,this.z<c?0:1,this.w<c?0:1)};og.math.Vector4.prototype.getFrac=function(c){return new og.math.Vector4(og.math.frac(c.x),og.math.frac(c.y),og.math.frac(c.z),og.math.frac(c.w))};og.utils={};og.utils.readTextFile=function(c){var d="";og.Ajax.request(c,{async:!1,success:function(c){d=c}});return d};
og.utils.htmlColor2rgba=function(c,d){var e;"#"==c[0]?e=7==c.length?new og.math.Veector4(parseInt(c[1]+c[3],16),parseInt(c[3]+c[5],16),parseInt(c[5]+c[7],16),1):new og.math.Vector4(parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16),1):(e=c.split(","),void 0==parseFloat(e[3])&&(d=1),e=new og.math.Vector4(parseInt(e[0].split("(")[1]),parseInt(e[1]),parseInt(e[2]),d));void 0!=d&&(e.w=d);return e};og.shaderProgram.billboard=function(){return new og.shaderProgram.ShaderProgram("billboard",{uniforms:{u_texture:{type:og.shaderProgram.types.SAMPLER2D},uPMatrix:{type:og.shaderProgram.types.MAT4},uMVMatrix:{type:og.shaderProgram.types.MAT4},uCamPos:{type:og.shaderProgram.types.VEC3},uViewAngle:{type:og.shaderProgram.types.FLOAT},uXRatio:{type:og.shaderProgram.types.FLOAT}},attributes:{a_vertices:{type:og.shaderProgram.types.VEC2,enableArray:!0},a_texCoord:{type:og.shaderProgram.types.VEC2,enableArray:!0},
a_positions:{type:og.shaderProgram.types.VEC3,enableArray:!0},a_size:{type:og.shaderProgram.types.VEC2,enableArray:!0},a_offset:{type:og.shaderProgram.types.VEC3,enableArray:!0},a_rgba:{type:og.shaderProgram.types.VEC4,enableArray:!0},a_rotation:{type:og.shaderProgram.types.FLOAT,enableArray:!0},a_alignedAxis:{type:og.shaderProgram.types.VEC3,enableArray:!0}},vertexShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"billboard_vs.txt"),fragmentShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+
"billboard_fs.txt")})};og.BillboardHandler=function(c){this._entityCollection=c;this._renderer=null;this._billboards=[];this._alignedAxisBuffer=this._vertexBuffer=this._texCoordBuffer=this._rotationBuffer=this._rgbaBuffer=this._offsetBuffer=this._sizeBuffer=this._positionBuffer=null;this._texCoordArr=[];this._vertexArr=[];this._positionArr=[];this._sizeArr=[];this._offsetArr=[];this._rgbaArr=[];this._rotationArr=[];this._alignedAxisArr=[];this._buffersUpdateCallbacks=[];this._buffersUpdateCallbacks[og.BillboardHandler.POSITION_BUFFER]=
this.createPositionBuffer;this._buffersUpdateCallbacks[og.BillboardHandler.SIZE_BUFFER]=this.createSizeBuffer;this._buffersUpdateCallbacks[og.BillboardHandler.OFFSET_BUFFER]=this.createOffsetBuffer;this._buffersUpdateCallbacks[og.BillboardHandler.RGBA_BUFFER]=this.createRgbaBuffer;this._buffersUpdateCallbacks[og.BillboardHandler.ROTATION_BUFFER]=this.createRotationBuffer;this._buffersUpdateCallbacks[og.BillboardHandler.TEXCOORD_BUFFER]=this.createTexCoordBuffer;this._buffersUpdateCallbacks[og.BillboardHandler.VERTEX_BUFFER]=
this.createVertexBuffer;this._buffersUpdateCallbacks[og.BillboardHandler.ALIGNEDAXIS_BUFFER]=this.createAlignedAxisBuffer;this._changedBuffers=Array(this._buffersUpdateCallbacks.length);this.__staticId=og.BillboardHandler.staticCounter++};og.BillboardHandler.staticCounter=0;og.BillboardHandler.POSITION_BUFFER=0;og.BillboardHandler.SIZE_BUFFER=1;og.BillboardHandler.OFFSET_BUFFER=2;og.BillboardHandler.RGBA_BUFFER=3;og.BillboardHandler.ROTATION_BUFFER=4;og.BillboardHandler.TEXCOORD_BUFFER=5;
og.BillboardHandler.VERTEX_BUFFER=6;og.BillboardHandler.ALIGNEDAXIS_BUFFER=7;og.BillboardHandler.prototype.initShaderProgram=function(){this._renderer.handler&&(this._renderer.handler.shaderPrograms.billboard||this._renderer.handler.addShaderProgram(og.shaderProgram.billboard()))};og.BillboardHandler.prototype.setRenderer=function(c){this._renderer=c;this.initShaderProgram()};og.BillboardHandler.prototype.refresh=function(){for(var c=this._changedBuffers.length;c--;)this._changedBuffers[c]=!0};
og.BillboardHandler.prototype.clear=function(){this._billboards.length=0;this._billboards=[];this._texCoordArr.length=0;this._vertexArr.length=0;this._positionArr.length=0;this._sizeArr.length=0;this._offsetArr.length=0;this._rgbaArr.length=0;this._rotationArr.length=0;this._alignedAxisArr.length=0;this._texCoordArr=[];this._vertexArr=[];this._positionArr=[];this._sizeArr=[];this._offsetArr=[];this._rgbaArr=[];this._rotationArr=[];this._alignedAxisArr=[];this.refresh()};
og.BillboardHandler.prototype.update=function(){if(this._renderer)for(var c=this._changedBuffers.length;c--;)this._changedBuffers[c]&&(this._buffersUpdateCallbacks[c].call(this),this._changedBuffers[c]=!1)};og.BillboardHandler.prototype.add=function(c){-1==c._handlerIndex&&(c._handler=this,c._handlerIndex=this._billboards.length,this._billboards.push(c),this._addBillboardToArrays(c),this.refresh(),c.setSrc(c.src))};
og.BillboardHandler.prototype._addBillboardToArrays=function(c){c.visibility?og.BillboardHandler.concArr(this._vertexArr,[-.5,.5,-.5,-.5,.5,-.5,.5,-.5,.5,.5,-.5,.5]):og.BillboardHandler.concArr(this._vertexArr,[0,0,0,0,0,0,0,0,0,0,0,0]);og.BillboardHandler.concArr(this._texCoordArr,[0,0,0,0,0,0,0,0,0,0,0,0]);var d=c.position.x,e=c.position.y,f=c.position.z;og.BillboardHandler.concArr(this._positionArr,[d,e,f,d,e,f,d,e,f,d,e,f,d,e,f,d,e,f]);d=c.width;e=c.height;og.BillboardHandler.concArr(this._sizeArr,
[d,e,d,e,d,e,d,e,d,e,d,e]);d=c.offset.x;e=c.offset.y;f=c.offset.z;og.BillboardHandler.concArr(this._offsetArr,[d,e,f,d,e,f,d,e,f,d,e,f,d,e,f,d,e,f]);d=c.color.x;e=c.color.y;f=c.color.z;w=c.color.w;og.BillboardHandler.concArr(this._rgbaArr,[d,e,f,w,d,e,f,w,d,e,f,w,d,e,f,w,d,e,f,w,d,e,f,w]);d=c.rotation;og.BillboardHandler.concArr(this._rotationArr,[d,d,d,d,d,d]);d=c.alignedAxis.x;e=c.alignedAxis.y;f=c.alignedAxis.z;og.BillboardHandler.concArr(this._alignedAxisArr,[d,e,f,d,e,f,d,e,f,d,e,f,d,e,f,d,e,
f])};og.BillboardHandler.concArr=function(c,d){for(var e=0;e<d.length;e++)c.push(d[e])};
og.BillboardHandler.prototype._displayPASS=function(){var c=this._renderer,d=c.handler;d.shaderPrograms.billboard.activate();var e=d.shaderPrograms.billboard._program,f=e.attributes,e=e.uniforms,d=d.gl;d.uniform1i(e.u_texture._pName,0);d.uniformMatrix4fv(e.uMVMatrix._pName,!1,c.activeCamera.mvMatrix._m);d.uniformMatrix4fv(e.uPMatrix._pName,!1,c.activeCamera.pMatrix._m);d.uniform3fv(e.uCamPos._pName,c.activeCamera.eye.toVec());d.uniform1f(e.uViewAngle._pName,c.activeCamera._tanViewAngle_hrad);d.uniform1f(e.uXRatio._pName,
c.handler.canvas._oneByHeight);d.bindBuffer(d.ARRAY_BUFFER,this._texCoordBuffer);d.vertexAttribPointer(f.a_texCoord._pName,this._texCoordBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._vertexBuffer);d.vertexAttribPointer(f.a_vertices._pName,this._vertexBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._positionBuffer);d.vertexAttribPointer(f.a_positions._pName,this._positionBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._rgbaBuffer);d.vertexAttribPointer(f.a_rgba._pName,
this._rgbaBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._sizeBuffer);d.vertexAttribPointer(f.a_size._pName,this._sizeBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._offsetBuffer);d.vertexAttribPointer(f.a_offset._pName,this._offsetBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._rotationBuffer);d.vertexAttribPointer(f.a_rotation._pName,this._rotationBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._alignedAxisBuffer);d.vertexAttribPointer(f.a_alignedAxis._pName,
this._alignedAxisBuffer.itemSize,d.FLOAT,!1,0,0);d.drawArrays(d.TRIANGLES,0,this._vertexBuffer.numItems)};og.BillboardHandler.prototype.draw=function(){this._entityCollection.visibility&&this._billboards.length&&(this.update(),this._displayPASS())};og.BillboardHandler.prototype.reindexBillbordsArray=function(c){for(var d=this._billboards;c<d.length;c++)d[c]._handlerIndex=c};
og.BillboardHandler.prototype._removeBillboard=function(c){var d=c._handlerIndex;this._billboards.splice(d,1);var e;this._rgbaArr.splice(24*d,24);e=18*d;this._offsetArr.splice(e,18);this._positionArr.splice(e,18);this._alignedAxisArr.splice(e,18);e=12*d;this._vertexArr.splice(e,12);this._sizeArr.splice(e,12);this._texCoordArr.splice(e,12);this._rotationArr.splice(6*d,6);this.reindexBillbordsArray(d);this.refresh();c._handlerIndex=-1;c._handler=null};
og.BillboardHandler.prototype.remove=function(c){c._handler&&this.__staticId==c._handler.__staticId&&this._removeBillboard(c)};og.BillboardHandler.prototype.setPositionArr=function(c,d){var e=18*c,f=this._positionArr,g=d.x,h=d.y,k=d.z;f[e]=g;f[e+1]=h;f[e+2]=k;f[e+3]=g;f[e+4]=h;f[e+5]=k;f[e+6]=g;f[e+7]=h;f[e+8]=k;f[e+9]=g;f[e+10]=h;f[e+11]=k;f[e+12]=g;f[e+13]=h;f[e+14]=k;f[e+15]=g;f[e+16]=h;f[e+17]=k;this._changedBuffers[og.BillboardHandler.POSITION_BUFFER]=!0};
og.BillboardHandler.prototype.setSizeArr=function(c,d,e){c*=12;var f=this._sizeArr;f[c]=d;f[c+1]=e;f[c+2]=d;f[c+3]=e;f[c+4]=d;f[c+5]=e;f[c+6]=d;f[c+7]=e;f[c+8]=d;f[c+9]=e;f[c+10]=d;f[c+11]=e;this._changedBuffers[og.BillboardHandler.SIZE_BUFFER]=!0};
og.BillboardHandler.prototype.setOffsetArr=function(c,d){var e=18*c,f=this._offsetArr,g=d.x,h=d.y,k=d.z;f[e]=g;f[e+1]=h;f[e+2]=k;f[e+3]=g;f[e+4]=h;f[e+5]=k;f[e+6]=g;f[e+7]=h;f[e+8]=k;f[e+9]=g;f[e+10]=h;f[e+11]=k;f[e+12]=g;f[e+13]=h;f[e+14]=k;f[e+15]=g;f[e+16]=h;f[e+17]=k;this._changedBuffers[og.BillboardHandler.OFFSET_BUFFER]=!0};
og.BillboardHandler.prototype.setRgbaArr=function(c,d){var e=24*c,f=this._rgbaArr,g=d.x,h=d.y,k=d.z,m=d.w;f[e]=g;f[e+1]=h;f[e+2]=k;f[e+3]=m;f[e+4]=g;f[e+5]=h;f[e+6]=k;f[e+7]=m;f[e+8]=g;f[e+9]=h;f[e+10]=k;f[e+11]=m;f[e+12]=g;f[e+13]=h;f[e+14]=k;f[e+15]=m;f[e+16]=g;f[e+17]=h;f[e+18]=k;f[e+19]=m;f[e+20]=g;f[e+21]=h;f[e+22]=k;f[e+23]=m;this._changedBuffers[og.BillboardHandler.RGBA_BUFFER]=!0};
og.BillboardHandler.prototype.setRotationArr=function(c,d){var e=6*c,f=this._rotationArr;f[e]=d;f[e+1]=d;f[e+2]=d;f[e+3]=d;f[e+4]=d;f[e+5]=d;this._changedBuffers[og.BillboardHandler.ROTATION_BUFFER]=!0};og.BillboardHandler.prototype.setTexCoordArr=function(c,d){var e=12*c,f=this._texCoordArr;f[e]=d[0];f[e+1]=d[1];f[e+2]=d[2];f[e+3]=d[3];f[e+4]=d[4];f[e+5]=d[5];f[e+6]=d[6];f[e+7]=d[7];f[e+8]=d[8];f[e+9]=d[9];f[e+10]=d[10];f[e+11]=d[11];this._changedBuffers[og.BillboardHandler.TEXCOORD_BUFFER]=!0};
og.BillboardHandler.prototype.setVisibility=function(c,d){this.setVertexArr(c,d?[-.5,.5,-.5,-.5,.5,-.5,.5,-.5,.5,.5,-.5,.5]:[0,0,0,0,0,0,0,0,0,0,0,0])};og.BillboardHandler.prototype.setVertexArr=function(c,d){var e=12*c,f=this._vertexArr;f[e]=d[0];f[e+1]=d[1];f[e+2]=d[2];f[e+3]=d[3];f[e+4]=d[4];f[e+5]=d[5];f[e+6]=d[6];f[e+7]=d[7];f[e+8]=d[8];f[e+9]=d[9];f[e+10]=d[10];f[e+11]=d[11];this._changedBuffers[og.BillboardHandler.VERTEX_BUFFER]=!0};
og.BillboardHandler.prototype.setAlignedAxisArr=function(c,d){var e=18*c,f=this._alignedAxisArr,g=d.x,h=d.y,k=d.z;f[e]=g;f[e+1]=h;f[e+2]=k;f[e+3]=g;f[e+4]=h;f[e+5]=k;f[e+6]=g;f[e+7]=h;f[e+8]=k;f[e+9]=g;f[e+10]=h;f[e+11]=k;f[e+12]=g;f[e+13]=h;f[e+14]=k;f[e+15]=g;f[e+16]=h;f[e+17]=k;this._changedBuffers[og.BillboardHandler.ALIGNEDAXIS_BUFFER]=!0};
og.BillboardHandler.prototype.createPositionBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._positionBuffer);this._positionBuffer=c.createArrayBuffer(new Float32Array(this._positionArr),3,this._positionArr.length/3)};og.BillboardHandler.prototype.createSizeBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._sizeBuffer);this._sizeBuffer=c.createArrayBuffer(new Float32Array(this._sizeArr),2,this._sizeArr.length/2)};
og.BillboardHandler.prototype.createOffsetBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._offsetBuffer);this._offsetBuffer=c.createArrayBuffer(new Float32Array(this._offsetArr),3,this._offsetArr.length/3)};og.BillboardHandler.prototype.createRgbaBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._rgbaBuffer);this._rgbaBuffer=c.createArrayBuffer(new Float32Array(this._rgbaArr),4,this._rgbaArr.length/4)};
og.BillboardHandler.prototype.createRotationBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._rotationBuffer);this._rotationBuffer=c.createArrayBuffer(new Float32Array(this._rotationArr),1,this._rotationArr.length)};og.BillboardHandler.prototype.createVertexBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._vertexBuffer);this._vertexBuffer=c.createArrayBuffer(new Float32Array(this._vertexArr),2,this._vertexArr.length/2)};
og.BillboardHandler.prototype.createTexCoordBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._texCoordBuffer);this._texCoordBuffer=c.createArrayBuffer(new Float32Array(this._texCoordArr),2,this._texCoordArr.length/2)};og.BillboardHandler.prototype.createAlignedAxisBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._alignedAxisBuffer);this._alignedAxisBuffer=c.createArrayBuffer(new Float32Array(this._alignedAxisArr),3,this._alignedAxisArr.length/3)};
og.BillboardHandler.prototype.refreshTexCoordsArr=function(){var c=this._entityCollection;if(c&&c.renderNode)for(var c=c.renderNode.billboardsTextureAtlas,d=0;d<this._billboards.length;d++){var e=this._billboards[d];if(e.image){var f=c.nodes[e.image.__nodeIndex];f&&this.setTexCoordArr(e._handlerIndex,f.texCoords)}}};og.BaseBillboard=function(c){c=c||{};this._handler=null;this._handlerIndex=-1;this.id=c.id||"noname_"+og.BaseBillboard.__staticId++;this.position=new og.math.Vector3;this.rotation=0;this.color=new og.math.Vector4(1,1,1,1);this.alignedAxis=new og.math.Vector3;this.offset=new og.math.Vector3;this.visibility=!0;this.size=null};og.BaseBillboard.__staticId=0;
og.BaseBillboard.prototype.setPosition3v=function(c){this.position.x=c.x;this.position.y=c.y;this.position.z=c.z;this._handler&&this._handler.setPositionArr(this._handlerIndex,c)};og.BaseBillboard.prototype.setPosition=function(c,d,e){this.position.x=c;this.position.y=d;this.position.z=e;this._handler&&this._handler.setPositionArr(this._handlerIndex,this.position)};
og.BaseBillboard.prototype.setOffset=function(c){this.offset.x=c.x;this.offset.y=c.y;this._handler&&this._handler.setOffsetArr(this._handlerIndex,c)};og.BaseBillboard.prototype.setRotation=function(c){this.rotation=c;this._handler&&this._handler.setRotationArr(this._handlerIndex,c)};og.BaseBillboard.prototype.setColor4v=function(c){this.color.x=c.x;this.color.y=c.y;this.color.z=c.z;this.color.w=c.w;this._handler&&this._handler.setRgbaArr(this._handlerIndex,c)};
og.BaseBillboard.prototype.setColor=function(c){this.setColor4v(og.utils.htmlColor2rgba(c))};og.BaseBillboard.prototype.setVisibility=function(c){this._handler&&this._handler.setVisibility(this._handlerIndex,c)};og.BaseBillboard.prototype.setAlignedAxis3v=function(c){this.alignedAxis.x=c.x;this.alignedAxis.y=c.y;this.alignedAxis.z=c.z;this._handler&&this._handler.setAlignedAxisArr(this._handlerIndex,c)};
og.BaseBillboard.prototype.setAlignedAxis=function(c,d,e){this.alignedAxis.x=c;this.alignedAxis.y=d;this.alignedAxis.z=e;this._handler&&this._handler.setAlignedAxisArr(this._handlerIndex,this.alignedAxis)};og.BaseBillboard.prototype.remove=function(){this._handler&&this._handler.remove(this)};og.Label=function(c){og.inheritance.base(this,c);this.text="";this.face=null;this.size=32;this.weight=this.style=null;this.outline=.9;this.outlineColor=new og.math.Vector4(0,0,0,1);this.align=og.Label.RIGHT;this._fontIndex=0;this._fontAtlas=null};og.inheritance.extend(og.Label,og.BaseBillboard);og.Label.RIGHT=0;og.Label.LEFT=1;og.Label.CENTER=2;og.Label.ALIGN={left:og.Label.LEFT,right:og.Label.RIGHT,center:og.Label.CENTER};
og.Label.prototype.setText=function(c){this.text=c;this._handler&&this._handler.setText(this._handlerIndex,c,this._fontIndex,this.align)};og.Label.prototype.setAlign=function(c){this.align=og.Label.ALIGN[c.trim().toLowerCase()];this._handler&&this._handler.setText(this._handlerIndex,this.text,this._fontIndex,this.align)};og.Label.prototype.setFace=function(c){this.face=c.trim().toLowerCase();this.update()};
og.Label.prototype.setSize=function(c){this.size=c;this._handler&&this._handler.setSizeArr(this._handlerIndex,c)};og.Label.prototype.setStyle=function(c){this.style=c.trim().toLowerCase();this.update()};og.Label.prototype.setWeight=function(c){this.weight=c.trim().toLowerCase();this.update()};
og.Label.prototype._applyFontIndex=function(c){this._fontIndex=c;this._handler&&(this._handler.setFontIndexArr(this._handlerIndex,this._fontIndex),this._handler.setText(this._handlerIndex,this.text,this._fontIndex,this.align))};og.Label.prototype.setOutline=function(c){this.outline=c;this._handler&&this._handler.setOutlineArr(this._handlerIndex,1-c)};
og.Label.prototype.setOutlineColor4v=function(c){this.outlineColor.x=c.x;this.outlineColor.y=c.y;this.outlineColor.z=c.z;this.outlineColor.w=c.w;this._handler&&this._handler.setOutlineColorArr(this._handlerIndex,c)};og.Label.prototype.setOutlineColor=function(c){this.setOutlineColor4v(og.utils.htmlColor2rgba(c))};og.Label.prototype.setOutlineOpacity=function(c){this.outlineColor.w=c;this._handler&&this._handler.setOutlineColorArr(this._handlerIndex,this.outlineColor)};
og.Label.prototype.update=function(){if(this._fontAtlas){var c=this._fontAtlas.getFontIndex(this.face,this.style,this.weight);void 0==c?this._fontAtlas.createFontAsync(this.face,this.style,this.weight,this._applyFontIndex.bind(this)):this._applyFontIndex(c)}};og.Label.prototype.assignFontAtlas=function(c){!this._fontAtlas&&(this._fontAtlas=c);this.update()};og.shaderProgram.label=function(){return new og.shaderProgram.ShaderProgram("label",{uniforms:{u_fontTextureArr:{type:og.shaderProgram.types.SAMPLER2DXX},uPMatrix:{type:og.shaderProgram.types.MAT4},uMVMatrix:{type:og.shaderProgram.types.MAT4},uCamPos:{type:og.shaderProgram.types.VEC3},uViewAngle:{type:og.shaderProgram.types.FLOAT},uXRatio:{type:og.shaderProgram.types.FLOAT},uZ:{type:og.shaderProgram.types.FLOAT}},attributes:{a_vertices:{type:og.shaderProgram.types.VEC2,enableArray:!0},a_texCoord:{type:og.shaderProgram.types.VEC4,
enableArray:!0},a_positions:{type:og.shaderProgram.types.VEC3,enableArray:!0},a_size:{type:og.shaderProgram.types.FLOAT,enableArray:!0},a_offset:{type:og.shaderProgram.types.VEC3,enableArray:!0},a_rgba:{type:og.shaderProgram.types.VEC4,enableArray:!0},a_rotation:{type:og.shaderProgram.types.FLOAT,enableArray:!0},a_alignedAxis:{type:og.shaderProgram.types.VEC3,enableArray:!0},a_fontIndex:{type:og.shaderProgram.types.FLOAT,enableArray:!0},a_bufferAA:{type:og.shaderProgram.types.VEC2,enableArray:!0}},
vertexShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"label_vs.txt"),fragmentShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"label_fs.txt")})};og.LabelHandler=function(c){og.inheritance.base(this,c);this._outlineColorBuffer=this._outlineBuffer=this._noOutlineBuffer=this._fontIndexBuffer=null;this._fontIndexArr=[];this._noOutlineArr=[];this._outlineArr=[];this._outlineColorArr=[];this._buffersUpdateCallbacks[og.LabelHandler.FONTINDEX_BUFFER]=this.createFontIndexBuffer;this._buffersUpdateCallbacks[og.LabelHandler.OUTLINE_BUFFER]=this.createOutlineBuffer;this._buffersUpdateCallbacks[og.LabelHandler.OUTLINECOLOR_BUFFER]=this.createOutlineColorBuffer;
this._changedBuffers=Array(this._buffersUpdateCallbacks.length);this._maxLetters=32};og.inheritance.extend(og.LabelHandler,og.BillboardHandler);og.LabelHandler.FONTINDEX_BUFFER=8;og.LabelHandler.OUTLINE_BUFFER=9;og.LabelHandler.OUTLINECOLOR_BUFFER=10;og.LabelHandler.prototype.initShaderProgram=function(){this._renderer.handler&&(this._renderer.handler.shaderPrograms.label||this._renderer.handler.addShaderProgram(og.shaderProgram.label()))};
og.LabelHandler.prototype.add=function(c){-1==c._handlerIndex&&(c._handler=this,c._handlerIndex=this._billboards.length,this._billboards.push(c),this._addBillboardToArrays(c),this.refresh(),this.assignFontAtlas(c))};og.LabelHandler.prototype.assignFontAtlas=function(c){this._entityCollection&&this._entityCollection.renderNode&&c.assignFontAtlas(this._entityCollection.renderNode.fontAtlas)};
og.LabelHandler.prototype.clear=function(){this._billboards.length=0;this._billboards=[];this._texCoordArr.length=0;this._vertexArr.length=0;this._positionArr.length=0;this._sizeArr.length=0;this._offsetArr.length=0;this._rgbaArr.length=0;this._rotationArr.length=0;this._alignedAxisArr.length=0;this._fontIndexArr.length=0;this._letterOffsetArr.length=0;this._noOutlineArr.length=0;this._outlineArr.length=0;this._outlineColorArr.length=0;this._texCoordArr=[];this._vertexArr=[];this._positionArr=[];
this._sizeArr=[];this._offsetArr=[];this._rgbaArr=[];this._rotationArr=[];this._alignedAxisArr=[];this._fontIndexArr=[];this._letterOffsetArr=[];this._noOutlineArr=[];this._outlineArr=[];this._outlineColorArr=[];this.refresh()};
og.LabelHandler.prototype._addBillboardToArrays=function(c){for(var d=0;d<this._maxLetters;d++){c.visibility?og.BillboardHandler.concArr(this._vertexArr,[-.5,.5,-.5,-.5,.5,-.5,.5,-.5,.5,.5,-.5,.5]):og.BillboardHandler.concArr(this._vertexArr,[0,0,0,0,0,0,0,0,0,0,0,0]);og.BillboardHandler.concArr(this._texCoordArr,[0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0]);var e=c.position.x,f=c.position.y,g=c.position.z;og.BillboardHandler.concArr(this._positionArr,[e,f,g,e,f,g,e,f,g,e,f,g,e,f,g,e,f,
g]);e=c.size;og.BillboardHandler.concArr(this._sizeArr,[e,e,e,e,e,e]);e=c.offset.x;f=c.offset.y;g=c.offset.z-.01;og.BillboardHandler.concArr(this._offsetArr,[e,f,g,e,f,g,e,f,g,e,f,g,e,f,g,e,f,g]);e=c.color.x;f=c.color.y;g=c.color.z;w=c.color.w;og.BillboardHandler.concArr(this._rgbaArr,[e,f,g,w,e,f,g,w,e,f,g,w,e,f,g,w,e,f,g,w,e,f,g,w]);e=c.rotation;og.BillboardHandler.concArr(this._rotationArr,[e,e,e,e,e,e]);e=c.alignedAxis.x;f=c.alignedAxis.y;g=c.alignedAxis.z;og.BillboardHandler.concArr(this._alignedAxisArr,
[e,f,g,e,f,g,e,f,g,e,f,g,e,f,g,e,f,g]);og.BillboardHandler.concArr(this._fontIndexArr,[0,0,0,0,0,0]);e=1-c.outline;f=0;og.BillboardHandler.concArr(this._outlineArr,[e,f,e,f,e,f,e,f,e,f,e,f]);e=.75;f=.7;og.BillboardHandler.concArr(this._noOutlineArr,[e,f,e,f,e,f,e,f,e,f,e,f]);e=c.outlineColor.x;f=c.outlineColor.y;g=c.outlineColor.z;w=c.outlineColor.w;og.BillboardHandler.concArr(this._outlineColorArr,[e,f,g,w,e,f,g,w,e,f,g,w,e,f,g,w,e,f,g,w,e,f,g,w])}};
og.LabelHandler.prototype._displayPASS=function(){var c=this._renderer,d=c.handler;d.shaderPrograms.label.activate();var e=d.shaderPrograms.label._program,f=e.attributes,e=e.uniforms,d=d.gl;d.uniform1iv(e.u_fontTextureArr._pName,this._entityCollection.renderNode.fontAtlas.samplerArr);d.uniformMatrix4fv(e.uMVMatrix._pName,!1,c.activeCamera.mvMatrix._m);d.uniformMatrix4fv(e.uPMatrix._pName,!1,c.activeCamera.pMatrix._m);d.uniform3fv(e.uCamPos._pName,c.activeCamera.eye.toVec());d.uniform1f(e.uViewAngle._pName,
c.activeCamera._tanViewAngle_hrad);d.uniform1f(e.uXRatio._pName,c.handler.canvas._oneByHeight);d.bindBuffer(d.ARRAY_BUFFER,this._texCoordBuffer);d.vertexAttribPointer(f.a_texCoord._pName,this._texCoordBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._vertexBuffer);d.vertexAttribPointer(f.a_vertices._pName,this._vertexBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._positionBuffer);d.vertexAttribPointer(f.a_positions._pName,this._positionBuffer.itemSize,d.FLOAT,!1,
0,0);d.bindBuffer(d.ARRAY_BUFFER,this._sizeBuffer);d.vertexAttribPointer(f.a_size._pName,this._sizeBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._offsetBuffer);d.vertexAttribPointer(f.a_offset._pName,this._offsetBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._rotationBuffer);d.vertexAttribPointer(f.a_rotation._pName,this._rotationBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._alignedAxisBuffer);d.vertexAttribPointer(f.a_alignedAxis._pName,this._alignedAxisBuffer.itemSize,
d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._fontIndexBuffer);d.vertexAttribPointer(f.a_fontIndex._pName,this._fontIndexBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._outlineColorBuffer);d.vertexAttribPointer(f.a_rgba._pName,this._outlineColorBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._outlineBuffer);d.vertexAttribPointer(f.a_bufferAA._pName,this._outlineBuffer.itemSize,d.FLOAT,!1,0,0);d.uniform1f(e.uZ._pName,0);d.drawArrays(d.TRIANGLES,0,this._vertexBuffer.numItems);
d.bindBuffer(d.ARRAY_BUFFER,this._rgbaBuffer);d.vertexAttribPointer(f.a_rgba._pName,this._rgbaBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._noOutlineBuffer);d.vertexAttribPointer(f.a_bufferAA._pName,this._noOutlineBuffer.itemSize,d.FLOAT,!1,0,0);d.uniform1f(e.uZ._pName,-.01);d.drawArrays(d.TRIANGLES,0,this._vertexBuffer.numItems)};
og.LabelHandler.prototype._removeBillboard=function(c){var d=c._handlerIndex;this._billboards.splice(d,1);var e=24*this._maxLetters,f=d*e;this._rgbaArr.splice(f,e);this._outlineColorArr.splice(f,e);this._texCoordArr.splice(f,e);e=18*this._maxLetters;f=d*e;this._offsetArr.splice(f,e);this._positionArr.splice(f,e);this._alignedAxisArr.splice(f,e);e=12*this._maxLetters;f=d*e;this._vertexArr.splice(f,e);this._outlineArr.splice(f,e);this._noOutlineArr.splice(f,e);e=6*this._maxLetters;f=d*e;this._sizeArr.splice(f,
e);this._rotationArr.splice(f,e);this._fontIndexArr.splice(f,e);this.reindexBillbordsArray(d);this.refresh();c._handlerIndex=-1;c._handler=null;c._fontIndex=0;c._fontAtlas=null};
og.LabelHandler.prototype.setText=function(c,d,e,f){if(e=this._entityCollection.renderNode.fontAtlas.atlasesArr[e]){c=24*c*this._maxLetters;for(var g=this._texCoordArr,h=0,k=c+24*h,m=e.nodes[d[h]],l=m.emptySize,n=l,h=0;h<d.length;h++){var k=c+24*h,m=e.nodes[d[h]],p=m.texCoords;g[k]=p[0];g[k+1]=p[1];g[k+2]=n;g[k+3]=0;g[k+4]=p[2];g[k+5]=p[3];g[k+6]=n;g[k+7]=0;g[k+8]=p[4];g[k+9]=p[5];g[k+10]=n;g[k+11]=0;g[k+12]=p[6];g[k+13]=p[7];g[k+14]=n;g[k+15]=0;g[k+16]=p[8];g[k+17]=p[9];g[k+18]=n;g[k+19]=0;g[k+20]=
p[10];g[k+21]=p[11];g[k+22]=n;g[k+23]=0;n+=m.emptySize}if(f==og.Label.CENTER)for(n=.5*(l+49/512-n),h=0;h<d.length;h++)k=c+24*h,g[k+3]=n,g[k+7]=n,g[k+11]=n,g[k+15]=n,g[k+19]=n,g[k+23]=n;else if(f==og.Label.LEFT)for(n=l+49/512-n,h=0;h<d.length;h++)k=c+24*h,g[k+3]=n,g[k+7]=n,g[k+11]=n,g[k+15]=n,g[k+19]=n,g[k+23]=n;for(;h<this._maxLetters;h++)k=c+24*h,g[k+2]=-1,g[k+6]=-1,g[k+10]=-1,g[k+14]=-1,g[k+18]=-1,g[k+17]=-1;this._changedBuffers[og.BillboardHandler.TEXCOORD_BUFFER]=!0}};
og.LabelHandler.prototype.setPositionArr=function(c,d){for(var e=18*c*this._maxLetters,f=this._positionArr,g=d.x,h=d.y,k=d.z,m=0;m<this._maxLetters;m++){var l=e+18*m;f[l]=g;f[l+1]=h;f[l+2]=k;f[l+3]=g;f[l+4]=h;f[l+5]=k;f[l+6]=g;f[l+7]=h;f[l+8]=k;f[l+9]=g;f[l+10]=h;f[l+11]=k;f[l+12]=g;f[l+13]=h;f[l+14]=k;f[l+15]=g;f[l+16]=h;f[l+17]=k}this._changedBuffers[og.BillboardHandler.POSITION_BUFFER]=!0};
og.LabelHandler.prototype.setSizeArr=function(c,d){for(var e=6*c*this._maxLetters,f=this._sizeArr,g=0;g<this._maxLetters;g++){var h=e+6*g;f[h]=d;f[h+1]=d;f[h+2]=d;f[h+3]=d;f[h+4]=d;f[h+5]=d}this._changedBuffers[og.BillboardHandler.SIZE_BUFFER]=!0};
og.LabelHandler.prototype.setOffsetArr=function(c,d){for(var e=18*c*this._maxLetters,f=this._offsetArr,g=d.x,h=d.y,k=d.z,m=0;m<this._maxLetters;m++){var l=e+18*m;f[l]=g;f[l+1]=h;f[l+2]=k;f[l+3]=g;f[l+4]=h;f[l+5]=k;f[l+6]=g;f[l+7]=h;f[l+8]=k;f[l+9]=g;f[l+10]=h;f[l+11]=k;f[l+12]=g;f[l+13]=h;f[l+14]=k;f[l+15]=g;f[l+16]=h;f[l+17]=k}this._changedBuffers[og.BillboardHandler.OFFSET_BUFFER]=!0};
og.LabelHandler.prototype.setRgbaArr=function(c,d){for(var e=24*c*this._maxLetters,f=this._rgbaArr,g=d.x,h=d.y,k=d.z,m=d.w,l=0;l<this._maxLetters;l++){var n=e+24*l;f[n]=g;f[n+1]=h;f[n+2]=k;f[n+3]=m;f[n+4]=g;f[n+5]=h;f[n+6]=k;f[n+7]=m;f[n+8]=g;f[n+9]=h;f[n+10]=k;f[n+11]=m;f[n+12]=g;f[n+13]=h;f[n+14]=k;f[n+15]=m;f[n+16]=g;f[n+17]=h;f[n+18]=k;f[n+19]=m;f[n+20]=g;f[n+21]=h;f[n+22]=k;f[n+23]=m}this._changedBuffers[og.BillboardHandler.RGBA_BUFFER]=!0};
og.LabelHandler.prototype.setOutlineColorArr=function(c,d){for(var e=24*c*this._maxLetters,f=this._outlineColorArr,g=d.x,h=d.y,k=d.z,m=d.w,l=0;l<this._maxLetters;l++){var n=e+24*l;f[n]=g;f[n+1]=h;f[n+2]=k;f[n+3]=m;f[n+4]=g;f[n+5]=h;f[n+6]=k;f[n+7]=m;f[n+8]=g;f[n+9]=h;f[n+10]=k;f[n+11]=m;f[n+12]=g;f[n+13]=h;f[n+14]=k;f[n+15]=m;f[n+16]=g;f[n+17]=h;f[n+18]=k;f[n+19]=m;f[n+20]=g;f[n+21]=h;f[n+22]=k;f[n+23]=m}this._changedBuffers[og.LabelHandler.OUTLINECOLOR_BUFFER]=!0};
og.LabelHandler.prototype.setOutlineArr=function(c,d){for(var e=12*c*this._maxLetters,f=this._outlineArr,g=0;g<this._maxLetters;g++){var h=e+12*g;f[h]=d;f[h+2]=d;f[h+4]=d;f[h+6]=d;f[h+8]=d;f[h+10]=d}this._changedBuffers[og.LabelHandler.OUTLINE_BUFFER]=!0};
og.LabelHandler.prototype.setRotationArr=function(c,d){for(var e=6*c*this._maxLetters,f=this._rotationArr,g=0;g<this._maxLetters;g++){var h=e+6*g;f[h]=d;f[h+1]=d;f[h+2]=d;f[h+3]=d;f[h+4]=d;f[h+5]=d}this._changedBuffers[og.BillboardHandler.ROTATION_BUFFER]=!0};
og.LabelHandler.prototype.setVertexArr=function(c,d){for(var e=12*c*this._maxLetters,f=this._vertexArr,g=0;g<this._maxLetters;g++){var h=e+12*g;f[h]=d[0];f[h+1]=d[1];f[h+2]=d[2];f[h+3]=d[3];f[h+4]=d[4];f[h+5]=d[5];f[h+6]=d[6];f[h+7]=d[7];f[h+8]=d[8];f[h+9]=d[9];f[h+10]=d[10];f[h+11]=d[11]}this._changedBuffers[og.BillboardHandler.VERTEX_BUFFER]=!0};
og.LabelHandler.prototype.setAlignedAxisArr=function(c,d){for(var e=18*c*this._maxLetters,f=this._alignedAxisArr,g=d.x,h=d.y,k=d.z,m=0;m<this._maxLetters;m++){var l=e+18*m;f[l]=g;f[l+1]=h;f[l+2]=k;f[l+3]=g;f[l+4]=h;f[l+5]=k;f[l+6]=g;f[l+7]=h;f[l+8]=k;f[l+9]=g;f[l+10]=h;f[l+11]=k;f[l+12]=g;f[l+13]=h;f[l+14]=k;f[l+15]=g;f[l+16]=h;f[l+17]=k}this._changedBuffers[og.BillboardHandler.ALIGNEDAXIS_BUFFER]=!0};
og.LabelHandler.prototype.setFontIndexArr=function(c,d){for(var e=6*c*this._maxLetters,f=this._fontIndexArr,g=0;g<this._maxLetters;g++){var h=e+6*g;f[h]=d;f[h+1]=d;f[h+2]=d;f[h+3]=d;f[h+4]=d;f[h+5]=d}this._changedBuffers[og.LabelHandler.FONTINDEX_BUFFER]=!0};og.LabelHandler.prototype.createSizeBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._sizeBuffer);this._sizeBuffer=c.createArrayBuffer(new Float32Array(this._sizeArr),1,this._sizeArr.length)};
og.LabelHandler.prototype.createFontIndexBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._fontIndexBuffer);this._fontIndexBuffer=c.createArrayBuffer(new Float32Array(this._fontIndexArr),1,this._fontIndexArr.length)};og.LabelHandler.prototype.createTexCoordBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._texCoordBuffer);this._texCoordBuffer=c.createArrayBuffer(new Float32Array(this._texCoordArr),4,this._texCoordArr.length/4)};
og.LabelHandler.prototype.createOutlineBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._outlineBuffer);this._outlineBuffer=c.createArrayBuffer(new Float32Array(this._outlineArr),2,this._outlineArr.length/2);c.gl.deleteBuffer(this._noOutlineBuffer);this._noOutlineBuffer=c.createArrayBuffer(new Float32Array(this._noOutlineArr),2,this._noOutlineArr.length/2)};
og.BillboardHandler.prototype.createOutlineColorBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._outlineColorBuffer);this._outlineColorBuffer=c.createArrayBuffer(new Float32Array(this._outlineColorArr),4,this._outlineColorArr.length/4)};og.LabelHandler.prototype.setMaxLetters=function(c){this._maxLetters=c};og.LabelHandler.prototype.refreshTexCoordsArr=function(){return null};og.EntityCollection=function(){this._renderNodeIndex=-1;this.renderNode=null;this.visibility=!0;this._billboardHandler=new og.BillboardHandler(this);this._labelHandler=new og.LabelHandler(this);this.entities=[]};og.EntityCollection.prototype.setVisibility=function(c){this.visibility=c};
og.EntityCollection.prototype._addRecursively=function(c){c.billboard&&this._billboardHandler.add(c.billboard);c.label&&this._labelHandler.add(c.label);for(var d=0;d<c.childrenNodes.length;d++)c.childrenNodes[d]._entityCollection=this,c.childrenNodes[d]._entityCollectionIndex=c._entityCollectionIndex,this._addRecursively(c.childrenNodes[d])};
og.EntityCollection.prototype.add=function(c){c._entityCollection||(c._entityCollection=this,c._entityCollectionIndex=this.entities.length,this.entities.push(c),this._addRecursively(c));return this};og.EntityCollection.prototype.belongs=function(c){return c._entityCollection&&this._renderNodeIndex==c._entityCollection._renderNodeIndex};
og.EntityCollection.prototype._removeRecursively=function(c){c._entityCollection=null;c._entityCollectionIndex=-1;c.billboard&&this._billboardHandler.remove(c.billboard);c.label&&this._labelHandler.remove(c.label);for(var d=0;d<c.childrenNodes.length;d++)this._removeRecursively(c.childrenNodes[d])};og.EntityCollection.prototype.removeEntity=function(c){this.entities.splice(c._entityCollectionIndex,1);this.reindexEntitiesArray(c._entityCollectionIndex);this.belongs(c)&&this._removeRecursively(c)};
og.EntityCollection.prototype.reindexEntitiesArray=function(c){for(var d=this.entities;c<d.length;c++)d[c]._entityCollectionIndex=c};og.EntityCollection.prototype.addTo=function(c){this.renderNode||(this._renderNodeIndex=c.entityCollections.length,this.renderNode=c,c.entityCollections.push(this),this._billboardHandler.setRenderer(c.renderer),this._labelHandler.setRenderer(c.renderer),this.updateBillboardsTextureAtlas(),this.updateLabelsFontAtlas());return this};
og.EntityCollection.prototype.updateBillboardsTextureAtlas=function(){for(var c=this._billboardHandler._billboards,d=0;d<c.length;d++)c[d].setSrc(c[d].src)};og.EntityCollection.prototype.updateLabelsFontAtlas=function(){if(this.renderNode)for(var c=this._labelHandler._billboards,d=0;d<c.length;d++)c[d].assignFontAtlas(this.renderNode.fontAtlas)};
og.EntityCollection.prototype.remove=function(){if(this.renderNode){this.renderNode.billboardCollection.splice(this._renderNodeIndex,1);this.renderNode=null;for(var c=this._renderNodeIndex=-1;c<this.renderNode.entityCollections.length;c++)this.renderNode.entityCollections._renderNodeIndex=c}};og.EntityCollection.prototype.clear=function(){for(var c=0;c<this.entities.length;c++)this.entities[c].remove()};og.input={};og.input.KEY_SHIFT=16;og.input.KEY_SPACE=32;og.input.KEY_LEFT=37;og.input.KEY_UP=38;og.input.KEY_RIGHT=39;og.input.KEY_DOWN=40;og.input.KEY_A=65;og.input.KEY_C=67;og.input.KEY_D=68;og.input.KEY_E=69;og.input.KEY_H=72;og.input.KEY_L=76;og.input.KEY_Q=81;og.input.KEY_S=83;og.input.KEY_V=86;og.input.KEY_W=87;og.input.KEY_X=88;og.input.KEY_F1=112;og.input.MB_LEFT=0;og.input.MB_RIGHT=2;og.input.MB_MIDDLE=1;og.control={};og.control.Control=function(c){this.renderer=null;this.activated=!1;c&&(this.autoActivate=c.autoActivate?c.autoActivate:!1,this.active=c.active?c.active:!1)};og.control.Control.prototype.setRenderer=function(c){this.renderer=c;this.autoActivate&&(this.initialize(),this.active=!0)};og.control.Control.prototype.initialize=function(){this.init&&this.init();this.activated=!0};og.control.Control.prototype.activate=function(){this.active=!0};
og.control.Control.prototype.deactivate=function(){this.active=!1};og.control.KeyboardNavigation=function(c){og.inheritance.base(this,c)};og.inheritance.extend(og.control.KeyboardNavigation,og.control.Control);
og.control.KeyboardNavigation.prototype.init=function(){this.renderer.events.on("onkeypressed",this,this.onCameraMoveForward,og.input.KEY_W);this.renderer.events.on("onkeypressed",this,this.onCameraMoveBackward,og.input.KEY_S);this.renderer.events.on("onkeypressed",this,this.onCameraStrifeLeft,og.input.KEY_A);this.renderer.events.on("onkeypressed",this,this.onCameraStrifeRight,og.input.KEY_D);this.renderer.events.on("onkeypressed",this,this.onCameraLookUp,og.input.KEY_UP);this.renderer.events.on("onkeypressed",
this,this.onCameraLookDown,og.input.KEY_DOWN);this.renderer.events.on("onkeypressed",this,this.onCameraTurnLeft,og.input.KEY_LEFT);this.renderer.events.on("onkeypressed",this,this.onCameraTurnRight,og.input.KEY_RIGHT);this.renderer.events.on("onkeypressed",this,this.onCameraRollLeft,og.input.KEY_Q);this.renderer.events.on("onkeypressed",this,this.onCameraRollRight,og.input.KEY_E);this.renderer.events.on("onkeypressed",this,this.onCameraGrowAlt,og.input.KEY_SPACE)};
og.control.KeyboardNavigation.prototype.onCameraGrowAlt=function(c){};og.control.KeyboardNavigation.prototype.onCameraMoveForward=function(c){c=this.renderer.activeCamera;c.slide(0,0,-c.lonLat.height/30);c.update()};og.control.KeyboardNavigation.prototype.onCameraMoveBackward=function(c){c=this.renderer.activeCamera;c.slide(0,0,c.lonLat.height/30);c.update()};og.control.KeyboardNavigation.prototype.onCameraStrifeLeft=function(c){c=this.renderer.activeCamera;c.slide(-c.lonLat.height/30,0,0);c.update()};
og.control.KeyboardNavigation.prototype.onCameraStrifeRight=function(c){c=this.renderer.activeCamera;c.slide(c.lonLat.height/30,0,0);c.update()};og.control.KeyboardNavigation.prototype.onCameraLookUp=function(c){c=this.renderer.activeCamera;this.renderer.events.isKeyPressed(og.input.KEY_SHIFT)?c.pitch(50*this.renderer.handler.delta):c.rotateVertical(c.lonLat.height/3E6*og.math.RADIANS,og.math.Vector3.ZERO);c.update()};
og.control.KeyboardNavigation.prototype.onCameraLookDown=function(c){c=this.renderer.activeCamera;this.renderer.events.isKeyPressed(og.input.KEY_SHIFT)?c.pitch(-50*this.renderer.handler.delta):c.rotateVertical(-c.lonLat.height/3E6*og.math.RADIANS,og.math.Vector3.ZERO);c.update()};
og.control.KeyboardNavigation.prototype.onCameraTurnLeft=function(c){c=this.renderer.activeCamera;this.renderer.events.isKeyPressed(og.input.KEY_SHIFT)?c.yaw(50*this.renderer.handler.delta):c.rotateHorizontal(c.lonLat.height/3E6*og.math.RADIANS,!1,og.math.Vector3.ZERO);c.update()};
og.control.KeyboardNavigation.prototype.onCameraTurnRight=function(c){c=this.renderer.activeCamera;this.renderer.events.isKeyPressed(og.input.KEY_SHIFT)?c.yaw(-50*this.renderer.handler.delta):c.rotateHorizontal(-c.lonLat.height/3E6*og.math.RADIANS,!1,og.math.Vector3.ZERO);c.update()};og.control.KeyboardNavigation.prototype.onCameraRollLeft=function(c){this.renderer.activeCamera.roll(-50*this.renderer.handler.delta);this.renderer.activeCamera.update()};
og.control.KeyboardNavigation.prototype.onCameraRollRight=function(c){this.renderer.activeCamera.roll(50*this.renderer.handler.delta);this.renderer.activeCamera.update()};og.mercator={};og.mercator.POLE=2.003750834E7;og.mercator.forward_lon=function(c){return c*og.mercator.POLE/180};og.mercator.forward_lat=function(c){return Math.log(Math.tan((90+c)*Math.PI/360))/Math.PI*og.mercator.POLE};og.mercator.inverse_lon=function(c){return 180*c/og.mercator.POLE};og.mercator.inverse_lat=function(c){return 180/Math.PI*(2*Math.atan(Math.exp(c/og.mercator.POLE*Math.PI))-Math.PI/2)};og.mercator.getTileX=function(c,d){return Math.floor((c+180)/360*Math.pow(2,d))};
og.mercator.getTileY=function(c,d){return Math.floor((1-Math.log(Math.tan(c*Math.PI/180)+1/Math.cos(c*Math.PI/180))/Math.PI)/2*Math.pow(2,d))};og.mercator.forwardArray=function(c){for(var d=[],e=0;e<c.length;e++)d.push(c[e].forwardMercator());return d};og.mercator.MAX_LAT=og.mercator.inverse_lat(og.mercator.POLE);og.mercator.MIN_LAT=-og.mercator.MAX_LAT;og.LonLat=function(c,d,e){this.lon=c||0;this.lat=d||0;this.height=e||0};og.lonLat=function(c,d){return new og.LonLat(c,d)};og.LonLat.prototype.set=function(c,d,e){this.lon=c;this.lat=d;this.height=e;return this};og.LonLat.createFromArray=function(c){return new og.LonLat(c[0],c[1],c[2])};og.LonLat.prototype.clone=function(){return new og.LonLat(this.lon,this.lat,this.height)};
og.LonLat.forwardMercator=function(c,d){return new og.LonLat(c*og.mercator.POLE/180,Math.log(Math.tan((90+d)*Math.PI/360))/Math.PI*og.mercator.POLE)};og.LonLat.inverseMercator=function(c,d){return new og.LonLat(180*c/og.mercator.POLE,180/Math.PI*(2*Math.atan(Math.exp(d/og.mercator.POLE*Math.PI))-Math.PI/2))};og.LonLat.prototype.forwardMercator=function(){return og.LonLat.forwardMercator(this.lon,this.lat)};og.LonLat.prototype.inverseMercator=function(){return og.LonLat.inverseMercator(this.lon,this.lat)};
og.LonLat.prototype.equal=function(c){return c.height?this.lon==c.lon&&this.lat==c.lat&&this.height==c.height:this.lon==c.lon&&this.lat==c.lat};og.Extent=function(c,d){this.southWest=c||new og.LonLat;this.northEast=d||new og.LonLat};og.extent=function(c,d){return new og.Extent(c,d)};og.Extent.prototype.intersects=function(c){return this.southWest.lon<c.northEast.lon&&this.northEast.lon>c.southWest.lon&&this.southWest.lat<c.northEast.lat&&this.northEast.lat>c.southWest.lat};og.Extent.FULL_MERC=new og.Extent(og.LonLat.SW_MERC,og.LonLat.NE_MERC);og.Extent.NORTH_POLE_DEG=new og.Extent(og.LonLat.NW_MERC_DEG,new og.LonLat(180,90));
og.Extent.SOUTH_POLE_DEG=new og.Extent(new og.LonLat(-180,-90),og.LonLat.SE_MERC_DEG);og.Extent.createByCoordinates=function(c){for(var d=og.math.MAX,e=og.math.MIN,f=og.math.MAX,g=og.math.MIN,h=0;h<c.length;h++){var k=c[h];k.lon<d&&(d=k.lon);k.lon>e&&(e=k.lon);k.lat<f&&(f=k.lat);k.lat>g&&(g=k.lat)}return new og.Extent(new og.LonLat(d,f),new og.LonLat(e,g))};
og.Extent.prototype.setByCoordinates=function(c){for(var d=og.math.MAX,e=og.math.MIN,f=og.math.MAX,g=og.math.MIN,h=0;h<c.length;h++){var k=c[h];k.lon<d&&(d=k.lon);k.lon>e&&(e=k.lon);k.lat<f&&(f=k.lat);k.lat>g&&(g=k.lat)}this.southWest.lon=d;this.southWest.lat=f;this.northEast.lon=e;this.northEast.lat=g};og.Extent.createFromArray=function(c){return new og.Extent(new og.LonLat(c[0],c[1]),new og.LonLat(c[2],c[3]))};
og.Extent.prototype.isInside=function(c){var d=this.southWest,e=this.northEast;return c.lon>=d.lon&&c.lon<=e.lon&&c.lat>=d.lat&&c.lat<=e.lat};og.Extent.prototype.getWidth=function(){return this.northEast.lon-this.southWest.lon};og.Extent.prototype.getHeight=function(){return this.northEast.lat-this.southWest.lat};og.Extent.prototype.clone=function(){return new og.Extent(this.southWest.clone(),this.northEast.clone())};
og.Extent.prototype.getCenter=function(){var c=this.southWest,d=this.northEast;return new og.LonLat(c.lon+.5*(d.lon-c.lon),c.lat+.5*(d.lat-c.lat))};og.Extent.prototype.getNorthWest=function(){return new og.LonLat(this.southWest.lon,this.northEast.lat)};og.Extent.prototype.getNorthEast=function(){return new og.LonLat(this.northEast.lon,this.northEast.lat)};og.Extent.prototype.getSouthWest=function(){return new og.LonLat(this.southWest.lon,this.southWest.lat)};
og.Extent.prototype.getSouthEast=function(){return new og.LonLat(this.northEast.lon,this.southWest.lat)};og.Extent.prototype.getNorth=function(){return this.northEast.lat};og.Extent.prototype.getEast=function(){return this.northEast.lon};og.Extent.prototype.getWest=function(){return this.southWest.lon};og.Extent.prototype.getSouth=function(){return this.southWest.lat};
og.Extent.fromTile=function(c,d,e){var f=360/Math.pow(2,e);e=180/Math.pow(2,e);c=-180+c*f;d=90-d*e;f=c+f;return new og.Extent(new og.LonLat(c,d-e),new og.LonLat(f,d))};og.Extent.prototype.equals=function(c){return this.southWest.lon==c.southWest.lon&&this.southWest.lat==c.southWest.lat&&this.northEast.lon==c.northEast.lon&&this.northEast.lat==c.northEast.lat};og.Extent.prototype.forwardMercator=function(){return new og.Extent(this.southWest.forwardMercator(),this.northEast.forwardMercator())};og.bv={};og.bv.Sphere=function(c,d){this.radius=c||0;this.center=d?d.clone():new og.math.Vector3};og.bv.Sphere.prototype.setFromBounds=function(c){this.center.set(c[0]+(c[1]-c[0])/2,c[2]+(c[3]-c[2])/2,c[4]+(c[5]-c[4])/2);this.radius=this.center.distance(new og.math.Vector3(c[0],c[2],c[4]))};og.math.Matrix3=function(){this._m=Array(9)};og.math.Matrix3.prototype.set=function(c){this._m[0]=c[0];this._m[1]=c[1];this._m[2]=c[2];this._m[3]=c[3];this._m[4]=c[4];this._m[5]=c[5];this._m[6]=c[6];this._m[7]=c[7];this._m[8]=c[8];return this};og.math.Matrix3.prototype.clone=function(){var c=new og.math.Matrix3;c.set(this);return c};og.math.Matrix3.prototype.copy=function(c){this.set(c._m)};
og.math.Matrix3.prototype.transpose=function(){var c=new og.math.Matrix3,d=this._m;c._m[0]=d[0];c._m[1]=d[3];c._m[2]=d[6];c._m[3]=d[1];c._m[4]=d[4];c._m[5]=d[7];c._m[6]=d[2];c._m[7]=d[5];c._m[8]=d[8];return c};og.math.Matrix3.prototype.setIdentity=function(){this._m[0]=1;this._m[1]=0;this._m[2]=0;this._m[3]=0;this._m[4]=1;this._m[5]=0;this._m[6]=0;this._m[7]=0;this._m[8]=1;return this};og.math.Matrix4=function(){this._m=Array(16)};og.math.Matrix4.prototype.set=function(c){this._m[0]=c[0];this._m[1]=c[1];this._m[2]=c[2];this._m[3]=c[3];this._m[4]=c[4];this._m[5]=c[5];this._m[6]=c[6];this._m[7]=c[7];this._m[8]=c[8];this._m[9]=c[9];this._m[10]=c[10];this._m[11]=c[11];this._m[12]=c[12];this._m[13]=c[13];this._m[14]=c[14];this._m[15]=c[15];return this};og.math.Matrix4.prototype.clone=function(){var c=new og.math.Matrix4;c.set(this);return c};og.math.Matrix4.prototype.copy=function(c){this.set(c._m)};
og.math.Matrix4.prototype.mulVec3=function(c){var d=c.x,e=c.y;c=c.z;return new og.math.Vector3(this._m[0]*d+this._m[4]*e+this._m[8]*c+this._m[12],this._m[1]*d+this._m[5]*e+this._m[9]*c+this._m[13],this._m[2]*d+this._m[6]*e+this._m[10]*c+this._m[14])};
og.math.Matrix4.prototype.mulVec4=function(c){var d=c.x,e=c.y,f=c.z;c=c.w;return new og.math.Vector4(this._m[0]*d+this._m[4]*e+this._m[8]*f+this._m[12]*c,this._m[1]*d+this._m[5]*e+this._m[9]*f+this._m[13]*c,this._m[2]*d+this._m[6]*e+this._m[10]*f+this._m[14]*c,this._m[3]*d+this._m[7]*e+this._m[11]*f+this._m[15]*c)};
og.math.Matrix4.prototype.toInverseMatrix3=function(){var c=this._m,d=c[0],e=c[1],f=c[2],g=c[4],h=c[5],k=c[6],m=c[8],l=c[9],c=c[10],n=c*h-k*l,p=-c*g+k*m,q=l*g-h*m,r=d*n+e*p+f*q;if(!r)return null;var r=1/r,t=new og.math.Matrix3;t._m[0]=n*r;t._m[1]=(-c*e+f*l)*r;t._m[2]=(k*e-f*h)*r;t._m[3]=p*r;t._m[4]=(c*d-f*m)*r;t._m[5]=(-k*d+f*g)*r;t._m[6]=q*r;t._m[7]=(-l*d+e*m)*r;t._m[8]=(h*d-e*g)*r;return t};
og.math.Matrix4.prototype.inverse=function(){var c=this._m[0],d=this._m[1],e=this._m[2],f=this._m[3],g=this._m[4],h=this._m[5],k=this._m[6],m=this._m[7],l=this._m[8],n=this._m[9],p=this._m[10],q=this._m[11],r=this._m[12],t=this._m[13],v=this._m[14],E=this._m[15],u=c*h-d*g,D=c*k-e*g,F=c*m-f*g,I=d*k-e*h,J=d*m-f*h,B=e*m-f*k,A=l*t-n*r,C=l*v-p*r,H=l*E-q*r,G=n*v-p*t,L=n*E-q*t,K=p*E-q*v,N=1/(u*K-D*L+F*G+I*H-J*C+B*A),M=new og.math.Matrix4;M._m[0]=(h*K-k*L+m*G)*N;M._m[1]=(-d*K+e*L-f*G)*N;M._m[2]=(t*B-v*J+
E*I)*N;M._m[3]=(-n*B+p*J-q*I)*N;M._m[4]=(-g*K+k*H-m*C)*N;M._m[5]=(c*K-e*H+f*C)*N;M._m[6]=(-r*B+v*F-E*D)*N;M._m[7]=(l*B-p*F+q*D)*N;M._m[8]=(g*L-h*H+m*A)*N;M._m[9]=(-c*L+d*H-f*A)*N;M._m[10]=(r*J-t*F+E*u)*N;M._m[11]=(-l*J+n*F-q*u)*N;M._m[12]=(-g*G+h*C-k*A)*N;M._m[13]=(c*G-d*C+e*A)*N;M._m[14]=(-r*I+t*D-v*u)*N;M._m[15]=(l*I-n*D+p*u)*N;return M};
og.math.Matrix4.prototype.transpose=function(){var c=new og.math.Matrix4;c._m[0]=this._m[0];c._m[1]=this._m[4];c._m[2]=this._m[8];c._m[3]=this._m[12];c._m[4]=this._m[1];c._m[5]=this._m[5];c._m[6]=this._m[9];c._m[7]=this._m[13];c._m[8]=this._m[2];c._m[9]=this._m[6];c._m[10]=this._m[10];c._m[11]=this._m[14];c._m[12]=this._m[3];c._m[13]=this._m[7];c._m[14]=this._m[11];c._m[15]=this._m[15];return c};
og.math.Matrix4.prototype.setIdentity=function(){this._m[0]=1;this._m[1]=0;this._m[2]=0;this._m[3]=0;this._m[4]=0;this._m[5]=1;this._m[6]=0;this._m[7]=0;this._m[8]=0;this._m[9]=0;this._m[10]=1;this._m[11]=0;this._m[12]=0;this._m[13]=0;this._m[14]=0;this._m[15]=1;return this};
og.math.Matrix4.identity=function(){var c=new og.math.Matrix4;c._m[0]=1;c._m[1]=0;c._m[2]=0;c._m[3]=0;c._m[4]=0;c._m[5]=1;c._m[6]=0;c._m[7]=0;c._m[8]=0;c._m[9]=0;c._m[10]=1;c._m[11]=0;c._m[12]=0;c._m[13]=0;c._m[14]=0;c._m[15]=1;return c};
og.math.Matrix4.prototype.mul=function(c){var d=this._m[0],e=this._m[1],f=this._m[2],g=this._m[3],h=this._m[4],k=this._m[5],m=this._m[6],l=this._m[7],n=this._m[8],p=this._m[9],q=this._m[10],r=this._m[11],t=this._m[12],v=this._m[13],E=this._m[14];a=this._m[15];var u=c._m[0],D=c._m[1],F=c._m[2],I=c._m[3],J=c._m[4],B=c._m[5],A=c._m[6],C=c._m[7],H=c._m[8],G=c._m[9],L=c._m[10],K=c._m[11],N=c._m[12],M=c._m[13],O=c._m[14];b=c._m[15];c=new og.math.Matrix4;c._m[0]=u*d+D*h+F*n+I*t;c._m[1]=u*e+D*k+F*p+I*v;c._m[2]=
u*f+D*m+F*q+I*E;c._m[3]=u*g+D*l+F*r+I*a;c._m[4]=J*d+B*h+A*n+C*t;c._m[5]=J*e+B*k+A*p+C*v;c._m[6]=J*f+B*m+A*q+C*E;c._m[7]=J*g+B*l+A*r+C*a;c._m[8]=H*d+G*h+L*n+K*t;c._m[9]=H*e+G*k+L*p+K*v;c._m[10]=H*f+G*m+L*q+K*E;c._m[11]=H*g+G*l+L*r+K*a;c._m[12]=N*d+M*h+O*n+b*t;c._m[13]=N*e+M*k+O*p+b*v;c._m[14]=N*f+M*m+O*q+b*E;c._m[15]=N*g+M*l+O*r+b*a;return c};
og.math.Matrix4.prototype.translate=function(c){var d=c.x,e=c.y;c=c.z;var f=this._m;f[12]=f[0]*d+f[4]*e+f[8]*c+f[12];f[13]=f[1]*d+f[5]*e+f[9]*c+f[13];f[14]=f[2]*d+f[6]*e+f[10]*c+f[14];f[15]=f[3]*d+f[7]*e+f[11]*c+f[15];return this};og.math.Matrix4.prototype.translateToPosition=function(c){var d=this._m;d[12]=c.x;d[13]=c.y;d[14]=c.z;return this};
og.math.Matrix4.prototype.rotate=function(c,d){var e=Math.cos(d),f=Math.sin(d),g=this._m;g[0]=e+(1-e)*c.x*c.x;g[1]=(1-e)*c.y*c.x-f*c.z;g[2]=(1-e)*c.z*c.x+f*c.y;g[3]=0;g[4]=(1-e)*c.x*c.y+f*c.z;g[5]=e+(1-e)*c.y*c.y;g[6]=(1-e)*c.z*c.y-f*c.x;g[7]=0;g[8]=(1-e)*c.x*c.z-f*c.y;g[9]=(1-e)*c.y*c.z+f*c.x;g[10]=e+(1-e)*c.z*c.z;g[11]=0;g[12]=0;g[13]=0;g[14]=0;g[15]=1;return this};og.math.Matrix4.prototype.rotateBetweenVectors=function(c,d){return og.math.Quaternion.getRotationBetweenVectors(c,d).getMatrix4()};
og.math.Matrix4.prototype.scale=function(c){var d=this._m;d[0]*=c.x;d[1]*=c.x;d[2]*=c.x;d[3]*=c.x;d[4]*=c.y;d[5]*=c.y;d[6]*=c.y;d[7]*=c.y;d[8]*=c.z;d[9]*=c.z;d[10]*=c.z;d[11]*=c.z;d[12]=d[12];d[13]=d[13];d[14]=d[14];d[15]=d[15];return this};
og.math.Matrix4.prototype.setFrustum=function(c,d,e,f,g,h){this.left=c;this.right=d;this.bottom=e;this.top=f;this.near=g;this.far=h;var k=d-c,m=f-e,l=h-g;this._m[0]=2*g/k;this._m[1]=0;this._m[2]=0;this._m[3]=0;this._m[4]=0;this._m[5]=2*g/m;this._m[6]=0;this._m[7]=0;this._m[8]=(d+c)/k;this._m[9]=(f+e)/m;this._m[10]=-(h+g)/l;this._m[11]=-1;this._m[12]=0;this._m[13]=0;this._m[14]=-(h*g*2)/l;this._m[15]=0;return this};
og.math.Matrix4.prototype.setPerspective=function(c,d,e,f){c=e*Math.tan(c*Math.PI/360);d*=c;return this.setFrustum(-d,d,-c,c,e,f)};og.math.Matrix4.prototype.setOrtho=function(c,d,e,f,g,h){var k=1/(c-d),m=1/(e-f),l=1/(g-h),n=this._m;n[0]=-2*k;n[1]=0;n[2]=0;n[3]=0;n[4]=0;n[5]=-2*m;n[6]=0;n[7]=0;n[8]=0;n[9]=0;n[10]=2*l;n[11]=0;n[12]=(c+d)*k;n[13]=(f+e)*m;n[14]=(h+g)*l;n[15]=1;return this};
og.math.Matrix4.prototype.eulerToMatrix=function(c,d,e){var f=Math.cos(c);c=Math.sin(c);var g=Math.cos(d);d=Math.sin(d);var h=Math.cos(e);e=Math.sin(e);var k=f*d,m=c*d,l=this._m;l[0]=g*h;l[1]=-g*e;l[2]=-d;l[4]=-m*h+f*e;l[5]=m*e+f*h;l[6]=-c*g;l[8]=k*h+c*e;l[9]=-k*e+c*h;l[10]=f*g;l[3]=l[7]=l[11]=l[12]=l[13]=l[14]=0;l[15]=1};og.math.Matrix4.prototype.getEulerAngles=function(){};og.math.Pixel=function(c,d){this.x=c||0;this.y=d||0};og.math.Ray=function(c,d){this.origin=c.clone();this.direction=d.clone().normalize()};og.math.Ray.prototype.set=function(c,d){this.origin=c.clone();this.direction=d.clone()};og.math.Ray.prototype.getPoint=function(c){return og.Vector3.add(this.origin,this.direction.scaleTo(c))};og.math.Ray.OUTSIDE=0;og.math.Ray.INSIDE=1;og.math.Ray.INPLANE=2;og.math.Ray.AWAY=3;
og.math.Ray.prototype.hitTriangle=function(c,d,e,f){d=og.math.Vector3.sub(d,c);e=og.math.Vector3.sub(e,c);var g=d.cross(e),h=og.math.Vector3.sub(this.origin,c),h=-g.dot(h),g=g.dot(this.direction);if(Math.abs(g)<og.math.EPSILON10)return 0==h?(f.copy(this.origin),og.math.Ray.INPLANE):og.math.Ray.OUTSIDE;g=h/g;f.copy(og.math.Vector3.add(this.origin,this.direction.scaleTo(g)));if(0>g)return og.math.Ray.AWAY;var g=d.dot(d),h=d.dot(e),k=e.dot(e);f=og.math.Vector3.sub(f,c);c=f.dot(d);f=f.dot(e);d=h*h-g*
k;e=(h*f-k*c)/d;if(0>e||1<e)return og.math.Ray.OUTSIDE;c=(h*c-g*f)/d;return 0>c||1<e+c?og.math.Ray.OUTSIDE:og.math.Ray.INSIDE};og.math.Ray.prototype.hitPlane=function(c,d){};
og.math.Ray.prototype.hitSphere=function(c){var d=c.radius,e=c.center,f=this.origin,g=this.direction,h=og.math.Vector3.sub(e,f);if(0>h.dot(g)){var k=h.length();if(k>d)return null;if(k===d)return f.clone();k=e.projToRay(f,h);h=og.math.Vector3.sub(k,e).length();c=Math.sqrt(d*d-h*h);d=c-og.math.Vector3.sub(k,f).length();return f=og.math.Vector3.add(f,g.scaleTo(d))}k=e.projToRay(f,g);e=og.math.Vector3.sub(e,k).length();if(e>c.radius)return null;c=Math.sqrt(d*d-e*e);k.sub(f);d=h.length()>d?k.length()-
c:k.length()+c;return f=og.math.Vector3.add(f,g.scaleTo(d))};og.math.Ray.prototype.hitBox=function(c){};og.math.Quaternion=function(c,d,e,f){this.x=c||0;this.y=d||0;this.z=e||0;this.w=f||0};og.math.Quaternion.IDENTITY=new og.math.Quaternion(0,0,0,1);og.math.Quaternion.prototype.clear=function(){this.x=this.y=this.z=this.w=0;return this};og.math.Quaternion.prototype.set=function(c,d,e,f){this.x=c;this.y=d;this.z=e;this.w=f;return this};og.math.Quaternion.prototype.copy=function(c){this.x=c.x;this.y=c.y;this.z=c.z;this.w=c.w;return this};
og.math.Quaternion.prototype.clone=function(){return new og.math.Quaternion(this.x,this.y,this.z,this.w)};og.math.Quaternion.prototype.add=function(c){return new og.math.Quaternion(this.x+c.x,this.y+c.y,this.z+c.z,this.w+c.w)};og.math.Quaternion.prototype.sub=function(c){return new og.math.Quaternion(this.x-c.x,this.y-c.y,this.z-c.z,this.w-c.w)};og.math.Quaternion.prototype.mulScal=function(c){return new og.math.Quaternion(this.x*c,this.y*c,this.z*c,this.w*c)};
og.math.Quaternion.prototype.toVec=function(){var c=new og.math.GLArray(4);c[0]=this.x;c[1]=this.y;c[2]=this.z;c[3]=this.w;return c};og.math.Quaternion.prototype.setFromSphericalCoords=function(c,d,e){var f=Math.sin(e/2);e=Math.cos(e/2);var g=Math.sin(c),h=Math.cos(d);this.x=f*Math.cos(c)*Math.sin(d);this.y=f*g;this.z=f*g*h;this.w=e;return this};
og.math.Quaternion.prototype.toSphericalCoords=function(){var c=this.w,d=Math.sqrt(1-c*c);5E-4>Math.abs(d)&&(d=1);var c=this.x/d,e=this.z/d,d=-Math.asin(this.y/d),c=5E-4>c*c+e*e?0:Math.atan2(c,e);0>c&&(c+=360);return{lat:d,lon:c}};og.math.Quaternion.axisAngleToQuat=function(c,d){var e=new og.math.Quaternion,f=c.normal(),g=.5*d,h=Math.sin(g);e.set(f.x*h,f.y*h,f.z*h,Math.cos(g));return e};
og.math.Quaternion.prototype.setFromAxisAngle=function(c,d){var e=c.normal(),f=.5*d,g=Math.sin(f);this.set(e.x*g,e.y*g,e.z*g,Math.cos(f));return this};og.math.Quaternion.prototype.getAxisAngle=function(){var c=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z),d;1E-7<c?(d=1/c,d=new og.math.Vector3(x*d,y*d,z*d),c=0>this.w?2*Math.atan2(-c,-w):2*Math.atan2(c,w)):(d=new og.math.Vector3(0,0,0),c=0);return{axis:d,angle:c}};
og.math.Quaternion.prototype.setFromEulerAngles=function(c,d,e){var f,g,h,k,m;f=x*og.Math.RADIANS/2;g=y*og.Math.RADIANS/2;h=z*og.Math.RADIANS/2;c=Math.cos(f);d=Math.cos(g);e=Math.cos(h);f=Math.sin(f);g=Math.sin(g);h=Math.sin(h);k=d*e;m=g*h;this.w=c*k+f*m;this.x=f*k-c*m;this.y=c*g*e+f*d*h;this.z=c*d*h-f*g*e;return this.normalize()};og.math.Quaternion.prototype.getEulerAngles=function(){return this.getMatrix4().getEulerAngles()};
og.math.Quaternion.prototype.setFromMatrix4=function(c){var d,e,f=[],g,h;c=c._m;e=[1,2,0];d=c[0]+c[5]+c[10];0<d?(e=Math.sqrt(d+1),this.w=e/2,e=.5/e,this.x=(c[6]-c[9])*e,this.y=(c[8]-c[2])*e,this.z=(c[1]-c[4])*e):(d=0,c[5]>c[0]&&(d=1),c[10]>c[5*d]&&(d=2),g=e[d],h=e[g],e=Math.sqrt(c[5*d]-(c[5*g]+c[5*h])+1),f[d]=.5*e,0!=e&&(e=.5/e),f[3]=(c[4*g+h]-c[4*h+g])*e,f[g]=(c[4*d+g]+c[4*g+d])*e,f[h]=(c[4*d+h]+c[4*h+d])*e,this.x=f[0],this.y=f[1],this.z=f[2],this.w=f[3]);return this};
og.math.Quaternion.prototype.getMatrix4=function(){var c=new og.math.Matrix4,d=c._m,e=this.x,f=this.y,g=this.z,h=this.w,k=e+e,m=f+f,l=g+g,n=e*k,p=e*m,e=e*l,q=f*m,f=f*l,g=g*l,k=h*k,m=h*m,h=h*l;d[0]=1-(q+g);d[1]=p-h;d[2]=e+m;d[3]=0;d[4]=p+h;d[5]=1-(n+g);d[6]=f-k;d[7]=0;d[8]=e-m;d[9]=f+k;d[10]=1-(n+q);d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return c};
og.math.Quaternion.prototype.mulVec3=function(c){var d=c.x,e=c.y;c=c.z;var f=this.x,g=this.y,h=this.z,k=this.w,m=k*d+g*c-h*e,l=k*e+h*d-f*c,n=k*c+f*e-g*d,d=-f*d-g*e-h*c;return new og.math.Vector3(m*k+d*-f+l*-h-n*-g,l*k+d*-g+n*-f-m*-h,n*k+d*-h+m*-g-l*-f)};og.math.Quaternion.prototype.mul=function(c){var d=this.x,e=this.y,f=this.z,g=this.w,h=c.x,k=c.y,m=c.z;c=c.w;return new og.math.Quaternion(d*c+g*h+e*m-f*k,e*c+g*k+f*h-d*m,f*c+g*m+d*k-e*h,g*c-d*h-e*k-f*m)};
og.math.Quaternion.prototype.conjugate=function(){return new og.math.Quaternion(-this.x,-this.y,-this.z,this.w)};og.math.Quaternion.prototype.inverse=function(){var c=1/this.norm2();return new og.math.Quaternion(-this.x*c,-this.y*c,-this.z*c,this.w*c)};og.math.Quaternion.prototype.norm=function(){var c=this.x,d=this.y,e=this.z,f=this.w;return Math.sqrt(c*c+d*d+e*e+f*f)};og.math.Quaternion.prototype.norm2=function(){var c=this.x,d=this.y,e=this.z,f=this.w;return c*c+d*d+e*e+f*f};
og.math.Quaternion.prototype.dot=function(c){return this.x*c.x+this.y*c.y+this.z*c.z};og.math.Quaternion.prototype.normalize=function(){var c=this.x,d=this.y,e=this.z,f=this.w,g=Math.sqrt(c*c+d*d+e*e+f*f);if(0==g)return this.w=this.z=this.y=this.x=0,this;g=1/g;this.x=c*g;this.y=d*g;this.z=e*g;this.w=f*g;return this};og.math.Quaternion.prototype.isEqual=function(c){c=this.dot(c);return.001>Math.abs(c-1)?!0:!1};
og.math.Quaternion.prototype.slerp=function(c,d){var e=this.x,f=this.y,g=this.z,h=this.w,k=c.x,m=c.y,l=c.z,n=c.w,p,q,r;q=e*k+f*m+g*l+h*n;0>q&&(q=-q,k=-k,m=-m,l=-l,n=-n);1E-6<1-q?(p=Math.acos(q),r=Math.sin(p),q=Math.sin((1-d)*p)/r,p=Math.sin(d*p)/r):(q=1-d,p=d);return new og.math.Quaternion(q*e+p*k,q*f+p*m,q*g+p*l,q*h+p*n)};
og.math.Quaternion.getLookAtTargetUp=function(c,d){var e=c.normal(),e=og.math.Vector3.OrthoNormalize(d,e),f=d.cross(e),g=new og.math.Quaternion;g.w=.5*Math.sqrt(1+f.x+d.y+e.z);var h=1/(4*g.w);g.x=(e.y-d.z)*h;g.y=(f.z-e.x)*h;g.z=(d.x-f.y)*h;return g};
og.math.Quaternion.getLookAtSourceDest=function(c,d){var e=d.sub(c).normalize(),f=og.math.Vector3.FORWARD.dot(e);if(1E-6>Math.abs(f- -1))return og.math.Quaternion.axisAngleToQuat(og.math.Vector3.UP,Math.PI);if(1E-6>Math.abs(f-1))return new og.math.Quaternion(0,0,0,1);f=Math.acos(f);e=og.math.Vector3.FORWARD.cross(e).normalize();return og.math.Quaternion.axisAngleToQuat(e,f)};og.math.Quaternion.getRotationBetweenVectors=function(c,d){var e=c.cross(d);return(new og.math.Quaternion(e.x,e.y,e.z,1+c.dot(d))).normalize()};
og.math.Quaternion.prototype.getRoll=function(c){var d=this.x,e=this.y,f=this.z,g=this.w;if(c){c=2*e;var h=2*f;return Math.atan2(c*d+h*g,1-(c*e+h*f))}return Math.atan2(2*(d*e+g*f),g*g+d*d-e*e-f*f)};og.math.Quaternion.prototype.getPitch=function(c){var d=this.x,e=this.y,f=this.z,g=this.w;if(c){c=2*d;var h=2*f;return Math.atan2(h*e+c*g,1-(c*d+h*f))}return Math.atan2(2*(e*f+g*d),g*g-d*d-e*e+f*f)};
og.math.Quaternion.prototype.getYaw=function(c){var d=this.x,e=this.y,f=this.z,g=this.w;return c?(c=2*e,Math.atan2(2*f*d+c*g,1-(2*d*d+c*e))):Math.asin(-2*(d*f-g*e))};og.control.TouchNavigation=function(c){og.inheritance.base(this,c);this.grabbedPoint=new og.math.Vector3;this.pointOnEarth=new og.math.Vector3;this.earthUp=new og.math.Vector3;this.inertia=.007;this.grabbedSpheroid=new og.bv.Sphere;this.planet=null;this.qRot=new og.math.Quaternion;this.scaleRot=0;this.distDiff=.33;this.stepsCount=5;this.stepsForward=null;this.stepIndex=0};og.inheritance.extend(og.control.TouchNavigation,og.control.Control);
og.control.TouchNavigation.prototype.init=function(){this.planet=this.renderer.renderNodes.Earth;this.renderer.events.on("ontouchstart",this,this.onTouchStart);this.renderer.events.on("ontouchend",this,this.onTouchEnd);this.renderer.events.on("ontouchcancel",this,this.onTouchCancel);this.renderer.events.on("ontouchmove",this,this.onTouchMove);this.renderer.events.on("ondraw",this,this.onDraw)};
og.control.TouchNavigation.prototype.onTouchStart=function(c){c.sys.touches.item(0)&&(c=new og.math.Pixel(c.sys.touches.item(0).pageX,c.sys.touches.item(0).pageY),this.grabbedPoint=this.planet.getCartesianFromPixelTerrain(c))&&(this.grabbedSpheroid.radius=this.grabbedPoint.length(),this.stopRotation())};og.control.TouchNavigation.prototype.stopRotation=function(){this.qRot.clear()};og.control.TouchNavigation.prototype.onTouchEnd=function(c){this.scaleRot=1};
og.control.TouchNavigation.prototype.onTouchCancel=function(c){};
og.control.TouchNavigation.prototype.onTouchMove=function(c){if(c.sys.touches.item(0)&&this.grabbedPoint){this.planet.stopFlying();var d=this.renderer.activeCamera;c=d.unproject(c.sys.touches.item(0).pageX,c.sys.touches.item(0).pageY);if(c=(new og.math.Ray(d.eye,c)).hitSphere(this.grabbedSpheroid))this.scaleRot=1,c=this.qRot=og.math.Quaternion.getRotationBetweenVectors(c.normal(),this.grabbedPoint.normal()),d.eye=c.mulVec3(d.eye),d.v=c.mulVec3(d.v),d.u=c.mulVec3(d.u),d.n=c.mulVec3(d.n),d.update();
this.scaleRot=0}};
og.control.TouchNavigation.prototype.onDraw=function(c){if(this.stepIndex){var d=this.stepsForward[this.stepsCount-this.stepIndex--];c=this.renderer.activeCamera;c.eye=d.eye;c.v=d.v;c.u=d.u;c.n=d.n;c.update()}c=this.renderer;c.controlsBag.scaleRot=this.scaleRot;!c.events.mouseState.leftButtonDown&&this.scaleRot&&(this.scaleRot-=this.inertia,0>=this.scaleRot?this.scaleRot=0:(c=c.activeCamera,d=this.qRot.slerp(og.math.Quaternion.IDENTITY,1-this.scaleRot*this.scaleRot*this.scaleRot).normalize(),d.x||
d.y||d.z||(this.scaleRot=0),c.eye=d.mulVec3(c.eye),c.v=d.mulVec3(c.v),c.u=d.mulVec3(c.u),c.n=d.mulVec3(c.n),c.update()))};og.math.Vector2=function(c,d){this.x=c||0;this.y=d||0};og.math.Vector2.prototype.toVector3=function(){return new og.math.Vector3(this.x,this.y,0)};og.math.Vector2.UP=new og.math.Vector2(0,1);og.math.Vector2.DOWN=new og.math.Vector2(0,-1);og.math.Vector2.RIGHT=new og.math.Vector2(1,0);og.math.Vector2.LEFT=new og.math.Vector2(-1,0);og.math.Vector2.ZERO=new og.math.Vector2;og.math.Vector2.prototype.clone=function(){return new og.math.Vector2(this.x,this.y)};
og.math.Vector2.add=function(c,d){var e=new og.math.Vector2(c.x,c.y);e.add(d);return e};og.math.Vector2.sub=function(c,d){var e=new og.math.Vector2(c.x,c.y);e.sub(d);return e};og.math.Vector2.scale=function(c,d){var e=new og.math.Vector2(c.x,c.y);e.scale(d);return e};og.math.Vector2.mull=function(c,d){var e=new og.math.Vector2(c.x,c.y);e.mull(d);return e};og.math.Vector2.div=function(c,d){var e=new og.math.Vector2(c.x,c.y);e.div(d);return e};
og.math.Vector2.prototype.equal=function(c){return this.x===c.x&&this.y===c.y};og.math.Vector2.prototype.copy=function(c){this.x=c.x;this.y=c.y;return this};og.math.Vector2.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};og.math.Vector2.prototype.length2=function(){return this.x*this.x+this.y*this.y};og.math.Vector2.prototype.add=function(c){this.x+=c.x;this.y+=c.y;return this};og.math.Vector2.prototype.sub=function(c){this.x-=c.x;this.y-=c.y;return this};
og.math.Vector2.prototype.scale=function(c){this.x*=c;this.y*=c;return this};og.math.Vector2.prototype.scaleTo=function(c){return new og.math.Vector2(this.x*c,this.y*c)};og.math.Vector2.prototype.mull=function(c){this.x*=c.x;this.y*=c.y;return this};og.math.Vector2.prototype.div=function(c){this.x/=c.x;this.y/=c.y;return this};og.math.Vector2.prototype.dot=function(c){return c.x*this.x+c.y*this.y+c.z*this.z};og.math.Vector2.prototype.dotArr=function(c){return c[0]*this.x+c[1]*this.y};
og.math.Vector2.prototype.cross=function(c){return this.x*c.y-this.y*c.x};og.math.Vector2.prototype.clear=function(){this.x=this.y=0;return this};og.math.Vector2.prototype.normal=function(){var c=new og.math.Vector2;c.copy(this);var d=1/c.length();c.x*=d;c.y*=d;return c};og.math.Vector2.prototype.normalize=function(){var c=1/this.length();this.x*=c;this.y*=c;return this};og.math.Vector2.prototype.toVec=function(){var c=new og.math.GLArray(2);c[0]=this.x;c[1]=this.y;return c};
og.math.Vector2.prototype.distance=function(c){return og.math.Vector2.sub(this,c).length()};og.math.Vector2.prototype.set=function(c,d){this.x=c;this.y=d;return this};og.math.Vector2.prototype.negate=function(){this.x=-this.x;this.y=-this.y;return this};og.math.Vector2.prototype.getNegate=function(){return new og.math.Vector2(-this.x,-this.y)};og.math.Vector2.proj_b_to_a=function(c,d){return d.scaleTo(d.dot(c)/d.dot(d))};
og.math.Vector2.prototype.projToRay=function(c,d){var e=og.math.Vector2.proj_b_to_a(og.math.Vector2.sub(this,c),d);e.add(c);return e};og.math.Vector2.prototype.angle=function(c){return og.math.Vector2.angle(this,c)};og.math.Vector2.angle=function(c,d){return Math.acos(c.dot(d)/Math.sqrt(c.length2()*d.length2()))};og.math.Vector2.prototype.lerp=function(c,d,e){var f=og.math.Vector2.clone(this);0>=e?f.copy(c):1<=e?f.copy(d):f=og.math.Vector2.add(c,og.math.Vector2.sub(d,c).scale(e));return f};
og.math.Vector2.LERP_DELTA=1E-6;og.math.Vector2.prototype.slerp=function(c,d,e){var f=new og.math.Vector2;if(0>=e)f.copy(c);else if(1<=e)f.copy(d);else{var g,h,f=c.dot(d);1-f>Vector2.LERP_DELTA?(g=Math.acos(f),h=Math.sin(g),f=Math.sin((1-e)*g)/h,e=Math.sin(e*g)/h):f=1-e;return og.math.Vector2.add(c.scale(f),d.scale(e))}};og.math.Vector2.orthoNormalize=function(c,d){c=c.normal();c.scale(d.dot(c));return d.sub(c).normalize()};og.Billboard=function(c){og.inheritance.base(this,c);this.image=this.src=null;this.height=this.width=0};og.inheritance.extend(og.Billboard,og.BaseBillboard);og.Billboard.prototype.setSrc=function(c){this.src=c;var d=this._handler;if(d&&c){var e=d._entityCollection.renderNode;if(e){var f=e.billboardsTextureAtlas,g=this;f.loadImage(c,function(c){f.nodes[c.__nodeIndex]?(g.image=c,d.setTexCoordArr(g._handlerIndex,f.nodes[g.image.__nodeIndex].texCoords)):(f.addImage(c),f.createTexture(),g.image=c,e.updateBillboardsTexCoords())})}}};
og.Billboard.prototype.setSize=function(c,d){this.width=c;this.height=d;this._handler&&this._handler.setSizeArr(this._handlerIndex,c,d)};og.Billboard.prototype.setWidth=function(c){this.setSize(c,this.height)};og.Billboard.prototype.setHeight=function(c){this.setSize(this.width,c)};og.Entity=function(c){c=c||{};this.position=new og.math.Vector3;this.visibility=!0;this.id=c.id||"noname_"+og.Entity.__staticCounter++;this.label=this.billboard=null;this.childrenNodes=[];this._entityCollection=this.parent=null;this._entityCollectionIndex=-1};og.Entity.__staticCounter=0;og.Entity.prototype.addTo=function(c){c.add(this)};og.Entity.prototype.remove=function(){this._entityCollection&&this._entityCollection.removeEntity(this)};
og.Entity.prototype.setVisibility=function(c){this.visibility=c;this.billboard&&this.billboard.setVisibility(c);this.label&&this.label.setVisibility(c);for(var d=0;d<this.childrenNodes.length;d++)this.childrenNodes[d].setVisibility(c)};og.Entity.prototype.setPosition3v=function(c){this.setPosition(c.x,c.y,c.z)};og.Entity.prototype.setPosition=function(c,d,e){var f=this.position;f.x=c;f.y=d;f.z=e;this.billboard&&this.billboard.setPosition3v(f);this.label&&this.label.setPosition3v(f);for(c=0;c<this.childrenNodes.length;c++)this.childrenNodes[c].setPosition3v(f)};
og.Entity.prototype.setBillboard=function(c){this.billboard&&this.billboard.remove();this.billboard=c;this.billboard.setPosition3v(this.position);this.billboard.setVisibility(this.visbility);this._entityCollection&&this._entityCollection._billboardHandler.add(c)};og.Entity.prototype.setLabel=function(c){this.label&&this.label.remove();this.label=c;this.label.setPosition3v(this.position);this.label.setVisibility(this.visbility);this._entityCollection&&this._entityCollection._labelHandler.add(c)};
og.Entity.prototype.appendChild=function(c){c._entityCollection=this._entityCollection;c.parent=this;this.childrenNodes.push(c);this._entityCollection&&this._entityCollection._addRecursively(c)};og.webgl={};og.webgl.vendorPrefixes=["","WEBKIT_","MOZ_"];og.webgl.RESOURCES_URL=COMPILED?"/resources/":"../../resources/";og.webgl.getExtension=function(c,d){var e,f;for(e in og.webgl.vendorPrefixes)if(f=c.getExtension(og.webgl.vendorPrefixes[e]+d))return f;return null};
og.webgl.initWebGLContext=function(c,d){var e;try{e=c.getContext("experimental-webgl",d),e.canvas=c,c.aspect=c.width/c.height}catch(f){alert("Exception during the GL context initialization")}e||alert("Could not initialise WebGL");return e};og.control.ToggleWireframe=function(c){og.inheritance.base(this,c)};og.inheritance.extend(og.control.ToggleWireframe,og.control.Control);og.control.ToggleWireframe.prototype.init=function(){this.renderer.events.on("oncharkeypressed",this,this.toogleWireframe,og.input.KEY_X)};
og.control.ToggleWireframe.prototype.toogleWireframe=function(c){this.renderer.renderNodes.Earth.drawMode===this.renderer.handler.gl.LINE_STRIP?this.renderer.renderNodes.Earth.setDrawMode(this.renderer.handler.gl.TRIANGLE_STRIP):this.renderer.renderNodes.Earth.setDrawMode(this.renderer.handler.gl.LINE_STRIP)};og.layer.WMS=function(c,d){og.inheritance.base(this,c,d);this.layers=d.layers};og.inheritance.extend(og.layer.WMS,og.layer.XYZ);og.layer.WMS.prototype.handleSegmentTile=function(c){og.layer.requestsCounter>=og.layer.MAX_REQUESTS&&this.counter?this.pendingsQueue.push(c):this.loadSegmentTileImage(c)};
og.layer.WMS.prototype.GetHTTPRequestString=function(c){return this.url+"wms?LAYERS="+this.layers+"&FORMAT=image/jpeg&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&SRS="+c._projection.code+"&BBOX="+c.extent.getWest()+","+c.extent.getSouth()+","+c.extent.getEast()+","+c.extent.getNorth()+"&WIDTH="+(this.width?this.width:256)+"&HEIGHT="+(this.height?this.height:256)};og.terrainProvider={};og.terrainProvider.defaultOptions={url:"http://earth3.openglobus.org/{zoom}/{tiley}/{tilex}.ddm",responseType:"arraybuffer",minZoom:3,maxZoom:14,gridSizeByZoom:[64,32,16,8,8,8,8,8,8,16,16,16,16,32,32,32,32,32,32,32,32],fileGridSize:32,MAX_LOADING_TILES:4};og.terrainProvider.EmptyTerrainProvider=function(){this.name="empty";this.maxZoom=this.minZoom=500;this.gridSizeByZoom=[64,32,16,16,8,8,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4];this.fileGridSize=32};
og.terrainProvider.EmptyTerrainProvider.prototype.handleSegmentTerrain=function(c){c.terrainIsLoading=!1;c.terrainReady=!0;c.terrainExists=!0};
og.terrainProvider.TerrainProvider=function(c,d){og.inheritance.base(this);this.name=c||"";d=d||{};this.minZoom=d.minZoom||og.terrainProvider.defaultOptions.minZoom;this.maxZoom=d.maxZoom||og.terrainProvider.defaultOptions.maxZoom;this.url=d.url||og.terrainProvider.defaultOptions.url;this.gridSizeByZoom=d.gridSizeByZoom||og.terrainProvider.defaultOptions.gridSizeByZoom;this.fileGridSize=d.fileGridSize||og.terrainProvider.defaultOptions.fileGridSize;this.responseType=d.responseType||og.terrainProvider.defaultOptions.responseType;
this.MAX_LOADING_TILES=d.MAX_LOADING_TILES||og.terrainProvider.defaultOptions.MAX_LOADING_TILES;this.events=new og.Events;this.events.registerNames(["onload","onloadend"]);this.active=!0;this._counter=0;this._pendingsQueue=new og.QueueArray};og.inheritance.extend(og.terrainProvider.TerrainProvider,og.terrainProvider.EmptyTerrainProvider);og.terrainProvider.TerrainProvider.prototype.abort=function(){this._pendingsQueue.length=0};
og.terrainProvider.TerrainProvider.prototype.setUrl=function(c){this.url=c};og.terrainProvider.TerrainProvider.prototype.setName=function(c){this.name=c};og.terrainProvider.TerrainProvider.prototype.handleSegmentTerrain=function(c){this.active?c._projection.id==og.proj.EPSG3857.id&&(this._counter>=this.MAX_LOADING_TILES?this._pendingsQueue.push(c):this.loadSegmentTerrainData(c)):c.terrainIsLoading=!1};
og.terrainProvider.TerrainProvider.prototype.getServerUrl=function(c){return og.layer.replaceTemplate(this.url,{tilex:c.tileX.toString(),tiley:c.tileY.toString(),zoom:c.zoomIndex.toString()})};og.terrainProvider.TerrainProvider.prototype.getElevations=function(c){return new Float32Array(c)};
og.terrainProvider.TerrainProvider.prototype.loadSegmentTerrainData=function(c){this._counter++;og.Ajax.request(this.getServerUrl(c),{responseType:this.responseType,sender:this,success:function(d){this._applyElevationsData(c,d)},error:function(){this._applyElevationsData(c,[])}})};og.terrainProvider.TerrainProvider.prototype._applyElevationsData=function(c,d){if(c){var e=this.getElevations(d),f=this.events.onload;f.length&&this.events.dispatch(f,{elevations:e,segment:c});c.applyTerrain.call(c,e)}this.dequeueRequest()};
og.terrainProvider.TerrainProvider.prototype.dequeueRequest=function(){this._counter--;if(this._pendingsQueue.length){if(this._counter<this.MAX_LOADING_TILES){var c;(c=this.whilePendings())&&this.loadSegmentTerrainData.call(this,c)}}else 0==this._counter&&this.events.dispatch(this.events.onloadend)};
og.terrainProvider.TerrainProvider.prototype.whilePendings=function(){for(;this._pendingsQueue.length;){var c=this._pendingsQueue.pop();if(c){if(c.node.getState()!=og.quadTree.NOTRENDERING)return c;c.terrainIsLoading=!1}}return null};og.ImageCanvas=function(c,d){this._canvas=document.createElement("canvas");this._canvas.width=c||256;this._canvas.height=d||256;this._context=this._canvas.getContext("2d")};og.ImageCanvas.prototype.getCanvas=function(){return this._canvas};og.ImageCanvas.prototype.getContext=function(){return this._context};
og.ImageCanvas.prototype.fillEmpty=function(){for(var c=this._context.getImageData(0,0,this._canvas.width,this._canvas.height),d=c.data,e=0,f=d.length;e<f;e+=4)d[e]=d[e+1]=d[e+2]=d[e+3]=0;this._context.putImageData(c,0,0)};og.ImageCanvas.prototype.getData=function(){return this._context.getImageData(0,0,this._canvas.width,this._canvas.height).data};og.ImageCanvas.prototype.fillColor=function(c){this._context.fillStyle=c;this._context.fillRect(0,0,this._canvas.width,this._canvas.height)};
og.ImageCanvas.prototype.setData=function(c){var d=this._context.createImageData(this._canvas.width,this._canvas.height);d.data.set(c);this._context.putImageData(d,0,0)};og.ImageCanvas.prototype.resize=function(c,d){this._canvas.width=c;this._canvas.height=d;this._context=this._canvas.getContext("2d")};og.ImageCanvas.prototype.drawImage=function(c,d,e,f,g){this._context=this._canvas.getContext("2d");this._context.drawImage(c,d||0,e||0,f||c.width,g||c.height)};
og.ImageCanvas.prototype.getImage=function(){var c=new Image;c.width=this.getWidth();c.height=this.getHeight();c.src=this._canvas.toDataURL("image/png");return c};og.ImageCanvas.prototype.getTextWidth=function(c){c=this._context.measureText(c);return Math.round(c.width)};og.ImageCanvas.prototype.drawText=function(c,d,e,f,g){this._context.fillStyle=g||"black";this._context.font=f||"normal 14px Verdana";this._context.fillText(c,d||0,e||14)};og.ImageCanvas.prototype.getWidth=function(){return this._canvas.width};
og.ImageCanvas.prototype.getHeight=function(){return this._canvas.height};og.ImageCanvas.prototype.loadImage=function(c,d){var e=new Image,f=this;e.onload=function(){f.resize(e.width,e.height);f._context.drawImage(e,0,0,e.width,e.height);d&&d(e)};e.src=c};og.webgl.ShaderController=function(c,d){this._program=d;this._handler=c;this._activated=!1};og.webgl.ShaderController.prototype.getProgram=function(){return this._program};og.webgl.ShaderController.prototype.activate=function(){if(!this._activated){this._handler.activeShaderProgram.deactivate();this._handler.activeShaderProgram=this;var c=this._program;this._activated=!0;c.enableAttribArrays();c.use()}};
og.webgl.ShaderController.prototype.deactivate=function(){this._program.disableAttribArrays();this._activated=!1};og.webgl.ShaderController.prototype.isActive=function(){return this._activated};og.webgl.ShaderController.prototype.set=function(c){this._program.set(c)};og.webgl.ShaderController.prototype.drawIndexBuffer=function(c,d){this._program.drawIndexBuffer(c,d)};og.webgl.ShaderController.prototype.drawArray=function(c,d){this._program.drawArray(c,d)};
og.webgl.ShaderController.prototype.initialize=function(){this._program.createProgram(this._handler.gl)};og.webgl.Handler=function(c,d){this.delta=this.fps=this.lastAnimationFrameTime=0;this.animSpeed=1;this._id=c;this.gl=this.canvas=null;this._initialized=!1;this.drawback=function(c){};this.shaderPrograms={};this.activeShaderProgram=null;this.af=4;this._params=d||{};this._params.width=this._params.width||og.webgl.Handler.defaultWidth;this._params.height=this._params.height||og.webgl.Handler.defaultHeight;this._params.context=this._params.context||{};this._params.extensions=this._params.extensions||
[];this._pExtensions={};this.backgroundColor={r:.41,g:.41,b:.41}};og.webgl.Handler.defaultWidth=256;og.webgl.Handler.defaultHeight=256;
og.webgl.Handler.prototype.createTexture_n=function(c){var d=this.gl,e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,c);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.bindTexture(d.TEXTURE_2D,null);
return e};og.webgl.Handler.prototype.createTexture_l=function(c){var d=this.gl,e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e);d.texImage2D(d.TEXTURE_2D,0,d.LUMINANCE,d.LUMINANCE,d.UNSIGNED_BYTE,c);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.bindTexture(d.TEXTURE_2D,null);return e};
og.webgl.Handler.prototype.createTexture_mm=function(c){var d=this.gl,e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,c);d.generateMipmap(d.TEXTURE_2D);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.bindTexture(d.TEXTURE_2D,null);return e};
og.webgl.Handler.prototype.createTexture_af=function(c){var d=this.gl,e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,c);d.generateMipmap(d.TEXTURE_2D);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_LINEAR);d.texParameterf(d.TEXTURE_2D,this._pExtensions.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this.af);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);
d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.bindTexture(d.TEXTURE_2D,null);return e};og.webgl.Handler.prototype.createTexture=og.webgl.Handler.prototype.createTexture_af;
og.webgl.Handler.prototype.loadCubeMapTexture=function(c){var d=this.gl,e=d.createTexture();d.bindTexture(d.TEXTURE_CUBE_MAP,e);d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MIN_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MAG_FILTER,d.LINEAR);c=[[c.px,d.TEXTURE_CUBE_MAP_POSITIVE_X],[c.nx,d.TEXTURE_CUBE_MAP_NEGATIVE_X],[c.py,d.TEXTURE_CUBE_MAP_POSITIVE_Y],
[c.ny,d.TEXTURE_CUBE_MAP_NEGATIVE_Y],[c.pz,d.TEXTURE_CUBE_MAP_POSITIVE_Z],[c.nz,d.TEXTURE_CUBE_MAP_NEGATIVE_Z]];var f=new og.ImageCanvas;f.fillEmpty();for(var g=f.getImage(),f=0;f<c.length;f++){var h=c[f][1];d.bindTexture(d.TEXTURE_CUBE_MAP,e);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1);d.texImage2D(h,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,g)}for(f=0;f<c.length;f++)h=c[f][1],g=new Image,g.crossOrigin="",g.onload=function(c,e,f){return function(){d.bindTexture(d.TEXTURE_CUBE_MAP,c);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,
!1);d.texImage2D(e,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,f)}}(e,h,g),g.src=c[f][0];return e};og.webgl.Handler.prototype.addShaderProgram=function(c,d){if(this.shaderPrograms[c.name])alert(c.name+" is allready exists.");else{var e=new og.webgl.ShaderController(this,c);this.shaderPrograms[c.name]=e;this._initShaderController(e);d&&(e._activated=!1)}};
og.webgl.Handler.prototype._initShaderController=function(c){this._initialized&&(c.initialize(),this.activeShaderProgram?(c.deactivate(),this.activeShaderProgram._program.enableAttribArrays(),this.activeShaderProgram._program.use()):(this.activeShaderProgram=c,c.activate()))};og.webgl.Handler.prototype.addShaderPrograms=function(c){for(var d=0;d<c.length;d++)this.addShaderProgram(c[d])};og.webgl.Handler.prototype.initShaderPrograms=function(){for(var c in this.shaderPrograms)this._initShaderController(this.shaderPrograms[c])};
og.webgl.Handler.prototype.initExtension=function(c){this._pExtensions&&this._pExtensions[c]||(this._pExtensions[c]=og.webgl.getExtension(this.gl,c))};
og.webgl.Handler.prototype.init=function(){this._id?this.canvas=document.getElementById(this._id):(this.canvas=document.createElement("canvas"),this.canvas.width=this._params.width,this.canvas.height=this._params.height);this.gl=og.webgl.initWebGLContext(this.canvas,this._params.context);this._initialized=!0;this._params.extensions.push("OES_standard_derivatives");this._params.extensions.push("EXT_texture_filter_anisotropic");for(var c=this._params.extensions.length;c--;)this.initExtension(this._params.extensions[c]);
this._pExtensions.EXT_texture_filter_anisotropic||(this.createTexture=this.createTexture_mm);this.initShaderPrograms();this.setDefaults()};og.webgl.Handler.prototype.setDefaults=function(){this.activateDepthTest();this.setSize(this.canvas.width,this.canvas.height);this.gl.frontFace(this.gl.CCW);this.gl.cullFace(this.gl.BACK);this.activateFaceCulling();this.deactivateBlending()};og.webgl.Handler.prototype.activateDepthTest=function(){this.gl.enable(this.gl.DEPTH_TEST)};
og.webgl.Handler.prototype.deactivateDepthTest=function(){this.gl.disable(this.gl.DEPTH_TEST)};og.webgl.Handler.prototype.activateFaceCulling=function(){this.gl.enable(this.gl.CULL_FACE)};og.webgl.Handler.prototype.deactivateFaceCulling=function(){this.gl.disable(this.gl.CULL_FACE)};og.webgl.Handler.prototype.activateBlending=function(){this.gl.enable(this.gl.BLEND)};og.webgl.Handler.prototype.deactivateBlending=function(){this.gl.disable(this.gl.BLEND)};
og.webgl.Handler.prototype.createArrayBuffer=function(c,d,e){var f=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,f);this.gl.bufferData(this.gl.ARRAY_BUFFER,c,this.gl.STATIC_DRAW);f.itemSize=d;f.numItems=e;return f};og.webgl.Handler.prototype.createElementArrayBuffer=function(c,d,e){var f=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,f);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,c,this.gl.STATIC_DRAW);f.itemSize=d;f.numItems=e;return f};
function print2d(c,d,e,f){c=document.getElementById(c);c.innerHTML=d;c.style.left=e;c.style.top=f}og.webgl.Handler.prototype.setSize=function(c,d){var e=Math.max(1,d);this.canvas.width=c;this.canvas.height=e;this.canvas.aspect=c/e;this.canvas._oneByHeight=1/e;this.gl&&this.gl.viewport(0,0,c,e)};og.webgl.Handler.prototype.viewportResized=function(){return this.canvas.clientWidth!=this.canvas.width||this.canvas.clientHeight!=this.canvas.height};
og.webgl.Handler.prototype.drawFrame=function(c){this.viewportResized()&&(this.setSize(this.gl.canvas.clientWidth,this.gl.canvas.clientHeight),this.onCanvasResize(this.gl.canvas));this.calculateFPS(c);this.clearFrame();this.drawback();var d=this;window.requestAnimationFrame(function(){d.drawFrame((new Date).getTime())})};og.webgl.Handler.prototype.calculateFPS=function(c){this.fps=1E3/(c-this.lastAnimationFrameTime);this.lastAnimationFrameTime=c;this.delta=this.animSpeed/this.fps};
og.webgl.Handler.prototype.clearFrame=function(){var c=this.gl,d=this.backgroundColor;this.gl.clearColor(d.r,d.g,d.b,1);c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT)};og.webgl.Handler.prototype.start=function(){var c=this;window.requestAnimationFrame(function(){c.drawFrame((new Date).getTime())})};og.FontDetector=function(){var c=["monospace","sans-serif","serif"],d=document.getElementsByTagName("body")[0],e=document.createElement("span");e.style.fontSize="72px";e.innerHTML="mmmmmmmmmmlli";var f={},g={},h;for(h in c)e.style.fontFamily=c[h],d.appendChild(e),f[c[h]]=e.offsetWidth,g[c[h]]=e.offsetHeight,d.removeChild(e);this.detect=function(h){var m=!1,l;for(l in c){e.style.fontFamily=h+","+c[l];d.appendChild(e);var n=e.offsetWidth!=f[c[l]]||e.offsetHeight!=g[c[l]];d.removeChild(e);m=m||n}return m}};og.Rectangle=function(c,d,e,f){this.left=c||0;this.right=e||0;this.top=d||0;this.bottom=f||0};og.Rectangle.prototype.clone=function(){return new og.Rectangle(this.left,this.top,this.right,this.bottom)};og.Rectangle.prototype.getWidth=function(){return Math.abs(this.right-this.left)};og.Rectangle.prototype.getHeight=function(){return Math.abs(this.bottom-this.top)};og.Rectangle.prototype.getSquare=function(){return this.getHeight()*this.getWidth()};
og.Rectangle.prototype.getDiagonal=function(){var c=this.getWidth(),d=this.getHeight();return Math.sqrt(d*d+c*c)};og.Rectangle.prototype.fit=function(c,d){return this.getWidth()==c&&this.getHeight()==d};og.utils.ImagesCacheManager=function(){this.imagesCache={};this._counter=0;this._pendingsQueue=new og.QueueArray;this._imageIndexCounter=0};og.utils.ImagesCacheManager.prototype.load=function(c,d){if(this.imagesCache[c])d(this.imagesCache[c]);else{var e={src:c,success:d};1<=this._counter?this._pendingsQueue.push(e):this._exec(e)}};
og.utils.ImagesCacheManager.prototype._exec=function(c){this._counter++;var d=this,e=new Image;e.crossOrigin="";e.onload=function(){d.imagesCache[c.src]=this;this.__nodeIndex=d._imageIndexCounter++;c.success(this);d._dequeueRequest()};e.onerror=function(){d._dequeueRequest()};e.src=c.src};
og.utils.ImagesCacheManager.prototype._dequeueRequest=function(){this._counter--;if(this._pendingsQueue.length&&1>this._counter)for(;this._pendingsQueue.length;){var c=this._pendingsQueue.pop();if(c)if(this.imagesCache[c.src])0>=this._counter?this._counter=0:this._counter--,c.success(this.imagesCache[c.src]);else{this._exec(c);break}}};og.utils.TextureAtlasNode=function(c){this.image=this.childNodes=null;this.rect=c;this.texCoords=Array(8);this.atlas=null};
og.utils.TextureAtlasNode.prototype.insert=function(c){if(this.childNodes){var d=this.childNodes[0].insert(c);return null!=d?d:this.childNodes[1].insert(c)}if(null!=this.image)return null;var d=this.rect,e=(c.atlasWidth||c.width)+this.atlas.borderSize,f=(c.atlasHeight||c.height)+this.atlas.borderSize;if(e>d.getWidth()||f>d.getHeight())return null;if(d.fit(e,f))return this.image=c,this;this.childNodes=Array(2);this.childNodes[0]=new og.utils.TextureAtlasNode;this.childNodes[0].atlas=this.atlas;this.childNodes[1]=
new og.utils.TextureAtlasNode;this.childNodes[1].atlas=this.atlas;var g=d.getWidth()-e,h=d.getHeight()-f;g>h?(this.childNodes[0].rect=new og.Rectangle(d.left,d.top,d.left+e,d.bottom),this.childNodes[1].rect=new og.Rectangle(d.left+e,d.top,d.right,d.bottom)):(this.childNodes[0].rect=new og.Rectangle(d.left,d.top,d.right,d.top+f),this.childNodes[1].rect=new og.Rectangle(d.left,d.top+f,d.right,d.bottom));return this.childNodes[0].insert(c)};
og.utils.TextureAtlas=function(c,d){this.texture=this._handler=null;this.canvas=new og.ImageCanvas(c||1024,d||1024);this.clearCanvas();this._images=[];this.nodes=[];this._btree=null;this._imagesCacheManager=new og.utils.ImagesCacheManager;this.borderSize=4};og.utils.TextureAtlas.BORDER_SIZE=4;og.utils.TextureAtlas.prototype.getImage=function(){return this.canvas.getImage()};og.utils.TextureAtlas.prototype.getCanvas=function(){return this.canvas._canvas};
og.utils.TextureAtlas.prototype.clearCanvas=function(){this.canvas.fillEmpty("black")};og.utils.TextureAtlas.prototype.assignHandler=function(c){this._handler=c;this.createTexture()};og.utils.TextureAtlas.getDiagonal=function(c){var d=c.atlasWidth||c.width;c=c.atlasHeight||c.height;return Math.sqrt(d*d+c*c)};og.utils.TextureAtlas.prototype.addImage=function(c,d){if(c.width&&c.height)return this._images.push(c),this._makeAtlas(d),this.nodes[c.__nodeIndex]};
og.utils.TextureAtlas.prototype._completeNode=function(c,d){if(d){var e=this.canvas.getWidth(),f=this.canvas.getHeight(),g=d.image,h=d.rect,k=Math.round(.5*this.borderSize);this.canvas.drawImage(g,h.left+k,h.top+k,g.atlasWidth,g.atlasHeight);var m=d.texCoords;m[0]=(h.left+k)/e;m[1]=(h.top+k)/f;m[2]=(h.left+k)/e;m[3]=(h.bottom-k)/f;m[4]=(h.right-k)/e;m[5]=(h.bottom-k)/f;m[6]=(h.right-k)/e;m[7]=(h.bottom-k)/f;m[8]=(h.right-k)/e;m[9]=(h.top+k)/f;m[10]=(h.left+k)/e;m[11]=(h.top+k)/f;c[g.__nodeIndex]=
d}};
og.utils.TextureAtlas.prototype._makeAtlas=function(c){if(c&&this._btree)c=this._images[this._images.length-1],this._completeNode(this.nodes,this._btree.insert(c));else{c=this._images.slice(0);c.sort(function(c,d){return(d.atlasWidth||d.width)-(c.atlasWidth||c.width)||(d.atlasHeight||d.height)-(c.atlasHeight||c.height)});this._btree=new og.utils.TextureAtlasNode(new og.Rectangle(0,0,this.canvas.getWidth(),this.canvas.getHeight()));this._btree.atlas=this;this.clearCanvas();for(var d=[],e=0;e<c.length;e++)this._completeNode(d,this._btree.insert(c[e]));
this.nodes=[];this.nodes=d}};og.utils.TextureAtlas.prototype.createTexture=function(){this._handler&&(this._handler.gl.deleteTexture(this.texture),this.texture=this._handler.createTexture(this.canvas._canvas))};og.utils.TextureAtlas.prototype.loadImage=function(c,d){this._imagesCacheManager.load(c,d)};og.webgl.Framebuffer=function(c,d,e,f){this.gl=c;this.fbo=null;this.width=d||256;this.height=e||256;this.texture=null;f&&this.initialize()};og.webgl.Framebuffer.prototype.initialize=function(){var c=this.gl;this.width=c.canvas.clientWidth||this.width;this.height=c.canvas.clientHeight||this.height;this.fbo=c.createFramebuffer();this._createTexture()};
og.webgl.Framebuffer.prototype._createTexture=function(){var c=this.gl;c.deleteTexture(this.texture);c.bindFramebuffer(c.FRAMEBUFFER,this.fbo);this.texture=c.createTexture();c.bindTexture(c.TEXTURE_2D,this.texture);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,this.width,this.height,0,c.RGBA,c.UNSIGNED_BYTE,null);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,
c.TEXTURE_MIN_FILTER,c.NEAREST);var d=c.createRenderbuffer();c.bindRenderbuffer(c.RENDERBUFFER,d);c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,this.width,this.height);c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,this.texture,0);c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,d);c.bindTexture(c.TEXTURE_2D,null);c.bindRenderbuffer(c.RENDERBUFFER,null);c.bindFramebuffer(c.FRAMEBUFFER,null)};
og.webgl.Framebuffer.prototype.setSize=function(c,d){this.width=c;this.height=d;this.gl.deleteFramebuffer(this.fbo);this.initialize()};og.webgl.Framebuffer.prototype.isComplete=function(){var c=this.gl;return c.checkFramebufferStatus(c.FRAMEBUFFER)==c.FRAMEBUFFER_COMPLETE?!0:!1};
og.webgl.Framebuffer.prototype.readAllPixels=function(){var c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,this.fbo);var d=new Uint8Array(4*this.width*this.height);c.readPixels(0,0,this.width,this.height,c.RGBA,c.UNSIGNED_BYTE,d);c.bindFramebuffer(c.FRAMEBUFFER,null);return d};og.webgl.Framebuffer.prototype.readPixel=function(c,d){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.fbo);var f=new Uint8Array(4);e.readPixels(c,d,1,1,e.RGBA,e.UNSIGNED_BYTE,f);e.bindFramebuffer(e.FRAMEBUFFER,null);return f};
og.webgl.Framebuffer.prototype.activate=function(){var c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,this.fbo)};og.webgl.Framebuffer.prototype.clear=function(){var c=this.gl;c.clearColor(0,0,0,0);c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT)};og.webgl.Framebuffer.prototype.deactivate=function(){var c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,null)};og.webgl.Framebuffer.prototype.getImage=function(){var c=this.readAllPixels(),d=new og.ImageCanvas(this.width,this.height);d.setData(c);return d.getImage()};
og.webgl.Framebuffer.prototype.openImage=function(){var c=this.getImage(),d=c.src,e;e="<!DOCTYPE html><html><head><title>Print</title></head>";e+="<body>";e+='<img src="'+d+'">';e+="</body>";e+="</html>";c=window.open("","","width="+c.width+"px ,height="+c.height+"px");c.document.open();c.document.write(e);c.document.close();c.focus()};og.utils.SDFCreator=function(c,d){this._vertexBuffer=this._framebuffer2=this._framebuffer1=this._framebuffer0=this._handler=null;this._width=c||512;this._height=d||512;var e=Math.max(this._width,this._height);this._outsideDistance=Math.round(80*e/512);this._insideDistance=Math.round(10*e/512);this._outsideMix=.71;this._insideMix=.679;this._sourceTexture=null;this.initialize()};og.utils.SDFCreator.prototype.initialize=function(){this._initHandler(this._width,this._height);this._initShaders()};
og.utils.SDFCreator.prototype._initHandler=function(c,d){this._handler=new og.webgl.Handler(null,{width:c,height:d,context:{alpha:!0,depth:!1}});this._handler.init();this._handler.deactivateFaceCulling();this._handler.deactivateDepthTest();this._vertexBuffer=this._handler.createArrayBuffer(new Float32Array([-1,-1,-1,1,1,-1,1,1]),2,4);this._framebuffer0=new og.webgl.Framebuffer(this._handler.gl,c,d,!0);this._framebuffer1=new og.webgl.Framebuffer(this._handler.gl,c,d,!0);this._framebuffer2=new og.webgl.Framebuffer(this._handler.gl,
c,d,!0)};
og.utils.SDFCreator.prototype._initShaders=function(){var c=new og.shaderProgram.ShaderProgram("vfield",{uniforms:{uTexSize:{type:og.shaderProgram.types.VEC2},uTex1:{type:og.shaderProgram.types.SAMPLER2D},uDistance:{type:og.shaderProgram.types.INT},uNeg:{type:og.shaderProgram.types.VEC2}},attributes:{aPos:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:"attribute vec2 aPos;\n\r\n            uniform vec2 uTexSize;\n\r\n            varying vec2 TexCoord;\n\r\n            varying vec2 vTexSize;\n\r\n            void main() {\n\r\n                TexCoord = (aPos + 1.0) * 0.5;\n\r\n                TexCoord *= uTexSize;\n\r\n                vTexSize = uTexSize;\n\r\n                gl_Position.xy = aPos;\n\r\n                gl_Position.zw = vec2(0.0, 1.0);\n\r\n            }",fragmentShader:"precision lowp float;\n\r\n            uniform sampler2D uTex1;\n\r\n            uniform int uDistance;\n\r\n            uniform vec2 uNeg;\n\r\n            varying vec2 TexCoord;\n\r\n            varying vec2 vTexSize;\n\r\n            const int maxDistance = "+
this._outsideDistance+";\n\r\n            void main() {\n\r\n                if ( uNeg.x - uNeg.y * texture2D(uTex1, TexCoord / vTexSize).r > 0.5 ) {\n\r\n                    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\r\n                    return;\n\r\n                }\n\r\n                for ( int i=1; i <= maxDistance; i++ ) {\n\r\n                    if(i > uDistance) break;\n\r\n                    if ( uNeg.x - uNeg.y * texture2D(uTex1, ( TexCoord + vec2(0.0, i) ) / vTexSize ).r > 0.5 ) {\n\r\n                        gl_FragColor = vec4( vec3(float(i)/float(uDistance)), 1.0 );\n\r\n                        return;\n\r\n                    }\n\r\n                    if ( uNeg.x - uNeg.y * texture2D(uTex1, ( TexCoord - vec2(0.0, i)) / vTexSize ).r > 0.5 ) {\n\r\n                        gl_FragColor = vec4(vec3(float(i)/float(uDistance)), 1.0);\n\r\n                        return;\n\r\n                    }\n\r\n                }\n\r\n                gl_FragColor = vec4(1.0);\n\r\n            }"}),
d=new og.shaderProgram.ShaderProgram("hfield",{uniforms:{uTexSize:{type:og.shaderProgram.types.VEC2},uTex1:{type:og.shaderProgram.types.SAMPLER2D},uDistance:{type:og.shaderProgram.types.INT}},attributes:{aPos:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:"attribute vec2 aPos;\n\r\n            uniform vec2 uTexSize;\n\r\n            varying vec2 TexCoord;\n\r\n            varying vec2 vTexSize;\n\r\n            void main() {\n\r\n                TexCoord = (aPos + 1.0) * 0.5;\n\r\n                TexCoord *= uTexSize;\n\r\n                vTexSize = uTexSize;\n\r\n                gl_Position.xy = aPos;\n\r\n                gl_Position.zw = vec2(0.0, 1.0);\n\r\n            }",
fragmentShader:"precision lowp float;\n\r\n            uniform sampler2D uTex1;\n\r\n            uniform int uDistance;\n\r\n            varying vec2 TexCoord;\n\r\n            varying vec2 vTexSize;\n\r\n            const int maxDistance = "+this._outsideDistance+";\n\r\n            float CalcC(float H, float V) {\n\r\n                return ( sqrt( H * H + V * V ) );\n\r\n            }\n\r\n            void main(){\n\r\n                float dist = CalcC( 0.0, texture2D( uTex1, TexCoord / vTexSize ).r );\n\r\n                for ( int i = 1; i <= maxDistance; i++ ) {\n\r\n                    if(i > uDistance) break;\n\r\n                    float H = float(i) / float(uDistance);\n\r\n                    dist = min( dist, CalcC( H, texture2D( uTex1, ( TexCoord + vec2( float(i), 0.0) ) / vTexSize ).r ) );\n\r\n                    dist = min( dist, CalcC( H, texture2D( uTex1, ( TexCoord - vec2( float(i), 0.0) ) / vTexSize ).r ) );\n\r\n                }\n\r\n                gl_FragColor = vec4(dist);\n\r\n                gl_FragColor.w = 1.0;\n\r\n            }"}),
e=new og.shaderProgram.ShaderProgram("sum",{uniforms:{outside:{type:og.shaderProgram.types.SAMPLER2D},inside:{type:og.shaderProgram.types.SAMPLER2D},source:{type:og.shaderProgram.types.SAMPLER2D}},attributes:{aPos:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:"attribute vec2 aPos;\n\r\n                        varying vec2 TexCoord;\n\r\n                        void main(){\n\r\n                            TexCoord = (aPos * vec2(1.0,-1.0) + 1.0) * 0.5;\n\r\n                            gl_Position.xy = aPos;\n\r\n                            gl_Position.zw = vec2(0.0, 1.0);\n\r\n                        }",
fragmentShader:"precision highp float;\n\r\n                        uniform sampler2D outside;\n\r\n                        uniform sampler2D inside;\n\r\n                        uniform sampler2D source;\n\r\n                        varying vec2 TexCoord;\n\r\n                        void main(){\n\r\n                            float o = texture2D(outside, TexCoord).r;\n\r\n                            float i = 1.0 - texture2D(inside, TexCoord).r;\n\r\n                            float s = texture2D(source, TexCoord).r;\n\r\n                            gl_FragColor = vec4( vec3(1.0 - mix(i, o, step(0.5, s) * "+
this._outsideMix+" + (1.0 - step(0.5, s)) * "+this._insideMix+" )), 1.0);\n\r\n                        }"});this._handler.addShaderPrograms([c,d,e])};og.utils.SDFCreator.prototype.setSize=function(c,d){if(c!=this._width||d!=this._height)this._width=c,this._height=d,this._handler.setSize(c,d),this._framebuffer0.setSize(c,d),this._framebuffer1.setSize(c,d)};
og.utils.SDFCreator.prototype.createSDF=function(c,d,e){var f=this._handler,g=f.gl;f.setSize(this._width,this._height);g.deleteTexture(this._sourceTexture);this._sourceTexture=f.createTexture_l(c);f.shaderPrograms.vfield.activate();var h=f.shaderPrograms.vfield._program;c=h.attributes;h=h.uniforms;g.activeTexture(g.TEXTURE0);g.bindTexture(g.TEXTURE_2D,this._sourceTexture);g.uniform1i(h.uTex1._pName,0);g.uniform2fv(h.uTexSize._pName,[this._width,this._height]);g.bindBuffer(g.ARRAY_BUFFER,this._vertexBuffer);
g.vertexAttribPointer(c.aPos._pName,this._vertexBuffer.itemSize,g.FLOAT,!1,0,0);this._framebuffer0.activate();g.uniform1i(h.uDistance._pName,this._outsideDistance);g.uniform2fv(h.uNeg._pName,[0,-1]);g.drawArrays(g.TRIANGLE_STRIP,0,4);this._framebuffer0.deactivate();this._framebuffer2.activate();g.uniform2fv(h.uNeg._pName,[1,1]);g.uniform1i(h.uDistance._pName,this._insideDistance);g.drawArrays(g.TRIANGLE_STRIP,0,4);this._framebuffer2.deactivate();f.shaderPrograms.hfield.activate();h=f.shaderPrograms.hfield._program;
c=h.attributes;h=h.uniforms;g.uniform2fv(h.uTexSize._pName,[this._width,this._height]);g.bindBuffer(g.ARRAY_BUFFER,this._vertexBuffer);g.vertexAttribPointer(c.aPos._pName,this._vertexBuffer.itemSize,g.FLOAT,!1,0,0);this._framebuffer1.activate();g.activeTexture(g.TEXTURE0);g.bindTexture(g.TEXTURE_2D,this._framebuffer0.texture);g.uniform1i(h.uTex1._pName,0);g.uniform1i(h.uDistance._pName,this._outsideDistance);g.drawArrays(g.TRIANGLE_STRIP,0,4);this._framebuffer1.deactivate();this._framebuffer0.activate();
g.activeTexture(g.TEXTURE0);g.bindTexture(g.TEXTURE_2D,this._framebuffer2.texture);g.uniform1i(h.uTex1._pName,0);g.uniform1i(h.uDistance._pName,this._insideDistance);g.drawArrays(g.TRIANGLE_STRIP,0,4);this._framebuffer0.deactivate();f.setSize(d||this._width,e||this._height);g.clearColor(0,0,0,0);g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT);f.shaderPrograms.sum.activate();h=f.shaderPrograms.sum._program;c=h.attributes;h=h.uniforms;g.activeTexture(g.TEXTURE0);g.bindTexture(g.TEXTURE_2D,this._framebuffer1.texture);
g.uniform1i(h.outside._pName,0);g.activeTexture(g.TEXTURE1);g.bindTexture(g.TEXTURE_2D,this._framebuffer0.texture);g.uniform1i(h.inside._pName,1);g.activeTexture(g.TEXTURE2);g.bindTexture(g.TEXTURE_2D,this._sourceTexture);g.uniform1i(h.source._pName,2);g.bindBuffer(g.ARRAY_BUFFER,this._vertexBuffer);g.vertexAttribPointer(c.aPos._pName,this._vertexBuffer.itemSize,g.FLOAT,!1,0,0);g.drawArrays(g.TRIANGLE_STRIP,0,4);return f.canvas};og.utils.FontAtlas=function(){this.atlasesArr=[];this.atlasIndexes={};this.tokenImageSize=64;this.samplerArr=[0];this._handler=null;this.defaultFace="arial";this._counter=0;this._pendingsQueue=new og.QueueArray;this.fontDetector=new og.FontDetector;this._sdfCreator=new og.utils.SDFCreator(256,256)};
og.utils.FontAtlas.tokens=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","\u0430","\u0431","\u0432","\u0433","\u0434","\u0435","\u0451","\u0436","\u0437","\u0438","\u043a","\u043b","\u043c","\u043d","\u043e","\u043f","\u0440","\u0441","\u0442","\u0443","\u0444","\u0445","\u0446","\u0447","\u0448","\u0449","\u044c","\u044d","\u044a","\u044e",
"\u044f","\u0439","\u0410","\u0411","\u0412","\u0413","\u0414","\u0415","\u0401","\u0416","\u0417","\u0418","\u041a","\u041b","\u041c","\u041d","\u041e","\u041f","\u0420","\u0421","\u0422","\u0423","\u0424","\u0425","\u0426","\u0427","\u0428","\u0429","\u042c","\u042d","\u042a","\u042e","\u042f","\u0419","1","2","3","4","5","6","7","8","9","0","`","!","@","#","$","%","^","&","*","(",")","_","+","-","=","[","]","{","}","\\","|",";",":",'"',",",".","/","<",">","?"," ","    "];
og.utils.FontAtlas.prototype.assignHandler=function(c){this._handler=c};og.utils.FontAtlas.prototype.getFontIndex=function(c,d,e){return this.atlasIndexes[this.getFullIndex(c,d,e)]};og.utils.FontAtlas.prototype.getFullIndex=function(c,d,e){c=c&&c.trim().toLowerCase();if(!c||c&&!this.fontDetector.detect(c))c=this.defaultFace;return c+" "+(d&&d.toLowerCase()||"normal")+" "+(e&&e.toLowerCase()||"normal")};
og.utils.FontAtlas.prototype.createFont=function(c,d,e){var f=this.getFontIndex(c,d,e);if(void 0==f){var g=this.tokenImageSize,f=this.getFullIndex(c,d,e),f=this.atlasIndexes[f]=this.atlasesArr.length,h=new og.utils.TextureAtlas(1024,1024);h.assignHandler(this._handler);h.borderSize=6;this.samplerArr[this.atlasesArr.length]=this.atlasesArr.length;this.atlasesArr.push(h);h.canvas.fillColor("black");var k=og.utils.FontAtlas.tokens,m=new og.ImageCanvas(512,512),l=this._sdfCreator,n=Math.round(337.92);
c=(d||"normal")+" "+(e||"normal")+" "+n+"px "+(c||this.defaultFace);for(d=0;d<k.length;d++){e=k[d];m.fillColor("black");m.drawText(e,49,n,c,"white");var p=l.createSDF(m._canvas,g,g);p.__nodeIndex=e;p=h.addImage(p,!0,!0);e=m.getTextWidth(e);p.emptySize=e/512}h.createTexture()}return f};og.utils.FontAtlas.prototype.createFontAsync=function(c,d,e,f){c={face:c,style:d,weight:e,callback:f};1<=this._counter?this._pendingsQueue.push(c):this._exec(c)};
og.utils.FontAtlas.prototype._exec=function(c){this._counter++;var d=this;setTimeout(function(){var e=d.createFont(c.face,c.style,c.weight);c.callback(e);d._dequeueRequest()},0)};og.utils.FontAtlas.prototype._dequeueRequest=function(){this._counter--;if(this._pendingsQueue.length&&1>this._counter){var c;(c=this._whilePendings())&&this._exec(c)}};
og.utils.FontAtlas.prototype._whilePendings=function(){for(;this._pendingsQueue.length;){var c=this._pendingsQueue.pop(),d=this.getFontIndex(c.face,c.style,c.weight);if(void 0!=d)c.callback(d);else return c}};og.node={};og.node.Node=function(c){this.name=c;this.topNode=this;this.dictionary=[];this.dictionary[c]=this;this.childNodes=[];this.parentNode=null;this.__staticId=og.node.Node.staticCounter++};og.node.Node.staticCounter=0;og.node.Node.prototype={name:"",childNodes:[],parentNode:null,topNode:null,dictionary:[]};
og.node.Node.prototype.addNode=function(c){c.topNode=null==this.parentNode?this:this.topNode;c.parentNode=this;c.dictionary=this.topNode.dictionary;this.childNodes.push(c);this.topNode.dictionary[c.name]=c};og.node.Node.prototype.destroy=function(){for(var c=0;c<this.childNodes.length;c++)this.childNodes[c].destroy();this._clear()};og.node.Node.prototype._clear=function(){this.name="";this.topNode=this.parentNode=null;this.childNodes.length=0};og.node.Node.prototype.getNodeByName=function(c){return this.dictionary[c]};og.node.RenderNode=function(c){og.inheritance.base(this,c);this.drawMode=this.renderer=null;this._isActive=this.show=!0;this._zIndex=1E3;this.scaleMatrix=(new og.math.Matrix4).setIdentity();this.rotationMatrix=(new og.math.Matrix4).setIdentity();this.translationMatrix=(new og.math.Matrix4).setIdentity();this.transformationMatrix=(new og.math.Matrix4).setIdentity();this.itransformationMatrix=(new og.math.Matrix4).setIdentity();this.lightEnabled=!1;this._pointLights=[];this._pointLightsTransformedPositions=
[];this._pointLightsParamsv=[];this._pointLightsParamsf=[];this._pointLightsNames=[];this.entityCollections=[];this.billboardsTextureAtlas=new og.utils.TextureAtlas;this.fontAtlas=new og.utils.FontAtlas};og.inheritance.extend(og.node.RenderNode,og.node.Node);og.node.RenderNode.prototype.addEntityCollection=function(c){c.addTo(this);return this};og.node.RenderNode.prototype.removeEntityCollection=function(c){c.remove()};og.node.RenderNode.prototype.addLight=function(c){c.addTo(this);return this};
og.node.RenderNode.prototype.getLightByName=function(c){c=this._pointLightsNames.indexOf(c);return this._pointLights[c]};og.node.RenderNode.prototype.removeLight=function(c){c.remove()};og.node.RenderNode.prototype.setScale=function(c){this.scaleMatrix.scale(c);return this};og.node.RenderNode.prototype.setOrigin=function(c){this.translationMatrix.translate(c);return this};og.node.RenderNode.prototype.setAngles=function(c,d,e){this.rotationMatrix.eulerToMatrix(c,d,e);return this};
og.node.RenderNode.prototype.updateMatrices=function(){this.transformationMatrix=this.translationMatrix.mul(this.rotationMatrix).mul(this.scaleMatrix);this.itransformationMatrix=this.transformationMatrix.inverse()};og.node.RenderNode.prototype.drawNode=function(){this._isActive&&this.drawNodes()};og.node.RenderNode.prototype.setZIndex=function(c){this._zIndex=c};og.node.RenderNode.prototype.getZIndex=function(){return this._zIndex};og.node.RenderNode.prototype.isActive=function(){return this._isActive};
og.node.RenderNode.prototype.setActive=function(c){this._isActive=c;for(var d=0;d<this.childNodes.length;d++)this.childNodes[d].setActive(c)};og.node.RenderNode.prototype.setDrawMode=function(c){this.drawMode=c;for(var d=0;d<this.childNodes.length;d++)this.childNodes[d].setDrawMode(c)};og.node.RenderNode.prototype.drawNodes=function(){for(var c=0;c<this.childNodes.length;c++)this.childNodes[c]._isActive&&this.childNodes[c].drawNodes();this.show&&(this.drawEntities(),this.frame&&this.frame())};
og.node.RenderNode.prototype.transformLights=function(){for(var c=this.renderer,d=0;d<this._pointLights.length;d++){var e=3*d,f=c.activeCamera.mvMatrix.mulVec3(this._pointLights[d]._position);this._pointLightsTransformedPositions[e]=f.x;this._pointLightsTransformedPositions[e+1]=f.y;this._pointLightsTransformedPositions[e+2]=f.z}};og.node.RenderNode.prototype.updateBillboardsTexCoords=function(){for(var c=0;c<this.entityCollections.length;c++)this.entityCollections[c]._billboardHandler.refreshTexCoordsArr()};
og.node.RenderNode.prototype.drawEntities=function(){var c=this.entityCollections;if(c.length){var d=this.renderer.handler.gl;d.enable(d.BLEND);d.blendEquation(d.FUNC_ADD);d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE);d.disable(d.CULL_FACE);var e=0;d.activeTexture(d.TEXTURE0);d.bindTexture(d.TEXTURE_2D,this.billboardsTextureAtlas.texture);for(e=c.length;e--;)c[e]._billboardHandler.draw();for(var f=this.fontAtlas.atlasesArr,e=0;e<f.length;e++)d.activeTexture(d.TEXTURE0+e),d.bindTexture(d.TEXTURE_2D,
f[e].texture);for(e=c.length;e--;)c[e]._labelHandler.draw();d.enable(d.CULL_FACE)}};og.node.RenderNode.prototype.assignRenderer=function(c){this.renderer=c;this.billboardsTextureAtlas.assignHandler(c.handler);this.fontAtlas.assignHandler(c.handler);for(var d=0;d<this.entityCollections.length;d++)this.entityCollections[d]._billboardHandler.setRenderer(c)};og.shaderProgram.skybox=function(){return new og.shaderProgram.ShaderProgram("skybox",{uniforms:{uPMVMatrix:{type:og.shaderProgram.types.MAT4},uSampler:{type:og.shaderProgram.types.SAMPLERCUBE},pos:{type:og.shaderProgram.types.VEC3}},attributes:{aVertexPosition:{type:og.shaderProgram.types.VEC3,enableArray:!0}},vertexShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"skybox_vs.txt"),fragmentShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"skybox_fs.txt")})};og.node.SkyBox=function(c){og.inheritance.base(this,"skybox");this.params=c;this.texture=this.vertexPositionBuffer=null};og.inheritance.extend(og.node.SkyBox,og.node.RenderNode);og.node.SkyBox.prototype.initialization=function(){this.renderer.handler.addShaderProgram(og.shaderProgram.skybox(),!0);this.texture=this.renderer.handler.loadCubeMapTexture(this.params);this.createBuffers();this.drawMode=this.renderer.handler.gl.TRIANGLES};
og.node.SkyBox.prototype.frame=function(){var c=this.renderer.handler,d=c.gl,e=this.renderer.activeCamera;d.disable(c.gl.DEPTH_TEST);c.shaderPrograms.skybox.activate();sh=c.shaderPrograms.skybox._program;var f=sh.uniforms;d.uniformMatrix4fv(f.uPMVMatrix._pName,!1,e.pmvMatrix._m);d.uniform3fv(f.pos._pName,e.eye.toVec());d.activeTexture(d.TEXTURE0);d.bindTexture(d.TEXTURE_CUBE_MAP,this.texture);d.uniform1i(f.uSampler._pName,0);e=this.vertexPositionBuffer;d.bindBuffer(d.ARRAY_BUFFER,e);d.vertexAttribPointer(sh.attributes.aVertexPosition._pName,
e.itemSize,d.FLOAT,!1,0,0);d.drawArrays(this.drawMode,0,e.numItems);c.gl.enable(c.gl.DEPTH_TEST)};
og.node.SkyBox.prototype.createBuffers=function(){var c=[-1E4,1E4,-1E4,-1E4,-1E4,-1E4,1E4,-1E4,-1E4,1E4,-1E4,-1E4,1E4,1E4,-1E4,-1E4,1E4,-1E4,-1E4,-1E4,1E4,-1E4,-1E4,-1E4,-1E4,1E4,-1E4,-1E4,1E4,-1E4,-1E4,1E4,1E4,-1E4,-1E4,1E4,1E4,-1E4,-1E4,1E4,-1E4,1E4,1E4,1E4,1E4,1E4,1E4,1E4,1E4,1E4,-1E4,1E4,-1E4,-1E4,-1E4,-1E4,1E4,-1E4,1E4,1E4,1E4,1E4,1E4,1E4,1E4,1E4,1E4,-1E4,1E4,-1E4,-1E4,1E4,-1E4,1E4,-1E4,1E4,1E4,-1E4,1E4,1E4,1E4,1E4,1E4,1E4,-1E4,1E4,1E4,-1E4,1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,1E4,1E4,-1E4,-1E4,
1E4,-1E4,-1E4,-1E4,-1E4,1E4,1E4,-1E4,1E4];this.vertexPositionBuffer=this.renderer.handler.createArrayBuffer(new Float32Array(c),3,c.length/3)};og.node.Axes=function(c){og.inheritance.base(this,"Axes");this.size=c;this.axesColorBuffer=this.axesBuffer=null};og.inheritance.extend(og.node.Axes,og.node.RenderNode);og.node.Axes.prototype.initialization=function(){this.createAxisBuffer(this.size);this.drawMode=this.renderer.handler.gl.LINES};
og.node.Axes.prototype.frame=function(){this.renderer.handler.shaderPrograms.flat.activate();this.renderer.handler.shaderPrograms.flat.set({uPMVMatrix:this.renderer.activeCamera.pmvMatrix._m,aVertexPosition:this.axisBuffer,aVertexColor:this.axisColorBuffer});this.renderer.handler.shaderPrograms.flat.drawArray(this.drawMode,this.axisBuffer.numItems)};
og.node.Axes.prototype.createAxisBuffer=function(c){this.axisBuffer=this.renderer.handler.createArrayBuffer(new Float32Array([0,0,0,c-1,0,0,0,0,0,0,c-1,0,0,0,0,0,0,c-1]),3,6);this.axisColorBuffer=this.renderer.handler.createArrayBuffer(new Float32Array([1,0,0,1,1,0,0,1,0,0,1,1,0,0,1,1,0,1,0,1,0,1,0,1]),4,6)};og.control.SimpleNavigation=function(c){og.inheritance.base(this,c)};og.inheritance.extend(og.control.SimpleNavigation,og.control.Control);
og.control.SimpleNavigation.prototype.init=function(){this.renderer.events.on("onkeypressed",this,this.onCameraMoveForward,og.input.KEY_W);this.renderer.events.on("onkeypressed",this,this.onCameraMoveBackward,og.input.KEY_S);this.renderer.events.on("onkeypressed",this,this.onCameraStrifeLeft,og.input.KEY_A);this.renderer.events.on("onkeypressed",this,this.onCameraStrifeRight,og.input.KEY_D);this.renderer.events.on("onkeypressed",this,this.onCameraLookUp,og.input.KEY_UP);this.renderer.events.on("onkeypressed",
this,this.onCameraLookDown,og.input.KEY_DOWN);this.renderer.events.on("onkeypressed",this,this.onCameraTurnLeft,og.input.KEY_LEFT);this.renderer.events.on("onkeypressed",this,this.onCameraTurnRight,og.input.KEY_RIGHT);this.renderer.events.on("onkeypressed",this,this.onCameraRollLeft,og.input.KEY_Q);this.renderer.events.on("onkeypressed",this,this.onCameraRollRight,og.input.KEY_E)};og.control.SimpleNavigation.prototype.onCameraMoveForward=function(c){c=this.renderer.activeCamera;c.slide(0,0,-30);c.update()};
og.control.SimpleNavigation.prototype.onCameraMoveBackward=function(c){c=this.renderer.activeCamera;c.slide(0,0,30);c.update()};og.control.SimpleNavigation.prototype.onCameraStrifeLeft=function(c){c=this.renderer.activeCamera;c.slide(-30,0,0);c.update()};og.control.SimpleNavigation.prototype.onCameraStrifeRight=function(c){c=this.renderer.activeCamera;c.slide(30,0,0);c.update()};og.control.SimpleNavigation.prototype.onCameraLookUp=function(c){c=this.renderer.activeCamera;c.pitch(1);c.update()};
og.control.SimpleNavigation.prototype.onCameraLookDown=function(c){c=this.renderer.activeCamera;c.pitch(-1);c.update()};og.control.SimpleNavigation.prototype.onCameraTurnLeft=function(c){c=this.renderer.activeCamera;c.yaw(1);c.update()};og.control.SimpleNavigation.prototype.onCameraTurnRight=function(c){c=this.renderer.activeCamera;c.yaw(-1);c.update()};og.control.SimpleNavigation.prototype.onCameraRollLeft=function(c){c=this.renderer.activeCamera;c.roll(-1);c.update()};
og.control.SimpleNavigation.prototype.onCameraRollRight=function(c){c=this.renderer.activeCamera;c.roll(1);c.update()};og.control.MouseNavigation=function(c){og.inheritance.base(this,c);this.grabbedPoint=new og.math.Vector3;this.pointOnEarth=new og.math.Vector3;this.earthUp=new og.math.Vector3;this.inertia=.007;this.grabbedSpheroid=new og.bv.Sphere;this.planet=null;this.qRot=new og.math.Quaternion;this.scaleRot=0;this.distDiff=.33;this.stepsCount=5;this.stepsForward=null;this.stepIndex=0};og.inheritance.extend(og.control.MouseNavigation,og.control.Control);
og.control.MouseNavigation.getMovePointsFromPixelTerrain=function(c,d,e,f,g,h,k){var m=[],l=c.eye.clone(),n=c.n.clone(),p=c.u.clone(),q=c.v.clone();d=d.getCartesianFromPixelTerrain(g);k||(k=og.math.Vector3.sub(d,c.eye).normalize());g=d?f*c.eye.distance(d)/e:1E3;g=h?-g:2*g;f=n.scaleTo(g);if(d&&9E3<c.lonLat.height&&.6<n.dot(l.normal())){var r=new og.bv.Sphere;r.radius=d.length();g=[];var t=[],v=!1;for(h=0;h<e;h++){l.add(f);var E=(new og.math.Ray(l,k)).hitSphere(r);t[h]=l.clone();if(E)g[h]=(new og.math.Matrix4).rotateBetweenVectors(d.normal(),
E.normal());else{v=!0;break}}if(v)for(l=c.eye.clone(),h=0;h<e;h++)m[h]={},m[h].eye=l.add(f).clone(),m[h].v=q,m[h].u=p,m[h].n=n;else for(h=0;h<e;h++)c=g[h],m[h]={},m[h].eye=c.mulVec3(t[h]),m[h].v=c.mulVec3(q),m[h].u=c.mulVec3(p),m[h].n=c.mulVec3(n)}else for(h=0;h<e;h++)m[h]={},m[h].eye=l.add(k.scaleTo(-g)).clone(),m[h].v=q,m[h].u=p,m[h].n=n;return m};
og.control.MouseNavigation.prototype.onMouseWheel=function(c){if(!this.stepIndex){this.planet.stopFlying();this.stopRotation();var d=this.renderer.events.mouseState;this.stepIndex=this.stepsCount;this.stepsForward=og.control.MouseNavigation.getMovePointsFromPixelTerrain(this.renderer.activeCamera,this.planet,this.stepsCount,this.distDiff,d,0<c.wheelDelta,d.direction)}};
og.control.MouseNavigation.prototype.init=function(){this.planet=this.renderer.renderNodes.Earth;this.renderer.events.on("onmousewheel",this,this.onMouseWheel);this.renderer.events.on("onmouselbuttonhold",this,this.onMouseLeftButtonDown);this.renderer.events.on("onmouserbuttonhold",this,this.onMouseRightButtonDown);this.renderer.events.on("onmouselbuttondown",this,this.onMouseLeftButtonClick);this.renderer.events.on("onmouselbuttonup",this,this.onMouseLeftButtonUp);this.renderer.events.on("onmouserbuttondown",
this,this.onMouseRightButtonClick);this.renderer.events.on("onmouselbuttondoubleclick",this,this.onMouseLeftButtonDoubleClick);this.renderer.events.on("onmouseclick",this,this.onMouseClick);this.renderer.events.on("ondraw",this,this.onDraw)};og.control.MouseNavigation.prototype.onMouseClick=function(){};
og.control.MouseNavigation.prototype.onMouseLeftButtonDoubleClick=function(){var c=this.renderer.events.mouseState;this.stepIndex=this.stepsCount;this.renderer.events.isKeyPressed(og.input.KEY_SHIFT)?this.stepsForward=og.control.MouseNavigation.getMovePointsFromPixelTerrain(this.renderer.activeCamera,this.planet,this.stepsCount,2*this.distDiff,c,!1,c.direction):this.stepsForward=og.control.MouseNavigation.getMovePointsFromPixelTerrain(this.renderer.activeCamera,this.planet,this.stepsCount,1.7*this.distDiff,
c,!0,c.direction)};og.control.MouseNavigation.prototype.onMouseLeftButtonClick=function(){this.renderer.handler.gl.canvas.classList.add("ogGrabbingPoiner");if(this.grabbedPoint=this.planet.getCartesianFromMouseTerrain())this.grabbedSpheroid.radius=this.grabbedPoint.length(),this.stopRotation()};og.control.MouseNavigation.prototype.stopRotation=function(){this.qRot.clear()};og.control.MouseNavigation.prototype.onMouseLeftButtonUp=function(c){this.renderer.handler.gl.canvas.classList.remove("ogGrabbingPoiner")};
og.control.MouseNavigation.prototype.onMouseLeftButtonDown=function(c){if(this.grabbedPoint)if(this.planet.stopFlying(),this.renderer.events.mouseState.moving){var d=this.renderer.activeCamera;if(c=(new og.math.Ray(d.eye,c.direction)).hitSphere(this.grabbedSpheroid))this.scaleRot=1,c=this.qRot=og.math.Quaternion.getRotationBetweenVectors(c.normal(),this.grabbedPoint.normal()),d.eye=c.mulVec3(d.eye),d.v=c.mulVec3(d.v),d.u=c.mulVec3(d.u),d.n=c.mulVec3(d.n),d.update()}else this.scaleRot=0};
og.control.MouseNavigation.prototype.onMouseRightButtonClick=function(c){this.stopRotation();this.planet.stopFlying();if(this.pointOnEarth=this.planet.getCartesianFromPixelTerrain({x:c.x,y:c.y}))this.earthUp=this.pointOnEarth.normal()};
og.control.MouseNavigation.prototype.onMouseRightButtonDown=function(c){var d=this.renderer.activeCamera;if(this.renderer.events.mouseState.moving){var e=.5/d.eye.distance(this.pointOnEarth)*d.lonLat.height*og.math.RADIANS;.007<e&&(e=.007);d.rotateHorizontal(e*(c.x-c.prev_x),!1,this.pointOnEarth,this.earthUp);d.rotateVertical(e*(c.y-c.prev_y),this.pointOnEarth);d.update()}};
og.control.MouseNavigation.prototype.onDraw=function(c){if(this.stepIndex){var d=this.stepsForward[this.stepsCount-this.stepIndex--];c=this.renderer.activeCamera;c.eye=d.eye;c.v=d.v;c.u=d.u;c.n=d.n;c.update()}c=this.renderer;c.controlsBag.scaleRot=this.scaleRot;!c.events.mouseState.leftButtonDown&&this.scaleRot&&(this.scaleRot-=this.inertia,0>=this.scaleRot?this.scaleRot=0:(c=c.activeCamera,d=this.qRot.slerp(og.math.Quaternion.IDENTITY,1-this.scaleRot*this.scaleRot*this.scaleRot).normalize(),d.x||
d.y||d.z||(this.scaleRot=0),c.eye=d.mulVec3(c.eye),c.v=d.mulVec3(c.v),c.u=d.mulVec3(c.u),c.n=d.mulVec3(c.n),c.update()))};og.control.ZoomControl=function(c){og.inheritance.base(this,c);this.distDiff=.33;this.stepsCount=5;this.stepsForward=null;this.stepIndex=0;this.planet=null};og.inheritance.extend(og.control.ZoomControl,og.control.Control);
og.control.ZoomControl.prototype.init=function(){var c=document.createElement("div"),d=document.createElement("button"),e=document.createElement("button");c.className="ogZoomControl";d.className="ogZoomButton ogZoomIn";e.className="ogZoomButton ogZoomOut";c.appendChild(d);c.appendChild(e);this.renderer.div.appendChild(c);var f=this;d.onclick=function(c){f.zoomIn()};e.onclick=function(c){f.zoomOut()};this.planet=this.renderer.renderNodes.Earth;this.renderer.events.on("ondraw",this,this.onDraw)};
og.control.ZoomControl.prototype.zoomIn=function(){this.stepIndex=this.stepsCount;this.stepsForward=og.control.MouseNavigation.getMovePointsFromPixelTerrain(this.renderer.activeCamera,this.planet,this.stepsCount,1.7*this.distDiff,this.renderer.getCenter(),!0,this.renderer.activeCamera.n.getNegate())};
og.control.ZoomControl.prototype.zoomOut=function(){this.stepIndex=this.stepsCount;this.stepsForward=og.control.MouseNavigation.getMovePointsFromPixelTerrain(this.renderer.activeCamera,this.planet,this.stepsCount,2*this.distDiff,this.renderer.getCenter(),!1,this.renderer.activeCamera.n.getNegate())};og.control.ZoomControl.prototype.onDraw=function(c){if(this.stepIndex){c=this.stepsForward[this.stepsCount-this.stepIndex--];var d=this.renderer.activeCamera;d.eye=c.eye;d.v=c.v;d.u=c.u;d.n=c.n;d.update()}};og.planetSegment={};og.planetSegment.PlanetSegmentHelper={};
og.planetSegment.PlanetSegmentHelper.initIndexesTables=function(c){c!=og.planetSegment.PlanetSegmentHelper.powerOfTwo&&(og.planetSegment.PlanetSegmentHelper.powerOfTwo=c,og.planetSegment.PlanetSegmentHelper.centerIndexesTable=og.planetSegment.PlanetSegmentHelper.initIndexBodiesTable(c),og.planetSegment.PlanetSegmentHelper.textureCoordsTable=og.planetSegment.PlanetSegmentHelper.initTextureCoordsTable(c),og.planetSegment.PlanetSegmentHelper.skirtsIndexesTable=og.planetSegment.PlanetSegmentHelper.initIndexesBodySkirts(c));
og.planetSegment.PlanetSegmentHelper.centerIndexesTable[0]=[];og.planetSegment.PlanetSegmentHelper.textureCoordsTable[0]=[]};
og.planetSegment.PlanetSegmentHelper.createSegmentIndexes=function(c,d){if(1!=c){for(var e=og.planetSegment.PlanetSegmentHelper.centerIndexesTable[c],f=og.planetSegment.PlanetSegmentHelper.skirtsIndexesTable[og.quadTree.W][c][d[og.quadTree.W]],g=og.planetSegment.PlanetSegmentHelper.skirtsIndexesTable[og.quadTree.N][c][d[og.quadTree.N]],h=og.planetSegment.PlanetSegmentHelper.skirtsIndexesTable[og.quadTree.E][c][d[og.quadTree.E]],k=og.planetSegment.PlanetSegmentHelper.skirtsIndexesTable[og.quadTree.S][c][d[og.quadTree.S]],
m=new Uint16Array(e.length+f.length+g.length+h.length+k.length),l=0,n=0,l=0;l<e.length;l++)m[n++]=e[l];for(l=0;l<f.length;l++)m[n++]=f[l];for(l=0;l<g.length;l++)m[n++]=g[l];for(l=0;l<h.length;l++)m[n++]=h[l];for(l=0;l<k.length;l++)m[n++]=k[l];return m}return new Uint16Array([0,2,1,3])};og.planetSegment.PlanetSegmentHelper.createCenterBodyIndexes=function(c,d){for(var e,f,g,h=1;h<c-1-1;h++){for(var k=1;k<c-1;k++)e=h*c+k,g=(h+1)*c,f=g+k,d.push(e,f);d.push(f,g+1)}d.push(d[d.length-1],c*c-c)};
og.planetSegment.PlanetSegmentHelper.createWestNeighborSkirt=function(c,d,e){for(var f=(c-1)/d,g=c*c-c,h=0,k=0;k<c-2;k++)0===k%f&&(h=k),e.push(g-c*h,g-c*k-c+1);d===c-1&&(e.push(c),e.push(0))};og.planetSegment.PlanetSegmentHelper.createNorthNeighborSkirt=function(c,d,e){for(var f=(c-1)/d,g=0,h=0;h<c-2;h++)0===h%f&&(g=h),e.push(g,c+h+1);d===c-1&&(e.push(c-2),e.push(c-1))};
og.planetSegment.PlanetSegmentHelper.createEastNeighborSkirt=function(c,d,e){for(var f=(c-1)/d,g=0,h=0;h<c-2;h++)0===h%f&&(g=h),e.push(c+c*g-1,c*(h+1)+c-2);d===c-1&&(e.push(c*(c-1)-1),e.push(c*c-1))};og.planetSegment.PlanetSegmentHelper.createSouthNeighborSkirt=function(c,d,e){for(var f=(c-1)/d,g=0,h=c*(c-1)-2,k=c*c-1,m=0;m<c-2;m++)0===m%f&&(g=m),e.push(k-g,h-m);d===c-1&&e.push(c*c-c+1);e.push(c*c-c)};
og.planetSegment.PlanetSegmentHelper.initIndexesBodySkirts=function(c){var d=[];d[og.quadTree.N]=[];d[og.quadTree.W]=[];d[og.quadTree.S]=[];d[og.quadTree.E]=[];d[og.quadTree.N][0]=[];d[og.quadTree.W][0]=[];d[og.quadTree.S][0]=[];d[og.quadTree.E][0]=[];for(var e=0;e<=c;e++){var f=Math.pow(2,e);d[og.quadTree.N][f]=[];d[og.quadTree.W][f]=[];d[og.quadTree.S][f]=[];d[og.quadTree.E][f]=[];d[og.quadTree.N][f][0]=[];d[og.quadTree.W][f][0]=[];d[og.quadTree.S][f][0]=[];d[og.quadTree.E][f][0]=[];for(var g=0;g<=
c;g++){var h=Math.pow(2,g),k=d[og.quadTree.N][f][h]=[],m=d[og.quadTree.W][f][h]=[],l=d[og.quadTree.S][f][h]=[],n=d[og.quadTree.E][f][h]=[];og.planetSegment.PlanetSegmentHelper.createWestNeighborSkirt(f+1,h,m);og.planetSegment.PlanetSegmentHelper.createNorthNeighborSkirt(f+1,h,k);og.planetSegment.PlanetSegmentHelper.createEastNeighborSkirt(f+1,h,n);og.planetSegment.PlanetSegmentHelper.createSouthNeighborSkirt(f+1,h,l)}}return d};
og.planetSegment.PlanetSegmentHelper.initTextureCoordsTable=function(c){for(var d=[],e=0;e<=c;e++){var f=Math.pow(2,e);d[f]=og.planetSegment.PlanetSegmentHelper.createTextureCoords(f)}return d};og.planetSegment.PlanetSegmentHelper.initIndexBodiesTable=function(c){for(var d=[],e=0;e<=c;e++){var f=Math.pow(2,e),g=d[f]=[];og.planetSegment.PlanetSegmentHelper.createCenterBodyIndexes(f+1,g)}return d};
og.planetSegment.PlanetSegmentHelper.createTextureCoords=function(c){for(var d=[],e=0;e<=c;e++)for(var f=0;f<=c;f++)d.push(f/c,e/c);return d};og.bv.Box=function(){this.vertices=[new og.math.Vector3,new og.math.Vector3,new og.math.Vector3,new og.math.Vector3,new og.math.Vector3,new og.math.Vector3,new og.math.Vector3,new og.math.Vector3]};
og.bv.Box.prototype.setFromBounds=function(c){var d=c[0],e=c[1],f=c[2],g=c[3],h=c[4];c=c[5];this.vertices[0].set(d,f,h);this.vertices[1].set(e,f,h);this.vertices[2].set(e,f,c);this.vertices[3].set(d,f,c);this.vertices[4].set(d,g,h);this.vertices[5].set(e,g,h);this.vertices[6].set(e,g,c);this.vertices[7].set(d,g,c)};og.bv.Box.prototype.setFromExtent=function(c,d){this.setFromBounds(og.bv.getBoundsFromExtent(c,d))};og.planetSegment.PlanetSegment=function(){this._projection=og.proj.EPSG3857;this.plainVertices=[];this.plainNormals=[];this.terrainVertices=[];this.tempVertices=[];this.normalMapTexture=null;this.normalMapTextureBias=[0,0,1];this.normalMapVertices=[];this.normalMapNormals=[];this.plainIndexes=[];this.bbox=new og.bv.Box;this.bsphere=new og.bv.Sphere;this.extent=this.vertexTextureCoordBuffer=this.vertexIndexBuffer=this.vertexPositionBuffer=this.vertexNormalBuffer=null;this.extentParams=[];this.handler=
this.planet=this.tileY=this.tileX=this.zoomIndex=this.gridSize=null;this.ready=!1;this.materials=[];this._inTheGeoImageTileCreatorQueue=this._inTheQueue=!1;this._appliedNeighborsZoom=[0,0,0,0];this.geoImageReady=this.terrainExists=this.terrainIsLoading=this.terrainReady=this.parentNormalMapReady=this.normalMapReady=!1;this.geoImageTexture=null;this.geoImageTextureBias=[0,0,1];this.texBiasArr=new Float32Array(3*og.layer.MAX_OVERLAYS);this.samplerArr=new Int32Array(og.layer.MAX_OVERLAYS);this.alfaArr=
new Float32Array(og.layer.MAX_OVERLAYS);this.node=null};og.planetSegment.PlanetSegment.RATIO_LOD=1.12;og.planetSegment.PlanetSegment.prototype.acceptForRendering=function(c){var d=this.bsphere;return c.projectedSize(d.center)>og.planetSegment.PlanetSegment.RATIO_LOD*d.radius};
og.planetSegment.PlanetSegment.prototype.getEarthPoint=function(c,d){var e=this.extent.northEast,f=this.extent.southWest,g=this.gridSize,h=d.eye,k=f.lon,m=f.lat,f=Math.floor((c.lon-k)/((e.lon-k)/g)),l=Math.floor(g-(c.lat-m)/((e.lat-m)/g)),k=this.terrainReady?this.terrainVertices:this.tempVertices,e=new og.math.Ray(h,h.getNegate());if(k.length){m=3*((g+1)*l+f);l=3*((g+1)*(l+1)+f);g=new og.math.Vector3(k[m],k[m+1],k[m+2]);f=new og.math.Vector3(k[m+3],k[m+4],k[m+5]);m=new og.math.Vector3(k[l],k[l+1],
k[l+2]);k=new og.math.Vector3(k[l+3],k[l+4],k[l+5]);l=new og.math.Vector3;g=e.hitTriangle(g,f,m,l);if(g==og.math.Ray.INSIDE)return{distance:h.distance(l),earth:l};g=e.hitTriangle(f,k,m,l);return g==og.math.Ray.INSIDE?{distance:h.distance(l),earth:l}:g==og.math.Ray.AWAY?{distance:-h.distance(l),earth:l}:{distance:h.distance(l),earth:l}}return{distance:d.lonLat.height,earth:this.planet.hitRayEllipsoid(e.origin,e.direction)}};
og.planetSegment.PlanetSegment.prototype.loadTerrain=function(){this.zoomIndex>=this.planet.terrainProvider.minZoom?this.terrainIsLoading||this.terrainReady||(this.terrainReady=!1,this.terrainIsLoading=!0,this.planet.terrainProvider.handleSegmentTerrain(this)):(this.terrainReady=!0,this.planet.normalMapCreator.queue(this))};
og.planetSegment.PlanetSegment.prototype.elevationsExists=function(c){if(this.ready&&this.terrainIsLoading){var d=og.math.MAX,e=og.math.MIN,f=og.math.MAX,g=og.math.MIN,h=og.math.MAX,k=og.math.MIN,m=this.planet.terrainProvider.gridSizeByZoom[this.zoomIndex],l=this.planet.terrainProvider.fileGridSize||Math.sqrt(c.length)-1,n=l+1,p=m+1,q=this.planet.heightFactor,r=[],t=[],v=0,E=32/m,u=new Float64Array(n*n*3),D=this.normalMapVertices,F=this.normalMapNormals;if(l>=m)for(var I=0;I<n;I++)for(var J=0;J<n;J++){var B=
I*n+J,p=3*B,B=q*c[B],A=new og.math.Vector3(D[p]+B*F[p],D[p+1]+B*F[p+1],D[p+2]+B*F[p+2]);t[p]=A.x;t[p+1]=A.y;t[p+2]=A.z;0==I%E&&0==J%E&&(r[v++]=A.x,r[v++]=A.y,r[v++]=A.z,A.x<d&&(d=A.x),A.x>e&&(e=A.x),A.y<f&&(f=A.y),A.y>g&&(g=A.y),A.z<h&&(h=A.z),A.z>k&&(k=A.z));if(I!=l&&J!=l){var C=I*n+J+1,B=3*C,C=q*c[C],H=new og.math.Vector3(D[B]+C*F[B],D[B+1]+C*F[B+1],D[B+2]+C*F[B+2]);t[B]=H.x;t[B+1]=H.y;t[B+2]=H.z;var G=(I+1)*n+J,C=3*G,G=q*c[G],L=new og.math.Vector3(D[C]+G*F[C],D[C+1]+G*F[C+1],D[C+2]+G*F[C+2]);t[C]=
L.x;t[C+1]=L.y;t[C+2]=L.z;var K=(I+1)*n+(J+1),G=3*K,K=q*c[K],K=new og.math.Vector3(D[G]+K*F[G],D[G+1]+K*F[G+1],D[G+2]+K*F[G+2]);t[G]=K.x;t[G+1]=K.y;t[G+2]=K.z;H=og.math.Vector3.sub(H,A);L=og.math.Vector3.sub(L,A);K=og.math.Vector3.sub(K,A);A=L.cross(K);H=K.cross(H);L=og.math.Vector3.add(H,A);u[p]+=L.x;u[p+1]+=L.y;u[p+2]+=L.z;u[B]+=H.x;u[B+1]+=H.y;u[B+2]+=H.z;u[C]+=A.x;u[C+1]+=A.y;u[C+2]+=A.z;u[G]+=L.x;u[G+1]+=L.y;u[G+2]+=L.z}}else{E=this.plainVertices;u=this.plainNormals;l=m/l;for(I=0;I<p;I++)for(I==
p-1?(D=l,F=Math.floor(I/l)-1):(D=I%l,F=Math.floor(I/l)),J=0;J<p;J++)J==p-1?(B=l,H=Math.floor(J/l)-1):(B=J%l,H=Math.floor(J/l)),C=c[F*n+H],A=c[F*n+H+1],G=c[(F+1)*n+H],H=c[(F+1)*n+H+1],A=D+B<l?q*(C+og.math.slice(B/l,A,C)+og.math.slice(D/l,G,C)):q*(H+og.math.slice((l-B)/l,G,H)+og.math.slice((l-D)/l,A,H)),B=E[v]+A*u[v],C=E[v+1]+A*u[v+1],A=E[v+2]+A*u[v+2],r[v]=B,r[v+1]=C,r[v+2]=A,v+=3,B<d&&(d=B),B>e&&(e=B),C<f&&(f=C),C>g&&(g=C),A<h&&(h=A),A>k&&(k=A);u=this.plainNormals}this.terrainExists=!0;this.normalMapNormals=
u;this.normalMapVertices=t;this.terrainVertices.length=0;this.terrainVertices=r;this.deleteBuffers();this.terrainReady=!0;this.terrainIsLoading=!1;this.planet.lightEnabled&&this.planet.normalMapCreator.queue(this);this.createCoordsBuffers(r,m);this.bsphere.setFromBounds([d,e,f,g,h,k]);this.gridSize=m;this.node.appliedTerrainNodeId=this.node.nodeId}c.length=0};
og.planetSegment.PlanetSegment.prototype.elevationsNotExists=function(){if(this.zoomIndex<=this.planet.terrainProvider.maxZoom){if(this.ready&&this.terrainIsLoading){this.terrainIsLoading=!1;this.terrainReady=!0;this.terrainExists=!1;this.node.appliedTerrainNodeId=this.node.nodeId;this.gridSize=this.planet.terrainProvider.gridSizeByZoom[this.zoomIndex];this.deleteBuffers();this.planet.lightEnabled&&this.planet.normalMapCreator.queue(this);if(5<this.zoomIndex){var c=3*this.gridSize,d=.5*c,e=c*(this.gridSize+
1),f=d*(this.gridSize+1),g=this.terrainVertices;this.terrainVertices=[g[0],g[1],g[2],g[d],g[d+1],g[d+2],g[c],g[c+1],g[c+2],g[f],g[f+1],g[f+2],g[f+d],g[f+d+1],g[f+d+2],g[f+c],g[f+c+1],g[f+c+2],g[e],g[e+1],g[e+2],g[e+d],g[e+d+1],g[e+d+2],g[e+c],g[e+c+1],g[e+c+2]];this.createCoordsBuffers(this.terrainVertices,2);this.gridSize=2}this.createCoordsBuffers(this.terrainVertices,this.gridSize)}for(var c=og.math.MAX,d=og.math.MIN,e=og.math.MAX,f=og.math.MIN,h=og.math.MAX,k=og.math.MIN,g=this.terrainVertices,
m=0;m<g.length;m+=3){var l=g[m],n=g[m+1],p=g[m+2];l<c&&(c=l);l>d&&(d=l);n<e&&(e=n);n>f&&(f=n);p<h&&(h=p);p>k&&(k=p)}this.bsphere.setFromBounds([c,d,e,f,h,k])}};
og.planetSegment.PlanetSegment.prototype.normalMapEdgeEqualize=function(c,d,e){var f=this.node.neighbors[c];if(f){var g=f.planetSegment;this._appliedNeighborsZoom[c]=g.zoomIndex;if(g.terrainReady&&g.terrainExists)if(!g._inTheQueue&&this.zoomIndex>g._appliedNeighborsZoom[og.quadTree.OPSIDE[c]])this.planet.normalMapCreator.queue(g);else{var h=this.planet.terrainProvider.fileGridSize,k=h+1,m=h-d,l=this.normalMapNormals,n=g.normalMapNormals;if(this.zoomIndex==g.zoomIndex)if(e)for(e=0;e<=h;e++)f=3*(e*
k+d),g=3*(e*k+m),n[g]=l[f]+=n[g],n[g+1]=l[f+1]+=n[g+1],n[g+2]=l[f+2]+=n[g+2];else for(e=0;e<=h;e++)f=3*(d*k+e),g=3*(m*k+e),n[g]=l[f]+=n[g],n[g+1]=l[f+1]+=n[g+1],n[g+2]=l[f+2]+=n[g+2];else if(this.zoomIndex>g.zoomIndex)if(c=og.quadTree.NOPSORD[c][this.node.partId]*h*.5,e)for(e=0;e<=h;e++)f=3*(e*k+d),g=3*((Math.floor(.5*e)+c)*k+m),n[g]=l[f]+=n[g],n[g+1]=l[f+1]+=n[g+1],n[g+2]=l[f+2]+=n[g+2];else for(e=0;e<=h;e++)f=3*(d*k+e),g=3*(m*k+Math.floor(.5*e)+c),n[g]=l[f]+=n[g],n[g+1]=l[f+1]+=n[g+1],n[g+2]=l[f+
2]+=n[g+2];else this.zoomIndex<g.zoomIndex&&(g._inTheQueue||this.planet.normalMapCreator.queue(g),(d=f.parentNode.nodes[og.quadTree.NOPS[c][this.node.partId]])&&!d.planetSegment._inTheQueue&&this.planet.normalMapCreator.queue(d.planetSegment))}}};
og.planetSegment.PlanetSegment.prototype.createNormalMapTexture=function(){if(!(this.zoomIndex>this.planet.terrainProvider.maxZoom)){var c=this.node.neighbors;if(c){var d=c[og.quadTree.N],e=c[og.quadTree.E],f=c[og.quadTree.S],c=c[og.quadTree.W];this.zoomIndex>this.planet.terrainProvider.minZoom&&(d&&d.planetSegment.terrainIsLoading||e&&e.planetSegment.terrainIsLoading||f&&f.planetSegment.terrainIsLoading||c&&c.planetSegment.terrainIsLoading)?this._inTheQueue||this.planet.normalMapCreator.shift(this):
(this.normalMapEdgeEqualize(og.quadTree.N,0),this.normalMapEdgeEqualize(og.quadTree.S,32),this.normalMapEdgeEqualize(og.quadTree.W,0,!0),this.normalMapEdgeEqualize(og.quadTree.E,32,!0),this.normalMapTexture=this.handler.createTexture_mm(this.planet.normalMapCreator.draw(this.normalMapNormals)),this.normalMapReady=!0,this.normalMapTextureBias=[0,0,1])}}};
og.planetSegment.PlanetSegment.prototype.createGeoImageTileTexture=function(){var c=this.planet.geoImageTileCreator.draw(this);this.geoImageTexture=c?this.handler.createTexture_mm(c):this.planet.transparentTexture;this.geoImageTextureBias=[0,0,1];this.geoImageReady=!0};
og.planetSegment.PlanetSegment.prototype.drawGeoImage=function(c){if(c.visibility&&c.imageLoaded&&c._mercExtent.intersects(this.extent)){var d=this.planet.geoImageTileCreator;c._mercSamplerReady||d.createMercatorSamplerPASS(c);var e=d._handler,f=e.shaderPrograms.geoImage._program,g=f.attributes,f=f.uniforms,h=e.gl;e.shaderPrograms.geoImage.activate();h.bindBuffer(h.ARRAY_BUFFER,d._texCoordsBuffer);h.vertexAttribPointer(g.a_texCoord._pName,d._texCoordsBuffer.itemSize,h.FLOAT,!1,0,0);h.bindBuffer(h.ARRAY_BUFFER,
c._mercCornersBuffer);h.vertexAttribPointer(g.a_corner._pName,c._mercCornersBuffer.itemSize,h.FLOAT,!1,0,0);h.uniform4fv(f.u_extentParams._pName,this.extentParams);h.uniform1f(f.u_opacity._pName,c.opacity);h.activeTexture(h.TEXTURE0);h.bindTexture(h.TEXTURE_2D,c._mercFramebuffer.texture);h.uniform1i(f.u_sourceImage._pName,0);h.drawArrays(h.TRIANGLE_STRIP,0,4);return!0}};og.planetSegment.PlanetSegment.prototype.applyTerrain=function(c){c.length?this.elevationsExists(c):this.elevationsNotExists()};
og.planetSegment.PlanetSegment.prototype.deleteBuffers=function(){var c=this.handler.gl;c.deleteBuffer(this.vertexPositionBuffer);c.deleteBuffer(this.vertexIndexBuffer);c.deleteBuffer(this.vertexTextureCoordBuffer);this.vertexTextureCoordBuffer=this.vertexIndexBuffer=this.vertexPositionBuffer=null};og.planetSegment.PlanetSegment.prototype.clearBuffers=function(){this.ready=!1;this.deleteBuffers()};
og.planetSegment.PlanetSegment.prototype.deleteElevations=function(){this.terrainIsLoading=this.terrainReady=this._inTheQueue=!1;this.normalMapVertices.length=0;this.normalMapNormals.length=0;this.tempVertices.length=0;this.terrainVertices.length=0;this.plainVertices.length=0;this.plainNormals.length=0;this.normalMapReady&&this.handler.gl.deleteTexture(this.normalMapTexture);this.geoImageReady&&!this.geoImageTexture["default"]&&this.handler.gl.deleteTexture(this.geoImageTexture);this.geoImageReady=
!1;this.geoImageTextureBias=[0,0,1];this.parentNormalMapReady=this.normalMapReady=!1;this._appliedNeighborsZoom=[0,0,0,0];this.normalMapTextureBias=[0,0,1]};og.planetSegment.PlanetSegment.prototype.getMaterialByLayer=function(c){for(var d=this.materials,e=0;e<d.length;e++)if(d[e].layer==c)return d[e]};og.planetSegment.PlanetSegment.prototype.getMaterialByLayerName=function(c){for(var d=this.materials,e=0;e<d.length;e++)if(d[e].layer.name==c)return d[e]};
og.planetSegment.PlanetSegment.prototype.clearSegment=function(){this.clearBuffers();this.deleteMaterials();this.deleteElevations()};og.planetSegment.PlanetSegment.prototype.deleteMaterials=function(){for(var c=this.materials,d=0;d<c.length;d++){var e=c[d];e&&e.clear()}c.length=0};
og.planetSegment.PlanetSegment.prototype.createBoundsByExtent=function(){var c=this.planet.ellipsoid,d=this.extent,e=og.math.MAX,f=og.math.MIN,g=og.math.MAX,h=og.math.MIN,k=og.math.MAX,m=og.math.MIN,l=[];l.push(og.LonLat.inverseMercator(d.southWest.lon,d.southWest.lat),og.LonLat.inverseMercator(d.southWest.lon,d.northEast.lat),og.LonLat.inverseMercator(d.northEast.lon,d.northEast.lat),og.LonLat.inverseMercator(d.northEast.lon,d.southWest.lat));for(d=0;d<l.length;d++){var n=c.LonLat2ECEF(l[d]),p=n.x,
q=n.y,n=n.z;p<e&&(e=p);p>f&&(f=p);q<g&&(g=q);q>h&&(h=q);n<k&&(k=n);n>m&&(m=n)}this.bsphere.setFromBounds([e,f,g,h,k,m])};og.planetSegment.PlanetSegment.prototype.destroySegment=function(){this.node.state=og.quadTree.NOTRENDERING;this.clearSegment();this.normalMapTextureBias=this._appliedNeighborsZoom=this.extent=null;this.node.neighbors=null;this.node.hasNeighbors=null;this.node.parentNode=null};
og.planetSegment.PlanetSegment.prototype.createCoordsBuffers=function(c,d){var e=(d+1)*(d+1);this.vertexTextureCoordBuffer=this.handler.createArrayBuffer(new Float32Array(og.planetSegment.PlanetSegmentHelper.textureCoordsTable[d]),2,e);this.vertexPositionBuffer=this.handler.createArrayBuffer(new Float32Array(c),3,e)};
og.planetSegment.PlanetSegment.prototype.createIndexesBuffer=function(c,d){var e=og.planetSegment.PlanetSegmentHelper.createSegmentIndexes(d,c);this.vertexIndexBuffer=this.handler.createElementArrayBuffer(e,1,e.length)};
og.planetSegment.PlanetSegment.prototype.assignTileIndexes=function(c,d){this.zoomIndex=c;this.extent=d;var e=og.mercator.POLE;this.tileX=Math.round(Math.abs(-e-d.southWest.lon)/(d.northEast.lon-d.southWest.lon));this.tileY=Math.round(Math.abs(e-d.northEast.lat)/(d.northEast.lat-d.southWest.lat));this.extentParams=[this.extent.southWest.lon,this.extent.southWest.lat,2/this.extent.getWidth(),2/this.extent.getHeight()]};
og.planetSegment.PlanetSegment.prototype.createPlainVertices=function(c){var d=this.plainVertices,e=this.plainNormals,f=this.normalMapVertices,g=this.normalMapNormals,h=this.extent,k=this.planet.terrainProvider.fileGridSize,m=h.getWidth()/Math.max(k,c),l=h.southWest.lon,h=h.northEast.lat,n=Math.max(k/c,1);c=Math.max(k,c)+1;for(var k=this.planet.ellipsoid._invRadii2,p=0,q=0,r=0;r<c;r++)for(var t=0;t<c;t++){var v=this.planet.ellipsoid.LonLat2ECEF(og.LonLat.inverseMercator(l+t*m,h-r*m)),E=v.x*k.x,u=
v.y*k.y,D=v.z*k.z,F=1/Math.sqrt(E*E+u*u+D*D),E=E*F,u=u*F,D=D*F;f[q]=v.x;g[q++]=E;f[q]=v.y;g[q++]=u;f[q]=v.z;g[q++]=D;0==r%n&&0==t%n&&(d[p]=v.x,e[p++]=E,d[p]=v.y,e[p++]=u,d[p]=v.z,e[p++]=D)}this.normalMapTexture=this.planet.transparentTexture};
og.planetSegment.drawSingle=function(c,d){if(d.ready){var e=d.handler.gl,f=c.uniforms,g=d.planet.visibleLayers;g.length&&(g=d.materials[g[0].id],e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,g.texture),e.uniform3fv(f.texBias._pName,g.texBias),e.uniform1i(f.uSampler._pName,0),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,d.geoImageTexture),e.uniform1i(f.uGeoImage._pName,2),e.uniform3fv(f.geoImageTexBias._pName,d.geoImageTextureBias),d.planet.lightEnabled&&(e.uniform3fv(f.uNormalMapBias._pName,
d.normalMapTextureBias),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,d.normalMapTexture),e.uniform1i(f.uNormalMap._pName,1)));d.draw(c)}};
og.planetSegment.drawOverlays=function(c,d){if(d.ready){for(var e=d.handler.gl,f=c.uniforms,g=d.planet.visibleLayers,h=0;h<g.length;h++){var k=d.materials[g[h].id],m=3*h;d.texBiasArr[m]=k.texBias[0];d.texBiasArr[m+1]=k.texBias[1];d.texBiasArr[m+2]=k.texBias[2];d.samplerArr[h]=h;e.activeTexture(e.TEXTURE0+c._textureID+h);e.bindTexture(e.TEXTURE_2D,k.texture)}e.uniform3fv(f.texBiasArr._pName,d.texBiasArr);e.uniform1iv(f.uSamplerArr._pName,d.samplerArr);d.planet.lightEnabled&&(e.uniform3fv(f.uNormalMapBias._pName,
d.normalMapTextureBias),e.activeTexture(e.TEXTURE0+g.length),e.bindTexture(e.TEXTURE_2D,d.normalMapTexture),e.uniform1i(f.uNormalMap._pName,g.length));e.activeTexture(e.TEXTURE0+g.length+1);e.bindTexture(e.TEXTURE_2D,d.geoImageTexture);e.uniform1i(f.uGeoImage._pName,+g.length+1);e.uniform3fv(f.geoImageTexBias._pName,d.geoImageTextureBias);d.draw(c)}};
og.planetSegment.PlanetSegment.prototype.draw=function(c){var d=this.handler.gl,e=c.attributes;d.bindBuffer(d.ARRAY_BUFFER,this.vertexPositionBuffer);d.vertexAttribPointer(e.aVertexPosition._pName,this.vertexPositionBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this.vertexTextureCoordBuffer);d.vertexAttribPointer(e.aTextureCoord._pName,this.vertexTextureCoordBuffer.itemSize,d.FLOAT,!1,0,0);this._setVIb();c.drawIndexBuffer(this.planet.drawMode,this._vib);this.node.hasNeighbor=[!1,!1,
!1,!1]};og.planetSegment.PlanetSegment.prototype._setVIb=function(){this.node.sideSize[og.quadTree.N]&this.node.sideSize[og.quadTree.W]&this.node.sideSize[og.quadTree.S]&this.node.sideSize[og.quadTree.E]?this._vib=this.planet.indexesBuffers[this.gridSize]:(this.createIndexesBuffer(this.node.sideSize,this.gridSize),this._vib=this.vertexIndexBuffer)};
og.planetSegment.PlanetSegment.prototype.drawPicking=function(){if(this.ready){var c=this.handler.gl,d=this.handler.shaderPrograms.picking._program,e=d.attributes;c.uniformMatrix4fv(d.uniforms.uPMVMatrix._pName,!1,this.node.planet.renderer.activeCamera.pmvMatrix._m);c.bindBuffer(c.ARRAY_BUFFER,this.vertexPositionBuffer);c.vertexAttribPointer(e.aVertexPosition._pName,this.vertexPositionBuffer.itemSize,c.FLOAT,!1,0,0);this._setVIb();d.drawIndexBuffer(c.TRIANGLE_STRIP,this._vib);this.node.sideSize=[this.gridSize,
this.gridSize,this.gridSize,this.gridSize]}};og.control.MousePosition=function(c){og.inheritance.base(this,c);this.displayType=0;this.converter=og.control.MousePosition.DisplayTypesConverters[0];this.position=this.display=null};og.inheritance.extend(og.control.MousePosition,og.control.Control);og.control.MousePosition.toDecimal=function(c){return c.lat.toFixed(5)+", "+c.lon.toFixed(5)};og.control.MousePosition.toDegrees=function(c){return og.control.MousePosition.dec2deg(c.lat)+", "+og.control.MousePosition.dec2deg(c.lon)};
og.control.MousePosition.toMercator=function(c){c=c.forwardMercator();return c.lat.toFixed(5)+", "+c.lon.toFixed(5)};og.control.MousePosition.DisplayTypesConverters=[og.control.MousePosition.toDecimal,og.control.MousePosition.toDegrees,og.control.MousePosition.toMercator];
og.control.MousePosition.dec2deg=function(c){var d,e=0>c?Math.ceil(c):Math.floor(c);c=Math.floor(d=60*Math.abs(c-e));d=Math.floor(6E3*(d-c));d/=100;return og.control.MousePosition.numToFixedString(e,3)+"\u00b0"+og.control.MousePosition.numToFixedString(c,2)+"'"+og.control.MousePosition.numToFixedString(d.toFixed(2),2)+'"'};og.control.MousePosition.numToFixedString=function(c,d){for(var e="&nbsp;",f=c.toString().split(".")[0].length;f<d;f++)e+="&nbsp;&nbsp;";return e+c.toString()};
og.control.MousePosition.prototype.init=function(){this.display=document.createElement("div");this.display.className="ogMousePositionControl";var c=this;this.display.onclick=function(d){c.displayType+=1;c.displayType>=og.control.MousePosition.DisplayTypesConverters.length&&(c.displayType=0);c.converter=og.control.MousePosition.DisplayTypesConverters[c.displayType];c.showPosition()};this.renderer.div.appendChild(this.display);this.renderer.events.on("onmousemove",this,this.onMouseMove)};
og.control.MousePosition.prototype.showPosition=function(){this.display.innerHTML=this.position?"Lat/Lon: "+this.converter(this.position)+" Height(km): "+(0<this.position.height?"~"+(Math.round(this.position.height)/1E3).toFixed(2):"-"):"Lat/Lon: _____________________"};
og.control.MousePosition.prototype.onMouseMove=function(){var c=this.renderer.events.mouseState;!c.leftButtonDown&&!c.rightButtonDown&&0>=this.renderer.controlsBag.scaleRot&&(this.position=this.renderer.renderNodes.Earth.getLonLatFromPixelTerrain(c),this.showPosition())};og.control.LoadingSpinner=function(c){og.inheritance.base(this,c);this.spinnerElement=null};og.inheritance.extend(og.control.LoadingSpinner,og.control.Control);
og.control.LoadingSpinner.prototype.init=function(){this.spinnerElement=document.createElement("div");this.spinnerElement.id="circleG";var c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("div");this.spinnerElement.appendChild(c);this.spinnerElement.appendChild(d);this.spinnerElement.appendChild(e);c.id="circleG_1";c.className="circleG";d.id="circleG_2";d.className="circleG";e.id="circleG_3";e.className="circleG";this.spinnerElement.className="displayBlock";
document.body.appendChild(this.spinnerElement);this.renderer.events.on("ondraw",this,this.draw)};og.control.LoadingSpinner.prototype.draw=function(){for(var c=!1,d=this.renderer.renderNodes.Earth,e=d.layers,f=0;f<e.length;)if(0!=e[f++].counter){c=!0;break}this.spinnerElement.className=0!=d.terrainProvider.counter||c?"displayBlock":"displayNone"};og.Ellipsoid=function(c,d){var e=this._a=c,f=this._b=d;this.flattening=e/f;this.a2=e*e;this.b2=f*f;this._e=Math.sqrt(this.a2-this.b2)/e;this._e2=Math.pow(this._e,2);this._k=Math.sqrt(this.a2-this.b2)/f;this._k2=Math.pow(this._k,2);this._radii=new og.math.Vector3(c,d,c);this._radii2=new og.math.Vector3(c*c,d*d,c*c);this._invRadii=new og.math.Vector3(1/c,1/d,1/c);this._invRadii2=new og.math.Vector3(1/(c*c),1/(d*d),1/(c*c))};
og.Ellipsoid.prototype.N=function(c){return this._a/Math.sqrt(1-this._e2*Math.pow(Math.sin(c),2))};og.Ellipsoid.prototype.LonLat2ECEF=function(c){var d=og.math.DEG2RAD(c.lat),e=og.math.DEG2RAD(c.lon),f=(this.N(d)+c.height)*Math.cos(d)*Math.cos(e),e=(this.N(d)+c.height)*Math.cos(d)*Math.sin(e);c=(this.N(d)*(1-this._e2)+c.height)*Math.sin(d);return new og.math.Vector3(e,c,f)};
og.Ellipsoid.prototype.ECEF2LonLat=function(c){var d=c.z,e=c.x;c=c.y;var f=this._e2,g=d*d+e*e,h=Math.sqrt(g),k=c*c,m=54*this.b2*k,l=g+(1-f)*k+f*(this.a2-this.b2),n=l*l,l=f*f*m*g/(n*l),l=Math.pow(1+l+Math.sqrt(l*(l+2)),1/3),m=m/(3*Math.pow(l+1/l+1,2)*n),n=Math.sqrt(1+2*f*f*m),g=-(m*f*h)/1+n+Math.sqrt(.5*this.a2*(1+1/n)-m*(1-f)*k/(n*(1+n))-.5*m*g),m=Math.sqrt(Math.pow(h-f*g,2)+(1-f)*k);return new og.LonLat(Math.atan2(e,d)/Math.PI*180,Math.atan((c+this.b2*c/(this._a*m)*this._k2)/h)/Math.PI*180,Math.sqrt(Math.pow(h-
f*g,2)+k)*(1-this.b2/(this._a*m)))};og.Ellipsoid.prototype.getSurfaceNormal=function(c,d,e){var f=this._invRadii2;c*=f.x;d*=f.y;e*=f.z;f=1/Math.sqrt(c*c+d*d+e*e);return new og.math.Vector3(c*f,d*f,e*f)};og.Ellipsoid.prototype.getCartesianHeight=function(c,d,e,f){var g=this._invRadii2,h=c*g.x,k=d*g.y,g=e*g.z,m=1/Math.sqrt(h*h+k*k+g*g);return new og.math.Vector3(c+f*h*m,d+f*k*m,e+f*g*m)};og.ellipsoid={};og.ellipsoid.wgs84=new og.Ellipsoid(6378137,6356752.3142);og.proj.EPSG4326=new og.proj.Projection({code:"epsg:4326",units:og.Units.DEGREES});og.planetSegment.Wgs84PlanetSegment=function(){og.inheritance.base(this);this._projection=og.proj.EPSG4326};og.planetSegment.Wgs84PlanetSegment._heightLat=90-og.mercator.MAX_LAT;og.planetSegment.Wgs84PlanetSegment._maxPoleZoom=7;og.planetSegment.Wgs84PlanetSegment._pieceSize=og.planetSegment.Wgs84PlanetSegment._heightLat/Math.pow(2,og.planetSegment.Wgs84PlanetSegment._maxPoleZoom);og.inheritance.extend(og.planetSegment.Wgs84PlanetSegment,og.planetSegment.PlanetSegment);
og.planetSegment.Wgs84PlanetSegment.RATIO_LOD=1.12;og.planetSegment.Wgs84PlanetSegment.prototype.acceptForRendering=function(c){var d=this.bsphere,e;e=this.extent.northEast.lat;0<e?(e=Math.floor((90-e)/og.planetSegment.Wgs84PlanetSegment._pieceSize),e=Math.floor(e/16)+7):(e=Math.floor((og.mercator.MIN_LAT-e)/og.planetSegment.Wgs84PlanetSegment._pieceSize),e=12-Math.floor(e/16));return c.projectedSize(d.center)>og.planetSegment.Wgs84PlanetSegment.RATIO_LOD*d.radius||this.zoomIndex>e};
og.planetSegment.Wgs84PlanetSegment.prototype.assignTileIndexes=function(c,d){this.zoomIndex=c;this.wgs84extent=this.extent=d;this.tileX=Math.round(Math.abs(-180-d.southWest.lon)/(d.northEast.lon-d.southWest.lon));var e=d.northEast.lat;this.tileY=0<e?Math.round((90-e)/(d.northEast.lat-d.southWest.lat)):Math.round((og.mercator.MIN_LAT-e)/(d.northEast.lat-d.southWest.lat));this.extentParams=[d.southWest.lon,d.southWest.lat,2/d.getWidth(),2/d.getHeight()]};
og.planetSegment.Wgs84PlanetSegment.prototype.createPlainVertices=function(c){for(var d=this.plainVertices,e=this.plainNormals,f=0,g=this.extent,h=g.getWidth(),k=g.getHeight(),h=h/c,k=k/c,m=g.southWest.lon,g=g.northEast.lat,l=this.planet.ellipsoid._invRadii2,n=0;n<=c;n++)for(var p=0;p<=c;p++){var q=this.planet.ellipsoid.LonLat2ECEF(new og.LonLat(m+p*h,g-n*k)),r=q.x*l.x,t=q.y*l.y,v=q.z*l.z,E=1/Math.sqrt(r*r+t*t+v*v);d[f]=q.x;e[f++]=r*E;d[f]=q.y;e[f++]=t*E;d[f]=q.z;e[f++]=v*E}this.normalMapVertices=
d;this.normalMapNormals=e;this.normalMapTexture=this.planet.transparentTexture};
og.planetSegment.Wgs84PlanetSegment.prototype.createBoundsByExtent=function(){var c=this.planet.ellipsoid,d=this.extent,e=og.math.MAX,f=og.math.MIN,g=og.math.MAX,h=og.math.MIN,k=og.math.MAX,m=og.math.MIN,l=[];l.push(new og.LonLat(d.southWest.lon,d.southWest.lat),new og.LonLat(d.southWest.lon,d.northEast.lat),new og.LonLat(d.northEast.lon,d.northEast.lat),new og.LonLat(d.northEast.lon,d.southWest.lat));for(d=0;d<l.length;d++){var n=c.LonLat2ECEF(l[d]),p=n.x,q=n.y,n=n.z;p<e&&(e=p);p>f&&(f=p);q<g&&(g=
q);q>h&&(h=q);n<k&&(k=n);n>m&&(m=n)}this.bsphere.setFromBounds([e,f,g,h,k,m])};
og.planetSegment.Wgs84PlanetSegment.prototype.drawGeoImage=function(c){if(c.visibility&&c.imageLoaded&&c._wgs84Extent.intersects(this.extent)){var d=this.planet.geoImageTileCreator,e=d._handler,f=e.shaderPrograms.geoImage._program,g=f.attributes,f=f.uniforms,h=e.gl;e.shaderPrograms.geoImage.activate();h.bindBuffer(h.ARRAY_BUFFER,d._texCoordsBuffer);h.vertexAttribPointer(g.a_texCoord._pName,d._texCoordsBuffer.itemSize,h.FLOAT,!1,0,0);h.bindBuffer(h.ARRAY_BUFFER,c._wgs84CornersBuffer);h.vertexAttribPointer(g.a_corner._pName,
c._wgs84CornersBuffer.itemSize,h.FLOAT,!1,0,0);h.uniform4fv(f.u_extentParams._pName,this.extentParams);h.uniform1f(f.u_opacity._pName,c.opacity);h.activeTexture(h.TEXTURE0);h.bindTexture(h.TEXTURE_2D,c._wgs84SourceTexture);h.uniform1i(f.u_sourceImage._pName,0);h.drawArrays(h.TRIANGLE_STRIP,0,4);return!0}};og.shaderProgram.overlays_nl=function(){return new og.shaderProgram.ShaderProgram("overlays_nl",{uniforms:{uPMVMatrix:{type:og.shaderProgram.types.MAT4},uSamplerArr:{type:og.shaderProgram.types.SAMPLER2DXX},texBiasArr:{type:og.shaderProgram.types.VEC3},tcolorArr:{type:og.shaderProgram.types.VEC4},numTex:{type:og.shaderProgram.types.INT},uGeoImage:{type:og.shaderProgram.types.SAMPLER2D},geoImageTexBias:{type:og.shaderProgram.types.VEC3}},attributes:{aVertexPosition:{type:og.shaderProgram.types.VEC3,
enableArray:!0},aTextureCoord:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"overlays_nl_vs.txt"),fragmentShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"overlays_nl_fs.txt")})};
og.shaderProgram.overlays_wl=function(){return new og.shaderProgram.ShaderProgram("overlays_wl",{uniforms:{uPMatrix:{type:og.shaderProgram.types.MAT4},uMVMatrix:{type:og.shaderProgram.types.MAT4},uNMatrix:{type:og.shaderProgram.types.MAT3},uNormalMap:{type:og.shaderProgram.types.SAMPLER2D},uNormalMapBias:{type:og.shaderProgram.types.VEC3},uSamplerArr:{type:og.shaderProgram.types.SAMPLER2DXX},texBiasArr:{type:og.shaderProgram.types.VEC3},tcolorArr:{type:og.shaderProgram.types.VEC4},numTex:{type:og.shaderProgram.types.INT},
pointLightsPositions:{type:og.shaderProgram.types.VEC3},pointLightsParamsv:{type:og.shaderProgram.types.VEC3},pointLightsParamsf:{type:og.shaderProgram.types.FLOAT},uGeoImage:{type:og.shaderProgram.types.SAMPLER2D},geoImageTexBias:{type:og.shaderProgram.types.VEC3}},attributes:{aVertexPosition:{type:og.shaderProgram.types.VEC3,enableArray:!0},aTextureCoord:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"overlays_wl_vs.txt"),fragmentShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+
"overlays_wl_fs.txt")})};og.math.coder={};og.math.coder.encodeFloatToRGBA=function(c){var d=Math.abs(c);c=og.math.step(0,-c);var e=Math.floor(og.math.log2(d)),f=og.math.exp2(-e)*d,e=Math.floor(og.math.log2(d)+127)+Math.floor(og.math.log2(f));return new og.math.Vector4(128*c+Math.floor(e*og.math.exp2(-1)),128*og.math.mod(e,2)+og.math.mod(Math.floor(128*f),128),Math.floor(og.math.mod(Math.floor(f*og.math.exp2(15)),og.math.exp2(8))),Math.floor(og.math.exp2(23)*og.math.mod(f,og.math.exp2(-15))))};
og.math.coder.decodeFloatFromRGBA=function(c){var d=1-2*og.math.step(128,c.x),e=2*og.math.mod(c.x,128)+og.math.step(128,c.y)-127;c=65536*og.math.mod(c.y,128)+256*c.z+c.w+8388608;return d*og.math.exp2(e)*c*og.math.exp2(-23)};og.math.coder.doubleToTwoFloats=function(c){var d;if(0<=c){var e=65536*Math.floor(c/65536);d=Math.fround(e);c=Math.fround(c-e)}else e=65536*Math.floor(-c/65536),d=Math.fround(-e),c=Math.fround(c+e);return[d,c]};og.utils.GeoImageTileCreator=function(c,d){this._width=c||256;this._height=d||256;this._framebufferPASS_ONE=this._vertexBuffer=this._texCoordsBuffer=this._framebufferPASS_ONE=this._handler=null;this._init()};
og.utils.GeoImageTileCreator.prototype._init=function(){var c=new og.shaderProgram.ShaderProgram("geoImage",{uniforms:{u_sourceImage:{type:og.shaderProgram.types.SAMPLER2D},u_extentParams:{type:og.shaderProgram.types.VEC4},u_opacity:{type:og.shaderProgram.types.FLOAT}},attributes:{a_corner:{type:og.shaderProgram.types.VEC2,enableArray:!0},a_texCoord:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:"attribute vec2 a_corner; \r\n                      attribute vec2 a_texCoord; \r\n                      varying vec2 v_texCoords; \r\n                      uniform vec4 u_extentParams; \r\n                      void main() { \r\n                          v_texCoords = a_texCoord; \r\n                          gl_Position = vec4(-1.0 + (a_corner - u_extentParams.xy) * u_extentParams.zw, 0, 1); \r\n                      }",
fragmentShader:"precision mediump float; \r\n                        uniform sampler2D uSourceImage; \r\n                        uniform float u_opacity; \r\n                        varying vec2 v_texCoords; \r\n                        void main () {  \r\n                            vec4 color = texture2D(uSourceImage, v_texCoords); \r\n                            if(color.a == 0.0) discard; \r\n                            gl_FragColor = vec4(color.rgb, u_opacity * color.a); \r\n                        }"}),
d=new og.shaderProgram.ShaderProgram("geoImageMercProj",{uniforms:{u_sampler:{type:og.shaderProgram.types.SAMPLER2D},u_extent:{type:og.shaderProgram.types.VEC4}},attributes:{a_vertex:{type:og.shaderProgram.types.VEC2,enableArray:!0},a_texCoord:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:"attribute vec2 a_vertex; \r\n                            attribute vec2 a_texCoord; \r\n                            varying vec2 v_texCoords; \r\n                            void main() { \r\n                                v_texCoords = a_texCoord; \r\n                                gl_Position = vec4(a_vertex, 0, 1); \r\n                            }",
fragmentShader:"precision highp float; \n\r\n                        uniform sampler2D u_sampler; \n\r\n                        uniform vec4 u_extent; \n\r\n                        varying vec2 v_texCoords; \n\r\n                        const float POLE=20037508.34; \n\r\n                        const float PI=3.141592653589793; \n\r\n                        \n\r\n                        vec2 forward(vec2 lonLat){\n\r\n                            return vec2(lonLat.x * POLE / 180.0, log(tan((90.0 + lonLat.y) * PI / 360.0)) / PI * POLE);\n\r\n                        }\n\r\n                        vec2 inverse(vec2 lonLat){\n\r\n                            return vec2(180.0 * lonLat.x / POLE, 180.0 / PI * (2.0 * atan(exp((lonLat.y / POLE) * PI)) - PI / 2.0));\n\r\n                        }\n\r\n                        \n\r\n                        void main () {\n\r\n                            vec2 minMerc = forward(u_extent.xy); \n\r\n                            vec2 d = (inverse(minMerc + (forward(u_extent.zw) - minMerc) * \r\n                            vec2(v_texCoords.x, 1.0 - v_texCoords.y)) - u_extent.xy) / \r\n                            vec2(u_extent.z - u_extent.x, u_extent.w - u_extent.y);\n\r\n                            gl_FragColor = texture2D(u_sampler, vec2(d.x, d.y));\n\r\n            }"});
this._handler=new og.webgl.Handler(null,{width:this._width,height:this._height,context:{alpha:!0,depth:!1}});this._handler.addShaderProgram(c);this._handler.addShaderProgram(d);this._handler.init();this._handler.deactivateFaceCulling();this._handler.deactivateDepthTest();this._framebufferPASS_ONE=new og.webgl.Framebuffer(this._handler.gl,1024,1024);this._texCoordsBuffer=this._handler.createArrayBuffer(new Float32Array([0,1,1,1,0,0,1,0]),2,4);this._vertexBuffer=this._handler.createArrayBuffer(new Float32Array([-1,
1,1,1,-1,-1,1,-1]),2,4)};
og.utils.GeoImageTileCreator.prototype.createMercatorSamplerPASS=function(c){this._framebufferPASS_ONE.setSize(c.image.width,c.image.height);c._mercFramebuffer.setSize(c.image.width,c.image.height);this._handler.setSize(c.image.width,c.image.height);var d=this._handler,e=d.gl;this._framebufferPASS_ONE.activate();d.shaderPrograms.geoImage.activate();var f=d.shaderPrograms.geoImage._program,g=f.attributes,f=f.uniforms;e.clearColor(1,1,1,0);e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);e.uniform1f(f.u_opacity._pName,
1);e.bindBuffer(e.ARRAY_BUFFER,this._texCoordsBuffer);e.vertexAttribPointer(g.a_texCoord._pName,this._texCoordsBuffer.itemSize,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,c._wgs84CornersBuffer);e.vertexAttribPointer(g.a_corner._pName,c._wgs84CornersBuffer.itemSize,e.FLOAT,!1,0,0);g=[c._wgs84MercExtent.southWest.lon,c._wgs84MercExtent.southWest.lat,2/c._wgs84MercExtent.getWidth(),2/c._wgs84MercExtent.getHeight()];e.uniform4fv(f.u_extentParams._pName,g);e.activeTexture(e.TEXTURE0);e.bindTexture(e.TEXTURE_2D,
c._wgs84SourceTexture);e.uniform1i(f.u_sourceImage._pName,0);e.drawArrays(e.TRIANGLE_STRIP,0,4);this._framebufferPASS_ONE.deactivate();c._mercFramebuffer.activate();d.shaderPrograms.geoImageMercProj.activate();f=d.shaderPrograms.geoImageMercProj._program;g=f.attributes;f=f.uniforms;e.clearColor(0,0,0,0);e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);e.bindBuffer(e.ARRAY_BUFFER,this._texCoordsBuffer);e.vertexAttribPointer(g.a_texCoord._pName,this._texCoordsBuffer.itemSize,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,
this._vertexBuffer);e.vertexAttribPointer(g.a_vertex._pName,this._vertexBuffer.itemSize,e.FLOAT,!1,0,0);e.activeTexture(e.TEXTURE0);e.bindTexture(e.TEXTURE_2D,this._framebufferPASS_ONE.texture);e.uniform1i(f.u_sampler._pName,0);e.uniform4fv(f.u_extent._pName,[c._wgs84MercExtent.southWest.lon,c._wgs84MercExtent.southWest.lat,c._wgs84MercExtent.northEast.lon,c._wgs84MercExtent.northEast.lat]);e.drawArrays(e.TRIANGLE_STRIP,0,4);c._mercFramebuffer.deactivate();c._mercSamplerReady=!0;this._handler.setSize(this._width,
this._height)};og.utils.GeoImageTileCreator.prototype.draw=function(c){var d=this._handler.gl;d.clearColor(0,0,0,0);d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT);d.enable(d.BLEND);d.blendEquation(d.FUNC_ADD);d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE);for(var e=c.planet.geoImagesArray,f=e.length,g=!1;f--;){var h=e[f];1==h.opacity?d.disable(d.BLEND):d.enable(d.BLEND);g|=c.drawGeoImage(h)}d.disable(d.BLEND);return g?this._handler.canvas:null};og.planetSegment.GeoImageTileCreatorQueue=function(c,d){og.inheritance.base(this,c,d);this.active=!0;this._counter=0;this._pendingsQueue=new og.QueueArray};og.inheritance.extend(og.planetSegment.GeoImageTileCreatorQueue,og.utils.GeoImageTileCreator);og.planetSegment.GeoImageTileCreatorQueue.prototype.shift=function(c){this.active&&(c._inTheGeoImageTileCreatorQueue=!0,1<=this._counter?this._pendingsQueue.unshift(c):this._exec(c))};
og.planetSegment.GeoImageTileCreatorQueue.prototype.queue=function(c){this.active&&(c._inTheGeoImageTileCreatorQueue=!0,1<=this._counter?this._pendingsQueue.push(c):this._exec(c))};og.planetSegment.GeoImageTileCreatorQueue.prototype._exec=function(c){this._counter++;var d=this;setTimeout(function(){c.createGeoImageTileTexture();c._inTheGeoImageTileCreatorQueue=!1;d._dequeueRequest()},0)};
og.planetSegment.GeoImageTileCreatorQueue.prototype._dequeueRequest=function(){this._counter--;if(this._pendingsQueue.length&&1>this._counter){var c;(c=this._whilePendings())&&this._exec(c)}};og.planetSegment.GeoImageTileCreatorQueue.prototype._whilePendings=function(){for(;this._pendingsQueue.length;){var c=this._pendingsQueue.pop();if(c.terrainReady&&c.node.getState()!=og.quadTree.NOTRENDERING&&c._inTheGeoImageTileCreatorQueue)return c;c._inTheGeoImageTileCreatorQueue=!1}return null};og.planetSegment.PlanetSegmentMaterial=function(c,d){this.segment=c;this.layer=d;this.imageIsLoading=this.imageReady=!1;this.texBias=[0,0,1];this.image=this.texture=null;this.textureExists=!1};og.planetSegment.PlanetSegmentMaterial.prototype.assignLayer=function(c){this.layer=c};
og.planetSegment.PlanetSegmentMaterial.prototype.loadTileImage=function(){this.texture=this.layer.isBaseLayer?this.segment.planet.solidTexture:this.segment.planet.transparentTexture;this.imageIsLoading||(this.imageReady=!1,this.imageIsLoading=!0,this.layer.handleSegmentTile(this))};og.planetSegment.PlanetSegmentMaterial.prototype.abortLoading=function(){this.image&&(this.image.src="",this.image=null);this.imageReady=this.imageIsLoading=!1};
og.planetSegment.PlanetSegmentMaterial.prototype.applyTexture=function(c){this.imageReady||(this.image=c,this.texture=this.segment.handler.createTexture(c),this.texBias=[0,0,1],this.segment.node.appliedTextureNodeId=this.segment.node.nodeId,this.textureExists=this.imageReady=!0,this.imageIsLoading=!1)};og.planetSegment.PlanetSegmentMaterial.prototype.textureNotExists=function(){this.imageIsLoading=!0;this.textureExists=!1};
og.planetSegment.PlanetSegmentMaterial.prototype.clear=function(){this.imageIsLoading=!1;this.imageReady&&(this.imageReady=!1,this.texture["default"]||this.segment.handler.gl.deleteTexture(this.texture),this.image=this.texture=null,this.texBias=[0,0,1])};og.quadTree.QuadNode=function(c){this.parentNode=null;this.nodes=[];this.state=this.planet=this.nodeId=this.partId=this.planetSegment=null;this.appliedTerrainNodeId=-1;this.sideSize=[0,0,0,0];this.hasNeighbor=[!1,!1,!1,!1];this.neighbors=[null,null,null,null];this.cameraInside=!1;this.planetSegmentPrototype=c};og.quadTree.QuadNode._vertOrder=[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}];og.quadTree.QuadNode._neGridSize=Math.sqrt(og.quadTree.QuadNode._vertOrder.length)-1;
og.quadTree.QuadNode.createNode=function(c,d,e,f,g,h,k){var m=new og.quadTree.QuadNode;m.partId=e;m.parentNode=f;m.nodeId=e+g;m.planet=d;m.planetSegment=new c;m.planetSegmentPrototype=c;m.planetSegment.node=m;m.planetSegment.planet=d;m.planetSegment.handler=d.renderer.handler;m.planetSegment.assignTileIndexes(h,k);m.planetSegment.gridSize=d.terrainProvider.gridSizeByZoom[h];m.createBounds();m.planet.createdNodesCount++;return m};
og.quadTree.QuadNode.prototype.createBounds=function(){var c=this.planetSegment;if(c.zoomIndex)if(c.zoomIndex<c.planet.terrainProvider.minZoom)c.createBoundsByExtent();else{for(var d=this;d.parentNode&&!d.planetSegment.terrainReady;)d=d.parentNode;var e=this.planetSegment.zoomIndex-d.planetSegment.zoomIndex,f=Math.pow(2,e),g=this.planetSegment.tileX-d.planetSegment.tileX*f,f=this.planetSegment.tileY-d.planetSegment.tileY*f;if(d.planetSegment.terrainReady){var h=d.planetSegment.gridSize/Math.pow(2,
e);if(1<=h){var k=d.planetSegment.terrainVertices,e=h*f,m=h*g,f=3*(e*(d.planetSegment.gridSize+1)+m),d=3*((e+h)*(d.planetSegment.gridSize+1)+m+h);c.bsphere.setFromBounds([k[f],k[d],k[f+1],k[d+1],k[f+2],k[d+2]])}else{var k=d.planetSegment,e=Math.floor(h*f),m=Math.floor(h*g),d=1/h,f=f-d*e,g=g-d*m,l=og.quadTree.getMatrixSubArray(k.terrainVertices,k.gridSize,e,m,1),e=new og.math.Vector3(l[0],l[1],l[2]),m=new og.math.Vector3(l[9],l[10],l[11]),h=new og.math.Vector3(l[3]-l[0],l[4]-l[1],l[5]-l[2]),k=new og.math.Vector3(l[6]-
l[0],l[7]-l[1],l[8]-l[2]),n=new og.math.Vector3(l[3]-l[9],l[4]-l[10],l[5]-l[11]),p=new og.math.Vector3(l[6]-l[9],l[7]-l[10],l[8]-l[11]),q=f,r=g,l=q+r<d?og.math.Vector3.add(h.scaleTo(r/d),k.scaleTo(q/d)).add(e):og.math.Vector3.add(p.scaleTo(1-r/d),n.scaleTo(1-q/d)).add(m),q=f+1,r=g+1,d=q+r<d?og.math.Vector3.add(h.scaleTo(r/d),k.scaleTo(q/d)).add(e):og.math.Vector3.add(p.scaleTo(1-r/d),n.scaleTo(1-q/d)).add(m);c.bsphere.radius=.5*l.distance(d);c.bsphere.center=l.add(d.sub(l).scale(.5))}}else c.createBoundsByExtent()}else c.bsphere.radius=
c.planet.ellipsoid._a,c.bsphere.center=new og.math.Vector3};
og.quadTree.QuadNode.prototype.createChildrenNodes=function(){var c=this.planet,d=this.planetSegment,e=d.extent,f=.5*e.getWidth(),g=.5*e.getHeight(),h=e.northEast,e=e.southWest,d=d.zoomIndex+1,k=4*this.nodeId+1,m=new og.LonLat(e.lon+f,e.lat+g),l=this.nodes;l[og.quadTree.NW]=og.quadTree.QuadNode.createNode(this.planetSegmentPrototype,c,og.quadTree.NW,this,k,d,new og.Extent(new og.LonLat(e.lon,e.lat+g),new og.LonLat(e.lon+f,h.lat)));l[og.quadTree.NE]=og.quadTree.QuadNode.createNode(this.planetSegmentPrototype,
c,og.quadTree.NE,this,k,d,new og.Extent(m,new og.LonLat(h.lon,h.lat)));l[og.quadTree.SW]=og.quadTree.QuadNode.createNode(this.planetSegmentPrototype,c,og.quadTree.SW,this,k,d,new og.Extent(new og.LonLat(e.lon,e.lat),m));l[og.quadTree.SE]=og.quadTree.QuadNode.createNode(this.planetSegmentPrototype,c,og.quadTree.SE,this,k,d,new og.Extent(new og.LonLat(e.lon+f,e.lat),new og.LonLat(h.lon,e.lat+g)))};
og.quadTree.QuadNode.prototype.reloadTerrain=function(){this.planetSegment.clearBuffers();this.planetSegment.deleteElevations();this.getState()===og.quadTree.WALKTHROUGH&&this.planetSegment.loadTerrain();for(var c=0;c<this.nodes.length;c++)this.nodes[c].reloadTerrain()};og.quadTree.QuadNode.prototype.getState=function(){for(var c=this.parentNode;c;){if(c.state!=og.quadTree.WALKTHROUGH)return og.quadTree.NOTRENDERING;c=c.parentNode}return this.state};og.quadTree.QuadNode.VISIBLE_DISTANCE=3570;
og.quadTree.QuadNode.prototype.prepareForRendering=function(c){3E6>c.lonLat.height?c.eye.distance(this.planetSegment.bsphere.center)-this.planetSegment.bsphere.radius<og.quadTree.QuadNode.VISIBLE_DISTANCE*Math.sqrt(c.lonLat.height)?this.renderNode():this.state=og.quadTree.NOTRENDERING:this.renderNode()};
og.quadTree.QuadNode.prototype.traverseNodes=function(){this.nodes.length||this.createChildrenNodes();this.nodes[og.quadTree.NW].renderTree();this.nodes[og.quadTree.NE].renderTree();this.nodes[og.quadTree.SW].renderTree();this.nodes[og.quadTree.SE].renderTree()};
og.quadTree.QuadNode.prototype.renderTree=function(){this.state=og.quadTree.WALKTHROUGH;var c=this.planet.renderer.activeCamera,d=this.planetSegment,e=this.planet;this.cameraInside=this.parentNode?c.isInsideSegment(this.planetSegment):!0;0<c.frustum.containsSphere(d.bsphere)||this.cameraInside?d.acceptForRendering(c)?this.prepareForRendering(c):d.zoomIndex<e.terrainProvider.gridSizeByZoom.length-1?this.traverseNodes():this.prepareForRendering(c):this.state=og.quadTree.NOTRENDERING};
og.quadTree.QuadNode.prototype.createPlainSegment=function(c){var d=this.planet.terrainProvider.gridSizeByZoom[c.zoomIndex];c.gridSize=d;this.sideSize=[d,d,d,d];c.createPlainVertices(d);c.terrainVertices=c.plainVertices;c.createCoordsBuffers(c.plainVertices,d);c.ready=!0};
og.quadTree.QuadNode.prototype.renderNode=function(){this.state=og.quadTree.RENDERING;var c=this.planetSegment;c.ready||this.createPlainSegment(c);c.terrainReady||(c.loadTerrain(),this.whileTerrainLoading());!c.planet.lightEnabled||c.normalMapReady||c.parentNormalMapReady||this.whileNormalMapCreating();this.createGeoImage();for(var d=this.planet.visibleLayers,e=c.materials,f=0;f<d.length;f++){var g=d[f],h=e[g.id];h||(h=c.materials[g.id]=new og.planetSegment.PlanetSegmentMaterial(c,g));h.imageReady||
(h.loadTileImage(),this.whileTextureLoading(g.id))}c.zoomIndex>this.planet.maxCurrZoom&&(this.planet.maxCurrZoom=c.zoomIndex);c.zoomIndex<this.planet.minCurrZoom&&(this.planet.minCurrZoom=c.zoomIndex);this.addToRender(this)};
og.quadTree.QuadNode.prototype.createGeoImage=function(){var c=this.planetSegment;if(this.planet.geoImagesArray.length&&!c.geoImageReady&&!c._inTheGeoImageTileCreatorQueue){for(var d=this;d.parentNode&&!d.planetSegment.geoImageReady;)d=d.parentNode;var e=Math.pow(2,c.zoomIndex-d.planetSegment.zoomIndex),f=c.tileX-d.planetSegment.tileX*e,g=c.tileY-d.planetSegment.tileY*e;c.geoImageTexture=d.planetSegment.geoImageTexture||this.planet.transparentTexture;c.geoImageTextureBias[0]=f;c.geoImageTextureBias[1]=
g;c.geoImageTextureBias[2]=1/e;this.planet.geoImageTileCreator.queue(c)}};
og.quadTree.QuadNode.prototype.addToRender=function(c){for(var d=this.planet.renderedNodes,e=0;e<d.length;e++){var f=d[e],g=c.getCommonSide(f);if(-1!=g){var h=og.quadTree.OPSIDE[g];c.neighbors[g]=f;f.neighbors[h]=c;if(!c.hasNeighbor[g]||!f.hasNeighbor[h]){var k=c.planetSegment,m=f.planetSegment,l=k.gridSize/(m.gridSize*Math.pow(2,m.zoomIndex-k.zoomIndex));c.hasNeighbor[g]=!0;f.hasNeighbor[h]=!0;1<l?(c.sideSize[g]=Math.ceil(k.gridSize/l),f.sideSize[h]=m.gridSize):1>l?(c.sideSize[g]=k.gridSize,f.sideSize[h]=
Math.ceil(m.gridSize*l)):(c.sideSize[g]=k.gridSize,f.sideSize[h]=m.gridSize)}}}d.push(c)};
og.quadTree.QuadNode.prototype.getCommonSide=function(c){var d=this.planetSegment.extent,e=c.planetSegment.extent,f=d.northEast,d=d.southWest;c=e.northEast;var g=e.southWest,e=f.lon,f=f.lat,h=d.lon,k=d.lat,m=c.lon,l=c.lat,n=g.lon,g=g.lat,p=og.mercator.POLE,q=og.mercator.MAX_LAT;return e==n&&(f<=l&&k>=g||f>=l&&k<=g)?og.quadTree.E:h==m&&(f<=l&&k>=g||f>=l&&k<=g)?og.quadTree.W:f==g&&(h>=n&&e<=m||h<=n&&e>=m)?og.quadTree.N:k==l&&(h>=n&&e<=m||h<=n&&e>=m)?og.quadTree.S:e==p&&n==-p?og.quadTree.E:d.lon==-p&&
c.lon==p?og.quadTree.W:f==p&&g==q?og.quadTree.N:k==-p&&l==-q?og.quadTree.S:-1};
og.quadTree.QuadNode.prototype.whileNormalMapCreating=function(){for(var c=this.planetSegment,d=this;d.parentNode&&!d.planetSegment.normalMapReady;)d=d.parentNode;var e=Math.pow(2,c.zoomIndex-d.planetSegment.zoomIndex),f=c.tileX-d.planetSegment.tileX*e,g=c.tileY-d.planetSegment.tileY*e;c.normalMapTexture=d.planetSegment.normalMapTexture;c.normalMapTextureBias[0]=f;c.normalMapTextureBias[1]=g;c.normalMapTextureBias[2]=1/e;e=this.planet.terrainProvider.maxZoom;if(c.zoomIndex<=e&&!c.terrainIsLoading&&
c.terrainReady&&!c._inTheQueue)c.planet.normalMapCreator.shift(c);else if(c.zoomIndex>e)if(d.planetSegment.zoomIndex==e)c.parentNormalMapReady=!0;else{for(d=this;d.parentNode&&d.planetSegment.zoomIndex!=e;)d=d.parentNode;c=d.planetSegment;c.ready?c._inTheQueue||c.terrainIsLoading||c.planet.normalMapCreator.shift(c):(this.createPlainSegment(c),c.loadTerrain())}};
og.quadTree.QuadNode.prototype.whileTerrainLoading=function(){for(var c=this;c.parentNode&&!c.planetSegment.terrainReady;)c=c.parentNode;var d=this.planetSegment.zoomIndex-c.planetSegment.zoomIndex,e=Math.pow(2,d),f=this.planetSegment.tileX-c.planetSegment.tileX*e,g=this.planetSegment.tileY-c.planetSegment.tileY*e,h=this.planet.terrainProvider.maxZoom;if(c.planetSegment.terrainReady){var e=this.planetSegment,k=c.planetSegment;if(c.planetSegment.terrainExists&&this.appliedTerrainNodeId!=c.nodeId){var d=
c.planetSegment.gridSize/Math.pow(2,d),m=[];e.deleteBuffers();e.refreshIndexesBuffer=!0;if(1<=d){e.gridSize=d;this.sideSize=[d,d,d,d];var l,n,m=og.quadTree.getMatrixSubArray(k.terrainVertices,k.gridSize,d*g,d*f,d)}else{e.gridSize=og.quadTree.QuadNode._neGridSize;this.sideSize=[e.gridSize,e.gridSize,e.gridSize,e.gridSize];l=Math.floor(d*g);n=Math.floor(d*f);k=og.quadTree.getMatrixSubArray(k.terrainVertices,k.gridSize,l,n,1);d=1/d;g-=d*l;f-=d*n;n=new og.math.Vector3(k[0],k[1],k[2]);l=new og.math.Vector3(k[9],
k[10],k[11]);for(var p=new og.math.Vector3(k[3]-k[0],k[4]-k[1],k[5]-k[2]),q=new og.math.Vector3(k[6]-k[0],k[7]-k[1],k[8]-k[2]),r=new og.math.Vector3(k[3]-k[9],k[4]-k[10],k[5]-k[11]),t=new og.math.Vector3(k[6]-k[9],k[7]-k[10],k[8]-k[11]),v=new og.math.Vector3,E=og.quadTree.QuadNode._vertOrder,u=0;u<E.length;u++){var v=E[u].y+g,D=E[u].x+f,F=D/d,I=v/d,v=v+D<d?og.math.Vector3.add(p.scaleTo(F),q.scaleTo(I)).add(n):og.math.Vector3.add(t.scaleTo(1-F),r.scaleTo(1-I)).add(l),D=3*u;m[D]=v.x;m[D+1]=v.y;m[D+
2]=v.z}k.length=0}e.createCoordsBuffers(m,e.gridSize);e.tempVertices=m;this.appliedTerrainNodeId=c.nodeId}if(e.zoomIndex>h)if(c.planetSegment.zoomIndex>=h)e.terrainReady=!0,e.terrainIsLoading=!1,this.appliedTerrainNodeId=this.nodeId,c.planetSegment.terrainExists?(e.terrainExists=!0,e.terrainVertices=m):(e.terrainExists=!1,e.deleteBuffers(),c=3*e.gridSize,m=.5*c,h=c*(e.gridSize+1),k=m*(e.gridSize+1),d=e.terrainVertices,e.terrainVertices=[d[0],d[1],d[2],d[m],d[m+1],d[m+2],d[c],d[c+1],d[c+2],d[k],d[k+
1],d[k+2],d[k+m],d[k+m+1],d[k+m+2],d[k+c],d[k+c+1],d[k+c+2],d[h],d[h+1],d[h+2],d[h+m],d[h+m+1],d[h+m+2],d[h+c],d[h+c+1],d[h+c+2]],e.createCoordsBuffers(e.terrainVertices,2),e.gridSize=2);else{for(c=this;c.parentNode&&c.planetSegment.zoomIndex!=h;)c=c.parentNode;e=c.planetSegment;e.ready||this.createPlainSegment(e);e.loadTerrain()}}};og.quadTree.getMatrixSubArray=function(c,d,e,f,g){for(var h=[],k=0,m=e;m<=e+g;m++)for(var l=f;l<=f+g;l++){var n=3*(m*(d+1)+l);h[k++]=c[n];h[k++]=c[n+1];h[k++]=c[n+2]}return h};
og.quadTree.QuadNode.prototype.whileTextureLoading=function(c){for(var d=this,e=!1,f=d.planetSegment.materials[c];d.parentNode;){if(f&&f.imageReady){e=!0;break}d=d.parentNode;f=d.planetSegment.materials[c]}var g=this.planetSegment.zoomIndex-d.planetSegment.zoomIndex,h=Math.pow(2,g),k=this.planetSegment.tileX-d.planetSegment.tileX*h,h=this.planetSegment.tileY-d.planetSegment.tileY*h;c=this.planetSegment.materials[c];if(e||f&&!d.parentNode)c.texture=f.texture,c.texBias[0]=k,c.texBias[1]=h,c.texBias[2]=
1/Math.pow(2,g)};og.quadTree.QuadNode.prototype.clearTree=function(){var c=this.getState();if(c===og.quadTree.NOTRENDERING)this.destroyBranches(!0);else if(c===og.quadTree.RENDERING)this.destroyBranches(!1);else for(c=0;c<this.nodes.length;c++)this.nodes[c].clearTree()};
og.quadTree.QuadNode.prototype.destroyBranches=function(c){if(!(this.planetSegment.zoomIndex<=this.planetSegment.planet.terrainProvider.minZoom)){c&&(this.planetSegment.clearSegment(),this.appliedTerrainNodeId=-1);for(c=0;c<this.nodes.length;c++)this.nodes[c].planetSegment.destroySegment(),this.appliedTerrainNodeId=-1,this.nodes[c].destroyBranches(!1);this.nodes.length=0}};og.quadTree.QuadNode.prototype.traverseTree=function(c){c(this);for(var d=0;d<this.nodes.length;d++)this.nodes[d].traverseTree(c)};og.Frustum=function(){this._f=Array(6);for(var c=0;6>c;c++)this._f[c]=Array(4)};
og.Frustum.prototype.setFrustum=function(c){this._f[0][0]=c[3]-c[0];this._f[0][1]=c[7]-c[4];this._f[0][2]=c[11]-c[8];this._f[0][3]=c[15]-c[12];this.planeNormalize(this._f[0]);this._f[1][0]=c[3]+c[0];this._f[1][1]=c[7]+c[4];this._f[1][2]=c[11]+c[8];this._f[1][3]=c[15]+c[12];this.planeNormalize(this._f[1]);this._f[2][0]=c[3]+c[1];this._f[2][1]=c[7]+c[5];this._f[2][2]=c[11]+c[9];this._f[2][3]=c[15]+c[13];this.planeNormalize(this._f[2]);this._f[3][0]=c[3]-c[1];this._f[3][1]=c[7]-c[5];this._f[3][2]=c[11]-
c[9];this._f[3][3]=c[15]-c[13];this.planeNormalize(this._f[3]);this._f[4][0]=c[3]-c[2];this._f[4][1]=c[7]-c[6];this._f[4][2]=c[11]-c[10];this._f[4][3]=c[15]-c[14];this.planeNormalize(this._f[4]);this._f[5][0]=c[3]+c[2];this._f[5][1]=c[7]+c[6];this._f[5][2]=c[11]+c[10];this._f[5][3]=c[15]+c[14];this.planeNormalize(this._f[5])};og.Frustum.prototype.planeNormalize=function(c){var d=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);c[0]/=d;c[1]/=d;c[2]/=d;c[3]/=d};
og.Frustum.prototype.containsPoint=function(c){for(var d,e=0;6>e;e++)if(d=c.dotArr(this._f[e])+this._f[e][3],0>=d)return!1;return!0};og.Frustum.prototype.containsSphere=function(c){for(var d,e=0;6>e;e++)if(d=c.center.dotArr(this._f[e])+this._f[e][3],d<=-c.radius)return-1;return d+c.radius};og.Frustum.prototype.containsBox=function(c){for(var d=!0,e,f,g=0;6>g;g++){for(var h=f=e=0;8>h&&(0==f||0==e);h++)0>c.vertices[h].dotArr(this._f[g])+this._f[g][3]?e++:f++;if(0==f)return!1;0<e&&(d=!0)}return d};og.Camera=function(c,d){this.events=new og.Events;this.renderer=null;this.events.registerNames(["onviewchanged"]);this.eye=new og.math.Vector3;this.u=new og.math.Vector3(0,1,0);this.v=new og.math.Vector3(1,0,0);this.n=new og.math.Vector3(0,0,1);this._tanViewAngle_hrad=this.viewAngle=this.farDist=this.nearDist=this.aspect=0;this.nMatrix=new og.math.Matrix3;this.pMatrix=new og.math.Matrix4;this.mvMatrix=new og.math.Matrix4;this.pmvMatrix=new og.math.Matrix4;this.ipmvMatrix=new og.math.Matrix4;this.frustum=
new og.Frustum;this.pMatrixPrecise=new og.math.Matrix4;c&&this.init(c,d)};og.Camera.clone=function(c){var d=new og.Camera;d.eye.copy(c.eye);d.u.copy(c.u);d.v.copy(c.v);d.n.copy(c.n);d.renderer=c.renderer;d.pMatrix.copy(c.pMatrix);d.mvMatrix.copy(c.mvMatrix);d.pmvMatrix.copy(c.pmvMatrix);d.ipmvMatrix.copy(c.ipmvMatrix);d.frustum.setFrustum(d.pmvMatrix);d.ellipsoid=c.ellipsoid;d.lonLat=c.lonLat.clone();return d};
og.Camera.defaultOptions={viewAngle:35,nearDist:1,farDist:og.math.MAX,eye:new og.math.Vector3(0,0,0),look:new og.math.Vector3(0,0,0),up:new og.math.Vector3(0,1,0)};
og.Camera.prototype.init=function(c,d){this.renderer=c;d?(this.setProjectionMatrix(d.viewAngle?d.viewAngle:og.Camera.defaultOptions.viewAngle,this.renderer.handler.gl.canvas.aspect,d.nearDist?d.nearDist:og.Camera.defaultOptions.nearDist,d.farDist?d.farDist:og.Camera.defaultOptions.farDist),this.set(d.eye?d.eye:og.Camera.defaultOptions.eye.clone(),d.look?d.look:og.Camera.defaultOptions.look.clone(),d.up?d.up:og.Camera.defaultOptions.up.clone())):this.initDefaults();this.update()};
og.Camera.prototype.initDefaults=function(){this.setProjectionMatrix(og.Camera.defaultOptions.viewAngle,this.renderer.handler.gl.canvas.aspect,og.Camera.defaultOptions.nearDist,og.Camera.defaultOptions.farDist);this.set(Camera.defaultOptions.eye.clone(),Camera.defaultOptions.look.clone(),Camera.defaultOptions.up.clone())};
og.Camera.prototype.update=function(){this.setModelViewMatrix();this.pmvMatrix=this.pMatrix.mul(this.mvMatrix);this.frustum.setFrustum(this.pmvMatrix._m);this.ipmvMatrix=this.pmvMatrix.inverse();this.nMatrix=this.mvMatrix.toInverseMatrix3().transpose();this.events.dispatch(this.events.onviewchanged,this)};
og.Camera.prototype.setModelViewMatrix=function(){this.mvMatrix.set([this.u.x,this.v.x,this.n.x,0,this.u.y,this.v.y,this.n.y,0,this.u.z,this.v.z,this.n.z,0,-this.eye.dot(this.u),-this.eye.dot(this.v),-this.eye.dot(this.n),1])};og.Camera.prototype.refresh=function(){this.setProjectionMatrix(this.viewAngle,this.renderer.handler.gl.canvas.aspect,this.nearDist,this.farDist);this.update()};og.Camera.prototype.setFarVisibilityDistance=function(c){this.farDist=c;this.refresh()};
og.Camera.prototype.setNearVisibilityDistance=function(c){this.nearDist=c;this.refresh()};og.Camera.prototype.setDistanceVisibility=function(c,d){this.nearDist=d||this.nearDist;this.farDist=c?d+c:d+this.farDist-this.nearDist;this.refresh()};og.Camera.prototype.setProjectionMatrix=function(c,d,e,f){this.viewAngle=c;this._tanViewAngle_hrad=Math.tan(c*og.math.RADIANS_HALF);this.aspect=d;this.nearDist=e;this.farDist=f;this.pMatrix.setPerspective(c,d,e,f);this.pMatrixPrecise.setPerspective(c,d,.1,10)};
og.Camera.prototype.setViewAngle=function(c){this.viewAngle=c;this.refresh()};og.Camera.prototype.set=function(c,d,e){this.eye.copy(c);this.n.set(c.x-d.x,c.y-d.y,c.z-d.z);this.u.copy(e.cross(this.n));this.n.normalize();this.u.normalize();this.v.copy(this.n.cross(this.u))};og.Camera.prototype.look=function(c,d){this.n.set(this.eye.x-c.x,this.eye.y-c.y,this.eye.z-c.z);this.u.copy((d?d:this.v).cross(this.n));this.n.normalize();this.u.normalize();this.v.copy(this.n.cross(this.u))};
og.Camera.prototype.slide=function(c,d,e){this.eye.x+=c*this.u.x+d*this.v.x+e*this.n.x;this.eye.y+=c*this.u.y+d*this.v.y+e*this.n.y;this.eye.z+=c*this.u.z+d*this.v.z+e*this.n.z};og.Camera.prototype.roll=function(c){var d=Math.cos(og.math.RADIANS*c);c=Math.sin(og.math.RADIANS*c);var e=this.u.clone();this.u.set(d*e.x-c*this.v.x,d*e.y-c*this.v.y,d*e.z-c*this.v.z);this.v.set(c*e.x+d*this.v.x,c*e.y+d*this.v.y,c*e.z+d*this.v.z)};
og.Camera.prototype.pitch=function(c){var d=Math.cos(og.math.RADIANS*c);c=Math.sin(og.math.RADIANS*c);var e=this.n.clone();this.n.set(d*e.x-c*this.v.x,d*e.y-c*this.v.y,d*e.z-c*this.v.z);this.v.set(c*e.x+d*this.v.x,c*e.y+d*this.v.y,c*e.z+d*this.v.z)};og.Camera.prototype.yaw=function(c){var d=Math.cos(og.math.RADIANS*c);c=Math.sin(og.math.RADIANS*c);var e=this.u.clone();this.u.set(d*e.x-c*this.n.x,d*e.y-c*this.n.y,d*e.z-c*this.n.z);this.n.set(c*e.x+d*this.n.x,c*e.y+d*this.n.y,c*e.z+d*this.n.z)};
og.Camera.prototype.unproject=function(c,d){var e=(c-this.renderer.handler.gl.canvas.width/2)/(this.renderer.handler.gl.canvas.width/2),f=-(d-this.renderer.handler.gl.canvas.height/2)/(this.renderer.handler.gl.canvas.height/2),g=this.ipmvMatrix.mulVec4(new og.math.Vector4(e,f,-1,1)).affinity();return this.ipmvMatrix.mulVec4(new og.math.Vector4(e,f,0,1)).affinity().sub(g).toVector3().normalize()};
og.Camera.prototype.project=function(c){c=this.pmvMatrix.mulVec4(c.toVector4());return new og.math.Pixel((1+c.x/c.w)*this.gl.canvas.width/2,(1-c.y/c.w)*this.gl.canvas.height/2)};og.Camera.prototype.setEye=function(c){this.eye.copy(c);this.refresh()};
og.Camera.prototype.rotateAround=function(c,d,e,f){e=e||og.math.Vector3.ZERO;f=f||og.math.Vector3.UP;c=(new og.math.Matrix4).rotate(d?this.v:f,c);d=(new og.math.Matrix4).setIdentity().translate(e);e=(new og.math.Matrix4).setIdentity().translate(e.getNegate());this.eye=d.mul(c).mul(e).mulVec3(this.eye);this.v=c.mulVec3(this.v).normalize();this.u=c.mulVec3(this.u).normalize();this.n=c.mulVec3(this.n).normalize()};og.Camera.prototype.rotateHorizontal=function(c,d,e,f){this.rotateAround(c,d,e,f)};
og.Camera.prototype.rotateVertical=function(c,d,e){this.rotateAround(c,!1,d,this.u)};og.Camera.prototype.projectedSize=function(c){return this.eye.distance(c)*this._tanViewAngle_hrad};og.PlanetCamera=function(c,d){this.planet=c;this._ellipsoid=c.ellipsoid;og.inheritance.base(this,c.renderer,d);this.lonLat=new og.LonLat;this.altitude=0;this.minAlt=d.minAltitude||50;this.earthPoint={distance:0,earth:new og.math.Vector3};this.bindEllipsoid(this._ellipsoid);this._framesArr=[];this._framesCounter=0;this._numFrames=150;this._completeCallback=null;this._flying=!1;this.cameraInsideNode=this._nodeCameraPosition=null};og.inheritance.extend(og.PlanetCamera,og.Camera);
og.PlanetCamera.prototype.bindEllipsoid=function(c){this._ellipsoid=c;this.lonLat=c.ECEF2LonLat(this.eye)};og.PlanetCamera.prototype.update=function(){this.setModelViewMatrix();this.pmvMatrix=this.pMatrix.mul(this.mvMatrix);this.frustum.setFrustum(this.pmvMatrix._m);this.ipmvMatrix=this.pMatrixPrecise.mul(this.mvMatrix).inverse();this.nMatrix=this.mvMatrix.toInverseMatrix3().transpose();this.lonLat=this._ellipsoid.ECEF2LonLat(this.eye);this.events.dispatch(this.events.onviewchanged,this)};
og.PlanetCamera.prototype.setAltitude=function(c){var d=this.eye.normal();this.eye=this.earthPoint.earth.add(d.scale(c));this.altitude=c};og.PlanetCamera.prototype.setLonLat=function(c){this.lonLat.set(c.lon,c.lat,c.height?c.height:this.lonLat.height);c=this._ellipsoid.LonLat2ECEF(this.lonLat);var d=(new og.math.Matrix4).rotateBetweenVectors(c.normal(),this.eye.normal());this.eye=c;this.v=d.mulVec3(this.v);this.u=d.mulVec3(this.u);this.n=d.mulVec3(this.n)};
og.PlanetCamera.prototype.viewLonLat=function(c,d){this.lonLat.set(c.lon,c.lat,c.height?c.height:this.lonLat.height);var e=this._ellipsoid.LonLat2ECEF(this.lonLat),f=this._ellipsoid.LonLat2ECEF(new og.LonLat(this.lonLat.lon,this.lonLat.lat,0));this.set(e,f,d||og.math.Vector3.UP)};
og.PlanetCamera.prototype.getExtentPosition=function(c){var d=c.getNorth(),e=c.getSouth(),f=c.getEast(),g=c.getWest();g>f&&(f+=360);var h=new og.LonLat(f,d),k=this._ellipsoid.LonLat2ECEF(h);h.lat=e;var m=this._ellipsoid.LonLat2ECEF(h);h.lon=g;var l=this._ellipsoid.LonLat2ECEF(h);h.lat=d;var n=this._ellipsoid.LonLat2ECEF(h);c=og.math.Vector3.sub(k,l).scale(.5).add(l);var p=c.length();1E-6>p&&(h.lon=.5*(f+g),h.lat=.5*(d+e),c=this._ellipsoid.LonLat2ECEF(h));n.sub(c);m.sub(c);k.sub(c);l.sub(c);e=c.normal();
d=e.cross(og.math.Vector3.UP).normalize();e=d.cross(e).normalize();e=Math.max(Math.abs(e.dot(n)),Math.abs(e.dot(m)),Math.abs(e.dot(k)),Math.abs(e.dot(l)));k=Math.max(Math.abs(d.dot(n)),Math.abs(d.dot(m)),Math.abs(d.dot(k)),Math.abs(d.dot(l)));m=Math.tan(this.viewAngle*og.math.RADIANS*.5);k=Math.max(k/(this.aspect*m),e/m);c.normalize();c.scale(p+k);return c};og.PlanetCamera.prototype.viewExtent=function(c){this.stopFlying();this.set(this.getExtentPosition(c,this._ellipsoid),og.math.Vector3.ZERO,og.math.Vector3.UP)};
og.PlanetCamera.prototype.viewLonLat=function(c,d){this.stopFlying();this.viewLonLat(c,d)};og.PlanetCamera.prototype.flyExtent=function(c,d,e,f){this.flyCartesian(this.getExtentPosition(c,this._ellipsoid),og.math.Vector3.ZERO,d,e,f)};og.PlanetCamera.prototype.flyGeoImage=function(c,d,e){var f=c.getCorners(),g=this._ellipsoid;this.flyExtent(c.getExtent(),g.LonLat2ECEF(f[0]).sub(g.LonLat2ECEF(f[3])).add(g.LonLat2ECEF(f[1]).sub(g.LonLat2ECEF(f[2]))).normalize(),d,e)};
og.PlanetCamera.prototype.flyCartesian=function(c,d,e,f,g){this.stopFlying();this._completeCallback=f;g&&g.call(this);var h=d||og.math.Vector3.ZERO;d instanceof og.LonLat&&(h=this._ellipsoid.LonLat2ECEF(d));d=this._ellipsoid.LonLat2ECEF(new og.LonLat(this.lonLat.lon,this.lonLat.lat));f=this.v;g=this.n;var k=this._ellipsoid.ECEF2LonLat(c),m=e||og.math.Vector3.UP;e=this._ellipsoid.LonLat2ECEF(new og.LonLat(k.lon,k.lat,0));c=og.math.Vector3.sub(c,h);h=m.cross(c);c.normalize();h.normalize();var h=c.cross(h),
m=d.normal(),l=e.normal(),m=og.math.SQRT_HALF*Math.sqrt(1-m.dot(l)),l=6639613,n=Math.max(this.lonLat.height,k.height);n>l&&(l=n);m=n+2.5*m*(l-n);l=og.math.Vector3.ZERO;for(n=0;n<=this._numFrames;n++){var p=1-n/this._numFrames,p=p*p*(3-2*p),p=p*p,q=d.smerp(e,p).normalize(),r=this.planet.getRayIntersectionEllipsoid(new og.math.Ray(l,q)),t=1-p,q=r.add(q.scale(this.lonLat.height*p*p*p+3*m*p*p*t+3*m*p*t*t+k.height*t*t*t)),r=f.smerp(h,p),p=og.math.Vector3.add(q,g.smerp(c,p).getNegate()),p=new og.math.Vector3(q.x-
p.x,q.y-p.y,q.z-p.z),r=r.cross(p);p.normalize();r.normalize();t=p.cross(r);this._framesArr[n]={eye:q,n:p,u:r,v:t}}this._framesCounter=this._numFrames;this._flying=!0};og.PlanetCamera.prototype.flyLonLat=function(c,d,e,f,g){c=new og.LonLat(c.lon,c.lat,c.height||this.lonLat.height);this.flyCartesian(this._ellipsoid.LonLat2ECEF(c),d,e,f,g)};
og.PlanetCamera.prototype.stopFlying=function(){this.planet.normalMapCreator.active=!0;this.planet.terrainProvider.active=!0;this._flying=!1;this._framesArr.length=0;this._framesArr=[];this._framesCounter=-1};
og.PlanetCamera.prototype.flyFrame=function(){if(this._flying){var c=this._numFrames-this._framesCounter;this.planet.normalMapCreator.active=!1;this.planet.terrainProvider.active=c%20?!1:!0;this.eye=this._framesArr[c].eye;this.u=this._framesArr[c].u;this.v=this._framesArr[c].v;this.n=this._framesArr[c].n;this.update();this._framesCounter--;0>this._framesCounter&&(this.stopFlying(),this._completeCallback&&(this._completeCallback(),this._completeCallback=null))}};
og.PlanetCamera.prototype.checkCollision=function(){if(1E6>this.lonLat.height){var c=this.cameraInsideNode.planetSegment;c._projection.id==og.proj.EPSG4326.id?(this.earthPoint.earth=this.planet.hitRayEllipsoid(cam.eye,cam.eye.getNegate().normalize()),this.earthPoint.distance=this.altitude=this.lonLat.height):(this.earthPoint=c.getEarthPoint(this._nodeCameraPosition,this),this.altitude=this.earthPoint.distance);this.altitude<this.minAlt&&this.setAltitude(this.minAlt)}else this.altitude=this.lonLat.height};
og.PlanetCamera.prototype.isInsideSegment=function(c){this._nodeCameraPosition=c._projection.id==og.proj.EPSG4326.id?this.lonLat:this.lonLat.forwardMercator();return c.node.parentNode.cameraInside&&c.extent.isInside(this._nodeCameraPosition)?(this.cameraInsideNode=c.node,!0):!1};og.PlanetCamera.prototype.rotateLeft=function(c,d){this.rotateHorizontal(c*og.math.RADIANS,d^1,og.math.Vector3.ZERO);this.update()};
og.PlanetCamera.prototype.rotateRight=function(c,d){this.rotateHorizontal(-c*og.math.RADIANS,d^1,og.math.Vector3.ZERO);this.update()};og.PlanetCamera.prototype.rotateUp=function(c){this.rotateVertical(c*og.math.RADIANS,og.math.Vector3.ZERO);this.update()};og.PlanetCamera.prototype.rotateDown=function(c){this.rotateVertical(-c*og.math.RADIANS,og.math.Vector3.ZERO);this.update()};og.shaderProgram.single_nl=function(){return new og.shaderProgram.ShaderProgram("single_nl",{uniforms:{uPMVMatrix:{type:og.shaderProgram.types.MAT4},texBias:{type:og.shaderProgram.types.VEC3},uSampler:{type:og.shaderProgram.types.SAMPLER2D},uGeoImage:{type:og.shaderProgram.types.SAMPLER2D},geoImageTexBias:{type:og.shaderProgram.types.VEC3}},attributes:{aVertexPosition:{type:og.shaderProgram.types.VEC3,enableArray:!0},aTextureCoord:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+
"single_nl_vs.txt"),fragmentShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"single_nl_fs.txt")})};
og.shaderProgram.single_wl=function(){return new og.shaderProgram.ShaderProgram("single_wl",{uniforms:{uPMatrix:{type:og.shaderProgram.types.MAT4},uMVMatrix:{type:og.shaderProgram.types.MAT4},uNMatrix:{type:og.shaderProgram.types.MAT3},texBias:{type:og.shaderProgram.types.VEC3},uSampler:{type:og.shaderProgram.types.SAMPLER2D},uNormalMap:{type:og.shaderProgram.types.SAMPLER2D},uNormalMapBias:{type:og.shaderProgram.types.VEC3},uGeoImage:{type:og.shaderProgram.types.SAMPLER2D},geoImageTexBias:{type:og.shaderProgram.types.VEC3},
pointLightsPositions:{type:og.shaderProgram.types.VEC3},pointLightsParamsv:{type:og.shaderProgram.types.VEC3},pointLightsParamsf:{type:og.shaderProgram.types.FLOAT}},attributes:{aVertexPosition:{type:og.shaderProgram.types.VEC3,enableArray:!0},aTextureCoord:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"single_wl_vs.txt"),fragmentShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"single_wl_fs.txt")})};og.shaderProgram.picking=function(){return new og.shaderProgram.ShaderProgram("picking",{uniforms:{uPMVMatrix:{type:og.shaderProgram.types.MAT4},camPos:{type:og.shaderProgram.types.VEC3}},attributes:{aVertexPosition:{type:og.shaderProgram.types.VEC3,enableArray:!0}},vertexShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"picking_vs.txt"),fragmentShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"picking_fs.txt")})};og.light={};
og.light.PointLight=function(c,d,e,f,g,h){this._name=c||"p"+og.light.PointLight._counter++;this._renderNode=null;this._position=d||new og.math.Vector3;this._ambient=e||new og.math.Vector3;this._diffuse=f||new og.math.Vector3(.8,.8,.8);this._specular=g||new og.math.Vector3(.18,.18,.18);this._shininess=h||3.3;this._active=!0;this._tempAmbient=e?e.clone():new og.math.Vector3;this._tempDiffuse=f?f.clone():new og.math.Vector3;this._tempSpecular=g?g.clone():new og.math.Vector3;this._tempShininess=h||1};
og.light.PointLight._counter=0;og.light.PointLight.prototype.clone=function(){};
og.light.PointLight.prototype.setActive=function(c){if(c&&!this._active){if(c=this._renderNode){var d=c._pointLightsNames.indexOf(this._name);this._shininess=c._pointLightsParamsf[d]=this._tempShininess;-1!=d&&(d*=9,this._ambient.x=c._pointLightsParamsv[d]=this._tempAmbient.x,this._ambient.y=c._pointLightsParamsv[d+1]=this._tempAmbient.y,this._ambient.z=c._pointLightsParamsv[d+2]=this._tempAmbient.z,this._diffuse.x=c._pointLightsParamsv[d+3]=this._tempDiffuse.x,this._diffuse.y=c._pointLightsParamsv[d+
4]=this._tempDiffuse.y,this._diffuse.z=c._pointLightsParamsv[d+5]=this._tempDiffuse.z,this._specular.x=c._pointLightsParamsv[d+6]=this._tempSpecular.x,this._specular.y=c._pointLightsParamsv[d+7]=this._tempSpecular.y,this._specular.z=c._pointLightsParamsv[d+8]=this._tempSpecular.z)}this._active=!0}else!c&&this._active&&(this._tempAmbient=this._ambient.clone(),this._tempDiffuse=this._diffuse.clone(),this._tempSpecular=this._specular.clone(),this._tempShininess=this._shininess,this.setBlack(),this._active=
!1);return this.active};og.light.PointLight.prototype.isActive=function(){return this._active};og.light.PointLight.prototype.setPosition=function(c){this._position=c;return this};og.light.PointLight.prototype.setAmbient=function(c){this._ambient=c;var d=this._renderNode;if(d){var e=9*d._pointLightsNames.indexOf(this._name);-1!=e&&(d._pointLightsParamsv[e]=c.x,d._pointLightsParamsv[e+1]=c.y,d._pointLightsParamsv[e+2]=c.z)}return this};
og.light.PointLight.prototype.setDiffuse=function(c){this._diffuse=c;var d=this._renderNode;if(d){var e=9*d._pointLightsNames.indexOf(this._name);-1!=e&&(d._pointLightsParamsv[e+3]=c.x,d._pointLightsParamsv[e+4]=c.y,d._pointLightsParamsv[e+5]=c.z)}return this};
og.light.PointLight.prototype.setSpecular=function(c){this._specular=c;var d=this._renderNode;if(d){var e=9*d._pointLightsNames.indexOf(this._name);-1!=e&&(d._pointLightsParamsv[e+6]=c.x,d._pointLightsParamsv[e+7]=c.y,d._pointLightsParamsv[e+8]=c.z)}return this};og.light.PointLight.prototype.setShininess=function(c){this._shininess=c;var d=this._renderNode;if(d){var e=d._pointLightsNames.indexOf(this._name);-1!=e&&(d._pointLightsParamsf[e]=c)}return this};
og.light.PointLight.prototype.setBlack=function(){this._ambient.clear();this._diffuse.clear();this._specular.clear();this._shininess=0;var c=this._renderNode;if(c){var d=9*c._pointLightsNames.indexOf(this._name);-1!=d&&(c._pointLightsParamsv[d]=c._pointLightsParamsv[d+1]=c._pointLightsParamsv[d+2]=c._pointLightsParamsv[d+3]=c._pointLightsParamsv[d+4]=c._pointLightsParamsv[d+5]=c._pointLightsParamsv[d+6]=c._pointLightsParamsv[d+7]=c._pointLightsParamsv[d+8]=0)}return this};
og.light.PointLight.prototype.addTo=function(c){this._renderNode=c;c._pointLights.push(this);c._pointLightsNames.push(this._name);c._pointLightsParamsf.push(this._shininess);c._pointLightsParamsv.push.apply(c._pointLightsParamsv,this._ambient.toVec());c._pointLightsParamsv.push.apply(c._pointLightsParamsv,this._diffuse.toVec());c._pointLightsParamsv.push.apply(c._pointLightsParamsv,this._specular.toVec());return this};
og.light.PointLight.prototype.remove=function(){var c=this.renderNode;if(c){var d=c.getLightById(this._name);-1!=d&&(c._pointLights.splice(d,1),c._pointLightsNames.splice(d,1),c._pointLightsParamsf.splice(d,1),c._pointLightsParamsv.splice(d,9))}this._renderNode=null};og.utils.NormalMapCreator=function(c,d){this._handler=null;this._verticesBufferArray=[];this._indexBufferArray=[];this._framebuffer=this._positionBuffer=null;this._width=c||128;this._height=d||128;this._init()};
og.utils.NormalMapCreator.prototype._init=function(){var c=new og.shaderProgram.ShaderProgram("normalMapBlur",{attributes:{a_position:{type:og.shaderProgram.types.VEC2,enableArray:!0}},uniforms:{s_texture:{type:og.shaderProgram.types.SAMPLER2D}},vertexShader:"attribute vec2 a_position; \r\n                       attribute vec2 a_texCoord; \r\n                      \r\n                      varying vec2 blurCoordinates[5]; \r\n                      \r\n                      void main() { \r\n                          vec2 vt = a_position * 0.5 + 0.5;vt.y = 1.0 - vt.y; gl_Position = vec4(a_position, 0.0, 1.0); \r\n                          blurCoordinates[0] = vt; \r\n                          blurCoordinates[1] = vt + "+1/
this._width*1.407333+";blurCoordinates[2] = vt - "+1/this._height*1.407333+";blurCoordinates[3] = vt + "+1/this._width*3.294215+";blurCoordinates[4] = vt - "+1/this._height*3.294215+";}",fragmentShader:"uniform sampler2D s_texture; \r\n                        \r\n                        varying highp vec2 blurCoordinates[5]; \r\n                        \r\n                        void main() { \r\n                            lowp vec4 sum = vec4(0.0); \r\n                            sum += texture2D(s_texture, blurCoordinates[0]) * 0.204164; \r\n                            sum += texture2D(s_texture, blurCoordinates[1]) * 0.304005; \r\n                            sum += texture2D(s_texture, blurCoordinates[2]) * 0.304005; \r\n                            sum += texture2D(s_texture, blurCoordinates[3]) * 0.093913; \r\n                            sum += texture2D(s_texture, blurCoordinates[4]) * 0.093913; \r\n                            gl_FragColor = sum; \r\n                        }"}),
d=new og.shaderProgram.ShaderProgram("normalMap",{attributes:{a_position:{type:og.shaderProgram.types.VEC2,enableArray:!0},a_normal:{type:og.shaderProgram.types.VEC3,enableArray:!0}},vertexShader:"attribute vec2 a_position; \r\n                      attribute vec3 a_normal; \r\n                      \r\n                      varying vec3 v_color; \r\n                      \r\n                      void main() { \r\n                          gl_PointSize = 1.0; \r\n                          gl_Position = vec4(a_position, 0, 1); \r\n                          v_color = normalize(a_normal) * 0.5 + 0.5; \r\n                      }",
fragmentShader:"precision mediump float; \r\n                        \r\n                        varying vec3 v_color; \r\n                        \r\n                        void main () { \r\n                            gl_FragColor = vec4(v_color, 1.0); \r\n                        }"});this._handler=new og.webgl.Handler(null,{width:this._width,height:this._height,context:{alpha:!1,depth:!1}});this._handler.addShaderProgram(c);this._handler.addShaderProgram(d);this._handler.init();this._handler.deactivateFaceCulling();
this._handler.deactivateDepthTest();this._framebuffer=new og.webgl.Framebuffer(this._handler.gl,this._width,this._height);this._framebuffer.initialize();for(c=1;6>=c;c++){for(var d=Math.pow(2,c),e=d/2,f=[],g=0;g<=d;g++)for(var h=0;h<=d;h++)f.push(-1+h/e,-1+g/e);this._verticesBufferArray[d]=this._handler.createArrayBuffer(new Float32Array(f),2,f.length/2);e=og.planetSegment.PlanetSegmentHelper.createSegmentIndexes(d,[d,d,d,d]);this._indexBufferArray[d]=this._handler.createElementArrayBuffer(e,1,e.length)}c=
[-1,-1,1,-1,-1,1,1,1];this._positionBuffer=this._handler.createArrayBuffer(new Float32Array(c),2,c.length/2)};
og.utils.NormalMapCreator.prototype._drawNormalMap=function(c){var d=c.length/3,e=Math.sqrt(d)-1;c=this._handler.createArrayBuffer(new Float32Array(c),3,d);var d=this._framebuffer,f=this._handler.shaderPrograms.normalMap,g=this._handler.gl,h=f._program.attributes;f.activate();d.activate();g.bindBuffer(g.ARRAY_BUFFER,this._verticesBufferArray[e]);g.vertexAttribPointer(h.a_position._pName,this._verticesBufferArray[e].itemSize,g.FLOAT,!1,0,0);g.bindBuffer(g.ARRAY_BUFFER,c);g.vertexAttribPointer(h.a_normal._pName,
c.itemSize,g.FLOAT,!1,0,0);g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this._indexBufferArray[e]);g.drawElements(g.TRIANGLE_STRIP,this._indexBufferArray[e].numItems,g.UNSIGNED_SHORT,0);d.deactivate()};
og.utils.NormalMapCreator.prototype._drawBlur=function(){var c=this._handler.gl,d=this._handler.shaderPrograms.normalMapBlur,e=d._program.attributes,f=d._program.uniforms;d.activate();c.bindBuffer(c.ARRAY_BUFFER,this._positionBuffer);c.vertexAttribPointer(e.a_position._pName,this._positionBuffer.itemSize,c.FLOAT,!1,0,0);c.activeTexture(c.TEXTURE0);c.bindTexture(c.TEXTURE_2D,this._framebuffer.texture);c.uniform1i(f.s_texture._pName,0);c.drawArrays(c.TRIANGLE_STRIP,0,this._positionBuffer.numItems)};
og.utils.NormalMapCreator.prototype.draw=function(c){this._drawNormalMap(c);this._drawBlur();return this._handler.canvas};og.planetSegment.NormalMapCreatorQueue=function(c,d){og.inheritance.base(this,c,d);this.active=!0;this._counter=0;this._pendingsQueue=new og.QueueArray};og.inheritance.extend(og.planetSegment.NormalMapCreatorQueue,og.utils.NormalMapCreator);og.planetSegment.NormalMapCreatorQueue.prototype.shift=function(c){this.active&&(c._inTheQueue=!0,1<=this._counter?this._pendingsQueue.unshift(c):this._exec(c))};
og.planetSegment.NormalMapCreatorQueue.prototype.queue=function(c){if(this.active||c.zoomIndex<=c.planet.terrainProvider.minZoom)c._inTheQueue=!0,1<=this._counter?this._pendingsQueue.push(c):this._exec(c)};og.planetSegment.NormalMapCreatorQueue.prototype._exec=function(c){this._counter++;var d=this;setTimeout(function(){c.createNormalMapTexture();c._inTheQueue=!1;d._dequeueRequest()},0)};
og.planetSegment.NormalMapCreatorQueue.prototype._dequeueRequest=function(){this._counter--;if(this._pendingsQueue.length&&1>this._counter){var c;(c=this._whilePendings())&&this._exec(c)}};og.planetSegment.NormalMapCreatorQueue.prototype._whilePendings=function(){for(;this._pendingsQueue.length;){var c=this._pendingsQueue.pop();if(c.terrainReady&&c.node.getState()!=og.quadTree.NOTRENDERING&&c._inTheQueue)return c;c._inTheQueue=!1}return null};og.node.Planet=function(c,d){og.inheritance.base(this,c);this.ellipsoid=d;this.quadTreeSouth=this.quadTreeNorth=this.quadTree=null;this.events=new og.Events;this.layers=[];this.visibleLayers=[];this.tcolorArr=[];this.camera=this.terrainProvider=this.baseLayer=null;this.createdNodesCount=0;this.renderedNodes=[];this.heightFactor=1;this.mousePositionOnEarth=new og.math.Vector3;this.indexesBuffers=[];this.backbuffer=null;this._currentDistanceFromPixel=0;this._viewChanged=!0;this.geoImageTileCreator=
this.normalMapCreator=this.sunlight=this.defaultTexture=this.transparentTexture=this.emptyTexture=null;this.geoImagesArray=[];this.minCurrZoom=og.math.MAX;this.maxCurrZoom=og.math.MIN};og.node.Planet.SUN_DISTANCE=1496E8;og.inheritance.extend(og.node.Planet,og.node.RenderNode);og.node.Planet.defaultEmptyColor="#C5C5C5";
og.node.Planet.prototype.createDefaultTexture=function(c){var d,e;if(c&&c.color)d=new og.ImageCanvas(2,2),d.fillColor(c.color),e=this.renderer.handler.createTexture(d._canvas);else if(c&&c.url){d=new og.ImageCanvas(c.width||256,c.height||256);var f=this;d.loadImage(c.url,function(c){e=f.renderer.handler.createTexture(c);e["default"]=!0})}else d=new og.ImageCanvas(2,2),d.fillColor(og.node.Planet.defaultEmptyColor),e=this.renderer.handler.createTexture(d._canvas);e["default"]=!0;return e};
og.node.Planet.prototype.getLayerByName=function(c){for(var d=this.layers.length;d--;)if(this.layers[d].name===c)return this.layers[d]};og.node.Planet.prototype.addGeoImage=function(c){c.addTo(this)};og.node.Planet.prototype.addLayer=function(c){c.planet=this;c.events.on("onvisibilitychanged",this,this._onLayerVisibilityChanged);c.isBaseLayer&&c.visibility&&this.setBaseLayer(c);this.layers.push(c);this.events.dispatch(this.events.onlayeradded,c);this.updateVisibleLayers()};
og.node.Planet.prototype._onLayerVisibilityChanged=function(c){this.events.dispatch(this.events.onlayervisibilitychanged,c)};og.node.Planet.prototype.addLayers=function(c){for(var d=0;d<c.length;d++)this.addLayer(c[d])};
og.node.Planet.prototype.removeLayer=function(c){for(var d=c.id,e=0;e<this.layers.length;e++)if(this.layers[e].id==d)return this.layers.splice(e,1),c.setVisibility(!1),c.abortLoading(),this.quadTree.traverseTree(function(c){c=c.planetSegment.materials;c[d]&&(c[d].clear(),c[d]=null)}),this.events.dispatch(this.events.onlayerremoved,c),c};
og.node.Planet.prototype.redrawGeoImages=function(){this.geoImagesArray.sort(function(c,e){return e.zIndex-c.zIndex});var c=function(c){c.planetSegment.geoImageReady=!1};this.quadTree.traverseTree(c);this.quadTreeNorth.traverseTree(c);this.quadTreeSouth.traverseTree(c)};og.node.Planet.prototype.getLayers=function(){return this.layers};
og.node.Planet.prototype.setBaseLayer=function(c){if(this.baseLayer){if(c.id!=this.baseLayer.id){for(var d=0;d<this.layers.length;d++){var e=this.layers[d];e.isBaseLayer&&(e.visibility=!1,e.id!=c.id&&e.events.dispatch(e.events.onvisibilitychanged,e))}c.visibility=!0;c.events.dispatch(c.events.onvisibilitychanged,c);this.baseLayer.abortLoading();this.baseLayer=c}}else this.baseLayer=c,this.baseLayer.setVisibility(!0);this.events.dispatch(this.events.onbaselayerchanged,c);this.updateVisibleLayers()};
og.node.Planet.prototype.setHeightFactor=function(c){this.heightFactor!==c&&(this.heightFactor=c,this.quadTree.reloadTerrain())};og.node.Planet.prototype.setTerrainProvider=function(c){this.terrainProvider=c};
og.node.Planet.prototype.initialization=function(){og.planetSegment.PlanetSegmentHelper.initIndexesTables(6);for(var c=0;6>=c;c++){var d=Math.pow(2,c),e=og.planetSegment.PlanetSegmentHelper.createSegmentIndexes(d,[d,d,d,d]);this.indexesBuffers[d]=this.renderer.handler.createElementArrayBuffer(e,1,e.length)}this.solidTexture=this.createDefaultTexture({color:"rgba(197,197,197,1.0)"});this.transparentTexture=this.createDefaultTexture({color:"rgba(0,0,0,0.0)"});this.camera=this.renderer.activeCamera=
new og.PlanetCamera(this,{eye:new og.math.Vector3(0,0,28E6),look:new og.math.Vector3(0,0,0),up:new og.math.Vector3(0,1,0)});this.quadTree=og.quadTree.QuadNode.createNode(og.planetSegment.PlanetSegment,this,og.quadTree.NW,null,0,0,og.Extent.createFromArray([-2.003750834E7,-2.003750834E7,2.003750834E7,2.003750834E7]));this.quadTreeNorth=og.quadTree.QuadNode.createNode(og.planetSegment.Wgs84PlanetSegment,this,og.quadTree.NW,null,0,0,og.Extent.createFromArray([-180,og.mercator.MAX_LAT,180,90]));this.quadTreeSouth=
og.quadTree.QuadNode.createNode(og.planetSegment.Wgs84PlanetSegment,this,og.quadTree.NW,null,0,0,og.Extent.createFromArray([-180,-90,180,og.mercator.MIN_LAT]));this.renderer.activeCamera.cameraInsideNode=this.quadTree;this.drawMode=this.renderer.handler.gl.TRIANGLE_STRIP;this.setScale(new og.math.Vector3(1,this.ellipsoid._a/this.ellipsoid._b,1));this.updateMatrices();this.renderer.handler.addShaderProgram(og.shaderProgram.single_nl(),!0);this.renderer.handler.addShaderProgram(og.shaderProgram.single_wl(),
!0);this.renderer.handler.addShaderProgram(og.shaderProgram.overlays_nl(),!0);this.renderer.handler.addShaderProgram(og.shaderProgram.overlays_wl(),!0);this.renderer.handler.addShaderProgram(og.shaderProgram.picking(),!0);this.backbuffer=new og.webgl.Framebuffer(this.renderer.handler.gl);this.backbuffer.initialize();this.updateVisibleLayers();this.events.registerNames(["ondraw","onlayeradded","onbaselayerchanged","onlayerremoved","onlayervisibilitychanged"]);this.renderer.events.on("onresize",this.backbuffer,
function(c){this.setSize(c.width,c.height)});this.renderer.activeCamera.events.on("onviewchanged",this,function(c){this._viewChanged=!0});this.renderer.events.on("onmousemove",this,function(c){this._viewChanged=!0});this.sunlight=new og.light.PointLight;this.sunlight._position.z=og.node.Planet.SUN_DISTANCE;this.sunlight.setAmbient(new og.math.Vector3(.18,.13,.25));this.sunlight.setDiffuse(new og.math.Vector3(.9,.9,.8));this.sunlight.setSpecular(new og.math.Vector3(.008,.008,.005));this.sunlight.setShininess(4);
this.sunlight.addTo(this);this.lightEnabled=!0;this.normalMapCreator=new og.planetSegment.NormalMapCreatorQueue(128,128);this.geoImageTileCreator=new og.planetSegment.GeoImageTileCreatorQueue(256,256);var f=this;this.renderer.events.on("oncharkeypressed",this,function(){f.memClear()},og.input.KEY_C);this.renderer.events.on("oncharkeypressed",this,function(){f.lightEnabled=!f.lightEnabled},og.input.KEY_L);this.renderer.events.on("onkeypressed",this,function(){f.sunlight._position=f.renderer.activeCamera.eye},
og.input.KEY_V)};og.node.Planet.prototype.updateAttributionsList=function(){for(var c="",d=0;d<this.layers.length;d++){var e=this.layers[d];e.visibility&&e._attribution.length&&(c+="<li>"+e._attribution+"</li>")}this.renderer&&(c.length?(this.renderer.div.attributions.style.display="block",this.renderer.div.attributions.innerHTML="<ul>"+c+"</ul>"):(this.renderer.div.attributions.style.display="none",this.renderer.div.attributions.innerHTML=""))};
og.node.Planet.prototype.updateVisibleLayers=function(){this.visibleLayers.length=0;for(var c="",d=0;d<this.layers.length;d++){var e=this.layers[d];e.visibility&&(e.isBaseLayer&&(this.baseLayer=e),this.visibleLayers.push(e),e._attribution.length&&(c+="<li>"+e._attribution+"</li>"))}this.renderer&&(c.length?(this.renderer.div.attributions.style.display="block",this.renderer.div.attributions.innerHTML="<ul>"+c+"</ul>"):(this.renderer.div.attributions.style.display="none",this.renderer.div.attributions.innerHTML=
""));this.sortVisibleLayersByZIndex()};og.node.Planet.prototype.sortVisibleLayersByZIndex=function(){this.visibleLayers.sort(function(c,d){return c.isBaseLayer?-1:c.zIndex-d.zIndex})};og.node.Planet.prototype.collectRenderNodes=function(){this.minCurrZoom=og.math.MAX;this.maxCurrZoom=og.math.MIN;this.quadTreeNorth.renderTree();this.quadTreeSouth.renderTree();this.quadTree.renderTree()};
og.node.Planet.prototype.frame=function(){var c=this.renderer.activeCamera;c.flyFrame();c.checkCollision();this.events.dispatch(this.events.ondraw,this);this.collectRenderNodes();this.sunlight._position=c.v.scaleTo(.2*c.altitude).add(c.u.scaleTo(.4*c.altitude)).add(c.eye);this.transformLights();this.renderNodesPASS();this.renderDistanceBackbufferPASS();var d=this;1370<this.createdNodesCount&&(setTimeout(function(){d.memClear()},0),d.createdNodesCount=0);this.renderedNodes.length=0};
og.node.Planet.prototype.memClear=function(){this.quadTree.clearTree();this.quadTreeNorth.clearTree();this.quadTreeSouth.clearTree()};
og.node.Planet.prototype.renderNodesPASS=function(){var c,d,e=this.renderer;c=e.handler;var f=c.gl;f.blendEquation(f.FUNC_ADD);f.blendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA);f.enable(f.BLEND);if(1<this.visibleLayers.length){d=og.planetSegment.drawOverlays;this.lightEnabled?(c.shaderPrograms.overlays_wl.activate(),c=c.shaderPrograms.overlays_wl._program,shu=c.uniforms,f.uniform3fv(shu.pointLightsPositions._pName,this._pointLightsTransformedPositions),f.uniform3fv(shu.pointLightsParamsv._pName,this._pointLightsParamsv),
f.uniform1fv(shu.pointLightsParamsf._pName,this._pointLightsParamsf),f.uniformMatrix3fv(shu.uNMatrix._pName,!1,e.activeCamera.nMatrix._m),f.uniformMatrix4fv(shu.uMVMatrix._pName,!1,e.activeCamera.mvMatrix._m),f.uniformMatrix4fv(shu.uPMatrix._pName,!1,e.activeCamera.pMatrix._m)):(c.shaderPrograms.overlays_nl.activate(),c=c.shaderPrograms.overlays_nl._program,f.uniformMatrix4fv(c.uniforms.uPMVMatrix._pName,!1,e.activeCamera.pmvMatrix._m));for(var e=this.visibleLayers,g=e.length;g--;){var h=e[g],k=4*
g;this.tcolorArr[k]=h.transparentColor[0];this.tcolorArr[k+1]=h.transparentColor[1];this.tcolorArr[k+2]=h.transparentColor[2];this.tcolorArr[k+3]=h.opacity}f.uniform1i(c.uniforms.numTex._pName,e.length);f.uniform4fv(c.uniforms.tcolorArr._pName,this.tcolorArr)}else d=og.planetSegment.drawSingle,this.lightEnabled?(c.shaderPrograms.single_wl.activate(),c=c.shaderPrograms.single_wl._program,shu=c.uniforms,f.uniform3fv(shu.pointLightsPositions._pName,this._pointLightsTransformedPositions),f.uniform3fv(shu.pointLightsParamsv._pName,
this._pointLightsParamsv),f.uniform1fv(shu.pointLightsParamsf._pName,this._pointLightsParamsf),f.uniformMatrix3fv(shu.uNMatrix._pName,!1,e.activeCamera.nMatrix._m),f.uniformMatrix4fv(shu.uMVMatrix._pName,!1,e.activeCamera.mvMatrix._m),f.uniformMatrix4fv(shu.uPMatrix._pName,!1,e.activeCamera.pMatrix._m)):(c.shaderPrograms.single_nl.activate(),c=c.shaderPrograms.single_nl._program,f.uniformMatrix4fv(c.uniforms.uPMVMatrix._pName,!1,e.activeCamera.pmvMatrix._m));for(g=this.renderedNodes.length;g--;)d(c,
this.renderedNodes[g].planetSegment);f.disable(f.BLEND)};og.node.Planet.prototype.hitRayEllipsoid=function(c,d){var e=this.transformationMatrix.transpose();return(e=(new og.math.Ray(e.mulVec3(c),e.mulVec3(d))).hitSphere(new og.bv.Sphere(this.ellipsoid._a)))?this.itransformationMatrix.mulVec3(e):null};og.node.Planet.prototype.getCartesianFromPixelEllipsoid=function(c){var d=this.renderer.activeCamera;return this.hitRayEllipsoid(d.eye,d.unproject(c.x,c.y))};
og.node.Planet.prototype.getLonLatFromPixelEllipsoid=function(c){return(c=this.getCartesianFromPixelEllipsoid(c))?this.ellipsoid.ECEF2LonLat(c):null};og.node.Planet.prototype.getRayIntersectionEllipsoid=function(c){var d=this.transformationMatrix.transpose();return(c=(new og.math.Ray(d.mulVec3(c.origin),d.mulVec3(c.direction))).hitSphere(new og.bv.Sphere(this.ellipsoid._a)))?this.itransformationMatrix.mulVec3(c):null};
og.node.Planet.prototype.getCartesianFromMouseTerrain=function(){var c=this.renderer.events.mouseState,d=this.getDistanceFromPixel(c);return d?c.direction.scaleTo(d).add(this.renderer.activeCamera.eye):null};og.node.Planet.prototype.getCartesianFromPixelTerrain=function(c){var d=this.getDistanceFromPixel(c);return d?this.renderer.activeCamera.unproject(c.x,c.y).scaleTo(d).add(this.renderer.activeCamera.eye):null};
og.node.Planet.prototype.getLonLatFromPixelTerrain=function(c){return(c=this.getCartesianFromPixelTerrain(c))?this.ellipsoid.ECEF2LonLat(c):null};og.node.Planet.prototype.getPixelFromCartesian=function(c){return this.renderer.activeCamera.project(c)};og.node.Planet.prototype.getPixelFromLonLat=function(c){return(c=this.ellipsoid.LonLat2ECEF(c))?this.renderer.activeCamera.project(c):null};
og.node.Planet.prototype.getDistanceFromPixelEllipsoid=function(c){return(c=this.getCartesianFromPixelEllipsoid(c))?c.distance(this.renderer.activeCamera.eye):null};og.node.Planet.prototype.getDistanceFromPixel=function(c){if(this._viewChanged){this._viewChanged=!1;var d=og.math.Vector4.fromVec(this.backbuffer.readPixel(c.x,this.backbuffer.height-c.y));return d.x|d.y|d.z|d.w?this._currentDistanceFromPixel=og.math.coder.decodeFloatFromRGBA(d):this.getDistanceFromPixelEllipsoid(c)}return this._currentDistanceFromPixel};
og.node.Planet.prototype.renderDistanceBackbufferPASS=function(){var c=this.backbuffer,d=this.renderer,e=d.handler,f=e.shaderPrograms.picking;e.gl.disable(e.gl.BLEND);c.activate();c.clear();f.activate();e.gl.uniform3fv(f._program.uniforms.camPos._pName,d.activeCamera.eye.toVec());for(d=this.renderedNodes.length;d--;)this.renderedNodes[d].planetSegment.drawPicking();c.deactivate();this.renderedNodes.length=0};og.node.Planet.prototype.viewExtent=function(c){this.renderer.activeCamera.viewExtent(c)};
og.node.Planet.prototype.viewLonLat=function(c,d){this.renderer.activeCamera.viewLonLat(c,d)};og.node.Planet.prototype.flyExtent=function(c,d){this.renderer.activeCamera.flyCartesian(c,d)};og.node.Planet.prototype.flyCartesian=function(c,d,e){this.renderer.activeCamera.flyCartesian(c,d,e)};og.node.Planet.prototype.flyLonLat=function(c,d,e){this.renderer.activeCamera.flyLonLat(c,d,e)};og.node.Planet.prototype.stopFlying=function(){this.renderer.activeCamera.stopFlying()};og.input.MouseHandler=function(c){this._htmlObject=c};
og.input.MouseHandler.prototype.setEvent=function(c,d,e){switch(c){case "onmousewheel":c=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";this._htmlObject.attachEvent?this._htmlObject.attachEvent("on"+c,function(c){e.call(d,c)}):this._htmlObject.addEventListener&&this._htmlObject.addEventListener(c,function(c){c.wheelDelta=-120*c.detail;e.call(d,c)},!1);break;case "onmousedown":this._htmlObject.onmousedown=function(c){e.call(d,c)};this._htmlObject.oncontextmenu=function(c){return!1};
break;case "onmouseup":this._htmlObject.onmouseup=function(c){e.call(d,c)};break;case "onmousemove":this._htmlObject.onmousemove=function(c){var g=this.getBoundingClientRect();e.call(d,{clientX:c.clientX-g.left,clientY:c.clientY-g.top})}}};og.input.KeyboardHandler=function(){var c={},d={},e={},f=this,g=null,h=null;if(og.input.KeyboardHandler.prototype._instance)return og.input.KeyboardHandler.prototype._instance;og.input.KeyboardHandler.prototype._instance=this;document.onkeydown=function(c){h=c;f.handleKeyDown.call(f)};document.onkeyup=function(c){h=c;f.handleKeyUp.call(f)};var k=function(c,d){return c.priority<d.priority};this.addEvent=function(c,h,n,p,q){void 0===q&&(q=1600);switch(c){case "onkeypressed":null==p?g={callback:n,sender:h||
f}:(d[p]||(d[p]=[]),d[p].push({callback:n,sender:h,priority:q}),d[p].sort(k));break;case "oncharkeypressed":e[p]||(e[p]=[]),e[p].push({callback:n,sender:h,priority:q}),e[p].sort(k)}};this.isKeyPressed=function(d){return c[d]};this.handleKeyDown=function(){g&&g.callback.call(g.sender,h);c[h.keyCode]=!0;for(var d in e)if(String.fromCharCode(h.keyCode)==String.fromCharCode(d))for(var f=e[d],k=0;k<f.length;k++)f[k].callback.call(f[k].sender,h)};this.handleKeyUp=function(){c[h.keyCode]=!1};this.handleEvents=
function(){for(var e in d)if(c[e])for(var f=d[e],g=0;g<f.length;g++)f[g].callback.call(f[g].sender,h)}};og.input.TouchHandler=function(c){this._htmlObject=c};
og.input.TouchHandler.prototype.setEvent=function(c,d,e){switch(c){case "ontouchcancel":this._htmlObject.ontouchcancel=function(c){c.preventDefault();e.call(d,c)};break;case "ontouchstart":this._htmlObject.ontouchstart=function(c){c.preventDefault();e.call(d,c)};break;case "ontouchend":this._htmlObject.ontouchend=function(c){c.preventDefault();e.call(d,c)};break;case "ontouchmove":this._htmlObject.ontouchmove=function(c){c.preventDefault();this.getBoundingClientRect();e.call(d,c)}}};og.RendererEvents=function(c){og.inheritance.base(this);this.touchHandler=new og.input.TouchHandler(c);this.mouseHandler=new og.input.MouseHandler(c);this.keyboardHandler=new og.input.KeyboardHandler;this.mouseState={x:0,y:0,prev_x:0,prev_y:0,direction:new og.math.Vector3,leftButtonUp:!1,rightButtonUp:!1,leftButtonDown:!1,rightButtonDown:!1,leftButtonHold:!1,rightButtonHold:!1,leftButtonDoubleClick:!1,click:!1,moving:!1,justStopped:!1,doubleClickDelay:300,wheelDelta:0};this.touchState={moving:!1,
touchEnd:!1,touchStart:!1,touchCancel:!1,sys:null};this._mousestopThread=null;this._clickY=this._clickX=this._dblClkBegins=0};og.inheritance.extend(og.RendererEvents,og.Events);og.RendererEvents.prototype.handleEvents=function(){this.keyboardHandler.handleEvents();this.handleMouseAndTouchEvents()};og.RendererEvents.prototype.on=function(c,d,e,f,g){this[c]?this.constructor.superclass.on.call(this,c,d,e):this.keyboardHandler.addEvent(c,d,e,f,g)};og.RendererEvents.prototype.isKeyPressed=function(c){return this.keyboardHandler.isKeyPressed(c)};
og.RendererEvents.prototype.initialize=function(){this.registerNames("ondraw onmousemove onmousestop onmouselbuttondoubleclick onmouseclick onmouselbuttondown onmouselbuttonhold onmouserbuttondown onmouserbuttonhold onmouselbuttonup onmouserbuttonup onresize onmousewheel ontouchstart ontouchend ontouchcancel ontouchmove".split(" "));this.mouseHandler.setEvent("onmouseup",this,this.onMouseUp);this.mouseHandler.setEvent("onmousemove",this,this.onMouseMove);this.mouseHandler.setEvent("onmousedown",this,
this.onMouseDown);this.mouseHandler.setEvent("onmousewheel",this,this.onMouseWheel);this.touchHandler.setEvent("ontouchstart",this,this.onTouchStart);this.touchHandler.setEvent("ontouchend",this,this.onTouchEnd);this.touchHandler.setEvent("ontouchcancel",this,this.onTouchCancel);this.touchHandler.setEvent("ontouchmove",this,this.onTouchMove)};og.RendererEvents.prototype.onMouseWheel=function(c){this.mouseState.wheelDelta=c.wheelDelta};
og.RendererEvents.prototype.onMouseMove=function(c){var d=this.mouseState;if(d.x!=c.clientX||d.y!=c.clientY)d.x=c.clientX,d.y=c.clientY,d.moving=!0,clearTimeout(this._mousestopThread),this._mousestopThread=setTimeout(function(){d.justStopped=!0},100)};og.RendererEvents.prototype.onMouseDown=function(c){c.button===og.input.MB_LEFT?(this._clickX=c.clientX,this._clickY=c.clientY,this.mouseState.leftButtonDown=!0):this.mouseState.rightButtonDown=!0};
og.RendererEvents.prototype.onMouseUp=function(c){var d=this.mouseState;c.button===og.input.MB_LEFT?(d.leftButtonDown=!1,d.leftButtonHold=!1,d.leftButtonUp=!0,this._dblClkBegins?((new Date).getTime()-this._dblClkBegins<=d.doubleClickDelay&&(d.leftButtonDoubleClick=!0),this._dblClkBegins=0):this._dblClkBegins=(new Date).getTime(),this._clickX==c.clientX&&this._clickY==c.clientY&&(d.click=!0)):(d.rightButtonDown=!1,d.rightButtonHold=!1,d.rightButtonUp=!0)};
og.RendererEvents.prototype.onTouchStart=function(c){var d=this.touchState;d.sys=c;d.x=c.clientX;d.y=c.clientY;d.touchStart=!0};og.RendererEvents.prototype.onTouchEnd=function(c){var d=this.touchState;d.sys=c;d.touchEnd=!0};og.RendererEvents.prototype.onTouchCancel=function(c){var d=this.touchState;d.sys=c;d.touchCancel=!0};og.RendererEvents.prototype.onTouchMove=function(c){var d=this.touchState;d.sys=c;d.moving=!0};
og.RendererEvents.prototype.handleMouseAndTouchEvents=function(){var c=this.mouseState,d=this.touchState,e=this.dispatch;c.click&&(e(this.onmouseclick,c),c.click=!1);c.leftButtonDown&&(c.leftButtonHold?e(this.onmouselbuttonhold,c):(c.leftButtonHold=!0,e(this.onmouselbuttondown,c)));c.rightButtonDown&&(c.rightButtonHold?e(this.onmouserbuttonhold,c):(c.rightButtonHold=!0,e(this.onmouserbuttondown,c)));c.leftButtonUp&&(c.leftButtonUp=!1,e(this.onmouselbuttonup,c));c.rightButtonUp&&(c.rightButtonUp=!1,
e(this.onmouserbuttonup,c));c.leftButtonDoubleClick&&(e(this.onmouselbuttondoubleclick,c),c.leftButtonDoubleClick=!1);c.wheelDelta&&(e(this.onmousewheel,c),c.wheelDelta=0);c.moving&&(e(this.onmousemove,c),c.prev_x=c.x,c.prev_y=c.y,this._dblClkBegins=0);d.touchEnd&&(d.touchEnd=!1,e(this.ontouchend,d));d.touchCancel&&(d.touchCancel=!1,e(this.ontouchcancel,d));d.touchStart&&(d.touchStart=!1,e(this.ontouchstart,d));d.moving&&e(this.ontouchmove,d);c.justStopped&&(e(this.onmousestop,c),c.justStopped=!1)};og.Renderer=function(c){this.div=null;this.handler=c;this._renderNodesArr=[];this.renderNodes={};this.cameras=[];this.activeCamera=null;this.events=new og.RendererEvents(c.gl.canvas);this.controls=[];this.controlsBag={}};og.Renderer.prototype.getWidth=function(){return this.handler.gl.canvas.width};og.Renderer.prototype.getHeight=function(){return this.handler.gl.canvas.height};
og.Renderer.prototype.getCenter=function(){var c=this.handler.gl.canvas;return new og.math.Pixel(Math.round(.5*c.width),Math.round(.5*c.height))};og.Renderer.prototype.addControl=function(c){c.setRenderer(this);this.controls.push(c)};og.Renderer.prototype.addControls=function(c){for(var d=0;d<c.length;d++)c[d].setRenderer(this),this.controls.push(c[d])};
og.Renderer.prototype.removeControl=function(c){for(var d=0;d<this.controls.length;d++)if(this.controls[d]==c)return this.controls.splice(d,1),c.deactivate(),c};
og.Renderer.prototype.init=function(){var c=this;this.handler.drawback=function(){c.draw()};this.activeCamera=new og.Camera(this,{eye:new og.math.Vector3(0,0,12E6),look:new og.math.Vector3(0,0,0),up:new og.math.Vector3(0,1,0)});this.events.initialize();this.handler.onCanvasResize=function(d){c.activeCamera.refresh();c.events.dispatch(c.events.onresize,d)}};
og.Renderer.prototype.addRenderNode=function(c){this.renderNodes[c.name]?alert("Node name: "+c.name+" allready exists."):(c.assignRenderer(this),c.initialization(),this._renderNodesArr.push(c),this.renderNodes[c.name]=c)};og.Renderer.prototype.addRenderNodes=function(c){for(var d=0;d<c;d++)this.addRenderNode(c[d])};
og.Renderer.prototype.draw=function(){this.events.mouseState.direction=this.activeCamera.unproject(this.events.mouseState.x,this.events.mouseState.y);this.events.handleEvents();this.events.dispatch(this.events.ondraw,this);for(var c=0;c<this._renderNodesArr.length;c++)this._renderNodesArr[c].drawNode();this.events.mouseState.moving=!1;this.events.touchState.moving=!1};og.Renderer.prototype.start=function(){this.handler.start()};og.Globus=function(c){function d(){return!1}function e(){return!0}var f=og.Globus.CANVAS_ID_PREFIX+og.Globus.__id,g=document.createElement("canvas");g.id=f;g.style.width="100%";g.style.height="100%";g.style.display="block";g.style.opacity="1.0";this.div=document.getElementById(c.target);this.div.appendChild(g);this.div.classList.add("ogViewport");this.div.onmouseenter=function(){document.onmousewheel=d};this.div.onmouseleave=function(){document.onmousewheel=e};f=new og.webgl.Handler(f,{alpha:!1});
f.init();this.renderer=new og.Renderer(f);this.renderer.init();this.renderer.div=this.div;this.renderer.div.attributions=document.createElement("div");this.renderer.div.attributions.classList.add("ogAttribution");this.div.appendChild(this.renderer.div.attributions);c.skybox&&this.renderer.addRenderNode(c.skybox);this._planetName=c.name?c.name:og.Globus.PLANET_NAME_PREFIX+og.Globus.__id;this.planet=new og.node.Planet(this._planetName,c.ellipsoid?c.ellipsoid:og.ellipsoid.wgs84);c.layers&&this.planet.addLayers(c.layers);
c.terrain?this.planet.setTerrainProvider(c.terrain):this.planet.setTerrainProvider(new og.terrainProvider.EmptyTerrainProvider);this.renderer.addRenderNode(this.planet);c.controls&&this.renderer.addControls(c.controls);og.Globus.__id++;c.viewExtent&&this.planet.viewToExtent(c.viewExtent);var h=0,k=null;this.fadeIn=function(c){clearInterval(null);clearInterval(k);h=g.style.opacity=0;var d=1/(c/10);k=setInterval(function(){h+=d;1<=h&&(h=1,clearInterval(k));g.style.opacity=h},10)};this.fadeOut=function(c){clearInterval(null);
clearInterval(k);h=g.style.opacity=1;var d=1/(c/10);k=setInterval(function(){h-=d;0>=h&&(h=0,clearInterval(k));g.style.opacity=h},10)};(isUndefined(c.autoActivate)||c.autoActivate)&&this.renderer.start()};og.Globus.__id=1;og.Globus.CANVAS_ID_PREFIX="globus_viewport_";og.Globus.PLANET_NAME_PREFIX="globus_planet_";function isUndefined(c){return void 0===c};og.control.ShowFps=function(c){og.inheritance.base(this,c)};og.inheritance.extend(og.control.ShowFps,og.control.Control);og.control.ShowFps.prototype.init=function(){var c=document.createElement("div");c.className="defaultText ";c.id="ogShowFpsControl";document.body.appendChild(c);this.renderer.events.on("ondraw",this,this.draw)};og.control.ShowFps.prototype.draw=function(){print2d("ogShowFpsControl",this.renderer.handler.fps.toFixed(1),this.renderer.handler.gl.canvas.width-60,0)};og.control.LayerSwitcher=function(c){og.inheritance.base(this,c);this.overlaysDiv=this.baseLayersDiv=this.dialog=null;this._id=og.control.LayerSwitcher.numSwitches++};og.control.LayerSwitcher.numSwitches=0;og.inheritance.extend(og.control.LayerSwitcher,og.control.Control);
og.control.LayerSwitcher.prototype.init=function(){this.renderer.renderNodes.Earth.events.on("onlayeradded",this,this.onLayerAdded);this.renderer.renderNodes.Earth.events.on("onlayerremoved",this,this.onLayerRemoved);this.renderer.renderNodes.Earth.events.on("onbaselayerchanged",this,this.onBaseLayerChanged);this.renderer.renderNodes.Earth.events.on("onlayervisibilitychanged",this,this.onLayerVisibilityChanged);this.createSwitcher();this.createDialog()};
og.control.LayerSwitcher.prototype.onLayerAdded=function(c){console.log("added")};og.control.LayerSwitcher.prototype.onLayerRemoved=function(c){console.log("removed")};og.control.LayerSwitcher.prototype.onBaseLayerChanged=function(c){console.log("basechanged")};og.control.LayerSwitcher.prototype.onLayerVisibilityChanged=function(c){console.log("changed "+c.id)};
og.control.LayerSwitcher.prototype.createBaseLayersDiv=function(){var c=document.createElement("div");c.className="layersDiv";this.dialog.appendChild(c);var d=document.createElement("div");d.className="layersDiv";d.innerHTML="Base Layer";c.appendChild(d);this.baseLayersDiv=document.createElement("div");c.appendChild(this.baseLayersDiv);this.createBaseLayersList(this.baseLayersDiv)};
og.control.LayerSwitcher.prototype.createOverlaysDiv=function(){var c=document.createElement("div");c.className="layersDiv";this.dialog.appendChild(c);var d=document.createElement("div");d.className="layersDiv";d.innerHTML="Overlays";c.appendChild(d);this.overlaysDiv=document.createElement("div");c.appendChild(this.overlaysDiv);this.createOverlaysList(this.overlaysDiv)};
og.control.LayerSwitcher.prototype.createDialog=function(){this.dialog=document.createElement("div");this.dialog.id="ogLayerSwitcherDialog";this.dialog.className="displayNone";this.renderer.div.appendChild(this.dialog);this.createBaseLayersDiv();this.createOverlaysDiv()};
og.control.LayerSwitcher.prototype.createOverlaysList=function(c){var d,e,f=this,g=this.renderer.renderNodes.Earth.layers;for(d=0;d<g.length;d++)g[d].isBaseLayer||(e=document.createElement("input"),e.type="checkbox",e.value=d,e.checked=g[d].visibility,e.name="ogBaseLayerCheckbox",e.className="ogLayerSwitcherInput",e.onclick=function(){f.switchLayerVisibility.call(f,this)},c.appendChild(e),e=document.createElement("label"),e.className="ogLayerSwitcherLabel",e.innerHTML=g[d].name+"</br>",c.appendChild(e))};
og.control.LayerSwitcher.prototype.createBaseLayersList=function(c){var d,e,f=this,g=this.renderer.renderNodes.Earth.layers;for(d=0;d<g.length;d++)g[d].isBaseLayer&&(e=document.createElement("input"),e.type="radio",e.value=d,e.checked=g[d].visibility,e.name="ogBaseLayerRadiosId"+this._id,e.className="ogLayerSwitcherInput",e.onclick=function(){f.switchLayer.call(f,this)},c.appendChild(e),e=document.createElement("label"),e.className="ogLayerSwitcherLabel",e.innerHTML=g[d].name+"</br>",c.appendChild(e))};
og.control.LayerSwitcher.prototype.switchLayer=function(c){var d=this.renderer.renderNodes.Earth;d.setBaseLayer(d.layers[c.value])};og.control.LayerSwitcher.prototype.switchLayerVisibility=function(c){c=this.renderer.renderNodes.Earth.layers[c.value];c.setVisibility(c.getVisibility()?!1:!0)};
og.control.LayerSwitcher.prototype.createSwitcher=function(){var c=document.createElement("div");c.className="ogLayerSwitcherButton";c.id="ogLayerSwitcherButtonMaximize";var d=this;c.onclick=function(c){"ogLayerSwitcherButtonMaximize"===this.id?(this.id="ogLayerSwitcherButtonMinimize",d.dialog.className="displayBlock"):(this.id="ogLayerSwitcherButtonMaximize",d.dialog.className="displayNone")};this.renderer.div.appendChild(c)};og.all=function(){};
