var COMPILED=!0,goog=goog||{};goog.global=this;goog.exportPath_=function(d,e,f){d=d.split(".");f=f||goog.global;d[0]in f||!f.execScript||f.execScript("var "+d[0]);for(var g;d.length&&(g=d.shift());)d.length||void 0===e?f=f[g]?f[g]:f[g]={}:f[g]=e};goog.define=function(d,e){var f=e;COMPILED||goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,d)&&(f=goog.global.CLOSURE_DEFINES[d]);goog.exportPath_(d,f)};goog.DEBUG=!0;goog.LOCALE="en";goog.TRUSTED_SITE=!0;
goog.provide=function(d){if(!COMPILED){if(goog.isProvided_(d))throw Error('Namespace "'+d+'" already declared.');delete goog.implicitNamespaces_[d];for(var e=d;(e=e.substring(0,e.lastIndexOf(".")))&&!goog.getObjectByName(e);)goog.implicitNamespaces_[e]=!0}goog.exportPath_(d)};goog.setTestOnly=function(d){if(COMPILED&&!goog.DEBUG)throw d=d||"",Error("Importing test-only code into non-debug environment"+d?": "+d:".");};
COMPILED||(goog.isProvided_=function(d){return!goog.implicitNamespaces_[d]&&!!goog.getObjectByName(d)},goog.implicitNamespaces_={});goog.getObjectByName=function(d,e){for(var f=d.split("."),g=e||goog.global,h;h=f.shift();)if(goog.isDefAndNotNull(g[h]))g=g[h];else return null;return g};goog.globalize=function(d,e){var f=e||goog.global,g;for(g in d)f[g]=d[g]};
goog.addDependency=function(d,e,f){if(goog.DEPENDENCIES_ENABLED){var g;d=d.replace(/\\/g,"/");for(var h=goog.dependencies_,k=0;g=e[k];k++)h.nameToPath[g]=d,d in h.pathToNames||(h.pathToNames[d]={}),h.pathToNames[d][g]=!0;for(g=0;e=f[g];g++)d in h.requires||(h.requires[d]={}),h.requires[d][e]=!0}};goog.ENABLE_DEBUG_LOADER=!0;
goog.require=function(d){if(!COMPILED&&!goog.isProvided_(d)){if(goog.ENABLE_DEBUG_LOADER){var e=goog.getPathFromDeps_(d);if(e){goog.included_[e]=!0;goog.writeScripts_();return}}d="goog.require could not find: "+d;goog.global.console&&goog.global.console.error(d);throw Error(d);}};goog.basePath="";goog.nullFunction=function(){};goog.identityFunction=function(d,e){return d};goog.abstractMethod=function(){throw Error("unimplemented abstract method");};
goog.addSingletonGetter=function(d){d.getInstance=function(){if(d.instance_)return d.instance_;goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=d);return d.instance_=new d}};goog.instantiatedSingletons_=[];goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;
goog.DEPENDENCIES_ENABLED&&(goog.included_={},goog.dependencies_={pathToNames:{},nameToPath:{},requires:{},visited:{},written:{}},goog.inHtmlDocument_=function(){var d=goog.global.document;return"undefined"!=typeof d&&"write"in d},goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH)goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_())for(var d=goog.global.document.getElementsByTagName("script"),e=d.length-1;0<=e;--e){var f=d[e].src,g=f.lastIndexOf("?"),g=-1==g?f.length:
g;if("base.js"==f.substr(g-7,7)){goog.basePath=f.substr(0,g-7);break}}},goog.importScript_=function(d){var e=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;!goog.dependencies_.written[d]&&e(d)&&(goog.dependencies_.written[d]=!0)},goog.writeScriptTag_=function(d){if(goog.inHtmlDocument_()){var e=goog.global.document;if("complete"==e.readyState){if(/\bdeps.js$/.test(d))return!1;throw Error('Cannot write "'+d+'" after document load');}e.write('<script type="text/javascript" src="'+d+'">\x3c/script>');
return!0}return!1},goog.writeScripts_=function(){function d(h){if(!(h in g.written)){if(!(h in g.visited)&&(g.visited[h]=!0,h in g.requires))for(var l in g.requires[h])if(!goog.isProvided_(l))if(l in g.nameToPath)d(g.nameToPath[l]);else throw Error("Undefined nameToPath for "+l);h in f||(f[h]=!0,e.push(h))}}var e=[],f={},g=goog.dependencies_,h;for(h in goog.included_)g.written[h]||d(h);for(h=0;h<e.length;h++)if(e[h])goog.importScript_(goog.basePath+e[h]);else throw Error("Undefined script input");
},goog.getPathFromDeps_=function(d){return d in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[d]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js"));
goog.typeOf=function(d){var e=typeof d;if("object"==e)if(d){if(d instanceof Array)return"array";if(d instanceof Object)return e;var f=Object.prototype.toString.call(d);if("[object Window]"==f)return"object";if("[object Array]"==f||"number"==typeof d.length&&"undefined"!=typeof d.splice&&"undefined"!=typeof d.propertyIsEnumerable&&!d.propertyIsEnumerable("splice"))return"array";if("[object Function]"==f||"undefined"!=typeof d.call&&"undefined"!=typeof d.propertyIsEnumerable&&!d.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==e&&"undefined"==typeof d.call)return"object";return e};goog.isDef=function(d){return void 0!==d};goog.isNull=function(d){return null===d};goog.isDefAndNotNull=function(d){return null!=d};goog.isArray=function(d){return"array"==goog.typeOf(d)};goog.isArrayLike=function(d){var e=goog.typeOf(d);return"array"==e||"object"==e&&"number"==typeof d.length};goog.isDateLike=function(d){return goog.isObject(d)&&"function"==typeof d.getFullYear};goog.isString=function(d){return"string"==typeof d};
goog.isBoolean=function(d){return"boolean"==typeof d};goog.isNumber=function(d){return"number"==typeof d};goog.isFunction=function(d){return"function"==goog.typeOf(d)};goog.isObject=function(d){var e=typeof d;return"object"==e&&null!=d||"function"==e};goog.getUid=function(d){return d[goog.UID_PROPERTY_]||(d[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(d){return!!d[goog.UID_PROPERTY_]};goog.removeUid=function(d){"removeAttribute"in d&&d.removeAttribute(goog.UID_PROPERTY_);try{delete d[goog.UID_PROPERTY_]}catch(e){}};
goog.UID_PROPERTY_="closure_uid_"+(1E9*Math.random()>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(d){var e=goog.typeOf(d);if("object"==e||"array"==e){if(d.clone)return d.clone();var e="array"==e?[]:{},f;for(f in d)e[f]=goog.cloneObject(d[f]);return e}return d};goog.bindNative_=function(d,e,f){return d.call.apply(d.bind,arguments)};
goog.bindJs_=function(d,e,f){if(!d)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var f=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(f,g);return d.apply(e,f)}}return function(){return d.apply(e,arguments)}};goog.bind=function(d,e,f){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_;return goog.bind.apply(null,arguments)};
goog.partial=function(d,e){var f=Array.prototype.slice.call(arguments,1);return function(){var e=f.slice();e.push.apply(e,arguments);return d.apply(this,e)}};goog.mixin=function(d,e){for(var f in e)d[f]=e[f]};goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date};
goog.globalEval=function(d){if(goog.global.execScript)goog.global.execScript(d,"JavaScript");else if(goog.global.eval)if(null==goog.evalWorksForGlobals_&&(goog.global.eval("var _et_ = 1;"),"undefined"!=typeof goog.global._et_?(delete goog.global._et_,goog.evalWorksForGlobals_=!0):goog.evalWorksForGlobals_=!1),goog.evalWorksForGlobals_)goog.global.eval(d);else{var e=goog.global.document,f=e.createElement("script");f.type="text/javascript";f.defer=!1;f.appendChild(e.createTextNode(d));e.body.appendChild(f);
e.body.removeChild(f)}else throw Error("goog.globalEval not available");};goog.evalWorksForGlobals_=null;goog.getCssName=function(d,e){var f=function(d){return goog.cssNameMapping_[d]||d},g=function(d){d=d.split("-");for(var e=[],g=0;g<d.length;g++)e.push(f(d[g]));return e.join("-")},g=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?f:g:function(d){return d};return e?d+"-"+g(e):g(d)};goog.setCssNameMapping=function(d,e){goog.cssNameMapping_=d;goog.cssNameMappingStyle_=e};
!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING);goog.getMsg=function(d,e){var f=e||{},g;for(g in f){var h=(""+f[g]).replace(/\$/g,"$$$$");d=d.replace(RegExp("\\{\\$"+g+"\\}","gi"),h)}return d};goog.getMsgWithFallback=function(d,e){return d};goog.exportSymbol=function(d,e,f){goog.exportPath_(d,e,f)};goog.exportProperty=function(d,e,f){d[e]=f};
goog.inherits=function(d,e){function f(){}f.prototype=e.prototype;d.superClass_=e.prototype;d.prototype=new f;d.prototype.constructor=d;d.base=function(d,f,k){var l=Array.prototype.slice.call(arguments,2);return e.prototype[f].apply(d,l)}};
goog.base=function(d,e,f){var g=arguments.callee.caller;if(goog.DEBUG&&!g)throw Error("arguments.caller not defined.  goog.base() expects not to be running in strict mode. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(g.superClass_)return g.superClass_.constructor.apply(d,Array.prototype.slice.call(arguments,1));for(var h=Array.prototype.slice.call(arguments,2),k=!1,l=d.constructor;l;l=l.superClass_&&l.superClass_.constructor)if(l.prototype[e]===g)k=!0;else if(k)return l.prototype[e].apply(d,
h);if(d[e]===g)return d.constructor.prototype[e].apply(d,h);throw Error("goog.base called from a method of one name to a method of a different name");};goog.scope=function(d){d.call(goog.global)};var og={Events:function(){}};og.Events.prototype.registerNames=function(d){for(var e=0;e<d.length;e++)this[d[e]]={active:!0,handlers:[]}};og.Events.prototype.on=function(d,e,f){this[d].handlers.push({sender:e,callback:f})};og.Events.prototype.dispatch=function(d,e){if(d&&d.active)for(var f=d.handlers,g=f.length;g--;){var h=f[g];h.callback.call(h.sender,e)}};og.layer={};og.layer.MAX_OVERLAYS=8;og.layer.MAX_REQUESTS=10;og.layer.layersCounter=0;og.layer.requestsCounter=0;og.layer.DEFAILT_Z_INDEX=0;og.layer.DEFAILT_OPACITY=1;
og.layer.Layer=function(d,e){this.name=d?d:"noname";this.planet=null;this.events=new og.Events;this.events.registerNames(["onload","onloadend","onvisibilitychanged"]);e&&(this.isBaseLayer=e.isBaseLayer?e.isBaseLayer:!1,this.numZoomLevels=e.numZoomLevels?e.numZoomLevels:-1,this.url=e.url?e.url:"",this.visibility=e.visibility?e.visibility:!1,this.opacity=e.opacity?e.opacity:og.layer.DEFAILT_OPACITY,this.transparentColor=e.transparentColor?e.transparentColor:[1,1,1],this.zIndex=e.zIndex?e.zIndex:og.layer.DEFAILT_Z_INDEX);
this.id=og.layer.layersCounter++;this.counter=0;this.pendingsQueue=[]};og.layer.Layer.prototype.clone=function(){};og.layer.Layer.prototype.setZIndex=function(d){this.zIndex=d;this.planet.updateVisibleLayers()};og.layer.Layer.prototype.abortLoading=function(){this.pendingsQueue.length=0};
og.layer.Layer.prototype.setVisibility=function(d){this.isBaseLayer&&d?this.planet.setBaseLayer(this):d||this.abortLoading();d!=this.visibility&&(this.events.dispatch(this.events.onvisibilitychanged,this),this.visibility=d,this.planet.updateVisibleLayers())};og.layer.Layer.prototype.getVisibility=function(){return this.visibility};og.layer.replaceTemplate=function(d,e){return d.replace(/{[^{}]+}/g,function(d){return e[d.replace(/[{}]+/g,"")]||""})};
og.layer.Layer.prototype.setUrl=function(d){this.url=d};og.layer.Layer.prototype.setName=function(d){this.name=d};og.inheritance={};og.inheritance.extend=function(d,e){var f=function(){};f.prototype=e.prototype;d.prototype=new f;d.prototype.constructor=d;d.superclass=e.prototype;d.superclass.constructor=e};og.inheritance.base=function(d){arguments.callee.caller.superclass.constructor.apply(d,Array.prototype.slice.call(arguments,1))};og.quadTree={};og.quadTree.NW=0;og.quadTree.NE=1;og.quadTree.SW=2;og.quadTree.SE=3;og.quadTree.N=0;og.quadTree.E=1;og.quadTree.S=2;og.quadTree.W=3;og.quadTree.WALKTHROUGH=0;og.quadTree.RENDERING=1;og.quadTree.NOTRENDERING=2;og.quadTree.RATIO_LOD=1.12;og.quadTree.OPSIDE=[og.quadTree.S,og.quadTree.W,og.quadTree.N,og.quadTree.E];og.quadTree.acceptableForRender=function(d,e){return d.projectedSize(e.center)>og.quadTree.RATIO_LOD*e.radius};og.layer.XYZ=function(d,e){og.inheritance.base(this,d,e)};og.inheritance.extend(og.layer.XYZ,og.layer.Layer);og.layer.XYZ.prototype.handleSegmentTile=function(d){og.layer.requestsCounter>=og.layer.MAX_REQUESTS&&this.counter?this.pendingsQueue.push(d):this.loadSegmentTileImage(d)};og.layer.XYZ.prototype.GetHTTPRequestString=function(d){return og.layer.replaceTemplate(this.url,{tilex:d.tileX.toString(),tiley:d.tileY.toString(),zoom:d.zoomIndex.toString()})};
og.layer.XYZ.prototype.loadSegmentTileImage=function(d){var e=this;this.counter++;og.layer.requestsCounter++;var f=new Image;f.crossOrigin="";f.onload=function(){var f=e.events.onload;f.length&&e.events.dispatch(f,{image:this,segment:d.segment});d.applyTexture.call(d,this);e.dequeueRequest()};f.onerror=function(){d&&d.textureNotExists.call(d);e.dequeueRequest()};d.segment.materials.length?f.src=this.GetHTTPRequestString(d.segment):this.dequeueRequest()};
og.layer.XYZ.prototype.dequeueRequest=function(){this.counter--;og.layer.requestsCounter--;if(this.pendingsQueue.length){if(og.layer.requestsCounter<og.layer.MAX_REQUESTS){var d;(d=this.whilePendings())&&this.loadSegmentTileImage.call(this,d)}}else this.events.dispatch(this.events.onloadend)};og.layer.XYZ.prototype.whilePendings=function(){for(;this.pendingsQueue.length;){var d=this.pendingsQueue.pop();if(d){if(d.segment.node.getState()!=og.quadTree.NOTRENDERING)return d;d.imageIsLoading=!1}}return null};og.input={};og.input.KEY_SPACE=32;og.input.KEY_H=72;og.input.KEY_C=67;og.input.KEY_X=88;og.input.KEY_E=69;og.input.KEY_Q=81;og.input.KEY_W=87;og.input.KEY_S=83;og.input.KEY_A=65;og.input.KEY_D=68;og.input.KEY_SHIFT=16;og.input.KEY_LEFT=37;og.input.KEY_RIGHT=39;og.input.KEY_UP=38;og.input.KEY_DOWN=40;og.input.KEY_F1=112;og.input.MB_LEFT=0;og.input.MB_RIGHT=2;og.input.MB_MIDDLE=1;og.control={};og.control.Control=function(d){this.renderer=null;this.activated=!1;d&&(this.autoActivate=d.autoActivate?d.autoActivate:!1,this.active=d.active?d.active:!1)};og.control.Control.prototype.setRenderer=function(d){this.renderer=d;this.autoActivate&&(this.initialize(),this.active=!0)};og.control.Control.prototype.initialize=function(){this.init&&this.init();this.activated=!0};og.control.Control.prototype.activate=function(){this.active=!0};
og.control.Control.prototype.deactivate=function(){this.active=!1};og.control.KeyboardNavigation=function(d){og.inheritance.base(this,d)};og.inheritance.extend(og.control.KeyboardNavigation,og.control.Control);
og.control.KeyboardNavigation.prototype.init=function(){this.renderer.events.on("onkeypressed",this,this.onCameraMoveForward,og.input.KEY_W);this.renderer.events.on("onkeypressed",this,this.onCameraMoveBackward,og.input.KEY_S);this.renderer.events.on("onkeypressed",this,this.onCameraStrifeLeft,og.input.KEY_A);this.renderer.events.on("onkeypressed",this,this.onCameraStrifeRight,og.input.KEY_D);this.renderer.events.on("onkeypressed",this,this.onCameraLookUp,og.input.KEY_UP);this.renderer.events.on("onkeypressed",
this,this.onCameraLookDown,og.input.KEY_DOWN);this.renderer.events.on("onkeypressed",this,this.onCameraTurnLeft,og.input.KEY_LEFT);this.renderer.events.on("onkeypressed",this,this.onCameraTurnRight,og.input.KEY_RIGHT);this.renderer.events.on("onkeypressed",this,this.onCameraRollLeft,og.input.KEY_Q);this.renderer.events.on("onkeypressed",this,this.onCameraRollRight,og.input.KEY_E);this.renderer.events.on("onkeypressed",this,this.onCameraGrowAlt,og.input.KEY_SPACE)};
og.control.KeyboardNavigation.prototype.onCameraGrowAlt=function(d){};og.control.KeyboardNavigation.prototype.onCameraMoveForward=function(d){d=this.renderer.activeCamera;d.slide(0,0,-d.lonLat.height/30)};og.control.KeyboardNavigation.prototype.onCameraMoveBackward=function(d){d=this.renderer.activeCamera;d.slide(0,0,d.lonLat.height/30)};og.control.KeyboardNavigation.prototype.onCameraStrifeLeft=function(d){d=this.renderer.activeCamera;d.slide(-d.lonLat.height/30,0,0)};
og.control.KeyboardNavigation.prototype.onCameraStrifeRight=function(d){d=this.renderer.activeCamera;d.slide(d.lonLat.height/30,0,0)};og.control.KeyboardNavigation.prototype.onCameraLookUp=function(d){d=this.renderer.activeCamera;this.renderer.events.isKeyPressed(og.input.KEY_SHIFT)?d.pitch(1):d.rotateVertical(d.lonLat.height/3E6*og.math.RADIANS,og.math.Vector3.ZERO)};
og.control.KeyboardNavigation.prototype.onCameraLookDown=function(d){d=this.renderer.activeCamera;this.renderer.events.isKeyPressed(og.input.KEY_SHIFT)?d.pitch(-1):d.rotateVertical(-d.lonLat.height/3E6*og.math.RADIANS,og.math.Vector3.ZERO)};og.control.KeyboardNavigation.prototype.onCameraTurnLeft=function(d){d=this.renderer.activeCamera;this.renderer.events.isKeyPressed(og.input.KEY_SHIFT)?d.yaw(1):d.rotateHorizontal(d.lonLat.height/3E6*og.math.RADIANS,!1,og.math.Vector3.ZERO)};
og.control.KeyboardNavigation.prototype.onCameraTurnRight=function(d){d=this.renderer.activeCamera;this.renderer.events.isKeyPressed(og.input.KEY_SHIFT)?d.yaw(-1):d.rotateHorizontal(-d.lonLat.height/3E6*og.math.RADIANS,!1,og.math.Vector3.ZERO)};og.control.KeyboardNavigation.prototype.onCameraRollLeft=function(d){this.renderer.activeCamera.roll(-1)};og.control.KeyboardNavigation.prototype.onCameraRollRight=function(d){this.renderer.activeCamera.roll(1)};og.math={};og.math.Vector3=function(d,e,f){this.x=d||0;this.y=e||0;this.z=f||0};og.math.Vector3.prototype.toVector4=function(){return new og.math.Vector4(this.x,this.y,this.z,1)};og.math.Vector3.UP=new og.math.Vector3(0,1,0);og.math.Vector3.DOWN=new og.math.Vector3(0,-1,0);og.math.Vector3.RIGHT=new og.math.Vector3(1,0,0);og.math.Vector3.LEFT=new og.math.Vector3(-1,0,0);og.math.Vector3.FORWARD=new og.math.Vector3(0,0,-1);og.math.Vector3.BACKWARD=new og.math.Vector3(0,0,1);og.math.Vector3.ZERO=new og.math.Vector3;
og.math.Vector3.prototype.clone=function(){return new og.math.Vector3(this.x,this.y,this.z)};og.math.Vector3.add=function(d,e){var f=new og.math.Vector3(d.x,d.y,d.z);f.add(e);return f};og.math.Vector3.sub=function(d,e){var f=new og.math.Vector3(d.x,d.y,d.z);f.sub(e);return f};og.math.Vector3.scale=function(d,e){var f=new og.math.Vector3(d.x,d.y,d.z);f.scale(e);return f};og.math.Vector3.mull=function(d,e){var f=new og.math.Vector3(d.x,d.y,d.z);f.mull(e);return f};
og.math.Vector3.div=function(d,e){var f=new og.math.Vector3(d.x,d.y,d.z);f.div(e);return f};og.math.Vector3.prototype.equal=function(d){return this.x===d.x&&this.y===d.y&&this.z===d.z};og.math.Vector3.prototype.copy=function(d){this.x=d.x;this.y=d.y;this.z=d.z;return this};og.math.Vector3.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};og.math.Vector3.prototype.length2=function(){return this.x*this.x+this.y*this.y+this.z*this.z};
og.math.Vector3.prototype.add=function(d){this.x+=d.x;this.y+=d.y;this.z+=d.z;return this};og.math.Vector3.prototype.sub=function(d){this.x-=d.x;this.y-=d.y;this.z-=d.z;return this};og.math.Vector3.prototype.scale=function(d){this.x*=d;this.y*=d;this.z*=d;return this};og.math.Vector3.prototype.scaleTo=function(d){return new og.math.Vector3(this.x*d,this.y*d,this.z*d)};og.math.Vector3.prototype.mull=function(d){this.x*=d.x;this.y*=d.y;this.z*=d.z;return this};
og.math.Vector3.prototype.div=function(d){this.x/=d.x;this.y/=d.y;this.z/=d.z;return this};og.math.Vector3.prototype.dot=function(d){return d.x*this.x+d.y*this.y+d.z*this.z};og.math.Vector3.prototype.dotArr=function(d){return d[0]*this.x+d[1]*this.y+d[2]*this.z};og.math.Vector3.prototype.cross=function(d){var e=new og.math.Vector3;e.set(this.y*d.z-this.z*d.y,this.z*d.x-this.x*d.z,this.x*d.y-this.y*d.x);return e};
og.math.Vector3.noncollinear=function(d,e){return d.y*e.z-d.z*e.y||d.z*e.x-d.x*e.z||d.x*e.y-d.y*e.z};og.math.Vector3.prototype.clear=function(){this.x=this.y=this.z=0;return this};og.math.Vector3.prototype.normal=function(){var d=new og.math.Vector3;d.copy(this);var e=1/d.length();d.x*=e;d.y*=e;d.z*=e;return d};og.math.Vector3.prototype.normalize=function(){var d=1/this.length();this.x*=d;this.y*=d;this.z*=d;return this};
og.math.Vector3.prototype.toVec=function(){var d=new og.math.GLArray(3);d[0]=this.x;d[1]=this.y;d[2]=this.z;return d};og.math.Vector3.prototype.distance=function(d){return og.math.Vector3.sub(this,d).length()};og.math.Vector3.prototype.set=function(d,e,f){this.x=d;this.y=e;this.z=f;return this};og.math.Vector3.prototype.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};og.math.Vector3.prototype.getNegate=function(){return new og.math.Vector3(-this.x,-this.y,-this.z)};
og.math.Vector3.proj_b_to_a=function(d,e){return e.scaleTo(e.dot(d)/e.dot(e))};og.math.Vector3.prototype.projToRay=function(d,e){var f=og.math.Vector3.proj_b_to_a(og.math.Vector3.sub(this,d),e);f.add(d);return f};og.math.Vector3.prototype.angle=function(d){return og.math.Vector3.angle(this,d)};og.math.Vector3.angle=function(d,e){return Math.acos(d.dot(e)/Math.sqrt(d.length2()*e.length2()))};
og.math.Vector3.prototype.lerp=function(d,e,f){var g=og.math.Vector3.clone(this);0>=f?g.copy(d):1<=f?g.copy(e):g=og.math.Vector3.add(d,og.math.Vector3.sub(e,d).scale(f));return g};og.math.Vector3.LERP_DELTA=1E-6;og.math.Vector3.prototype.slerp=function(d,e,f){var g=new og.math.Vector3;if(0>=f)g.copy(d);else if(1<=f)g.copy(e);else{var h,k,g=d.dot(e);1-g>Vector3.LERP_DELTA?(h=Math.acos(g),k=Math.sin(h),g=Math.sin((1-f)*h)/k,f=Math.sin(f*h)/k):g=1-f;return og.math.Vector3.add(d.scale(g),e.scale(f))}};
og.math.Vector3.orthoNormalize=function(d,e){d=d.normal();d.scale(e.dot(d));return e.sub(d).normalize()};og.math.GLArray="undefined"!=typeof Float32Array?Float32Array:"undefined"!=typeof WebGLFloatArray?WebGLFloatArray:Array;og.math.X=0;og.math.Y=1;og.math.Z=2;og.math.W=3;og.math.LOG2=Math.log(2);og.math.MAX=549755748352;og.math.MIN=-og.math.MAX;og.math.RADIANS=Math.PI/180;og.math.DEGREES=180/Math.PI;Math.PI=3.1415927410125732;og.math.EPSILON1=0.1;og.math.EPSILON2=0.01;og.math.EPSILON3=0.001;og.math.EPSILON4=1E-4;og.math.EPSILON5=1E-5;og.math.EPSILON6=1E-6;og.math.EPSILON7=1E-7;og.math.EPSILON8=1E-8;
og.math.EPSILON9=1E-9;og.math.EPSILON10=1E-10;og.math.EPSILON11=1E-11;og.math.EPSILON12=1E-12;og.math.EPSILON13=1E-13;og.math.EPSILON14=1E-14;og.math.EPSILON15=1E-15;og.math.EPSILON16=1E-16;og.math.EPSILON17=1E-17;og.math.EPSILON18=1E-18;og.math.EPSILON19=1E-19;og.math.EPSILON20=1E-20;og.math.log=function(d,e){return Math.log(d)/Math.log(e)};og.math.clamp=function(d,e,f){return Math.max(e,Math.min(d,f))};og.math.DEG2RAD=function(d){return d*og.math.RADIANS};og.math.RAD2DEG=function(d){return d*og.math.DEGREES};
og.math.isPowerOfTwo=function(d){return 0==(d&d-1)};og.math.nextHighestPowerOfTwo=function(d){--d;for(var e=1;32>e;e<<=1)d|=d>>e;return d+1};og.math.mod=function(d,e){return d-e*Math.floor(d/e)};og.math.step=function(d,e){return e<d?0:1};og.math.frac=function(d){return d-floor(d)};og.math.log2=function(d){return Math.log(d)/og.math.LOG2};og.math.exp2=function(d){return Math.pow(2,d)};og.math.slice=function(d,e,f){return d*(e-f)};og.math.lerp=function(d,e,f){return f+d*(e-f)};og.math.Vector4=function(d,e,f,g){this.x=d||0;this.y=e||0;this.z=f||0;this.w=g||0};og.math.Vector4.identity=new og.math.Vector4(0,0,0,1);og.math.Vector4.prototype.toVector3=function(){return new og.math.Vector3(this.x,this.y,this.z)};og.math.Vector4.prototype.clone=function(d){return new og.math.Vector4(this.x,this.y,this.z,this.w)};og.math.Vector4.prototype.equal=function(d){return this.x===d.x&&this.y===d.y&&this.z===d.z&&this.w===d.w};
og.math.Vector4.prototype.copy=function(d){this.x=d.x;this.y=d.y;this.z=d.z;this.w=d.w;return this};og.math.Vector4.prototype.toVec=function(){var d=new og.math.GLArray(4);d[0]=this.x;d[1]=this.y;d[2]=this.z;d[3]=this.w;return d};og.math.Vector4.fromVec=function(d){return new og.math.Vector4(d[0],d[1],d[2],d[3])};og.math.Vector4.prototype.set=function(d,e,f,g){this.x=d;this.y=e;this.z=f;this.w=g;return this};
og.math.Vector4.prototype.add=function(d){this.x+=d.x;this.y+=d.y;this.z+=d.z;this.w+=d.w;return this};og.math.Vector4.prototype.sub=function(d){this.x-=d.x;this.y-=d.y;this.z-=d.z;this.w-=d.w;return this};og.math.Vector4.prototype.scale=function(d){this.x*=d;this.y*=d;this.z*=d;this.w*=d;return this};og.math.Vector4.prototype.affinity=function(){var d=1/this.w;this.x*=d;this.y*=d;this.z*=d;this.w=1;return this};
og.math.Vector4.prototype.scaleTo=function(d){return new og.math.Vector4(this.x*d,this.y*d,this.z*d,this.w*d)};og.math.Vector4.prototype.getStep=function(d){return new og.math.Vector4(this.x<d?0:1,this.y<d?0:1,this.z<d?0:1,this.w<d?0:1)};og.math.Vector4.prototype.getFrac=function(d){return new og.math.Vector4(og.math.frac(d.x),og.math.frac(d.y),og.math.frac(d.z),og.math.frac(d.w))};og.math.Matrix4=function(){this._m=Array(16)};og.math.Matrix4.prototype.set=function(d){this._m[0]=d[0];this._m[1]=d[1];this._m[2]=d[2];this._m[3]=d[3];this._m[4]=d[4];this._m[5]=d[5];this._m[6]=d[6];this._m[7]=d[7];this._m[8]=d[8];this._m[9]=d[9];this._m[10]=d[10];this._m[11]=d[11];this._m[12]=d[12];this._m[13]=d[13];this._m[14]=d[14];this._m[15]=d[15];return this};og.math.Matrix4.prototype.clone=function(){var d=new og.math.Matrix4;d.set(this);return d};og.math.Matrix4.prototype.copy=function(d){this.set(d._m)};
og.math.Matrix4.prototype.mulVec3=function(d){return new og.math.Vector3(this._m[0]*d.x+this._m[4]*d.y+this._m[8]*d.z+this._m[12],this._m[1]*d.x+this._m[5]*d.y+this._m[9]*d.z+this._m[13],this._m[2]*d.x+this._m[6]*d.y+this._m[10]*d.z+this._m[14])};
og.math.Matrix4.prototype.mulVec4=function(d){var e=d.x,f=d.y,g=d.z;d=d.w;return new og.math.Vector4(this._m[0]*e+this._m[4]*f+this._m[8]*g+this._m[12]*d,this._m[1]*e+this._m[5]*f+this._m[9]*g+this._m[13]*d,this._m[2]*e+this._m[6]*f+this._m[10]*g+this._m[14]*d,this._m[3]*e+this._m[7]*f+this._m[11]*g+this._m[15]*d)};
og.math.Matrix4.prototype.inverse=function(){var d=this._m[0],e=this._m[1],f=this._m[2],g=this._m[3],h=this._m[4],k=this._m[5],l=this._m[6],n=this._m[7],m=this._m[8],p=this._m[9],r=this._m[10],s=this._m[11],t=this._m[12],u=this._m[13],q=this._m[14],B=this._m[15],v=d*k-e*h,C=d*l-f*h,A=d*n-g*h,H=e*l-f*k,I=e*n-g*k,G=f*n-g*l,E=m*u-p*t,J=m*q-r*t,K=m*B-s*t,L=p*q-r*u,M=p*B-s*u,N=r*B-s*q,F=1/(v*N-C*M+A*L+H*K-I*J+G*E),D=new og.math.Matrix4;D._m[0]=(k*N-l*M+n*L)*F;D._m[1]=(-e*N+f*M-g*L)*F;D._m[2]=(u*G-q*I+
B*H)*F;D._m[3]=(-p*G+r*I-s*H)*F;D._m[4]=(-h*N+l*K-n*J)*F;D._m[5]=(d*N-f*K+g*J)*F;D._m[6]=(-t*G+q*A-B*C)*F;D._m[7]=(m*G-r*A+s*C)*F;D._m[8]=(h*M-k*K+n*E)*F;D._m[9]=(-d*M+e*K-g*E)*F;D._m[10]=(t*I-u*A+B*v)*F;D._m[11]=(-m*I+p*A-s*v)*F;D._m[12]=(-h*L+k*J-l*E)*F;D._m[13]=(d*L-e*J+f*E)*F;D._m[14]=(-t*H+u*C-q*v)*F;D._m[15]=(m*H-p*C+r*v)*F;return D};
og.math.Matrix4.prototype.transpose=function(){var d=new og.math.Matrix4;d._m[0]=this._m[0];d._m[1]=this._m[4];d._m[2]=this._m[8];d._m[3]=this._m[12];d._m[4]=this._m[1];d._m[5]=this._m[5];d._m[6]=this._m[9];d._m[7]=this._m[13];d._m[8]=this._m[2];d._m[9]=this._m[6];d._m[10]=this._m[10];d._m[11]=this._m[14];d._m[12]=this._m[3];d._m[13]=this._m[7];d._m[14]=this._m[11];d._m[15]=this._m[15];return d};
og.math.Matrix4.prototype.setIdentity=function(){this._m[0]=1;this._m[1]=0;this._m[2]=0;this._m[3]=0;this._m[4]=0;this._m[5]=1;this._m[6]=0;this._m[7]=0;this._m[8]=0;this._m[9]=0;this._m[10]=1;this._m[11]=0;this._m[12]=0;this._m[13]=0;this._m[14]=0;this._m[15]=1;return this};
og.math.Matrix4.identity=function(){var d=new og.math.Matrix4;d._m[0]=1;d._m[1]=0;d._m[2]=0;d._m[3]=0;d._m[4]=0;d._m[5]=1;d._m[6]=0;d._m[7]=0;d._m[8]=0;d._m[9]=0;d._m[10]=1;d._m[11]=0;d._m[12]=0;d._m[13]=0;d._m[14]=0;d._m[15]=1;return d};
og.math.Matrix4.prototype.mul=function(d){var e=this._m[0],f=this._m[1],g=this._m[2],h=this._m[3],k=this._m[4],l=this._m[5],n=this._m[6],m=this._m[7],p=this._m[8],r=this._m[9],s=this._m[10],t=this._m[11],u=this._m[12],q=this._m[13],B=this._m[14];a=this._m[15];var v=d._m[0],C=d._m[1],A=d._m[2],H=d._m[3],I=d._m[4],G=d._m[5],E=d._m[6],J=d._m[7],K=d._m[8],L=d._m[9],M=d._m[10],N=d._m[11],F=d._m[12],D=d._m[13],O=d._m[14];b=d._m[15];d=new og.math.Matrix4;d._m[0]=v*e+C*k+A*p+H*u;d._m[1]=v*f+C*l+A*r+H*q;d._m[2]=
v*g+C*n+A*s+H*B;d._m[3]=v*h+C*m+A*t+H*a;d._m[4]=I*e+G*k+E*p+J*u;d._m[5]=I*f+G*l+E*r+J*q;d._m[6]=I*g+G*n+E*s+J*B;d._m[7]=I*h+G*m+E*t+J*a;d._m[8]=K*e+L*k+M*p+N*u;d._m[9]=K*f+L*l+M*r+N*q;d._m[10]=K*g+L*n+M*s+N*B;d._m[11]=K*h+L*m+M*t+N*a;d._m[12]=F*e+D*k+O*p+b*u;d._m[13]=F*f+D*l+O*r+b*q;d._m[14]=F*g+D*n+O*s+b*B;d._m[15]=F*h+D*m+O*t+b*a;return d};
og.math.Matrix4.prototype.translate=function(d){var e=d.x,f=d.y;d=d.z;var g=this._m;g[12]=g[0]*e+g[4]*f+g[8]*d+g[12];g[13]=g[1]*e+g[5]*f+g[9]*d+g[13];g[14]=g[2]*e+g[6]*f+g[10]*d+g[14];g[15]=g[3]*e+g[7]*f+g[11]*d+g[15];return this};og.math.Matrix4.prototype.translateToPosition=function(d){var e=this._m;e[12]=d.x;e[13]=d.y;e[14]=d.z;return this};
og.math.Matrix4.prototype.rotate=function(d,e){var f=Math.cos(e),g=Math.sin(e),h=this._m;h[0]=f+(1-f)*d.x*d.x;h[1]=(1-f)*d.y*d.x-g*d.z;h[2]=(1-f)*d.z*d.x+g*d.y;h[3]=0;h[4]=(1-f)*d.x*d.y+g*d.z;h[5]=f+(1-f)*d.y*d.y;h[6]=(1-f)*d.z*d.y-g*d.x;h[7]=0;h[8]=(1-f)*d.x*d.z-g*d.y;h[9]=(1-f)*d.y*d.z+g*d.x;h[10]=f+(1-f)*d.z*d.z;h[11]=0;h[12]=0;h[13]=0;h[14]=0;h[15]=1;return this};og.math.Matrix4.prototype.rotateBetweenVectors=function(d,e){return og.math.Quaternion.getRotationBetweenVectors(d,e).getMatrix4()};
og.math.Matrix4.prototype.scale=function(d){var e=this._m;e[0]*=d.x;e[1]*=d.x;e[2]*=d.x;e[3]*=d.x;e[4]*=d.y;e[5]*=d.y;e[6]*=d.y;e[7]*=d.y;e[8]*=d.z;e[9]*=d.z;e[10]*=d.z;e[11]*=d.z;e[12]=e[12];e[13]=e[13];e[14]=e[14];e[15]=e[15];return this};
og.math.Matrix4.prototype.setFrustum=function(d,e,f,g,h,k){this.right=e;this.left=d;this.top=g;this.bottom=f;this.far=k;this.near=h;var l=e-d,n=g-f,m=k-h;this._m[0]=2*h/l;this._m[1]=0;this._m[2]=0;this._m[3]=0;this._m[4]=0;this._m[5]=2*h/n;this._m[6]=0;this._m[7]=0;this._m[8]=(e+d)/l;this._m[9]=(g+f)/n;this._m[10]=-(k+h)/m;this._m[11]=-1;this._m[12]=0;this._m[13]=0;this._m[14]=-(2*k*h)/m;this._m[15]=0;return this};
og.math.Matrix4.prototype.setPerspective=function(d,e,f,g){d=f*Math.tan(d*Math.PI/360);e*=d;return this.setFrustum(-e,e,-d,d,f,g)};og.math.Matrix4.prototype.eulerToMatrix=function(d,e,f){var g=Math.cos(d);d=Math.sin(d);var h=Math.cos(e);e=Math.sin(e);var k=Math.cos(f);f=Math.sin(f);var l=g*e,n=d*e,m=this._m;m[0]=h*k;m[1]=-h*f;m[2]=-e;m[4]=-n*k+g*f;m[5]=n*f+g*k;m[6]=-d*h;m[8]=l*k+d*f;m[9]=-l*f+d*k;m[10]=g*h;m[3]=m[7]=m[11]=m[12]=m[13]=m[14]=0;m[15]=1};og.math.Matrix4.prototype.getEulerAngles=function(){};og.math.Pixel=function(d,e){this.x=d||0;this.y=e||0};og.Frustum=function(){this._f=Array(6);for(var d=0;6>d;d++)this._f[d]=Array(4)};
og.Frustum.prototype.setFrustum=function(d){this._f[0][0]=d[3]-d[0];this._f[0][1]=d[7]-d[4];this._f[0][2]=d[11]-d[8];this._f[0][3]=d[15]-d[12];this.planeNormalize(this._f[0]);this._f[1][0]=d[3]+d[0];this._f[1][1]=d[7]+d[4];this._f[1][2]=d[11]+d[8];this._f[1][3]=d[15]+d[12];this.planeNormalize(this._f[1]);this._f[2][0]=d[3]+d[1];this._f[2][1]=d[7]+d[5];this._f[2][2]=d[11]+d[9];this._f[2][3]=d[15]+d[13];this.planeNormalize(this._f[2]);this._f[3][0]=d[3]-d[1];this._f[3][1]=d[7]-d[5];this._f[3][2]=d[11]-
d[9];this._f[3][3]=d[15]-d[13];this.planeNormalize(this._f[3]);this._f[4][0]=d[3]-d[2];this._f[4][1]=d[7]-d[6];this._f[4][2]=d[11]-d[10];this._f[4][3]=d[15]-d[14];this.planeNormalize(this._f[4]);this._f[5][0]=d[3]+d[2];this._f[5][1]=d[7]+d[6];this._f[5][2]=d[11]+d[10];this._f[5][3]=d[15]+d[14];this.planeNormalize(this._f[5])};og.Frustum.prototype.planeNormalize=function(d){var e=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);d[0]/=e;d[1]/=e;d[2]/=e;d[3]/=e};
og.Frustum.prototype.containsPoint=function(d){for(var e,f=0;6>f;f++)if(e=d.dotArr(this._f[f])+this._f[f][3],0>=e)return!1;return!0};og.Frustum.prototype.containsSphere=function(d){for(var e,f=0;6>f;f++)if(e=d.center.dotArr(this._f[f])+this._f[f][3],e<=-d.radius)return-1;return e+d.radius};og.Frustum.prototype.containsBox=function(d){for(var e=!0,f,g,h=0;6>h;h++){for(var k=g=f=0;8>k&&(0==g||0==f);k++)0>d.vertices[k].dotArr(this._f[h])+this._f[h][3]?f++:g++;if(0==g)return!1;0<f&&(e=!0)}return e};og.Camera=function(){this.events=new og.Events;this.renderer=null;this.events.registerNames(["onviewchanged"]);this.eye=new og.math.Vector3;this.u=new og.math.Vector3(0,1,0);this.v=new og.math.Vector3(1,0,0);this.n=new og.math.Vector3(0,0,1);this.viewAngle=this.farDist=this.nearDist=this.aspect=0;this.pMatrix=new og.math.Matrix4;this.mvMatrix=new og.math.Matrix4;this.pmvMatrix=new og.math.Matrix4;this.ipmvMatrix=new og.math.Matrix4;this.frustum=new og.Frustum;this.pMatrixRot=new og.math.Matrix4;this.pmvMatrixRot=
new og.math.Matrix4;this.lonLat=new og.LonLat;this._ellipsoid=null};og.Camera.clone=function(d){var e=new og.Camera;e.eye.copy(d.eye);e.u.copy(d.u);e.v.copy(d.v);e.n.copy(d.n);e.renderer=d.renderer;e.pMatrix.copy(d.pMatrix);e.mvMatrix.copy(d.mvMatrix);e.pmvMatrix.copy(d.pmvMatrix);e.ipmvMatrix.copy(d.ipmvMatrix);e.frustum.setFrustum(e.pmvMatrix);e.ellipsoid=d.ellipsoid;e.lonLat=d.lonLat.clone();return e};
og.Camera.defaultOptions={viewAngle:35,nearDist:1,farDist:og.math.MAX,eye:new og.math.Vector3(0,0,0),look:new og.math.Vector3(0,0,0),up:new og.math.Vector3(0,1,0)};og.Camera.prototype.bindEllipsoid=function(d){this._ellipsoid=d;this.lonLat=d.ECEF2LonLat(this.eye)};
og.Camera.prototype.init=function(d,e){this.renderer=d;e?(this._ellipsoid=e.ellipsoid,this.setProjectionMatrix(e.viewAngle?e.viewAngle:og.Camera.defaultOptions.viewAngle,this.renderer.handler.gl.canvas.aspect,e.nearDist?e.nearDist:og.Camera.defaultOptions.nearDist,e.farDist?e.farDist:og.Camera.defaultOptions.farDist),this.set(e.eye?e.eye:og.Camera.defaultOptions.eye.clone(),e.look?e.look:og.Camera.defaultOptions.look.clone(),e.up?e.up:og.Camera.defaultOptions.up.clone())):this.initDefaults();this.update()};
og.Camera.prototype.initDefaults=function(){this.setProjectionMatrix(og.Camera.defaultOptions.viewAngle,this.renderer.handler.gl.canvas.aspect,og.Camera.defaultOptions.nearDist,og.Camera.defaultOptions.farDist);this.set(Camera.defaultOptions.eye.clone(),Camera.defaultOptions.look.clone(),Camera.defaultOptions.up.clone())};
og.Camera.prototype.update=function(){this.setModelViewMatrix();this.pmvMatrix=this.pMatrix.mul(this.mvMatrix);this.frustum.setFrustum(this.pmvMatrix._m);this.pmvMatrixRot=this.pMatrixRot.mul(this.mvMatrix);this.ipmvMatrix=this.pmvMatrixRot.inverse();this._ellipsoid&&(this.lonLat=this._ellipsoid.ECEF2LonLat(this.eye));this.events.dispatch(this.events.onviewchanged,this)};
og.Camera.prototype.setModelViewMatrix=function(){this.mvMatrix.set([this.u.x,this.v.x,this.n.x,0,this.u.y,this.v.y,this.n.y,0,this.u.z,this.v.z,this.n.z,0,-this.eye.dot(this.u),-this.eye.dot(this.v),-this.eye.dot(this.n),1])};og.Camera.prototype.refresh=function(){this.setProjectionMatrix(this.viewAngle,this.renderer.handler.gl.canvas.aspect,this.nearDist,this.farDist);this.update()};og.Camera.prototype.setFarVisibilityDistance=function(d){this.farDist=d;this.refresh()};
og.Camera.prototype.setNearVisibilityDistance=function(d){this.nearDist=d;this.refresh()};og.Camera.prototype.setDistanceVisibility=function(d,e){this.nearDist=e||this.nearDist;this.farDist=d?e+d:e+this.farDist-this.nearDist;this.refresh()};og.Camera.prototype.setProjectionMatrix=function(d,e,f,g){this.viewAngle=d;this.aspect=e;this.nearDist=f;this.farDist=g;this.pMatrix.setPerspective(d,e,f,g);this.pMatrixRot.setPerspective(d,e,0.1,10)};
og.Camera.prototype.setViewAngle=function(d){this.viewAngle=d;this.refresh()};og.Camera.prototype.set=function(d,e,f){this.eye.copy(d);this.n.set(d.x-e.x,d.y-e.y,d.z-e.z);this.u.copy(f.cross(this.n));this.n.normalize();this.u.normalize();this.v.copy(this.n.cross(this.u));this.update()};og.Camera.prototype.look=function(d,e){this.n.set(this.eye.x-d.x,this.eye.y-d.y,this.eye.z-d.z);this.u.copy((e?e:this.v).cross(this.n));this.n.normalize();this.u.normalize();this.v.copy(this.n.cross(this.u));this.update()};
og.Camera.prototype.slide=function(d,e,f){this.eye.x+=d*this.u.x+e*this.v.x+f*this.n.x;this.eye.y+=d*this.u.y+e*this.v.y+f*this.n.y;this.eye.z+=d*this.u.z+e*this.v.z+f*this.n.z;this.update()};og.Camera.prototype.roll=function(d){var e=Math.cos(og.math.RADIANS*d);d=Math.sin(og.math.RADIANS*d);var f=this.u.clone();this.u.set(e*f.x-d*this.v.x,e*f.y-d*this.v.y,e*f.z-d*this.v.z);this.v.set(d*f.x+e*this.v.x,d*f.y+e*this.v.y,d*f.z+e*this.v.z);this.update()};
og.Camera.prototype.pitch=function(d){var e=Math.cos(og.math.RADIANS*d);d=Math.sin(og.math.RADIANS*d);var f=this.n.clone();this.n.set(e*f.x-d*this.v.x,e*f.y-d*this.v.y,e*f.z-d*this.v.z);this.v.set(d*f.x+e*this.v.x,d*f.y+e*this.v.y,d*f.z+e*this.v.z);this.update()};
og.Camera.prototype.yaw=function(d){var e=Math.cos(og.math.RADIANS*d);d=Math.sin(og.math.RADIANS*d);var f=this.u.clone();this.u.set(e*f.x-d*this.n.x,e*f.y-d*this.n.y,e*f.z-d*this.n.z);this.n.set(d*f.x+e*this.n.x,d*f.y+e*this.n.y,d*f.z+e*this.n.z);this.update()};
og.Camera.prototype.unproject=function(d,e){var f=(d-this.renderer.handler.gl.canvas.width/2)/(this.renderer.handler.gl.canvas.width/2),g=-(e-this.renderer.handler.gl.canvas.height/2)/(this.renderer.handler.gl.canvas.height/2),h=this.ipmvMatrix.mulVec4(new og.math.Vector4(f,g,-1,1)).affinity();return this.ipmvMatrix.mulVec4(new og.math.Vector4(f,g,0,1)).affinity().sub(h).toVector3().normalize()};
og.Camera.prototype.project=function(d){d=this.pmvMatrix.mulVec4(d.toVector4());return new og.math.Pixel((1+d.x/d.w)*this.gl.canvas.width/2,(1-d.y/d.w)*this.gl.canvas.height/2)};og.Camera.prototype.setEye=function(d){this.eye.copy(d);this.update()};
og.Camera.prototype.setLonLat=function(d){this.lonLat.set(d.lon,d.lat,d.height?d.height:this.lonLat.height);d=this._ellipsoid.LonLat2ECEF(this.lonLat);var e=(new og.math.Matrix4).rotateBetweenVectors(d.normal(),this.eye.normal());this.eye=d;this.v=e.mulVec3(this.v);this.u=e.mulVec3(this.u);this.n=e.mulVec3(this.n);this.update()};
og.Camera.prototype.rotateAround=function(d,e,f,g){f=f||og.math.Vector3.ZERO;g=g||og.math.Vector3.UP;d=(new og.math.Matrix4).rotate(e?this.v:g,d);e=(new og.math.Matrix4).setIdentity().translate(f);f=(new og.math.Matrix4).setIdentity().translate(f.getNegate());this.eye=e.mul(d).mul(f).mulVec3(this.eye);this.v=d.mulVec3(this.v);this.u=d.mulVec3(this.u);this.n=d.mulVec3(this.n);this.update()};og.Camera.prototype.rotateHorizontal=function(d,e,f,g){this.rotateAround(d,e,f,g)};
og.Camera.prototype.rotateVertical=function(d,e,f){this.rotateAround(d,!1,e,this.u)};og.Camera.prototype.projectedSize=function(d){return this.eye.distance(d)*Math.tan(0.5*this.viewAngle*og.math.RADIANS)};
og.Camera.prototype.getExtentPosition=function(d){var e=d.getNorth(),f=d.getSouth(),g=d.getEast(),h=d.getWest();h>g&&(g+=360);var k=new og.LonLat(g,e),l=this._ellipsoid.LonLat2ECEF(k);k.lat=f;var n=this._ellipsoid.LonLat2ECEF(k);k.lon=h;var m=this._ellipsoid.LonLat2ECEF(k);k.lat=e;var p=this._ellipsoid.LonLat2ECEF(k);d=og.math.Vector3.sub(l,m).scale(0.5).add(m);var r=d.length();1E-6>r&&(k.lon=0.5*(g+h),k.lat=0.5*(e+f),d=this._ellipsoid.LonLat2ECEF(k));p.sub(d);n.sub(d);l.sub(d);m.sub(d);f=d.normal();
e=f.cross(og.math.Vector3.UP).normalize();f=e.cross(f).normalize();f=Math.max(Math.abs(f.dot(p)),Math.abs(f.dot(n)),Math.abs(f.dot(l)),Math.abs(f.dot(m)));l=Math.max(Math.abs(e.dot(p)),Math.abs(e.dot(n)),Math.abs(e.dot(l)),Math.abs(e.dot(m)));n=Math.tan(0.5*this.viewAngle*og.math.RADIANS);l=Math.max(l/(this.aspect*n),f/n);d.normalize();d.scale(r+l);return d};og.input.MouseHandler=function(d){this._htmlObject=d};
og.input.MouseHandler.prototype.setEvent=function(d,e,f,g){switch(d){case "onmousewheel":d=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";this._htmlObject.attachEvent?this._htmlObject.attachEvent("on"+d,function(d){f.call(e,d)}):this._htmlObject.addEventListener&&this._htmlObject.addEventListener(d,function(d){d.wheelDelta=-120*d.detail;f.call(e,d)},!1);break;case "onmousedown":this._htmlObject.onmousedown=function(d){f.call(e,d)};this._htmlObject.oncontextmenu=function(d){return!1};
break;case "onmouseup":this._htmlObject.onmouseup=function(d){f.call(e,d)};break;case "onmousemove":this._htmlObject.onmousemove=function(d){var g=this.getBoundingClientRect();f.call(e,{clientX:d.clientX-g.left,clientY:d.clientY-g.top})}}};og.input.KeyboardHandler=function(){var d={},e={},f={},g=this;if(og.input.KeyboardHandler.prototype._instance)return og.input.KeyboardHandler.prototype._instance;og.input.KeyboardHandler.prototype._instance=this;document.onkeydown=function(d){g.handleKeyDown.call(g,d)};document.onkeyup=function(d){g.handleKeyUp.call(g,d)};var h=function(d,e){return d.priority<e.priority};this.addEvent=function(d,g,n,m,p){void 0===p&&(p=1600);switch(d){case "onkeypressed":e[m]||(e[m]=[]);e[m].push({callback:n,sender:g,
priority:p});e[m].sort(h);break;case "oncharkeypressed":f[m]||(f[m]=[]),f[m].push({callback:n,sender:g,priority:p}),f[m].sort(h)}};this.isKeyPressed=function(e){return d[e]};this.handleKeyDown=function(e){d[e.keyCode]=!0;for(var g in f)if(String.fromCharCode(e.keyCode)==String.fromCharCode(g))for(var h=f[g],m=0;m<h.length;m++)h[m].callback.call(h[m].sender)};this.handleKeyUp=function(e){d[e.keyCode]=!1};this.handleEvents=function(){for(var f in e)if(d[f])for(var g=e[f],h=0;h<g.length;h++)g[h].callback.call(g[h].sender)}};og.RendererEvents=function(d){og.inheritance.base(this);this.mouseHandler=new og.input.MouseHandler(d);this.keyboardHandler=new og.input.KeyboardHandler;this.mouseState={x:0,y:0,prev_x:0,prev_y:0,direction:new og.math.Vector3,leftButtonUp:!1,rightButtonUp:!1,leftButtonDown:!1,rightButtonDown:!1,leftButtonHold:!1,rightButtonHold:!1,leftButtonDoubleClick:!1,click:!1,moving:!1,justStopped:!1,doubleClickDelay:300,wheelDelta:0};this._mousestopThread=null;this._clickY=this._clickX=this._dblClkBegins=0};
og.inheritance.extend(og.RendererEvents,og.Events);og.RendererEvents.prototype.handleEvents=function(){this.keyboardHandler.handleEvents();this.handleMouseEvents()};og.RendererEvents.prototype.on=function(d,e,f,g,h){this[d]?this.constructor.superclass.on.call(this,d,e,f):this.keyboardHandler.addEvent(d,e,f,g,h)};og.RendererEvents.prototype.isKeyPressed=function(d){return this.keyboardHandler.isKeyPressed(d)};
og.RendererEvents.prototype.initialize=function(){this.registerNames("ondraw onmousemove onmousestop onmouselbuttondoubleclick onmouseclick onmouselbuttondown onmouselbuttonhold onmouserbuttondown onmouserbuttonhold onmouselbuttonup onmouserbuttonup onresize onmousewheel".split(" "));this.mouseHandler.setEvent("onmouseup",this,this.onMouseUp);this.mouseHandler.setEvent("onmousemove",this,this.onMouseMove);this.mouseHandler.setEvent("onmousedown",this,this.onMouseDown);this.mouseHandler.setEvent("onmousewheel",
this,this.onMouseWheel)};og.RendererEvents.prototype.onMouseWheel=function(d){this.mouseState.wheelDelta=d.wheelDelta};og.RendererEvents.prototype.onMouseMove=function(d){var e=this.mouseState;if(e.x!=d.clientX||e.y!=d.clientY)e.x=d.clientX,e.y=d.clientY,e.moving=!0,clearTimeout(this._mousestopThread),this._mousestopThread=setTimeout(function(){e.justStopped=!0},100)};
og.RendererEvents.prototype.onMouseDown=function(d){d.button===og.input.MB_LEFT?(this._clickX=d.clientX,this._clickY=d.clientY,this.mouseState.leftButtonDown=!0):this.mouseState.rightButtonDown=!0};
og.RendererEvents.prototype.onMouseUp=function(d){var e=this.mouseState;d.button===og.input.MB_LEFT?(e.leftButtonDown=!1,e.leftButtonHold=!1,e.leftButtonUp=!0,this._dblClkBegins?((new Date).getTime()-this._dblClkBegins<=e.doubleClickDelay&&(e.leftButtonDoubleClick=!0),this._dblClkBegins=0):this._dblClkBegins=(new Date).getTime(),this._clickX==d.clientX&&this._clickY==d.clientY&&(e.click=!0)):(e.rightButtonDown=!1,e.rightButtonHold=!1,e.rightButtonUp=!0)};
og.RendererEvents.prototype.handleMouseEvents=function(){var d=this.mouseState,e=this.dispatch;d.click&&(e(this.onmouseclick,d),d.click=!1);d.leftButtonDown&&(d.leftButtonHold?e(this.onmouselbuttonhold,d):(d.leftButtonHold=!0,e(this.onmouselbuttondown,d)));d.rightButtonDown&&(d.rightButtonHold?e(this.onmouserbuttonhold,d):(d.rightButtonHold=!0,e(this.onmouserbuttondown,d)));d.leftButtonUp&&(d.leftButtonUp=!1,e(this.onmouselbuttonup,d));d.rightButtonUp&&(d.rightButtonUp=!1,e(this.onmouserbuttonup,
d));d.leftButtonDoubleClick&&(e(this.onmouselbuttondoubleclick,d),d.leftButtonDoubleClick=!1);d.wheelDelta&&(e(this.onmousewheel,d),d.wheelDelta=0);d.moving&&(e(this.onmousemove,d),d.prev_x=d.x,d.prev_y=d.y,this._dblClkBegins=0);d.justStopped&&(e(this.onmousestop,d),d.justStopped=!1)};og.Renderer=function(d){this.div=null;this.handler=d;this._renderNodesArr=[];this.renderNodes={};this.cameras=[];this.activeCamera;this.events=new og.RendererEvents(d.gl.canvas);this.controls=[];this.controlsBag={}};og.Renderer.prototype.getWidth=function(){return this.handler.gl.canvas.width};og.Renderer.prototype.getHeight=function(){return this.handler.gl.canvas.height};og.Renderer.prototype.addControl=function(d){d.setRenderer(this);this.controls.push(d)};
og.Renderer.prototype.addControls=function(d){for(var e=0;e<d.length;e++)d[e].setRenderer(this),this.controls.push(d[e])};og.Renderer.prototype.removeControl=function(d){for(var e=0;e<this.controls.length;e++)if(this.controls[e]==d)return this.controls.splice(e,1),d.deactivate(),d};
og.Renderer.prototype.init=function(){var d=this;this.handler.drawback=function(){d.draw()};var e=new og.Camera;e.init(this,{eye:new og.math.Vector3(0,0,12E6),look:new og.math.Vector3(0,0,0),up:new og.math.Vector3(0,1,0)});this.activeCamera=e;this.events.initialize();this.handler.onCanvasResize=function(e){d.activeCamera.refresh();d.events.dispatch(d.events.onresize,e)}};
og.Renderer.prototype.addRenderNode=function(d){this.renderNodes[d.name]?alert("Node name: "+d.name+" allready exists."):(d.assignRenderer(this),d.initialization(),this._renderNodesArr.push(d),this.renderNodes[d.name]=d)};og.Renderer.prototype.addRenderNodes=function(d){for(var e=0;e<d;e++)this.addRenderNode(d[e])};
og.Renderer.prototype.draw=function(){this.events.handleEvents();this.events.mouseState.direction=this.activeCamera.unproject(this.events.mouseState.x,this.events.mouseState.y);for(var d=0;d<this._renderNodesArr.length;d++)this._renderNodesArr[d].drawNode();this.events.dispatch(this.events.ondraw,this);this.events.mouseState.moving=!1};og.Renderer.prototype.start=function(){this.handler.start()};og.LonLat=function(d,e,f){this.lon=d||0;this.lat=e||0;this.height=f||0};og.LonLat.prototype.set=function(d,e,f){this.lon=d;this.lat=e;this.height=f};og.LonLat.createFromArray=function(d){return new og.LonLat(d[0],d[1],d[2])};og.LonLat.prototype.clone=function(){return new og.LonLat(this.lon,this.lat,this.height)};
og.LonLat.prototype.toTile=function(d){return{x:Math.floor((this.lon+180)/360*Math.pow(2,d)),y:Math.floor((1-Math.log(Math.tan(this.lat*Math.PI/180)+1/Math.cos(this.lat*Math.PI/180))/Math.PI)/2*Math.pow(2,d))}};og.Extent=function(d,e){this.southWest=d||new og.LonLat;this.northEast=e||new og.LonLat};og.Extent.createFromArray=function(d){return new og.Extent(new og.LonLat(d[0],d[1]),new og.LonLat(d[2],d[3]))};og.Extent.prototype.getWidth=function(){return this.northEast.lon-this.southWest.lon};og.Extent.prototype.getHeight=function(){return this.northEast.lat-this.southWest.lat};og.Extent.prototype.clone=function(){return new og.Extent(this.sw,this.ne)};
og.Extent.prototype.getCenter=function(){var d=this.southWest,e=this.northEast;return new og.LonLat(d.lon+0.5*(e.lon-d.lon),d.lat+0.5*(e.lat-d.lat))};og.Extent.prototype.getNorthWest=function(){return new og.LonLat(this.northEast.lon,this.southWest.lat)};og.Extent.prototype.getNorthEast=function(){return new og.LonLat(this.northEast.lon,this.northEast.lat)};og.Extent.prototype.getSouthWest=function(){return new og.LonLat(this.southWest.lon,this.southWest.lat)};
og.Extent.prototype.getSouthEast=function(){return new og.LonLat(this.southWest.lon,this.northEast.lat)};og.Extent.prototype.getNorth=function(){return this.northEast.lat};og.Extent.prototype.getEast=function(){return this.northEast.lon};og.Extent.prototype.getWest=function(){return this.southWest.lon};og.Extent.prototype.getSouth=function(){return this.southWest.lat};
og.Extent.fromTile=function(d,e,f){var g=Math.pow(2,zoom);f=360/Math.pow(2,zoom);g=180/g;d=-180+d*f;e=90-e*g;f=d+f;return new og.Extent(new og.LonLat(d,e-g),new og.LonLat(f,e))};og.mercator={};og.mercator.POLE=2.003750834E7;og.mercator.inverseMercator=function(d,e){var f=180*d/og.mercator.POLE,g=180/Math.PI*(2*Math.atan(Math.exp(e/og.mercator.POLE*Math.PI))-Math.PI/2);return new og.LonLat(f,g)};og.mercator.forwardMercator=function(d,e){var f=d*og.mercator.POLE/180,g=Math.log(Math.tan((90+e)*Math.PI/360))/Math.PI*og.mercator.POLE;return new og.LonLat(f,g)};og.bv={};
og.bv.getBoundsFromExtent=function(d,e){var f=og.math.MAX,g=og.math.MIN,h=og.math.MAX,k=og.math.MIN,l=og.math.MAX,n=og.math.MIN,m=[];m.push(og.mercator.inverseMercator(e.southWest.lon,e.southWest.lat),og.mercator.inverseMercator(e.southWest.lon,e.northEast.lat),og.mercator.inverseMercator(e.northEast.lon,e.northEast.lat),og.mercator.inverseMercator(e.northEast.lon,e.southWest.lat));for(var p=0;p<m.length;p++){var r=d.LonLat2ECEF(m[p]),s=r.x,t=r.y,r=r.z;s<f&&(f=s);s>g&&(g=s);t<h&&(h=t);t>k&&(k=t);
r<l&&(l=r);r>n&&(n=r)}return[f,g,h,k,l,n]};og.bv.Sphere=function(d,e){this.radius=d||0;this.center=e?e.clone():new og.math.Vector3};og.bv.Sphere.prototype.setFromBounds=function(d){this.center.set(d[0]+(d[1]-d[0])/2,d[2]+(d[3]-d[2])/2,d[4]+(d[5]-d[4])/2);this.radius=this.center.distance(new og.math.Vector3(d[0],d[2],d[4]))};og.bv.Sphere.prototype.setFromExtent=function(d,e){this.setFromBounds(og.bv.getBoundsFromExtent(d,e))};og.planetSegment={};og.planetSegment.PlanetSegmentHelper={};
og.planetSegment.PlanetSegmentHelper.initIndexesTables=function(d){d!=og.planetSegment.PlanetSegmentHelper.powerOfTwo&&(og.planetSegment.PlanetSegmentHelper.powerOfTwo=d,og.planetSegment.PlanetSegmentHelper.centerIndexesTable=og.planetSegment.PlanetSegmentHelper.initIndexBodiesTable(d),og.planetSegment.PlanetSegmentHelper.textureCoordsTable=og.planetSegment.PlanetSegmentHelper.initTextureCoordsTable(d),og.planetSegment.PlanetSegmentHelper.skirtsIndexesTable=og.planetSegment.PlanetSegmentHelper.initIndexesBodySkirts(d));
og.planetSegment.PlanetSegmentHelper.centerIndexesTable[0]=[];og.planetSegment.PlanetSegmentHelper.textureCoordsTable[0]=[]};
og.planetSegment.PlanetSegmentHelper.createSegmentIndexes=function(d,e){if(1!=d){for(var f=og.planetSegment.PlanetSegmentHelper.centerIndexesTable[d],g=og.planetSegment.PlanetSegmentHelper.skirtsIndexesTable[og.quadTree.W][d][e[og.quadTree.W]],h=og.planetSegment.PlanetSegmentHelper.skirtsIndexesTable[og.quadTree.N][d][e[og.quadTree.N]],k=og.planetSegment.PlanetSegmentHelper.skirtsIndexesTable[og.quadTree.E][d][e[og.quadTree.E]],l=og.planetSegment.PlanetSegmentHelper.skirtsIndexesTable[og.quadTree.S][d][e[og.quadTree.S]],
n=new Uint16Array(f.length+g.length+h.length+k.length+l.length),m=0,p=0,m=0;m<f.length;m++)n[p++]=f[m];for(m=0;m<g.length;m++)n[p++]=g[m];for(m=0;m<h.length;m++)n[p++]=h[m];for(m=0;m<k.length;m++)n[p++]=k[m];for(m=0;m<l.length;m++)n[p++]=l[m];return n}return new Uint16Array([0,2,1,3])};og.planetSegment.PlanetSegmentHelper.createCenterBodyIndexes=function(d,e){for(var f,g,h,k=1;k<d-1-1;k++){for(var l=1;l<d-1;l++)f=k*d+l,h=(k+1)*d,g=h+l,e.push(f,g);e.push(g,h+1)}e.push(e[e.length-1],d*d-d)};
og.planetSegment.PlanetSegmentHelper.createWestNeighborSkirt=function(d,e,f){for(var g=(d-1)/e,h=d*d-d,k=0,l=0;l<d-2;l++)0===l%g&&(k=l),f.push(h-d*k,h-d*l-d+1);e===d-1&&(f.push(d),f.push(0))};og.planetSegment.PlanetSegmentHelper.createNorthNeighborSkirt=function(d,e,f){for(var g=(d-1)/e,h=0,k=0;k<d-2;k++)0===k%g&&(h=k),f.push(h,d+k+1);e===d-1&&(f.push(d-2),f.push(d-1))};
og.planetSegment.PlanetSegmentHelper.createEastNeighborSkirt=function(d,e,f){for(var g=(d-1)/e,h=0,k=0;k<d-2;k++)0===k%g&&(h=k),f.push(d+d*h-1,d*(k+1)+d-2);e===d-1&&(f.push(d*(d-1)-1),f.push(d*d-1))};og.planetSegment.PlanetSegmentHelper.createSouthNeighborSkirt=function(d,e,f){for(var g=(d-1)/e,h=0,k=d*(d-1)-2,l=d*d-1,n=0;n<d-2;n++)0===n%g&&(h=n),f.push(l-h,k-n);e===d-1&&f.push(d*d-d+1);f.push(d*d-d)};
og.planetSegment.PlanetSegmentHelper.initIndexesBodySkirts=function(d){var e=[];e[og.quadTree.N]=[];e[og.quadTree.W]=[];e[og.quadTree.S]=[];e[og.quadTree.E]=[];e[og.quadTree.N][0]=[];e[og.quadTree.W][0]=[];e[og.quadTree.S][0]=[];e[og.quadTree.E][0]=[];for(var f=0;f<=d;f++){var g=Math.pow(2,f);e[og.quadTree.N][g]=[];e[og.quadTree.W][g]=[];e[og.quadTree.S][g]=[];e[og.quadTree.E][g]=[];e[og.quadTree.N][g][0]=[];e[og.quadTree.W][g][0]=[];e[og.quadTree.S][g][0]=[];e[og.quadTree.E][g][0]=[];for(var h=0;h<=
d;h++){var k=Math.pow(2,h),l=e[og.quadTree.N][g][k]=[],n=e[og.quadTree.W][g][k]=[],m=e[og.quadTree.S][g][k]=[],p=e[og.quadTree.E][g][k]=[];og.planetSegment.PlanetSegmentHelper.createWestNeighborSkirt(g+1,k,n);og.planetSegment.PlanetSegmentHelper.createNorthNeighborSkirt(g+1,k,l);og.planetSegment.PlanetSegmentHelper.createEastNeighborSkirt(g+1,k,p);og.planetSegment.PlanetSegmentHelper.createSouthNeighborSkirt(g+1,k,m)}}return e};
og.planetSegment.PlanetSegmentHelper.initTextureCoordsTable=function(d){for(var e=[],f=0;f<=d;f++){var g=Math.pow(2,f);e[g]=og.planetSegment.PlanetSegmentHelper.createTextureCoords(g)}return e};og.planetSegment.PlanetSegmentHelper.initIndexBodiesTable=function(d){for(var e=[],f=0;f<=d;f++){var g=Math.pow(2,f),h=e[g]=[];og.planetSegment.PlanetSegmentHelper.createCenterBodyIndexes(g+1,h)}return e};
og.planetSegment.PlanetSegmentHelper.createTextureCoords=function(d){for(var e=[],f=0;f<=d;f++)for(var g=0;g<=d;g++)e.push(g/d,f/d);return e};og.bv.Box=function(){this.vertices=[new og.math.Vector3,new og.math.Vector3,new og.math.Vector3,new og.math.Vector3,new og.math.Vector3,new og.math.Vector3,new og.math.Vector3,new og.math.Vector3]};
og.bv.Box.prototype.setFromBounds=function(d){var e=d[0],f=d[1],g=d[2],h=d[3],k=d[4];d=d[5];this.vertices[0].set(e,g,k);this.vertices[1].set(f,g,k);this.vertices[2].set(f,g,d);this.vertices[3].set(e,g,d);this.vertices[4].set(e,h,k);this.vertices[5].set(f,h,k);this.vertices[6].set(f,h,d);this.vertices[7].set(e,h,d)};og.bv.Box.prototype.setFromExtent=function(d,e){this.setFromBounds(og.bv.getBoundsFromExtent(d,e))};og.planetSegment.PlanetSegment=function(){this.plainVertices=[];this.terrainVertices=[];this.tempVertices=[];this.bbox=new og.bv.Box;this.bsphere=new og.bv.Sphere;this.vertexPositionBuffer;this.vertexIndexBuffer;this.vertexTextureCoordBuffer;this.extent;this.gridSize;this.zoomIndex;this.tileX;this.tileY;this.planet;this.handler=null;this.ready=!1;this.materials=[];this.terrainExists=this.terrainIsLoading=this.terrainReady=!1;this.texBiasArr=new Float32Array(3*og.layer.MAX_OVERLAYS);this.samplerArr=
new Int32Array(og.layer.MAX_OVERLAYS);this.alfaArr=new Float32Array(og.layer.MAX_OVERLAYS);this.node};og.planetSegment.PlanetSegment.getCornersVertices=function(d,e){var f=3*e,g=0.5*f,h=f*(e+1),k=g*(e+1);return[d[0],d[1],d[2],d[g],d[g+1],d[g+2],d[f],d[f+1],d[f+2],d[k],d[k+1],d[k+2],d[k+g],d[k+g+1],d[k+g+2],d[k+f],d[k+f+1],d[k+f+2],d[h],d[h+1],d[h+2],d[h+g],d[h+g+1],d[h+g+2],d[h+f],d[h+f+1],d[h+f+2]]};
og.planetSegment.PlanetSegment.prototype.loadTerrain=function(){this.zoomIndex>=this.planet.terrainProvider.minZoom?this.terrainIsLoading||this.terrainReady||(this.terrainReady=!1,this.terrainIsLoading=!0,this.planet.terrainProvider.handleSegmentTerrain(this)):this.terrainReady=!0};
og.planetSegment.PlanetSegment.prototype.applyTerrain=function(d){if(d.length){if(this.ready&&this.terrainIsLoading){this.terrainExists=!0;var e=og.math.MAX,f=og.math.MIN,g=og.math.MAX,h=og.math.MIN,k=og.math.MAX,l=og.math.MIN,n=this.planet.terrainProvider.gridSizeByZoom[this.zoomIndex],m=this.planet.terrainProvider.fileGridSize||Math.sqrt(d.length)-1,p=n+1,r=this.planet.heightFactor,s=this.plainVertices,t=[],u=m/n,q=new og.math.Vector3,B;if(m>=n)for(var v=0;v<p;v++)for(var C=0;C<p;C++){var A=3*(v*
p+C);q.set(s[A],s[A+1],s[A+2]);B=q.length();q.scale((B+r*d[v*u*(m+1)+C*u])/B);t[A]=q.x;t[A+1]=q.y;t[A+2]=q.z;q.x<e&&(e=q.x);q.x>f&&(f=q.x);q.y<g&&(g=q.y);q.y>h&&(h=q.y);q.z<k&&(k=q.z);q.z>l&&(l=q.z)}else for(var u=n/m,H,I,G,E,v=0;v<p;v++)for(v==p-1?(I=u,G=Math.floor(v/u)-1):(I=v%u,G=Math.floor(v/u)),C=0;C<p;C++){C==p-1?(B=u,E=Math.floor(C/u)-1):(B=C%u,E=Math.floor(C/u));A=d[G*(m+1)+E];H=d[G*(m+1)+E+1];var J=d[(G+1)*(m+1)+E];E=d[(G+1)*(m+1)+E+1];H=I+B<u?A+og.math.slice(B/u,H,A)+og.math.slice(I/u,J,
A):E+og.math.slice((u-B)/u,J,E)+og.math.slice((u-I)/u,H,E);A=3*(v*p+C);q.set(s[A],s[A+1],s[A+2]);B=q.length();q.scale((B+r*H)/B);t[A]=q.x;t[A+1]=q.y;t[A+2]=q.z;q.x<e&&(e=q.x);q.x>f&&(f=q.x);q.y<g&&(g=q.y);q.y>h&&(h=q.y);q.z<k&&(k=q.z);q.z>l&&(l=q.z)}this.deleteBuffers();this.createCoordsBuffers(t,n);this.bsphere.setFromBounds([e,f,g,h,k,l]);this.terrainVertices.length=0;this.terrainVertices=t;this.gridSize=n;this.terrainReady=!0;this.terrainIsLoading=!1;this.node.appliedTerrainNodeId=this.node.nodeId;
d.length=0}}else this.zoomIndex<=this.planet.terrainProvider.maxZoom&&this.ready&&this.terrainIsLoading&&(this.terrainIsLoading=!1,this.terrainReady=!0,this.terrainExists=!1,this.node.appliedTerrainNodeId=this.node.nodeId,this.gridSize=this.planet.terrainProvider.gridSizeByZoom[this.zoomIndex],this.deleteBuffers(),5<this.zoomIndex?(this.terrainVertices=og.planetSegment.PlanetSegment.getCornersVertices(this.terrainVertices,this.gridSize),this.createCoordsBuffers(this.terrainVertices,2),this.gridSize=
2):this.createCoordsBuffers(this.terrainVertices,this.gridSize))};og.planetSegment.PlanetSegment.prototype.deleteBuffers=function(){this.handler.gl.deleteBuffer(this.vertexPositionBuffer);this.handler.gl.deleteBuffer(this.vertexIndexBuffer);this.handler.gl.deleteBuffer(this.vertexTextureCoordBuffer)};og.planetSegment.PlanetSegment.prototype.clearBuffers=function(){this.ready=!1;this.deleteBuffers()};
og.planetSegment.PlanetSegment.prototype.deleteElevations=function(){this.terrainIsLoading=this.terrainReady=!1;this.tempVertices.length=0;this.terrainVertices.length=0;this.plainVertices.length=0};og.planetSegment.PlanetSegment.prototype.clearSegment=function(){this.clearBuffers();this.deleteMaterials();this.deleteElevations()};og.planetSegment.PlanetSegment.prototype.deleteMaterials=function(){for(var d=this.materials,e=0;e<d.length;e++){var f=d[e];f&&f.clear()}d.length=0};
og.planetSegment.PlanetSegment.prototype.destroySegment=function(){this.clearSegment();this.extent=null};og.planetSegment.PlanetSegment.prototype.createCoordsBuffers=function(d,e){var f=(e+1)*(e+1);this.vertexTextureCoordBuffer=this.handler.createArrayBuffer(new Float32Array(og.planetSegment.PlanetSegmentHelper.textureCoordsTable[e]),2,f);this.vertexPositionBuffer=this.handler.createArrayBuffer(new Float32Array(d),3,f)};
og.planetSegment.PlanetSegment.prototype.createIndexesBuffer=function(d,e){var f=og.planetSegment.PlanetSegmentHelper.createSegmentIndexes(e,d);this.vertexIndexBuffer=this.handler.createElementArrayBuffer(f,1,f.length)};og.planetSegment.PlanetSegment.prototype.assignTileIndexes=function(d,e){this.zoomIndex=d;this.extent=e;var f=e.getCenter(),f=og.mercator.inverseMercator(f.lon,f.lat).toTile(d);this.tileX=f.x;this.tileY=f.y};
og.planetSegment.PlanetSegment.prototype.createPlainVertices=function(d){for(var e=[],f=0,g=this.extent,h=g.getWidth()/d,k=0;k<=d;k++)for(var l=0;l<=d;l++){var n=og.mercator.inverseMercator(g.southWest.lon+l*h,g.northEast.lat-k*h),n=this.planet.ellipsoid.LonLat2ECEF(n);e[f++]=n.x;e[f++]=n.y;e[f++]=n.z}this.plainVertices=e};
og.planetSegment.drawSingle=function(d,e){if(e.ready){var f=e.handler.gl,g=d.uniforms,h=e.planet.visibleLayers;h.length&&(h=e.materials[h[0].id],f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,h.texture),f.uniform3fv(g.texBias._pName,h.texBias),f.uniform1i(g.uSampler._pName,0));e.draw(d)}};
og.planetSegment.drawOverlays=function(d,e){if(e.ready){for(var f=e.handler.gl,g=d.uniforms,h=e.planet.visibleLayers,k=0;k<h.length;k++){var l=e.materials[h[k].id],n=3*k;e.texBiasArr[n]=l.texBias[0];e.texBiasArr[n+1]=l.texBias[1];e.texBiasArr[n+2]=l.texBias[2];e.samplerArr[k]=k;f.activeTexture(f.TEXTURE0+d._textureID+k);f.bindTexture(f.TEXTURE_2D,l.texture)}f.uniform3fv(g.texBiasArr._pName,e.texBiasArr);f.uniform1iv(g.uSamplerArr._pName,e.samplerArr);e.draw(d)}};
og.planetSegment.PlanetSegment.prototype.draw=function(d){var e=this.handler.gl,f=d.attributes;e.bindBuffer(e.ARRAY_BUFFER,this.vertexPositionBuffer);e.vertexAttribPointer(f.aVertexPosition._pName,this.vertexPositionBuffer.itemSize,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,this.vertexTextureCoordBuffer);e.vertexAttribPointer(f.aTextureCoord._pName,this.vertexTextureCoordBuffer.itemSize,e.FLOAT,!1,0,0);this._setVIb();d.drawIndexBuffer(this.planet.drawMode,this._vib);this.node.sideSize=[this.gridSize,
this.gridSize,this.gridSize,this.gridSize];this.node.hasNeighbor.length=0};og.planetSegment.PlanetSegment.prototype._setVIb=function(){this.node.sideSize[og.quadTree.N]&this.node.sideSize[og.quadTree.W]&this.node.sideSize[og.quadTree.S]&this.node.sideSize[og.quadTree.E]?this._vib=this.planet.indexesBuffers[this.gridSize]:(this.createIndexesBuffer(this.node.sideSize,this.gridSize),this._vib=this.vertexIndexBuffer)};
og.planetSegment.PlanetSegment.prototype.drawPicking=function(){if(this.ready){var d=this.handler.gl,e=this.handler.shaderPrograms.picking._program,f=e.attributes;d.uniformMatrix4fv(e.uniforms.uPMVMatrix._pName,!1,this.node.planet.renderer.activeCamera.pmvMatrix._m);d.bindBuffer(d.ARRAY_BUFFER,this.vertexPositionBuffer);d.vertexAttribPointer(f.aVertexPosition._pName,this.vertexPositionBuffer.itemSize,d.FLOAT,!1,0,0);this._setVIb();e.drawIndexBuffer(this.planet.drawMode,this._vib);this.node.sideSize=
[this.gridSize,this.gridSize,this.gridSize,this.gridSize];this.node.hasNeighbor.length=0}};og.control.MousePosition=function(d){og.inheritance.base(this,d);this.displayType=0;this.converter=og.control.MousePosition.DisplayTypesConverters[0];this.position=this.display=null};og.inheritance.extend(og.control.MousePosition,og.control.Control);og.control.MousePosition.toDecimal=function(d){return d.lat.toFixed(5)+", "+d.lon.toFixed(5)};og.control.MousePosition.toDegrees=function(d){return og.control.MousePosition.dec2deg(d.lat)+", "+og.control.MousePosition.dec2deg(d.lon)};
og.control.MousePosition.toMercator=function(d){d=og.mercator.forwardMercator(d.lon,d.lat);return d.lat.toFixed(5)+", "+d.lon.toFixed(5)};og.control.MousePosition.DisplayTypesConverters=[og.control.MousePosition.toDecimal,og.control.MousePosition.toDegrees,og.control.MousePosition.toMercator];
og.control.MousePosition.dec2deg=function(d){var e,f=0>d?Math.ceil(d):Math.floor(d);d=Math.floor(e=60*Math.abs(d-f));e=Math.floor(6E3*(e-d));e/=100;return og.control.MousePosition.numToFixedString(f,3)+"\u00b0"+og.control.MousePosition.numToFixedString(d,2)+"'"+og.control.MousePosition.numToFixedString(e.toFixed(2),2)+'"'};og.control.MousePosition.numToFixedString=function(d,e){for(var f="&nbsp;",g=d.toString().split(".")[0].length;g<e;g++)f+="&nbsp;&nbsp;";return f+d.toString()};
og.control.MousePosition.prototype.init=function(){this.display=document.createElement("div");this.display.className="ogMousePositionControl";var d=this;this.display.onclick=function(e){d.displayType+=1;d.displayType>=og.control.MousePosition.DisplayTypesConverters.length&&(d.displayType=0);d.converter=og.control.MousePosition.DisplayTypesConverters[d.displayType];d.showPosition()};this.renderer.div.appendChild(this.display);this.renderer.events.on("onmousemove",this,this.onMouseMove)};
og.control.MousePosition.prototype.showPosition=function(){this.display.innerHTML=this.position?"Lat/Lon: "+this.converter(this.position)+" Height(km): "+(0<this.position.height?"~"+(Math.round(this.position.height)/1E3).toFixed(2):"-"):"Lat/Lon: _____________________"};
og.control.MousePosition.prototype.onMouseMove=function(){var d=this.renderer.events.mouseState;!d.leftButtonDown&&!d.rightButtonDown&&0>=this.renderer.controlsBag.scaleRot&&(this.position=this.renderer.renderNodes.Earth.getLonLatFromPixelTerrain(d),this.showPosition())};og.control.LoadingSpinner=function(d){og.inheritance.base(this,d);this.spinnerElement=null};og.inheritance.extend(og.control.LoadingSpinner,og.control.Control);
og.control.LoadingSpinner.prototype.init=function(){this.spinnerElement=document.createElement("div");this.spinnerElement.id="circleG";var d=document.createElement("div"),e=document.createElement("div"),f=document.createElement("div");this.spinnerElement.appendChild(d);this.spinnerElement.appendChild(e);this.spinnerElement.appendChild(f);d.id="circleG_1";d.className="circleG";e.id="circleG_2";e.className="circleG";f.id="circleG_3";f.className="circleG";this.spinnerElement.className="displayBlock";
document.body.appendChild(this.spinnerElement);this.renderer.events.on("ondraw",this,this.draw)};og.control.LoadingSpinner.prototype.draw=function(){for(var d=!1,e=this.renderer.renderNodes.Earth,f=e.layers,g=0;g<f.length;)if(0!=f[g++].counter){d=!0;break}this.spinnerElement.className=0!=e.terrainProvider.counter||d?"displayBlock":"displayNone"};og.Ellipsoid=function(d,e){var f=this._a=d,g=this._b=e;this.flattening=f/g;this.a2=f*f;this.b2=g*g;this._e=Math.sqrt(this.a2-this.b2)/f;this._e2=Math.pow(this._e,2);this._k=Math.sqrt(this.a2-this.b2)/g;this._k2=Math.pow(this._k,2);this._radii=new og.math.Vector3(d,e,d);this._radii2=new og.math.Vector3(d*d,e*e,d*d);this._invRadii=new og.math.Vector3(1/d,1/e,1/d);this._invRadii2=new og.math.Vector3(1/(d*d),1/(e*e),1/(d*d))};
og.Ellipsoid.prototype.N=function(d){d=Math.pow(Math.sin(d),2);d=Math.sqrt(1-this._e2*d);return this._a/d};og.Ellipsoid.prototype.LonLat2ECEF=function(d){var e=og.math.DEG2RAD(d.lat),f=og.math.DEG2RAD(d.lon),g=(this.N(e)+d.height)*Math.cos(e)*Math.cos(f),f=(this.N(e)+d.height)*Math.cos(e)*Math.sin(f);d=(this.N(e)*(1-this._e2)+d.height)*Math.sin(e);return new og.math.Vector3(f,d,g)};
og.Ellipsoid.prototype.ECEF2LonLat=function(d){var e=d.z,f=d.x;d=d.y;var g=this._e2,h=this._k2,k=e*e+f*f,l=Math.sqrt(k),n=d*d,m=54*this.b2*n,p=k+(1-g)*n+g*(this.a2-this.b2),r=p*p,p=g*g*m*k/(r*p),p=Math.pow(1+p+Math.sqrt(p*(p+2)),1/3),m=m/(3*Math.pow(p+1/p+1,2)*r),r=Math.sqrt(1+2*g*g*m),m=-(m*g*l)/1+r+Math.sqrt(0.5*this.a2*(1+1/r)-m*(1-g)*n/(r*(1+r))-0.5*m*k),k=Math.sqrt(Math.pow(l-g*m,2)+n),n=Math.sqrt(Math.pow(l-g*m,2)+(1-g)*n),g=k*(1-this.b2/(this._a*n));d=Math.atan((d+h*(this.b2*d/(this._a*n)))/
l);e=Math.atan2(f,e);return new og.LonLat(180*(e/Math.PI),180*(d/Math.PI),g)};og.Ellipsoid.prototype.getSurfaceNormal=function(d){return og.math.Vector3.mull(d,this._invRadii2).normalize()};og.ellipsoid={};og.ellipsoid.wgs84=new og.Ellipsoid(6378137,6356752.3142);og.layer.WMS=function(d,e){og.inheritance.base(this,d,e);this.layers=e.layers};og.inheritance.extend(og.layer.WMS,og.layer.XYZ);og.layer.WMS.prototype.GetHTTPRequestString=function(d){return this.url+"wms?LAYERS="+this.layers+"&FORMAT=image/jpeg&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&SRS=EPSG:900913&BBOX="+d.extent.getWest()+","+d.extent.getSouth()+","+d.extent.getEast()+","+d.extent.getNorth()+"&WIDTH="+(this.width?this.width:256)+"&HEIGHT="+(this.height?this.height:256)};og.control.LayerSwitcher=function(d){og.inheritance.base(this,d);this.overlaysDiv=this.baseLayersDiv=this.dialog=null;this._id=og.control.LayerSwitcher.numSwitches++};og.control.LayerSwitcher.numSwitches=0;og.inheritance.extend(og.control.LayerSwitcher,og.control.Control);
og.control.LayerSwitcher.prototype.init=function(){this.renderer.renderNodes.Earth.events.on("onlayeradded",this,this.onLayerAdded);this.renderer.renderNodes.Earth.events.on("onlayerremoved",this,this.onLayerRemoved);this.renderer.renderNodes.Earth.events.on("onbaselayerchanged",this,this.onBaseLayerChanged);this.renderer.renderNodes.Earth.events.on("onlayervisibilitychanged",this,this.onLayerVisibilityChanged);this.createSwitcher();this.createDialog()};
og.control.LayerSwitcher.prototype.onLayerAdded=function(d){console.log("added")};og.control.LayerSwitcher.prototype.onLayerRemoved=function(d){console.log("removed")};og.control.LayerSwitcher.prototype.onBaseLayerChanged=function(d){console.log("basechanged")};og.control.LayerSwitcher.prototype.onLayerVisibilityChanged=function(d){console.log("changed "+d.id)};
og.control.LayerSwitcher.prototype.createBaseLayersDiv=function(){var d=document.createElement("div");d.className="layersDiv";this.dialog.appendChild(d);var e=document.createElement("div");e.className="layersDiv";e.innerHTML="Base Layer";d.appendChild(e);this.baseLayersDiv=document.createElement("div");d.appendChild(this.baseLayersDiv);this.createBaseLayersList(this.baseLayersDiv)};
og.control.LayerSwitcher.prototype.createOverlaysDiv=function(){var d=document.createElement("div");d.className="layersDiv";this.dialog.appendChild(d);var e=document.createElement("div");e.className="layersDiv";e.innerHTML="Overlays";d.appendChild(e);this.overlaysDiv=document.createElement("div");d.appendChild(this.overlaysDiv);this.createOverlaysList(this.overlaysDiv)};
og.control.LayerSwitcher.prototype.createDialog=function(){this.dialog=document.createElement("div");this.dialog.id="ogLayerSwitcherDialog";this.dialog.className="displayNone";this.renderer.div.appendChild(this.dialog);this.createBaseLayersDiv();this.createOverlaysDiv()};
og.control.LayerSwitcher.prototype.createOverlaysList=function(d){var e,f,g=this,h=this.renderer.renderNodes.Earth.layers;for(e=0;e<h.length;e++)h[e].isBaseLayer||(f=document.createElement("input"),f.type="checkbox",f.value=e,f.checked=h[e].visibility,f.name="ogBaseLayerCheckbox",f.className="ogLayerSwitcherInput",f.onclick=function(){g.switchLayerVisibility.call(g,this)},d.appendChild(f),f=document.createElement("label"),f.className="ogLayerSwitcherLabel",f.innerHTML=h[e].name+"</br>",d.appendChild(f))};
og.control.LayerSwitcher.prototype.createBaseLayersList=function(d){var e,f,g=this,h=this.renderer.renderNodes.Earth.layers;for(e=0;e<h.length;e++)h[e].isBaseLayer&&(f=document.createElement("input"),f.type="radio",f.value=e,f.checked=h[e].visibility,f.name="ogBaseLayerRadiosId"+this._id,f.className="ogLayerSwitcherInput",f.onclick=function(){g.switchLayer.call(g,this)},d.appendChild(f),f=document.createElement("label"),f.className="ogLayerSwitcherLabel",f.innerHTML=h[e].name+"</br>",d.appendChild(f))};
og.control.LayerSwitcher.prototype.switchLayer=function(d){var e=this.renderer.renderNodes.Earth;e.setBaseLayer(e.layers[d.value])};og.control.LayerSwitcher.prototype.switchLayerVisibility=function(d){d=this.renderer.renderNodes.Earth.layers[d.value];d.setVisibility(d.getVisibility()?!1:!0)};
og.control.LayerSwitcher.prototype.createSwitcher=function(){var d=document.createElement("div");d.className="ogLayerSwitcherButton";d.id="ogLayerSwitcherButtonMaximize";var e=this;d.onclick=function(d){"ogLayerSwitcherButtonMaximize"===this.id?(this.id="ogLayerSwitcherButtonMinimize",e.dialog.className="displayBlock"):(this.id="ogLayerSwitcherButtonMaximize",e.dialog.className="displayNone")};this.renderer.div.appendChild(d)};og.Ajax={ReadyState:{Uninitialized:0,Loading:1,Loaded:2,Interactive:3,Complete:4},Status:{OK:200,Created:201,Accepted:202,NoContent:204,BadRequest:400,Forbidden:403,NotFound:404,Gone:410,ServerError:500},Method:{Get:"GET",Post:"POST"},Asynchronous:!0,Synchronous:!1};og.Ajax.defaultParams={type:og.Ajax.Method.Get,async:og.Ajax.Asynchronous,data:null,sender:null,responseType:"text"};
og.Ajax.createXMLHttp=function(){var d=null;if(void 0!=typeof XMLHttpRequest)return d=new XMLHttpRequest;if(window.ActiveXObject)for(var e=["MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"],f=0;f<e.length;f++)try{return d=new ActiveXObject(e[f])}catch(g){}};
og.Ajax.request=function(d,e){var f={},g;for(g in og.Ajax.defaultParams)f[g]=og.Ajax.defaultParams[g];for(g in e)f[g]=e[g];var h=og.Ajax.createXMLHttp();h.open(f.type,d,f.async);f.type===og.Ajax.Method.Post&&h.setRequestHeader("Content-Type","application/x-www-form-urlencoded");f.async&&(h.responseType=f.responseType);h.overrideMimeType("text/plain");h.onreadystatechange=function(){h.readyState===og.Ajax.ReadyState.Complete&&(h.status===og.Ajax.Status.OK?e.success&&e.success.call(e.sender?e.sender:
this,h.response):e.error&&e.error.call(e.sender?e.sender:this,h.response,h.status))};h.send(e.data?e.data:og.Ajax.defaultParams.data)};og.utils={};og.utils.readTextFile=function(d){var e="";og.Ajax.request(d,{async:!1,success:function(d){e=d}});return e};og.webgl={};og.webgl.vendorPrefixes=["","WEBKIT_","MOZ_"];og.webgl.MAX_FRAME_DELAY=24;og.webgl.RESOURCES_URL="../../resources/";og.webgl.getExtension=function(d,e){var f,g;for(f in og.webgl.vendorPrefixes)if(g=d.getExtension(og.webgl.vendorPrefixes[f]+e))return g;return null};
og.webgl.initCanvas=function(d){d=document.getElementById(d);var e;try{e=d.getContext("experimental-webgl"),e.canvas=d,d.width=d.scrollWidth,d.height=d.scrollHeight,d.aspect=d.width/d.height}catch(f){alert("Exception during the GL context initialization")}e||alert("Could not initialise WebGL, sorry :-(");return e};
(function(){var d=0;og.webgl.requestAnimationFrame=function(e,f){var g=(new Date).getTime(),h=Math.max(og.webgl.MAX_FRAME_DELAY,16-(g-d)),k=window.setTimeout(function(){e(g+h,f)},h);d=g+h;return k};og.webgl.cancelAnimationFrame=function(d){clearTimeout(d)}})();og.control.ToggleWireframe=function(d){og.inheritance.base(this,d)};og.inheritance.extend(og.control.ToggleWireframe,og.control.Control);og.control.ToggleWireframe.prototype.init=function(){this.renderer.events.on("oncharkeypressed",this,this.toogleWireframe,og.input.KEY_X)};
og.control.ToggleWireframe.prototype.toogleWireframe=function(d){this.renderer.renderNodes.Earth.drawMode===this.renderer.handler.gl.LINE_STRIP?this.renderer.renderNodes.Earth.setDrawMode(this.renderer.handler.gl.TRIANGLE_STRIP):this.renderer.renderNodes.Earth.setDrawMode(this.renderer.handler.gl.LINE_STRIP)};og.planetSegment.PlanetSegmentMaterial=function(d,e){this.segment=d;this.layer=e;this.imageIsLoading=this.imageReady=!1;this.texBias=[0,0,1];this.texture=null};og.planetSegment.PlanetSegmentMaterial.prototype.assignLayer=function(d){this.layer=d};og.planetSegment.PlanetSegmentMaterial.prototype.loadTileImage=function(){this.imageIsLoading||(this.imageReady=!1,this.imageIsLoading=!0,this.layer.handleSegmentTile(this))};
og.planetSegment.PlanetSegmentMaterial.prototype.applyTexture=function(d){this.segment.ready&&this.imageIsLoading?(this.texture=this.segment.handler.createTextureFromImage(d),this.texBias=[0,0,1],this.segment.node.appliedTextureNodeId=this.segment.node.nodeId,this.imageReady=!0):(this.imageReady=!1,this.texture=null,this.texBias=[0,0,1]);this.imageIsLoading=!1};og.planetSegment.PlanetSegmentMaterial.prototype.textureNotExists=function(){this.imageIsLoading=!0};
og.planetSegment.PlanetSegmentMaterial.prototype.clear=function(){this.imageIsLoading=!1;this.imageReady&&(this.imageReady=!1,this.segment.handler.gl.deleteTexture(this.texture),this.texture=null,this.texBias=[0,0,1])};og.quadTree.QuadNode=function(){this.parentNode;this.nodes=[];this.planetSegment;this.partId;this.nodeId;this.planet;this.state;this.appliedTerrainNodeId;this.appliedTextureNodeId;this.sideSize=[0,0,0,0];this.hasNeighbor=[];this.neighbors=[]};og.quadTree.QuadNode._vertOrder=[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}];og.quadTree.QuadNode._neGridSize=Math.sqrt(og.quadTree.QuadNode._vertOrder.length)-1;
og.quadTree.QuadNode.createNode=function(d,e,f,g,h,k){var l=new og.quadTree.QuadNode;l.partId=e;l.parentNode=f;l.nodeId=e+g;l.planet=d;l.planetSegment=new og.planetSegment.PlanetSegment;l.planetSegment.node=l;l.planetSegment.planet=d;l.planetSegment.handler=d.renderer.handler;l.planetSegment.assignTileIndexes(h,k);l.planetSegment.gridSize=d.terrainProvider.gridSizeByZoom[h];l.createBounds();l.planet.createdNodesCount++;return l};
og.quadTree.QuadNode.prototype.getCommonSide=function(d){var e=this.planetSegment.extent,f=d.planetSegment.extent,g=e.northEast,e=e.southWest;d=f.northEast;var h=f.southWest,f=g.lon,g=g.lat,k=e.lon,l=e.lat,n=d.lon,m=d.lat,p=h.lon,h=h.lat;return f==p&&(g<=m&&l>=h||g>=m&&l<=h)?og.quadTree.E:k==n&&(g<=m&&l>=h||g>=m&&l<=h)?og.quadTree.W:g==h&&(k>=p&&f<=n||k<=p&&f>=n)?og.quadTree.N:l==m&&(k>=p&&f<=n||k<=p&&f>=n)?og.quadTree.S:2.003750834E7==f&&-2.003750834E7==p?og.quadTree.E:-2.003750834E7==e.lon&&2.003750834E7==
d.lon?og.quadTree.W:-1};
og.quadTree.QuadNode.prototype.createBounds=function(){var d=this.planetSegment;if(d.zoomIndex)if(d.zoomIndex<d.planet.terrainProvider.minZoom)d.bsphere.setFromExtent(d.planet.ellipsoid,d.extent);else{for(var e=this,f=0,g=0,h=0;e.parentNode&&!e.planetSegment.terrainReady;)e.partId!==og.quadTree.NW&&(e.partId===og.quadTree.NE?g+=Math.pow(2,f):e.partId===og.quadTree.SW?h+=Math.pow(2,f):e.partId===og.quadTree.SE&&(g+=Math.pow(2,f),h+=Math.pow(2,f))),f++,e=e.parentNode;if(e.planetSegment.terrainReady){var k=e.planetSegment.gridSize/
Math.pow(2,f);if(1<=k){var l=e.planetSegment.terrainVertices,f=k*h,n=k*g,h=3*(f*(e.planetSegment.gridSize+1)+n),e=3*((f+k)*(e.planetSegment.gridSize+1)+n+k);d.bsphere.setFromBounds([l[h],l[e],l[h+1],l[e+1],l[h+2],l[e+2]])}else{var l=e.planetSegment,f=Math.floor(k*h),n=Math.floor(k*g),e=1/k,h=h-e*f,g=g-e*n,m=og.quadTree.getVerticesArray(l.terrainVertices,l.gridSize,f,n,1),f=new og.math.Vector3(m[0],m[1],m[2]),n=new og.math.Vector3(m[9],m[10],m[11]),k=new og.math.Vector3(m[3]-m[0],m[4]-m[1],m[5]-m[2]),
l=new og.math.Vector3(m[6]-m[0],m[7]-m[1],m[8]-m[2]),p=new og.math.Vector3(m[3]-m[9],m[4]-m[10],m[5]-m[11]),r=new og.math.Vector3(m[6]-m[9],m[7]-m[10],m[8]-m[11]),s=h,t=g,m=s+t<e?og.math.Vector3.add(k.scaleTo(t/e),l.scaleTo(s/e)).add(f):og.math.Vector3.add(r.scaleTo(1-t/e),p.scaleTo(1-s/e)).add(n),s=h+1,t=g+1,e=s+t<e?og.math.Vector3.add(k.scaleTo(t/e),l.scaleTo(s/e)).add(f):og.math.Vector3.add(r.scaleTo(1-t/e),p.scaleTo(1-s/e)).add(n);d.bsphere.radius=0.5*m.distance(e);d.bsphere.center=m.add(e.sub(m).scale(0.5))}}else d.bsphere.setFromExtent(d.planet.ellipsoid,
d.extent)}else d.bsphere.radius=d.planet.ellipsoid._a,d.bsphere.center=new og.math.Vector3};
og.quadTree.QuadNode.prototype.createChildrenNodes=function(){var d=this.planet,e=this.planetSegment,f=e.extent,g=0.5*f.getWidth(),h=f.northEast,f=f.southWest,e=e.zoomIndex+1,k=4*this.nodeId+1,l=new og.LonLat(f.lon+g,f.lat+g),n=this.nodes;n[og.quadTree.NW]=og.quadTree.QuadNode.createNode(d,og.quadTree.NW,this,k,e,new og.Extent(new og.LonLat(f.lon,f.lat+g),new og.LonLat(f.lon+g,h.lat)));n[og.quadTree.NE]=og.quadTree.QuadNode.createNode(d,og.quadTree.NE,this,k,e,new og.Extent(l,new og.LonLat(h.lon,
h.lat)));n[og.quadTree.SW]=og.quadTree.QuadNode.createNode(d,og.quadTree.SW,this,k,e,new og.Extent(new og.LonLat(f.lon,f.lat),l));n[og.quadTree.SE]=og.quadTree.QuadNode.createNode(d,og.quadTree.SE,this,k,e,new og.Extent(new og.LonLat(f.lon+g,f.lat),new og.LonLat(h.lon,f.lat+g)))};og.quadTree.QuadNode.prototype.reloadTerrain=function(){this.planetSegment.clearBuffers();this.planetSegment.deleteElevations();this.getState()===og.quadTree.WALKTHROUGH&&this.planetSegment.loadTerrain();for(var d=0;d<this.nodes.length;d++)this.nodes[d].reloadTerrain()};
og.quadTree.QuadNode.prototype.getState=function(){for(var d=this.parentNode;d;){if(d.state!=og.quadTree.WALKTHROUGH)return og.quadTree.NOTRENDERING;d=d.parentNode}return this.state};og.quadTree.QuadNode.prototype.prepareForRendering=function(d){if(3E6>d.lonLat.height){var e=d.eye.distance(this.planetSegment.bsphere.center)-this.planetSegment.bsphere.radius;d=3570*Math.sqrt(d.lonLat.height);e<d?this.renderNode():this.state=og.quadTree.NOTRENDERING}else this.renderNode()};
og.quadTree.QuadNode.prototype.traverseNodes=function(){this.nodes.length||this.createChildrenNodes();this.nodes[og.quadTree.NW].renderTree();this.nodes[og.quadTree.NE].renderTree();this.nodes[og.quadTree.SW].renderTree();this.nodes[og.quadTree.SE].renderTree()};
og.quadTree.QuadNode.prototype.renderTree=function(){this.state=og.quadTree.WALKTHROUGH;var d=this.planet.renderer.activeCamera;0<d.frustum.containsSphere(this.planetSegment.bsphere)?og.quadTree.acceptableForRender(d,this.planetSegment.bsphere)?this.prepareForRendering(d):this.planetSegment.zoomIndex<this.planet.terrainProvider.gridSizeByZoom.length-1?this.traverseNodes():this.prepareForRendering(d):this.state=og.quadTree.NOTRENDERING};
og.quadTree.QuadNode.prototype.createPlainSegment=function(d){var e=this.planet.terrainProvider.gridSizeByZoom[d.zoomIndex];d.gridSize=e;this.sideSize=[e,e,e,e];d.createPlainVertices(e);d.terrainVertices=d.plainVertices;d.createCoordsBuffers(d.plainVertices,e);d.ready=!0};
og.quadTree.QuadNode.prototype.renderNode=function(){this.state=og.quadTree.RENDERING;var d=this.planetSegment;d.ready||this.createPlainSegment(d);d.terrainReady||(d.loadTerrain(),this.whileTerrainLoading());for(var e=this.planet.visibleLayers,f=d.materials,g=0;g<e.length;g++){var h=e[g],k=f[h.id];k||(k=d.materials[h.id]=new og.planetSegment.PlanetSegmentMaterial(d,h));k.imageReady||(k.loadTileImage(),this.whileTextureLoading(h.id))}this.addToRender(this)};
og.quadTree.QuadNode.prototype.addToRender=function(d){for(var e=this.planet.renderedNodes,f=0;f<e.length;f++){var g=e[f],h=d.getCommonSide(g);if(-1!=h){var k=og.quadTree.OPSIDE[h];if(!d.hasNeighbor[h]||!g.hasNeighbor[k]){var l=d.planetSegment,n=g.planetSegment,m=l.gridSize/(n.gridSize*Math.pow(2,n.zoomIndex-l.zoomIndex));d.hasNeighbor[h]=!0;g.hasNeighbor[k]=!0;d.neighbors[h]=g;g.neighbors[k]=d;1<m?(d.sideSize[h]=Math.ceil(l.gridSize/m),g.sideSize[k]=n.gridSize):1>m?(d.sideSize[h]=l.gridSize,g.sideSize[k]=
Math.ceil(n.gridSize*m)):(d.sideSize[h]=l.gridSize,g.sideSize[k]=n.gridSize)}}}e.push(d)};
og.quadTree.QuadNode.prototype.whileTerrainLoading=function(){for(var d=this,e=0,f=0,g=0;d.parentNode&&!d.planetSegment.terrainReady;)d.partId==og.quadTree.NE?f+=Math.pow(2,e):d.partId==og.quadTree.SW?g+=Math.pow(2,e):d.partId==og.quadTree.SE&&(f+=Math.pow(2,e),g+=Math.pow(2,e)),e++,d=d.parentNode;var h=this.planet.terrainProvider.maxZoom;if(d.planetSegment.terrainReady&&d.planetSegment.terrainExists&&this.appliedTerrainNodeId!=d.nodeId){var k=d.planetSegment.gridSize/Math.pow(2,e),e=this.planetSegment,
l=d.planetSegment,n=[];e.deleteBuffers();e.refreshIndexesBuffer=!0;if(1<=k){e.gridSize=k;this.sideSize=[k,k,k,k];var m,p,n=og.quadTree.getVerticesArray(l.terrainVertices,l.gridSize,k*g,k*f,k)}else{e.gridSize=og.quadTree.QuadNode._neGridSize;this.sideSize=[e.gridSize,e.gridSize,e.gridSize,e.gridSize];m=Math.floor(k*g);p=Math.floor(k*f);l=og.quadTree.getVerticesArray(l.terrainVertices,l.gridSize,m,p,1);k=1/k;g-=k*m;f-=k*p;p=new og.math.Vector3(l[0],l[1],l[2]);m=new og.math.Vector3(l[9],l[10],l[11]);
for(var r=new og.math.Vector3(l[3]-l[0],l[4]-l[1],l[5]-l[2]),s=new og.math.Vector3(l[6]-l[0],l[7]-l[1],l[8]-l[2]),t=new og.math.Vector3(l[3]-l[9],l[4]-l[10],l[5]-l[11]),u=new og.math.Vector3(l[6]-l[9],l[7]-l[10],l[8]-l[11]),q=new og.math.Vector3,B=og.quadTree.QuadNode._vertOrder,v=0;v<B.length;v++){var q=B[v].y+g,C=B[v].x+f,q=q+C<k?og.math.Vector3.add(r.scaleTo(C/k),s.scaleTo(q/k)).add(p):og.math.Vector3.add(u.scaleTo(1-C/k),t.scaleTo(1-q/k)).add(m);n[3*v]=q.x;n[3*v+1]=q.y;n[3*v+2]=q.z}l.length=0}e.createCoordsBuffers(n,
e.gridSize);e.tempVertices=n;if(e.zoomIndex>h&&d.planetSegment.zoomIndex>=h)e.terrainVertices=n,e.terrainReady=!0,e.terrainExists=!0;else{for(d=this;d.parentNode&&d.planetSegment.zoomIndex!=h;)d=d.parentNode;d=d.planetSegment;d.ready||this.createPlainSegment(d);d.loadTerrain()}}};og.quadTree.getVerticesArray=function(d,e,f,g,h){for(var k=[],l=0,n=f;n<=f+h;n++)for(var m=g;m<=g+h;m++){var p=3*(n*(e+1)+m);k[l++]=d[p];k[l++]=d[p+1];k[l++]=d[p+2]}return k};
og.quadTree.QuadNode.prototype.whileTextureLoading=function(d){for(var e=this,f=0,g=0,h=0,k=!1,l=e.planetSegment.materials[d];e.parentNode;){if(l&&l.imageReady){k=!0;break}e.partId==og.quadTree.NE?g+=Math.pow(2,f):e.partId==og.quadTree.SW?h+=Math.pow(2,f):e.partId==og.quadTree.SE&&(g+=Math.pow(2,f),h+=Math.pow(2,f));f++;e=e.parentNode;l=e.planetSegment.materials[d]}d=this.planetSegment.materials[d];d.imageIsLoading&&k&&(d.texture=l.texture,d.texBias[0]=g,d.texBias[1]=h,d.texBias[2]=1/Math.pow(2,f))};
og.quadTree.QuadNode.prototype.clearTree=function(){var d=this.getState();if(d===og.quadTree.NOTRENDERING)this.destroyBranches(!0);else if(d===og.quadTree.RENDERING)this.destroyBranches(!1);else for(d=0;d<this.nodes.length;d++)this.nodes[d].clearTree()};og.quadTree.QuadNode.prototype.destroyBranches=function(d){d&&this.planetSegment.clearSegment();for(d=0;d<this.nodes.length;d++)this.nodes[d].planetSegment.destroySegment(),this.nodes[d].destroyBranches(!1);this.nodes.length=0};
og.quadTree.QuadNode.prototype.traverseTree=function(d){d(this);for(var e=0;e<this.nodes.length;e++)this.nodes[e].traverseTree(d)};og.shaderProgram={};og.shaderProgram.types={};og.shaderProgram.types._declarations="FLOAT DOUBLE BOOL INT UINT VEC2 VEC3 VEC4 DVEC2 DVEC3 DVEC4 BVEC2 BVEC3 BVEC4 IVEC2 IVEC3 IVEC4 UVEC2 UVEC3 UVEC4 MAT2 DMAT2 MAT3 DMAT3 MAT4 DMAT4 MAT2X3 MAT2X4 MAT3X2 MAT3X4 MAT4X2 MAT4X3 DMAT2X3 DMAT2X4 DMAT3X2 DMAT3X4 DMAT4X2 DMAT4X3 SAMPLER1D SAMPLER2D SAMPLER3D SAMPLERCUBE SAMPLER2DSHADOW SAMPLER2DXX INTXX FLOATXX".split(" ");
(function(){for(var d=0;d<og.shaderProgram.types._declarations.length;d++)og.shaderProgram.types[og.shaderProgram.types._declarations[d]]=d})();og.shaderProgram.callbacks={};og.shaderProgram.bindBuffer=function(d,e){var f=d.gl;f.bindBuffer(f.ARRAY_BUFFER,e.value);f.vertexAttribPointer(e._pName,e.value.itemSize,f.FLOAT,!1,0,0)};og.shaderProgram.callbacks.u=[];og.shaderProgram.callbacks.a=[];og.shaderProgram.callbacks.u[og.shaderProgram.types.MAT4]=function(d,e){d.gl.uniformMatrix4fv(e._pName,!1,e.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.FLOAT]=function(d,e){d.gl.uniform1f(e._pName,e.value)};
og.shaderProgram.callbacks.u[og.shaderProgram.types.INT]=function(d,e){d.gl.uniform1i(e._pName,e.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.VEC2]=function(d,e){d.gl.uniform2fv(e._pName,e.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.VEC3]=function(d,e){d.gl.uniform3fv(e._pName,e.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.VEC4]=function(d,e){d.gl.uniform4fv(e._pName,e.value)};
og.shaderProgram.callbacks.u[og.shaderProgram.types.SAMPLER2D]=function(d,e){var f=d.gl;f.activeTexture(f.TEXTURE0+d._textureID);f.bindTexture(f.TEXTURE_2D,e.value);f.uniform1i(e._pName,d._textureID);d._textureID++};og.shaderProgram.callbacks.u[og.shaderProgram.types.SAMPLERCUBE]=function(d,e){var f=d.gl;f.activeTexture(f.TEXTURE0+d._textureID);f.bindTexture(f.TEXTURE_CUBE_MAP,e.value);f.uniform1i(e._pName,d._textureID);d._textureID++};
og.shaderProgram.callbacks.u[og.shaderProgram.types.SAMPLER2DXX]=function(d,e){for(var f=d.gl,g=e.value.length,h=new Int32Array(g),k=0;k<g;k++)f.activeTexture(f.TEXTURE0+d._textureID+k),f.bindTexture(f.TEXTURE_2D,e.value[k]),h[k]=k;f.uniform1iv(e._pName,h)};og.shaderProgram.callbacks.u[og.shaderProgram.types.INTXX]=function(d,e){pgl.uniform1iv(e._pName,e.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.FLOATXX]=function(d,e){d.gl.uniform1fv(e._pName,e.value)};
og.shaderProgram.callbacks.a[og.shaderProgram.types.FLOAT]=function(d,e){d.gl.vertexAttrib1f(e._pName,e.value)};og.shaderProgram.callbacks.a[og.shaderProgram.types.VEC2]=function(d,e){d.gl.vertexAttrib2fv(e._pName,e.value)};og.shaderProgram.callbacks.a[og.shaderProgram.types.VEC3]=function(d,e){d.gl.vertexAttrib3fv(e._pName,e.value)};og.shaderProgram.callbacks.a[og.shaderProgram.types.VEC4]=function(d,e){d.gl.vertexAttrib4fv(e._pName,e.value)};og.shaderProgram.SHADERS_URL="./shaders/";og.shaderProgram.ShaderProgram=function(d,e){this.name=d;this.attributes=e.attributes;this.uniforms=e.uniforms;this._variables={};this.vertexShader=e.vertexShader;this.fragmentShader=e.fragmentShader;this._p=this.gl=null;this._textureID=0;this._attribArrays=[]};og.shaderProgram.ShaderProgram.prototype.use=function(){this.gl.useProgram(this._p)};
og.shaderProgram.ShaderProgram.prototype.set=function(d){this._textureID=0;for(var e in d)this._variables[e].value=d[e],this._variables[e]._callback(this,this._variables[e])};og.shaderProgram.ShaderProgram.prototype.apply=function(){this._textureID=0;var d=this._variables,e;for(e in d)d[e]._callback(this,d[e])};og.shaderProgram.ShaderProgram.prototype.drawIndexBuffer=function(d,e){this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,e);this.gl.drawElements(d,e.numItems,this.gl.UNSIGNED_SHORT,0)};
og.shaderProgram.ShaderProgram.prototype.drawArray=function(d,e){this.gl.drawArrays(d,0,e)};og.shaderProgram.ShaderProgram.prototype.getShaderCompileStatus=function(d,e){this.gl.shaderSource(d,e);this.gl.compileShader(d);return this.gl.getShaderParameter(d,this.gl.COMPILE_STATUS)?!0:(alert(this.gl.getShaderInfoLog(d)),!1)};og.shaderProgram.ShaderProgram.prototype.createVertexShader=function(d){var e=this.gl.createShader(this.gl.VERTEX_SHADER);return this.getShaderCompileStatus(e,d)?e:null};
og.shaderProgram.ShaderProgram.prototype.createFragmentShader=function(d){var e=this.gl.createShader(this.gl.FRAGMENT_SHADER);return this.getShaderCompileStatus(e,d)?e:null};og.shaderProgram.ShaderProgram.prototype.disableAttribArrays=function(){for(var d=this.gl,e=this._attribArrays,f=e.length;f--;)d.disableVertexAttribArray(e[f])};og.shaderProgram.ShaderProgram.prototype.enableAttribArrays=function(){for(var d=this.gl,e=this._attribArrays,f=e.length;f--;)d.enableVertexAttribArray(e[f])};
og.shaderProgram.ShaderProgram.prototype.createProgram=function(d){this.gl=d;this._p=this.gl.createProgram();d.attachShader(this._p,this.createFragmentShader(this.fragmentShader));d.attachShader(this._p,this.createVertexShader(this.vertexShader));d.linkProgram(this._p);d.getProgramParameter(this._p,d.LINK_STATUS)||alert("Could not initialise shaders.");this.use();for(var e in this.attributes)this.attributes[e]._name=e,this._variables[e]=this.attributes[e],this.attributes[e]._callback=this.attributes[e].enableArray?
og.shaderProgram.bindBuffer:og.shaderProgram.callbacks.a[this.attributes[e].type],this._p[e]=d.getAttribLocation(this._p,e),this.attributes[e].enableArray&&(this._attribArrays.push(this._p[e]),d.enableVertexAttribArray(this._p[e])),this.attributes[e]._pName=this._p[e];for(var f in this.uniforms)this.uniforms[f]._name=f,this.uniforms[f]._callback=og.shaderProgram.callbacks.u[this.uniforms[f].type],this._variables[f]=this.uniforms[f],this._p[f]=d.getUniformLocation(this._p,f),this.uniforms[f]._pName=
this._p[f]};og.shaderProgram.overlays=function(){return new og.shaderProgram.ShaderProgram("overlays",{uniforms:{uPMVMatrix:{type:og.shaderProgram.types.MAT4},uSamplerArr:{type:og.shaderProgram.types.SAMPLER2DXX},texBiasArr:{type:og.shaderProgram.types.VEC3},tcolorArr:{type:og.shaderProgram.types.VEC4},numTex:{type:og.shaderProgram.types.INT}},attributes:{aVertexPosition:{type:og.shaderProgram.types.VEC3,enableArray:!0},aTextureCoord:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+
"overlays_vs.txt"),fragmentShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"overlays_fs.txt")})};og.shaderProgram.single=function(){return new og.shaderProgram.ShaderProgram("single",{uniforms:{uPMVMatrix:{type:og.shaderProgram.types.MAT4},texBias:{type:og.shaderProgram.types.VEC3},uSampler:{type:og.shaderProgram.types.SAMPLER2D}},attributes:{aVertexPosition:{type:og.shaderProgram.types.VEC3,enableArray:!0},aTextureCoord:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"single_vs.txt"),fragmentShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+
"single_fs.txt")})};og.ImageCanvas=function(d,e){this._canvas=document.createElement("canvas");this._canvas.width=d||256;this._canvas.height=e||256;this.context=this._canvas.getContext("2d")};og.ImageCanvas.prototype.fillEmpty=function(){for(var d=this.context.getImageData(0,0,this._canvas.width,this._canvas.height),e=d.data,f=0,g=e.length;f<g;f+=4)e[f]=e[f+1]=e[f+2]=e[f+3]=0;this.context.putImageData(d,0,0)};
og.ImageCanvas.prototype.fillColor=function(d,e,f,g){for(var h=this.context.getImageData(0,0,this._canvas.width,this._canvas.height),k=h.data,l=0,n=k.length;l<n;l+=4)k[l]=d,k[l+1]=e,k[l+2]=f,k[l+3]=g;this.context.putImageData(h,0,0)};og.ImageCanvas.prototype.setData=function(d){var e=this.context.createImageData(this._canvas.width,this._canvas.height);e.data.set(d);this.context.putImageData(e,0,0)};
og.ImageCanvas.prototype.resize=function(d,e){this._canvas.width=d;this._canvas.height=e;this.context=this._canvas.getContext("2d")};og.ImageCanvas.prototype.getImage=function(){var d=new Image;d.src=this._canvas.toDataURL();return d};og.ImageCanvas.prototype.getWidth=function(){return this._canvas.width};og.ImageCanvas.prototype.getHeight=function(){return this._canvas.height};
og.ImageCanvas.prototype.loadImage=function(d,e){var f=new Image,g=this;f.onload=function(){g.resize(f.width,f.height);g.context.drawImage(f,0,0,f.width,f.height);e&&e(f)};f.src=d};og.webgl.Framebuffer=function(d){this.gl=d;this.fbo;this.width;this.height;this._imageCanvas=this.texture=null};og.webgl.Framebuffer.prototype.initialize=function(){var d=this.gl;this.fbo=d.createFramebuffer();this.width=d.canvas.width;this.height=d.canvas.height;this._imageCanvas=new og.ImageCanvas(this.width,this.height);this._createTexture()};
og.webgl.Framebuffer.prototype._createTexture=function(){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,this.fbo);this.texture=d.createTexture();d.bindTexture(d.TEXTURE_2D,this.texture);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,this.width,this.height,0,d.RGBA,d.UNSIGNED_BYTE,null);var e=d.createRenderbuffer();d.bindRenderbuffer(d.RENDERBUFFER,e);d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_COMPONENT16,this.width,this.height);d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,this.texture,
0);d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,e);d.bindTexture(d.TEXTURE_2D,null);d.bindRenderbuffer(d.RENDERBUFFER,null);d.bindFramebuffer(d.FRAMEBUFFER,null)};og.webgl.Framebuffer.prototype.setSize=function(d,e){this.width=d;this.height=e;this._createTexture();this._imageCanvas.resize(d,e)};og.webgl.Framebuffer.prototype.isComplete=function(){var d=this.gl;return d.checkFramebufferStatus(d.FRAMEBUFFER)==d.FRAMEBUFFER_COMPLETE?!0:!1};
og.webgl.Framebuffer.prototype.readPixels=function(d,e,f,g){var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,this.fbo);var k=new Uint8Array(4);h.readPixels(d,e,f||1,g||1,h.RGBA,h.UNSIGNED_BYTE,k);h.bindFramebuffer(h.FRAMEBUFFER,null);return k};og.webgl.Framebuffer.prototype.activate=function(){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,this.fbo)};og.webgl.Framebuffer.prototype.clear=function(){var d=this.gl;d.clearColor(0,0,0,0);d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT)};
og.webgl.Framebuffer.prototype.deactivate=function(){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,null)};og.webgl.Framebuffer.prototype.getImage=function(){var d=this.readPixels(0,0,this.width,this.height);this._imageCanvas.setData(d);return this._imageCanvas.getImage()};og.math.Ray=function(d,e){this.origin=d.clone();this.direction=e.clone().normalize()};og.math.Ray.prototype.set=function(d,e){this.origin=d.clone();this.direction=e.clone()};og.math.Ray.prototype.getPoint=function(d){return og.Vector3.add(this.origin,this.direction.scaleTo(d))};og.math.Ray.prototype.hitTriangle=function(d,e,f){};og.math.Ray.prototype.hitPlane=function(d,e){};
og.math.Ray.prototype.hitSphere=function(d){var e=d.radius,f=d.center,g=this.origin,h=this.direction,k=og.math.Vector3.sub(f,g);if(0>k.dot(h)){var l=k.length();if(l>e)return null;if(l===e)return g.clone();l=f.projToRay(g,k);k=og.math.Vector3.sub(l,f).length();d=Math.sqrt(e*e-k*k);e=d-og.math.Vector3.sub(l,g).length();return g=og.math.Vector3.add(g,h.scaleTo(e))}l=f.projToRay(g,h);f=og.math.Vector3.sub(f,l).length();if(f>d.radius)return null;d=Math.sqrt(e*e-f*f);l.sub(g);e=k.length()>e?l.length()-
d:l.length()+d;return g=og.math.Vector3.add(g,h.scaleTo(e))};og.math.Ray.prototype.hitBox=function(d){};og.shaderProgram.picking=function(){return new og.shaderProgram.ShaderProgram("picking",{uniforms:{uPMVMatrix:{type:og.shaderProgram.types.MAT4},camPos:{type:og.shaderProgram.types.VEC3}},attributes:{aVertexPosition:{type:og.shaderProgram.types.VEC3,enableArray:!0}},vertexShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"picking_vs.txt"),fragmentShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"picking_fs.txt")})};og.node={};og.node.Node=function(d){this.name=d;this.topNode=this;this.dictionary=[];this.dictionary[d]=this;this.childNodes=[];this.parentNode=null};og.node.Node.prototype={name:"",childNodes:[],parentNode:null,topNode:null,dictionary:[]};og.node.Node.prototype.addNode=function(d){d.topNode=null==this.parentNode?this:this.topNode;d.parentNode=this;d.dictionary=this.topNode.dictionary;this.childNodes.push(d);this.topNode.dictionary[d.name]=d};
og.node.Node.prototype.destroy=function(){for(var d=0;d<this.childNodes.length;d++)this.childNodes[d].destroy();this._clear()};og.node.Node.prototype._clear=function(){this.name="";this.topNode=this.parentNode=null;this.childNodes.length=0};og.node.Node.prototype.getNodeByName=function(d){return this.dictionary[d]};og.node.RenderNode=function(d){og.inheritance.base(this,d);this.renderer=null;this.drawMode;this._isActive=this.show=!0;this._zIndex=1E3;this.scaleMatrix=(new og.math.Matrix4).setIdentity();this.rotationMatrix=(new og.math.Matrix4).setIdentity();this.translationMatrix=(new og.math.Matrix4).setIdentity();this.transformationMatrix=(new og.math.Matrix4).setIdentity();this.itransformationMatrix=(new og.math.Matrix4).setIdentity()};og.inheritance.extend(og.node.RenderNode,og.node.Node);
og.node.RenderNode.prototype.setScale=function(d){this.scaleMatrix.scale(d)};og.node.RenderNode.prototype.setOrigin=function(d){this.translationMatrix.translate(d)};og.node.RenderNode.prototype.setAngles=function(d,e,f){this.rotationMatrix.eulerToMatrix(d,e,f)};og.node.RenderNode.prototype.updateMatrices=function(){this.transformationMatrix=this.translationMatrix.mul(this.rotationMatrix).mul(this.scaleMatrix);this.itransformationMatrix=this.transformationMatrix.inverse()};
og.node.RenderNode.prototype.drawNode=function(){this._isActive&&this.drawNodes()};og.node.RenderNode.prototype.setZIndex=function(d){this._zIndex=d};og.node.RenderNode.prototype.getZIndex=function(){return this._zIndex};og.node.RenderNode.prototype.isActive=function(){return this._isActive};og.node.RenderNode.prototype.setActive=function(d){this._isActive=d;for(var e=0;e<this.childNodes.length;e++)this.childNodes[e].setActive(d)};
og.node.RenderNode.prototype.setDrawMode=function(d){this.drawMode=d;for(var e=0;e<this.childNodes.length;e++)this.childNodes[e].setDrawMode(d)};og.node.RenderNode.prototype.drawNodes=function(){for(var d=0;d<this.childNodes.length;d++)this.childNodes[d]._isActive&&this.childNodes[d].drawNodes();this.show&&this.frame&&this.frame()};og.node.RenderNode.prototype.assignRenderer=function(d){this.renderer=d};og.math.coder={};og.math.coder.encodeFloatToRGBA=function(d){var e=Math.abs(d);d=og.math.step(0,-d);var f=Math.floor(og.math.log2(e)),g=og.math.exp2(-f)*e,f=Math.floor(og.math.log2(e)+127)+Math.floor(og.math.log2(g));return new og.math.Vector4(128*d+Math.floor(f*og.math.exp2(-1)),128*og.math.mod(f,2)+og.math.mod(Math.floor(128*g),128),Math.floor(og.math.mod(Math.floor(g*og.math.exp2(15)),og.math.exp2(8))),Math.floor(og.math.exp2(23)*og.math.mod(g,og.math.exp2(-15))))};
og.math.coder.decodeFloatFromRGBA=function(d){var e=1-2*og.math.step(128,d.x),f=2*og.math.mod(d.x,128)+og.math.step(128,d.y)-127;d=65536*og.math.mod(d.y,128)+256*d.z+d.w+8388608;return e*og.math.exp2(f)*d*og.math.exp2(-23)};og.math.coder.doubleToTwoFloats=function(d){var e;if(0<=d){var f=65536*Math.floor(d/65536);e=Math.fround(f);d=Math.fround(d-f)}else f=65536*Math.floor(-d/65536),e=Math.fround(-f),d=Math.fround(d+f);return[e,d]};og.node.Planet=function(d,e){og.inheritance.base(this,d);this.ellipsoid=e;this.quadTree;this.events=new og.Events;this.layers=[];this.visibleLayers=[];this.tcolorArr=[];this.baseLayer;this.terrainProvider;this.createdNodesCount=0;this.renderedNodes=[];this.heightFactor=1;this.mousePositionOnEarth=new og.math.Vector3;this.indexesBuffers=[];this.backbuffer;this._currentDistanceFromPixel=0;this._viewChanged=!0};og.inheritance.extend(og.node.Planet,og.node.RenderNode);
og.node.Planet.prototype.getLayerByName=function(d){for(var e=this.layers.length;e--;)if(this.layers[e].name===d)return this.layers[e]};og.node.Planet.prototype.addLayer=function(d){d.planet=this;d.events.on("onvisibilitychanged",this,this._onLayerVisibilityChanged);d.isBaseLayer&&d.visibility&&this.setBaseLayer(d);this.layers.push(d);this.events.dispatch(this.events.onlayeradded,d);this.updateVisibleLayers()};
og.node.Planet.prototype._onLayerVisibilityChanged=function(d){this.events.dispatch(this.events.onlayervisibilitychanged,d)};og.node.Planet.prototype.addLayers=function(d){for(var e=0;e<d.length;e++)this.addLayer(d[e])};
og.node.Planet.prototype.removeLayer=function(d){for(var e=d.id,f=0;f<this.layers.length;f++)if(this.layers[f].id==e)return this.layers.splice(f,1),d.setVisibility(!1),d.abortLoading(),this.quadTree.traverseTree(function(d){d=d.planetSegment.materials;d[e]&&(d[e].clear(),d[e]=null)}),this.events.dispatch(this.events.onlayerremoved,d),d};og.node.Planet.prototype.getLayers=function(){return this.layers};
og.node.Planet.prototype.setBaseLayer=function(d){if(this.baseLayer){if(d.id!=this.baseLayer.id){for(var e=0;e<this.layers.length;e++){var f=this.layers[e];f.isBaseLayer&&(f.visibility=!1,f.id!=d.id&&f.events.dispatch(f.events.onvisibilitychanged,f))}d.visibility=!0;d.events.dispatch(d.events.onvisibilitychanged,d);this.baseLayer.abortLoading();this.baseLayer=d}}else this.baseLayer=d,this.baseLayer.setVisibility(!0);this.events.dispatch(this.events.onbaselayerchanged,d);this.updateVisibleLayers()};
og.node.Planet.prototype.setHeightFactor=function(d){this.heightFactor!==d&&(this.heightFactor=d,this.quadTree.reloadTerrain())};og.node.Planet.prototype.setTerrainProvider=function(d){this.terrainProvider=d};
og.node.Planet.prototype.initialization=function(){og.planetSegment.PlanetSegmentHelper.initIndexesTables(6);for(var d=0;6>=d;d++){var e=Math.pow(2,d),f=og.planetSegment.PlanetSegmentHelper.createSegmentIndexes(e,[e,e,e,e]);this.indexesBuffers[e]=this.renderer.handler.createElementArrayBuffer(f,1,f.length)}this.renderer.activeCamera.bindEllipsoid(this.ellipsoid);this.quadTree=og.quadTree.QuadNode.createNode(this,og.quadTree.NW,null,0,0,og.Extent.createFromArray([-2.003750834E7,-2.003750834E7,2.003750834E7,
2.003750834E7]));this.drawMode=this.renderer.handler.gl.TRIANGLE_STRIP;this.setScale(new og.math.Vector3(1,this.ellipsoid._a/this.ellipsoid._b,1));this.updateMatrices();this.renderer.handler.addShaderProgram(og.shaderProgram.overlays(),!0);this.renderer.handler.addShaderProgram(og.shaderProgram.single(),!0);this.renderer.handler.addShaderProgram(og.shaderProgram.picking(),!0);this.backbuffer=new og.webgl.Framebuffer(this.renderer.handler.gl);this.backbuffer.initialize();this.updateVisibleLayers();
this.events.registerNames(["ondraw","onlayeradded","onbaselayerchanged","onlayerremoved","onlayervisibilitychanged"]);this.renderer.events.on("onresize",this.backbuffer,function(d){this.setSize(d.width,d.height)});this.renderer.activeCamera.events.on("onviewchanged",this,function(d){this._viewChanged=!0});this.renderer.events.on("onmousemove",this,function(d){this._viewChanged=!0})};
og.node.Planet.prototype.updateVisibleLayers=function(){for(var d=this.visibleLayers.length=0;d<this.layers.length;d++)this.layers[d].visibility&&(this.layers[d].isBaseLayer&&(this.baseLayer=this.layers[d]),this.visibleLayers.push(this.layers[d]));this.sortVisibleLayersByZIndex()};og.node.Planet.prototype.sortVisibleLayersByZIndex=function(){this.visibleLayers.sort(function(d,e){return d.isBaseLayer?-1:d.zIndex-e.zIndex})};
og.node.Planet.prototype.frame=function(){this.quadTree.renderTree();this.renderNodesPASS();this.renderDistanceBackbufferPASS();this.events.dispatch(this.events.ondraw,this);140<this.createdNodesCount&&(this.quadTree.clearTree(),this.createdNodesCount=0);this.renderedNodes.length=0};
og.node.Planet.prototype.renderNodesPASS=function(){var d,e,f=this.renderer,g=f.handler;if(1<this.visibleLayers.length){g.shaderPrograms.overlays.activate();d=g.shaderPrograms.overlays._program;e=og.planetSegment.drawOverlays;for(var h=this.visibleLayers,k=h.length;k--;){var l=h[k],n=4*k;this.tcolorArr[n]=l.transparentColor[0];this.tcolorArr[n+1]=l.transparentColor[1];this.tcolorArr[n+2]=l.transparentColor[2];this.tcolorArr[n+3]=l.opacity}g.gl.uniform1i(d.uniforms.numTex._pName,h.length);g.gl.uniform4fv(d.uniforms.tcolorArr._pName,
this.tcolorArr)}else g.shaderPrograms.single.activate(),d=g.shaderPrograms.single._program,e=og.planetSegment.drawSingle;g.gl.uniformMatrix4fv(d.uniforms.uPMVMatrix._pName,!1,f.activeCamera.pmvMatrix._m);for(k=this.renderedNodes.length;k--;)e(d,this.renderedNodes[k].planetSegment)};
og.node.Planet.prototype.getCartesianFromPixelEllipsoid=function(d){d=this.renderer.activeCamera.unproject(d.x,d.y);var e=this.transformationMatrix.transpose();return(d=(new og.math.Ray(e.mulVec3(this.renderer.activeCamera.eye),e.mulVec3(d))).hitSphere(new og.bv.Sphere(this.ellipsoid._a)))?this.itransformationMatrix.mulVec3(d):null};og.node.Planet.prototype.getLonLatFromPixelEllipsoid=function(d){return(d=this.getCartesianFromPixelEllipsoid(d))?this.ellipsoid.ECEF2LonLat(d):null};
og.node.Planet.prototype.getRayIntersectionEllipsoid=function(d){var e=this.transformationMatrix.transpose();return(d=(new og.math.Ray(e.mulVec3(d.origin),e.mulVec3(d.direction))).hitSphere(new og.bv.Sphere(this.ellipsoid._a)))?this.itransformationMatrix.mulVec3(d):null};og.node.Planet.prototype.getCartesianFromPixelTerrain=function(d){var e=this.getDistanceFromPixel(d);return e?this.renderer.activeCamera.unproject(d.x,d.y).scaleTo(e).add(this.renderer.activeCamera.eye):null};
og.node.Planet.prototype.getLonLatFromPixelTerrain=function(d){return(d=this.getCartesianFromPixelTerrain(d))?this.ellipsoid.ECEF2LonLat(d):null};og.node.Planet.prototype.getPixelFromCartesian=function(d){return this.renderer.activeCamera.project(d)};og.node.Planet.prototype.getPixelFromLonLat=function(d){return(d=this.ellipsoid.LonLat2ECEF(d))?this.renderer.activeCamera.project(d):null};
og.node.Planet.prototype.getDistanceFromPixelEllipsoid=function(d){return(d=this.getCartesianFromPixelEllipsoid(d))?d.distance(this.renderer.activeCamera.eye):null};og.node.Planet.prototype.getDistanceFromPixel=function(d){if(this._viewChanged){this._viewChanged=!1;var e=og.math.Vector4.fromVec(this.backbuffer.readPixels(d.x,this.backbuffer.height-d.y));return e.x|e.y|e.z|e.w?this._currentDistanceFromPixel=og.math.coder.decodeFloatFromRGBA(e):this.getDistanceFromPixelEllipsoid(d)}return this._currentDistanceFromPixel};
og.node.Planet.prototype.renderDistanceBackbufferPASS=function(){var d=this.backbuffer,e=this.renderer,f=e.handler,g=f.shaderPrograms.picking;d.activate();d.clear();g.activate();f.gl.uniform3fv(g._program.uniforms.camPos._pName,e.activeCamera.eye.toVec());for(e=this.renderedNodes.length;e--;)this.renderedNodes[e].planetSegment.drawPicking();d.deactivate();this.renderedNodes.length=0};
og.node.Planet.prototype.viewToExtent=function(d){var e=this.renderer.activeCamera;e.set(e.getExtentPosition(d,this.ellipsoid),og.math.Vector3.ZERO,og.math.Vector3.UP)};og.terrainProvider={};og.terrainProvider.defaultOptions={url:"http://earth3.openglobus.org/{zoom}/{tiley}/{tilex}.ddm",responseType:"arraybuffer",minZoom:3,maxZoom:14,gridSizeByZoom:[32,32,32,32,8,8,8,8,16,16,16,32,32,32,32,32,32,32,32,32,32],fileGridSize:32,MAX_LOADING_TILES:10};
og.terrainProvider.TerrainProvider=function(d,e){this.name=d||"";e=e||{};this.minZoom=e.minZoom||og.terrainProvider.defaultOptions.minZoom;this.maxZoom=e.maxZoom||og.terrainProvider.defaultOptions.maxZoom;this.url=e.url||og.terrainProvider.defaultOptions.url;this.gridSizeByZoom=e.gridSizeByZoom||og.terrainProvider.defaultOptions.gridSizeByZoom;this.fileGridSize=e.fileGridSize||og.terrainProvider.defaultOptions.fileGridSize;this.responseType=e.responseType||og.terrainProvider.defaultOptions.responseType;
this.MAX_LOADING_TILES=e.MAX_LOADING_TILES||og.terrainProvider.defaultOptions.MAX_LOADING_TILES;this.events=new og.Events;this.events.registerNames(["onload","onloadend"]);this._counter=0;this._pendingsQueue=[]};og.terrainProvider.TerrainProvider.prototype.abort=function(){this._pendingsQueue.length=0};og.terrainProvider.TerrainProvider.prototype.setUrl=function(d){this.url=d};og.terrainProvider.TerrainProvider.prototype.setName=function(d){this.name=d};
og.terrainProvider.TerrainProvider.prototype.handleSegmentTerrain=function(d){this._counter>=this.MAX_LOADING_TILES?this._pendingsQueue.push(d):this.loadSegmentTerrainData(d)};og.terrainProvider.TerrainProvider.prototype.getServerUrl=function(d){return og.layer.replaceTemplate(this.url,{tilex:d.tileX.toString(),tiley:d.tileY.toString(),zoom:d.zoomIndex.toString()})};og.terrainProvider.TerrainProvider.prototype.getElevations=function(d){return new Float32Array(d)};
og.terrainProvider.TerrainProvider.prototype.loadSegmentTerrainData=function(d){this._counter++;og.Ajax.request(this.getServerUrl(d),{responseType:this.responseType,sender:this,success:function(e){this._applyElevationsData(d,e)},error:function(){this._applyElevationsData(d,[])}})};og.terrainProvider.TerrainProvider.prototype._applyElevationsData=function(d,e){if(d){var f=this.getElevations(e),g=this.events.onload;g.length&&this.events.dispatch(g,{elevations:[],segment:d});d.applyTerrain.call(d,f)}this.dequeueRequest()};
og.terrainProvider.TerrainProvider.prototype.dequeueRequest=function(){this._counter--;if(this._pendingsQueue.length){if(this._counter<this.MAX_LOADING_TILES){var d;(d=this.whilePendings())&&this.loadSegmentTerrainData.call(this,d)}}else this.events.dispatch(this.events.onloadend)};og.terrainProvider.TerrainProvider.prototype.whilePendings=function(){for(;this._pendingsQueue.length;){var d=this._pendingsQueue.pop();if(d){if(d.node.getState()!=og.quadTree.NOTRENDERING)return d;d.terrainIsLoading=!1}}return null};og.webgl.ShaderController=function(d,e){this._program=e;this._handler=d;this._activated=!1};og.webgl.ShaderController.prototype.getProgram=function(){return this._program};og.webgl.ShaderController.prototype.activate=function(){if(!this._activated){this._handler.activeShaderProgram.deactivate();this._handler.activeShaderProgram=this;var d=this._program;this._activated=!0;d.enableAttribArrays();d.use()}};
og.webgl.ShaderController.prototype.deactivate=function(){this._program.disableAttribArrays();this._activated=!1};og.webgl.ShaderController.prototype.isActive=function(){return this._activated};og.webgl.ShaderController.prototype.set=function(d){this._program.set(d)};og.webgl.ShaderController.prototype.drawIndexBuffer=function(d,e){this._program.drawIndexBuffer(d,e)};og.webgl.ShaderController.prototype.drawArray=function(d,e){this._program.drawArray(d,e)};
og.webgl.ShaderController.prototype.initialize=function(){this._program.createProgram(this._handler.gl)};og.webgl.Handler=function(d){this.lastAnimationFrameTime=0;this.fps;this.delta;this.animSpeed=1;this.backgroundColor={r:0.48,g:0.48,b:0.48,a:1};this.htmlCanvasId=d;this.gl;this._initialized=!1;this.emptyTexture=null;this.drawback=function(d){};this.shaderPrograms={};this.activeShaderProgram=null;this.anisotropicFilteringEnabled=!1};
og.webgl.Handler.prototype.createTextureFromImage=function(d){var e=this.gl,f=e.createTexture();e.bindTexture(e.TEXTURE_2D,f);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,d);e.generateMipmap(e.TEXTURE_2D);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR);this.anisotropicFilteringEnabled&&e.texParameterf(e.TEXTURE_2D,e.ext.TEXTURE_MAX_ANISOTROPY_EXT,4);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,
e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.bindTexture(e.TEXTURE_2D,null);return f};
og.webgl.Handler.prototype.loadCubeMapTexture=function(d){var e=this.gl,f=e.createTexture();e.bindTexture(e.TEXTURE_CUBE_MAP,f);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR);d=[[d.positiveX,e.TEXTURE_CUBE_MAP_POSITIVE_X],[d.negativeX,e.TEXTURE_CUBE_MAP_NEGATIVE_X],[d.positiveY,
e.TEXTURE_CUBE_MAP_POSITIVE_Y],[d.negativeY,e.TEXTURE_CUBE_MAP_NEGATIVE_Y],[d.positiveZ,e.TEXTURE_CUBE_MAP_POSITIVE_Z],[d.negativeZ,e.TEXTURE_CUBE_MAP_NEGATIVE_Z]];var g=new og.ImageCanvas;g.fillEmpty();for(var h=g.getImage(),g=0;g<d.length;g++){var k=d[g][1];e.bindTexture(e.TEXTURE_CUBE_MAP,f);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1);e.texImage2D(k,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,h)}for(g=0;g<d.length;g++)k=d[g][1],h=new Image,h.crossOrigin="",h.onload=function(d,f,g){return function(){e.bindTexture(e.TEXTURE_CUBE_MAP,
d);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1);e.texImage2D(f,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,g)}}(f,k,h),h.src=d[g][0];return f};og.webgl.Handler.prototype.createEmptyTexture=function(d){d=new og.ImageCanvas;d.fillEmpty();this.emptyTexture=this.createTextureFromImage(d.getImage())};
og.webgl.Handler.prototype.addShaderProgram=function(d,e){if(this.shaderPrograms[d.name])alert(d.name+" is allready exists.");else{var f=new og.webgl.ShaderController(this,d);this.shaderPrograms[d.name]=f;this._initShaderController(f);e&&(f._activated=!1)}};og.webgl.Handler.prototype._initShaderController=function(d){this._initialized&&(d.initialize(),this.activeShaderProgram?this.activeShaderProgram._program.use():(this.activeShaderProgram=d,d.activate()))};
og.webgl.Handler.prototype.addShaderPrograms=function(d){for(var e=0;e<d.length;e++)this.addShaderProgram(d[e])};og.webgl.Handler.prototype.initAnysotropicFiltering=function(){var d=og.webgl.getExtension(this.gl,"EXT_texture_filter_anisotropic");if(!d)return null;this.anisotropicFilteringEnabled=!0;return d};og.webgl.Handler.prototype.initShaderPrograms=function(){for(var d in this.shaderPrograms)this._initShaderController(this.shaderPrograms[d])};
og.webgl.Handler.prototype.init=function(){this.gl=og.webgl.initCanvas(this.htmlCanvasId);this._initialized=!0;this.createEmptyTexture();this.initShaderPrograms();this.setDefaults()};og.webgl.Handler.prototype.setDefaults=function(){this.activateDepthTest();this.applyViewport(this.gl.canvas.width,this.gl.canvas.height);this.gl.frontFace(this.gl.CCW);this.gl.cullFace(this.gl.BACK);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE);this.activateFaceCulling();this.deactivateBlending();this.gl.ext=this.initAnysotropicFiltering()};
og.webgl.Handler.prototype.activateDepthTest=function(){this.gl.enable(this.gl.DEPTH_TEST)};og.webgl.Handler.prototype.deactivateDepthTest=function(){this.gl.disable(this.gl.DEPTH_TEST)};og.webgl.Handler.prototype.activateFaceCulling=function(){this.gl.enable(this.gl.CULL_FACE)};og.webgl.Handler.prototype.deactivateFaceCulling=function(){this.gl.disable(this.gl.CULL_FACE)};og.webgl.Handler.prototype.activateBlending=function(){this.gl.enable(this.gl.BLEND)};
og.webgl.Handler.prototype.deactivateBlending=function(){this.gl.disable(this.gl.BLEND)};og.webgl.Handler.prototype.createArrayBuffer=function(d,e,f){var g=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,g);this.gl.bufferData(this.gl.ARRAY_BUFFER,d,this.gl.STATIC_DRAW);g.itemSize=e;g.numItems=f;return g};
og.webgl.Handler.prototype.createElementArrayBuffer=function(d,e,f){var g=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,g);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,d,this.gl.STATIC_DRAW);g.itemSize=e;g.numItems=f;return g};og.webgl.Handler.prototype.fillBackGroundColor=function(d){this.gl.clearColor(d.r,d.g,d.b,d.a)};function print2d(d,e,f,g){d=document.getElementById(d);d.innerHTML=e;d.style.left=f;d.style.top=g}
og.webgl.Handler.prototype.calculateFPS=function(d){this.fps=1E3/(d-this.lastAnimationFrameTime);this.lastAnimationFrameTime=d;this.delta=this.animSpeed/this.fps};og.webgl.Handler.prototype.setBackgroundColor=function(d){this.backgroundColor.r=d.r;this.backgroundColor.g=d.g;this.backgroundColor.b=d.b;this.backgroundColor.a=d.a};
og.webgl.Handler.prototype.applyViewport=function(d,e){var f=Math.max(1,e);this.gl.viewport(0,0,d,f);this.gl.canvas.width=d;this.gl.canvas.height=f;this.gl.canvas.aspect=d/f};og.webgl.Handler.prototype.viewportResized=function(){return this.gl.canvas.clientWidth!=this.gl.canvas.width||this.gl.canvas.clientHeight!=this.gl.canvas.height};
og.webgl.Handler.prototype.drawFrame=function(d,e){e.viewportResized()&&(e.applyViewport(e.gl.canvas.clientWidth,e.gl.canvas.clientHeight),e.onCanvasResize(e.gl.canvas));e.calculateFPS(d);e.clearFrame();e.drawback();og.webgl.requestAnimationFrame(e.drawFrame,e)};og.webgl.Handler.prototype.clearFrame=function(){var d=this.gl;this.fillBackGroundColor(this.backgroundColor);d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT)};
og.webgl.Handler.prototype.start=function(){og.webgl.requestAnimationFrame(this.drawFrame,this)};og.Globus=function(d){function e(){return!1}function f(){return!0}var g=og.Globus.CANVAS_ID_PREFIX+og.Globus.__id,h=document.createElement("canvas");h.id=g;h.style.width="100%";h.style.height="100%";h.style.display="block";this.div=document.getElementById(d.target);this.div.appendChild(h);this.div.classList.add("ogViewport");this.div.onmouseenter=function(){document.onmousewheel=e};this.div.onmouseleave=function(){document.onmousewheel=f};g=new og.webgl.Handler(g);g.init();this.renderer=new og.Renderer(g);
this.renderer.init();this.renderer.div=this.div;d.skybox&&this.renderer.addRenderNode(d.skybox);this._planetName=d.name?d.name:og.Globus.PLANET_NAME_PREFIX+og.Globus.__id;this.planet=new og.node.Planet(this._planetName,d.ellipsoid?d.ellipsoid:og.ellipsoid.wgs84);d.layers&&this.planet.addLayers(d.layers);d.terrain&&this.planet.setTerrainProvider(d.terrain);this.renderer.addRenderNode(this.planet);d.controls&&this.renderer.addControls(d.controls);og.Globus.__id++;d.viewExtent&&this.planet.viewToExtent(d.viewExtent);
(isUndefined(d.autoActivate)||d.autoActivate)&&this.renderer.start()};og.Globus.__id=1;og.Globus.CANVAS_ID_PREFIX="globus_viewport_";og.Globus.PLANET_NAME_PREFIX="globus_planet_";function isUndefined(d){return void 0===d};og.math.Quaternion=function(d,e,f,g){this.x=d||0;this.y=e||0;this.z=f||0;this.w=g||0};og.math.Quaternion.prototype.clear=function(){this.x=this.y=this.z=this.w=0;return this};og.math.Quaternion.prototype.set=function(d,e,f,g){this.x=d;this.y=e;this.z=f;this.w=g;return this};og.math.Quaternion.prototype.copy=function(d){this.x=d.x;this.y=d.y;this.z=d.z;this.w=d.w;return this};og.math.Quaternion.prototype.clone=function(){return new og.math.Quaternion(this.x,this.y,this.z,this.w)};
og.math.Quaternion.prototype.add=function(d){return new og.math.Quaternion(this.x+d.x,this.y+d.y,this.z+d.z,this.w+d.w)};og.math.Quaternion.prototype.sub=function(d){return new og.math.Quaternion(this.x-d.x,this.y-d.y,this.z-d.z,this.w-d.w)};og.math.Quaternion.prototype.scale=function(d){this.x*=d;this.y*=d;this.z*=d;return this};og.math.Quaternion.prototype.scaleTo=function(d){return new og.math.Quaternion(this.x*d,this.y*d,this.z*d,this.w)};
og.math.Quaternion.prototype.toVec=function(){var d=new og.math.GLArray(4);d[0]=this.x;d[1]=this.y;d[2]=this.z;d[3]=this.w;return d};og.math.Quaternion.prototype.setFromSphericalCoords=function(d,e,f){var g=Math.sin(f/2);f=Math.cos(f/2);var h=Math.sin(d);d=Math.cos(d);var k=Math.sin(e);e=Math.cos(e);this.x=g*d*k;this.y=g*h;this.z=g*h*e;this.w=f;return this};
og.math.Quaternion.prototype.toSphericalCoords=function(){var d=this.w,e=Math.sqrt(1-d*d);Math.acos(d);5E-4>Math.abs(e)&&(e=1);var d=this.x/e,f=this.z/e,e=-Math.asin(this.y/e),d=5E-4>d*d+f*f?0:Math.atan2(d,f);0>d&&(d+=360);return{lat:e,lon:d}};og.math.Quaternion.axisAngleToQuat=function(d,e){var f=new og.math.Quaternion,g=d.normal(),h=0.5*e,k=Math.sin(h);f.set(g.x*k,g.y*k,g.z*k,Math.cos(h));return f};
og.math.Quaternion.prototype.setFromAxisAngle=function(d,e){var f=d.normal(),g=0.5*e,h=Math.sin(g);this.set(f.x*h,f.y*h,f.z*h,Math.cos(g));return this};og.math.Quaternion.prototype.getAxisAngle=function(){var d=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z),e;1E-7<d?(e=1/d,e=new og.math.Vector3(x*e,y*e,z*e),d=0>this.w?2*Math.atan2(-d,-w):2*Math.atan2(d,w)):(e=new og.math.Vector3(0,0,0),d=0);return{axis:e,angle:d}};
og.math.Quaternion.prototype.setFromEulerAngles=function(d,e,f){var g,h,k,l,n;g=x*og.Math.RADIANS/2;h=y*og.Math.RADIANS/2;k=z*og.Math.RADIANS/2;d=Math.cos(g);e=Math.cos(h);f=Math.cos(k);g=Math.sin(g);h=Math.sin(h);k=Math.sin(k);l=e*f;n=h*k;this.w=d*l+g*n;this.x=g*l-d*n;this.y=d*h*f+g*e*k;this.z=d*e*k-g*h*f;return this.normalize()};og.math.Quaternion.prototype.getEulerAngles=function(){return this.getMatrix4().getEulerAngles()};
og.math.Quaternion.prototype.setFromMatrix4=function(d){var e,f,g=[],h,k;d=d._m;f=[1,2,0];e=d[0]+d[5]+d[10];0<e?(f=Math.sqrt(e+1),this.w=f/2,f=0.5/f,this.x=(d[6]-d[9])*f,this.y=(d[8]-d[2])*f,this.z=(d[1]-d[4])*f):(e=0,d[5]>d[0]&&(e=1),d[10]>d[5*e]&&(e=2),h=f[e],k=f[h],f=Math.sqrt(d[5*e]-(d[5*h]+d[5*k])+1),g[e]=0.5*f,0!=f&&(f=0.5/f),g[3]=(d[4*h+k]-d[4*k+h])*f,g[h]=(d[4*e+h]+d[4*h+e])*f,g[k]=(d[4*e+k]+d[4*k+e])*f,this.x=g[0],this.y=g[1],this.z=g[2],this.w=g[3]);return this};
og.math.Quaternion.prototype.getMatrix4=function(){var d=new og.math.Matrix4,e=d._m,f=this.x,g=this.y,h=this.z,k=this.w,l=f+f,n=g+g,m=h+h,p=f*l,r=f*n,f=f*m,s=g*n,g=g*m,h=h*m,l=k*l,n=k*n,k=k*m;e[0]=1-(s+h);e[1]=r-k;e[2]=f+n;e[3]=0;e[4]=r+k;e[5]=1-(p+h);e[6]=g-l;e[7]=0;e[8]=f-n;e[9]=g+l;e[10]=1-(p+s);e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return d};
og.math.Quaternion.prototype.mulVec3=function(d){var e=d.x,f=d.y;d=d.z;var g=this.x,h=this.y,k=this.z,l=this.w,n=l*e+h*d-k*f,m=l*f+k*e-g*d,p=l*d+g*f-h*e,e=-g*e-h*f-k*d;return new og.math.Quaternion(n*l+e*-g+m*-k-p*-h,m*l+e*-h+p*-g-n*-k,p*l+e*-k+n*-h-m*-g)};og.math.Quaternion.prototype.mul=function(d){var e=this.x,f=this.y,g=this.z,h=this.w,k=d.x,l=d.y,n=d.z;d=d.w;return new og.math.Quaternion(e*d+h*k+f*n-g*l,f*d+h*l+g*k-e*n,g*d+h*n+e*l-f*k,h*d-e*k-f*l-g*n)};
og.math.Quaternion.prototype.conjugate=function(){return new og.math.Quaternion(-this.x,-this.y,-this.z,this.w)};og.math.Quaternion.prototype.inverse=function(){var d=1/this.norm2();return new og.math.Quaternion(-this.x*d,-this.y*d,-this.z*d,this.w*d)};og.math.Quaternion.prototype.norm=function(){var d=this.x,e=this.y,f=this.z,g=this.w;return Math.sqrt(d*d+e*e+f*f+g*g)};og.math.Quaternion.prototype.norm2=function(){var d=this.x,e=this.y,f=this.z,g=this.w;return d*d+e*e+f*f+g*g};
og.math.Quaternion.prototype.dot=function(d){return this.x*d.x+this.y*d.y+this.z*d.z};og.math.Quaternion.prototype.normalize=function(){var d=this.x,e=this.y,f=this.z,g=this.w,h=Math.sqrt(d*d+e*e+f*f+g*g);if(0==h)return this.w=this.z=this.y=this.x=0,this;h=1/h;this.x=d*h;this.y=e*h;this.z=f*h;this.w=g*h;return this};og.math.Quaternion.prototype.isEqual=function(d){d=this.dot(d);return 0.001>Math.abs(d-1)?!0:!1};
og.math.Quaternion.prototype.slerp=function(){var d=c;0>this.x*b.x+this.y*b.y+this.z*b.z+this.w*b.w&&(d=-1*c);this.x=1-c*this.x+d*b.x;this.y=1-c*this.y+d*b.y;this.z=1-c*this.z+d*b.z;this.w=1-c*this.w+d*b.w;return this};og.math.Quaternion.getLookAtTargetUp=function(d,e){var f=d.normal(),f=og.math.Vector3.OrthoNormalize(e,f),g=e.cross(f),h=new og.math.Quaternion;h.w=0.5*Math.sqrt(1+g.x+e.y+f.z);var k=1/(4*h.w);h.x=(f.y-e.z)*k;h.y=(g.z-f.x)*k;h.z=(e.x-g.y)*k;return h};
og.math.Quaternion.getLookAtSourceDest=function(d,e){var f=e.sub(d).normalize(),g=og.math.Vector3.FORWARD.dot(f);if(1E-6>Math.abs(g- -1))return og.math.Quaternion.axisAngleToQuat(og.math.Vector3.UP,Math.PI);if(1E-6>Math.abs(g-1))return new og.math.Quaternion(0,0,0,1);g=Math.acos(g);f=og.math.Vector3.FORWARD.cross(f).normalize();return og.math.Quaternion.axisAngleToQuat(f,g)};og.math.Quaternion.getRotationBetweenVectors=function(d,e){var f=d.cross(e);return(new og.math.Quaternion(f.x,f.y,f.z,1+d.dot(e))).normalize()};
og.math.Quaternion.prototype.getRoll=function(d){var e=this.x,f=this.y,g=this.z,h=this.w;if(d){d=2*f;var k=2*g;return Math.atan2(d*e+k*h,1-(d*f+k*g))}return Math.atan2(2*(e*f+h*g),h*h+e*e-f*f-g*g)};og.math.Quaternion.prototype.getPitch=function(d){var e=this.x,f=this.y,g=this.z,h=this.w;if(d){d=2*e;var k=2*g;return Math.atan2(k*f+d*h,1-(d*e+k*g))}return Math.atan2(2*(f*g+h*e),h*h-e*e-f*f+g*g)};
og.math.Quaternion.prototype.getYaw=function(d){var e=this.x,f=this.y,g=this.z,h=this.w;return d?(d=2*f,Math.atan2(2*g*e+d*h,1-(2*e*e+d*f))):Math.asin(-2*(e*g-h*f))};og.control.MouseNavigation=function(d){og.inheritance.base(this,d);this.grabbedPoint=new og.math.Vector3;this.pointOnEarth=new og.math.Vector3;this.earthUp=new og.math.Vector3;this.distDiff=0.2;this.inertia=0.007;this.grabbedSpheroid=new og.bv.Sphere;this.planet;this.qRot=new og.math.Quaternion;this.scaleRot=0};og.inheritance.extend(og.control.MouseNavigation,og.control.Control);
og.control.MouseNavigation.prototype.onMouseWheel=function(d){this.stopRotation();var e=this.planet.getCartesianFromPixelTerrain(this.renderer.events.mouseState);if(e){var f=this.renderer.activeCamera,g=this.renderer.events.mouseState.direction,h=this.distDiff*f.eye.distance(e);0<d.wheelDelta&&(h=-h);9E3<f.lonLat.height?(this.grabbedSpheroid.radius=e.length(),f.eye.add(f.n.scaleTo(h)),(d=(new og.math.Ray(f.eye,g)).hitSphere(this.grabbedSpheroid))?(e=(new og.math.Matrix4).rotateBetweenVectors(e.normal(),
d.normal()),f.eye=e.mulVec3(f.eye),f.v=e.mulVec3(f.v),f.u=e.mulVec3(f.u),f.n=e.mulVec3(f.n)):f.eye.add(f.n.scaleTo(h))):f.eye.add(g.scaleTo(-h));f.update()}};
og.control.MouseNavigation.prototype.init=function(){this.renderer.events.on("onmousewheel",this,this.onMouseWheel);this.renderer.events.on("onmouselbuttonhold",this,this.onMouseLeftButtonDown);this.renderer.events.on("onmouserbuttonhold",this,this.onMouseRightButtonDown);this.renderer.events.on("onmouselbuttondown",this,this.onMouseLeftButtonClick);this.renderer.events.on("onmouserbuttondown",this,this.onMouseRightButtonClick);this.renderer.events.on("onmouselbuttondoubleclick",this,this.onMouseLeftButtonDoubleClick);
this.renderer.events.on("onmouseclick",this,this.onMouseClick);this.renderer.events.on("ondraw",this,this.onDraw);this.planet=this.renderer.renderNodes.Earth};og.control.MouseNavigation.prototype.onMouseClick=function(){};og.control.MouseNavigation.prototype.onMouseLeftButtonDoubleClick=function(){};og.control.MouseNavigation.prototype.onMouseLeftButtonClick=function(d){if(this.grabbedPoint=this.planet.getCartesianFromPixelTerrain(d))this.grabbedSpheroid.radius=this.grabbedPoint.length(),this.stopRotation()};
og.control.MouseNavigation.prototype.stopRotation=function(){this.qRot.clear()};
og.control.MouseNavigation.prototype.onMouseLeftButtonDown=function(d){if(this.grabbedPoint)if(this.renderer.events.mouseState.moving){var e=this.renderer.activeCamera;if(d=(new og.math.Ray(e.eye,d.direction)).hitSphere(this.grabbedSpheroid))this.scaleRot=1,this.qRot=og.math.Quaternion.getRotationBetweenVectors(this.grabbedPoint.normal(),d.normal()),d=this.qRot.getMatrix4(),e.eye=d.mulVec3(e.eye),e.v=d.mulVec3(e.v),e.u=d.mulVec3(e.u),e.n=d.mulVec3(e.n),e.update()}else this.scaleRot=0};
og.control.MouseNavigation.prototype.onMouseRightButtonClick=function(d){this.stopRotation();this.pointOnEarth=this.planet.getCartesianFromPixelTerrain({x:d.x,y:d.y});this.earthUp=this.pointOnEarth.normal()};
og.control.MouseNavigation.prototype.onMouseRightButtonDown=function(d){var e=this.renderer.activeCamera;if(this.renderer.events.mouseState.moving){var f=0.5/e.eye.distance(this.pointOnEarth)*e.lonLat.height*og.math.RADIANS;0.007<f&&(f=0.007);e.rotateHorizontal(f*(d.x-d.prev_x),!1,this.pointOnEarth,this.earthUp);e.rotateVertical(f*(d.y-d.prev_y),this.pointOnEarth)}};
og.control.MouseNavigation.prototype.onDraw=function(d){var e=this.renderer;e.controlsBag.scaleRot=this.scaleRot;d=e.activeCamera;e.events.mouseState.leftButtonDown||(e=this.qRot.scaleTo(Math.pow(this.scaleRot,3)).getMatrix4(),d.eye=e.mulVec3(d.eye),d.v=e.mulVec3(d.v),d.u=e.mulVec3(d.u),d.n=e.mulVec3(d.n),d.update(),this.scaleRot-=this.inertia,0>=this.scaleRot&&(this.scaleRot=0))};og.shaderProgram.skybox=function(){return new og.shaderProgram.ShaderProgram("skybox",{uniforms:{uPMVMatrix:{type:og.shaderProgram.types.MAT4},uSampler:{type:og.shaderProgram.types.SAMPLERCUBE},pos:{type:og.shaderProgram.types.VEC3}},attributes:{aVertexPosition:{type:og.shaderProgram.types.VEC3,enableArray:!0}},vertexShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"skybox_vs.txt"),fragmentShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"skybox_fs.txt")})};og.node.SkyBox=function(d){og.inheritance.base(this,"skybox");this.params=d;this.texture=this.vertexPositionBuffer=null};og.inheritance.extend(og.node.SkyBox,og.node.RenderNode);og.node.SkyBox.prototype.initialization=function(){this.renderer.handler.addShaderProgram(og.shaderProgram.skybox(),!0);this.texture=this.renderer.handler.loadCubeMapTexture(this.params);this.createBuffers();this.drawMode=this.renderer.handler.gl.TRIANGLES};
og.node.SkyBox.prototype.frame=function(){var d=this.renderer.handler,e=d.gl,f=this.renderer.activeCamera;e.disable(d.gl.DEPTH_TEST);d.shaderPrograms.skybox.activate();sh=d.shaderPrograms.skybox._program;var g=sh.uniforms;e.uniformMatrix4fv(g.uPMVMatrix._pName,!1,f.pmvMatrix._m);e.uniform3fv(g.pos._pName,f.eye.toVec());e.activeTexture(e.TEXTURE0);e.bindTexture(e.TEXTURE_CUBE_MAP,this.texture);e.uniform1i(g.uSampler._pName,0);f=this.vertexPositionBuffer;e.bindBuffer(e.ARRAY_BUFFER,f);e.vertexAttribPointer(sh.attributes.aVertexPosition._pName,
f.itemSize,e.FLOAT,!1,0,0);e.drawArrays(this.drawMode,0,f.numItems);d.gl.enable(d.gl.DEPTH_TEST)};
og.node.SkyBox.prototype.createBuffers=function(){this.vertexPositionBuffer=this.renderer.handler.createArrayBuffer(new Float32Array([-100,100,-100,-100,-100,-100,100,-100,-100,100,-100,-100,100,100,-100,-100,100,-100,-100,-100,100,-100,-100,-100,-100,100,-100,-100,100,-100,-100,100,100,-100,-100,100,100,-100,-100,100,-100,100,100,100,100,100,100,100,100,100,-100,100,-100,-100,-100,-100,100,-100,100,100,100,100,100,100,100,100,100,-100,100,-100,-100,100,-100,100,-100,100,100,-100,100,100,100,100,
100,100,-100,100,100,-100,100,-100,-100,-100,-100,-100,-100,100,100,-100,-100,100,-100,-100,-100,-100,100,100,-100,100]),3,36)};og.all=function(){};
