var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(c,d,e){if(e.get||e.set)throw new TypeError("ES3 does not support getters and setters.");c!=Array.prototype&&c!=Object.prototype&&(c[d]=e.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global?global:c};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(c,d,e,f){if(d){e=$jscomp.global;c=c.split(".");for(f=0;f<c.length-1;f++){var g=c[f];g in e||(e[g]={});e=e[g]}c=c[c.length-1];f=e[c];d=d(f);d!=f&&null!=d&&$jscomp.defineProperty(e,c,{configurable:!0,writable:!0,value:d})}};$jscomp.polyfill("Math.sign",function(c){return c?c:function(c){c=Number(c);return 0===c||isNaN(c)?c:0<c?1:-1}},"es6-impl","es3");
$jscomp.polyfill("Math.sinh",function(c){if(c)return c;var d=Math.exp;return function(c){c=Number(c);return 0===c?c:(d(c)-d(-c))/2}},"es6-impl","es3");$jscomp.polyfill("Math.cosh",function(c){if(c)return c;var d=Math.exp;return function(c){c=Number(c);return(d(c)+d(-c))/2}},"es6-impl","es3");var COMPILED=!0,goog=goog||{};goog.global=this;goog.isDef=function(c){return void 0!==c};
goog.exportPath_=function(c,d,e){c=c.split(".");e=e||goog.global;c[0]in e||!e.execScript||e.execScript("var "+c[0]);for(var f;c.length&&(f=c.shift());)!c.length&&goog.isDef(d)?e[f]=d:e=e[f]?e[f]:e[f]={}};
goog.define=function(c,d){var e=d;COMPILED||(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,c)?e=goog.global.CLOSURE_UNCOMPILED_DEFINES[c]:goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,c)&&(e=goog.global.CLOSURE_DEFINES[c]));goog.exportPath_(c,e)};goog.DEBUG=!0;goog.LOCALE="en";goog.TRUSTED_SITE=!0;goog.STRICT_MODE_COMPATIBLE=!1;goog.DISALLOW_TEST_ONLY_CODE=COMPILED&&!goog.DEBUG;
goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING=!1;goog.provide=function(c){if(goog.isInModuleLoader_())throw Error("goog.provide can not be used within a goog.module.");if(!COMPILED&&goog.isProvided_(c))throw Error('Namespace "'+c+'" already declared.');goog.constructNamespace_(c)};goog.constructNamespace_=function(c,d){if(!COMPILED){delete goog.implicitNamespaces_[c];for(var e=c;(e=e.substring(0,e.lastIndexOf(".")))&&!goog.getObjectByName(e);)goog.implicitNamespaces_[e]=!0}goog.exportPath_(c,d)};
goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/;goog.module=function(c){if(!goog.isString(c)||!c||-1==c.search(goog.VALID_MODULE_RE_))throw Error("Invalid module identifier");if(!goog.isInModuleLoader_())throw Error("Module "+c+" has been loaded incorrectly.");if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");goog.moduleLoaderState_.moduleName=c;if(!COMPILED){if(goog.isProvided_(c))throw Error('Namespace "'+c+'" already declared.');delete goog.implicitNamespaces_[c]}};
goog.module.get=function(c){return goog.module.getInternal_(c)};goog.module.getInternal_=function(c){if(!COMPILED)return goog.isProvided_(c)?c in goog.loadedModules_?goog.loadedModules_[c]:goog.getObjectByName(c):null};goog.moduleLoaderState_=null;goog.isInModuleLoader_=function(){return null!=goog.moduleLoaderState_};
goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInModuleLoader_())throw Error("goog.module.declareLegacyNamespace must be called from within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=!0};
goog.setTestOnly=function(c){if(goog.DISALLOW_TEST_ONLY_CODE)throw c=c||"",Error("Importing test-only code into non-debug environment"+(c?": "+c:"."));};goog.forwardDeclare=function(c){};COMPILED||(goog.isProvided_=function(c){return c in goog.loadedModules_||!goog.implicitNamespaces_[c]&&goog.isDefAndNotNull(goog.getObjectByName(c))},goog.implicitNamespaces_={"goog.module":!0});
goog.getObjectByName=function(c,d){for(var e=c.split("."),f=d||goog.global,g;g=e.shift();)if(goog.isDefAndNotNull(f[g]))f=f[g];else return null;return f};goog.globalize=function(c,d){var e=d||goog.global,f;for(f in c)e[f]=c[f]};
goog.addDependency=function(c,d,e,f){if(goog.DEPENDENCIES_ENABLED){var g;c=c.replace(/\\/g,"/");var h=goog.dependencies_;f&&"boolean"!==typeof f||(f=f?{module:"goog"}:{});for(var k=0;g=d[k];k++)h.nameToPath[g]=c,h.loadFlags[c]=f;for(f=0;d=e[f];f++)c in h.requires||(h.requires[c]={}),h.requires[c][d]=!0}};goog.ENABLE_DEBUG_LOADER=!0;goog.logToConsole_=function(c){goog.global.console&&goog.global.console.error(c)};
goog.require=function(c){if(!COMPILED){goog.ENABLE_DEBUG_LOADER&&goog.IS_OLD_IE_&&goog.maybeProcessDeferredDep_(c);if(goog.isProvided_(c)){if(goog.isInModuleLoader_())return goog.module.getInternal_(c)}else if(goog.ENABLE_DEBUG_LOADER){var d=goog.getPathFromDeps_(c);if(d)goog.writeScripts_(d);else throw c="goog.require could not find: "+c,goog.logToConsole_(c),Error(c);}return null}};goog.basePath="";goog.nullFunction=function(){};
goog.abstractMethod=function(){throw Error("unimplemented abstract method");};goog.addSingletonGetter=function(c){c.getInstance=function(){if(c.instance_)return c.instance_;goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=c);return c.instance_=new c}};goog.instantiatedSingletons_=[];goog.LOAD_MODULE_USING_EVAL=!0;goog.SEAL_MODULE_EXPORTS=goog.DEBUG;goog.loadedModules_={};goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;goog.TRANSPILE="detect";
goog.TRANSPILER="transpile.js";
goog.DEPENDENCIES_ENABLED&&(goog.dependencies_={loadFlags:{},nameToPath:{},requires:{},visited:{},written:{},deferred:{}},goog.inHtmlDocument_=function(){var c=goog.global.document;return null!=c&&"write"in c},goog.findBasePath_=function(){if(goog.isDef(goog.global.CLOSURE_BASE_PATH))goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_())for(var c=goog.global.document.getElementsByTagName("SCRIPT"),d=c.length-1;0<=d;--d){var e=c[d].src,f=e.lastIndexOf("?"),f=-1==f?e.length:f;if("base.js"==
e.substr(f-7,7)){goog.basePath=e.substr(0,f-7);break}}},goog.importScript_=function(c,d){(goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_)(c,d)&&(goog.dependencies_.written[c]=!0)},goog.IS_OLD_IE_=!(goog.global.atob||!goog.global.document||!goog.global.document.all),goog.importProcessedScript_=function(c,d,e){goog.importScript_("",'goog.retrieveAndExec_("'+c+'", '+d+", "+e+");")},goog.queuedModules_=[],goog.wrapModule_=function(c,d){return goog.LOAD_MODULE_USING_EVAL&&goog.isDef(goog.global.JSON)?
"goog.loadModule("+goog.global.JSON.stringify(d+"\n//# sourceURL="+c+"\n")+");":'goog.loadModule(function(exports) {"use strict";'+d+"\n;return exports});\n//# sourceURL="+c+"\n"},goog.loadQueuedModules_=function(){var c=goog.queuedModules_.length;if(0<c){var d=goog.queuedModules_;goog.queuedModules_=[];for(var e=0;e<c;e++)goog.maybeProcessDeferredPath_(d[e])}},goog.maybeProcessDeferredDep_=function(c){goog.isDeferredModule_(c)&&goog.allDepsAreAvailable_(c)&&(c=goog.getPathFromDeps_(c),goog.maybeProcessDeferredPath_(goog.basePath+
c))},goog.isDeferredModule_=function(c){var d=(c=goog.getPathFromDeps_(c))&&goog.dependencies_.loadFlags[c]||{};return c&&("goog"==d.module||goog.needsTranspile_(d.lang))?goog.basePath+c in goog.dependencies_.deferred:!1},goog.allDepsAreAvailable_=function(c){if((c=goog.getPathFromDeps_(c))&&c in goog.dependencies_.requires)for(var d in goog.dependencies_.requires[c])if(!goog.isProvided_(d)&&!goog.isDeferredModule_(d))return!1;return!0},goog.maybeProcessDeferredPath_=function(c){if(c in goog.dependencies_.deferred){var d=
goog.dependencies_.deferred[c];delete goog.dependencies_.deferred[c];goog.globalEval(d)}},goog.loadModuleFromUrl=function(c){goog.retrieveAndExec_(c,!0,!1)},goog.writeScriptSrcNode_=function(c){goog.global.document.write('<script type="text/javascript" src="'+c+'">\x3c/script>')},goog.appendScriptSrcNode_=function(c){var d=goog.global.document,e=d.createElement("script");e.type="text/javascript";e.src=c;e.defer=!1;e.async=!1;d.head.appendChild(e)},goog.writeScriptTag_=function(c,d){if(goog.inHtmlDocument_()){var e=
goog.global.document;if(!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING&&"complete"==e.readyState){if(/\bdeps.js$/.test(c))return!1;throw Error('Cannot write "'+c+'" after document load');}if(void 0===d)if(goog.IS_OLD_IE_){var f=" onreadystatechange='goog.onScriptLoad_(this, "+ ++goog.lastNonModuleScriptIndex_+")' ";e.write('<script type="text/javascript" src="'+c+'"'+f+">\x3c/script>")}else goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING?goog.appendScriptSrcNode_(c):goog.writeScriptSrcNode_(c);else e.write('<script type="text/javascript">'+
d+"\x3c/script>");return!0}return!1},goog.needsTranspile_=function(c){if("always"==goog.TRANSPILE)return!0;if("never"==goog.TRANSPILE)return!1;if(!goog.transpiledLanguages_){goog.transpiledLanguages_={es5:!0,es6:!0,"es6-impl":!0};try{goog.transpiledLanguages_.es5=eval("[1,].length!=1"),eval('(()=>{"use strict";let a={};const X=class{constructor(){}x(z){return new Map([...arguments]).get(z[0])==3}};return new X().x([a,3])})()')&&(goog.transpiledLanguages_["es6-impl"]=!1),eval('(()=>{"use strict";class X{constructor(){if(new.target!=String)throw 1;this.x=42}}let q=Reflect.construct(X,[],String);if(q.x!=42||!(q instanceof String))throw 1;for(const a of[2,3]){if(a==2)continue;function f(z={a}){let a=0;return z.a}{function f(){return 0;}}return f()==3}})()')&&
(goog.transpiledLanguages_.es6=!1)}catch(d){}}return!!goog.transpiledLanguages_[c]},goog.transpiledLanguages_=null,goog.lastNonModuleScriptIndex_=0,goog.onScriptLoad_=function(c,d){"complete"==c.readyState&&goog.lastNonModuleScriptIndex_==d&&goog.loadQueuedModules_();return!0},goog.writeScripts_=function(c){function d(c){if(!(c in g.written||c in g.visited)){g.visited[c]=!0;if(c in g.requires)for(var h in g.requires[c])if(!goog.isProvided_(h))if(h in g.nameToPath)d(g.nameToPath[h]);else throw Error("Undefined nameToPath for "+
h);c in f||(f[c]=!0,e.push(c))}}var e=[],f={},g=goog.dependencies_;d(c);for(c=0;c<e.length;c++){var h=e[c];goog.dependencies_.written[h]=!0}var k=goog.moduleLoaderState_;goog.moduleLoaderState_=null;for(c=0;c<e.length;c++)if(h=e[c]){var m=g.loadFlags[h]||{},l=goog.needsTranspile_(m.lang);"goog"==m.module||l?goog.importProcessedScript_(goog.basePath+h,"goog"==m.module,l):goog.importScript_(goog.basePath+h)}else throw goog.moduleLoaderState_=k,Error("Undefined script input");goog.moduleLoaderState_=
k},goog.getPathFromDeps_=function(c){return c in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[c]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js"));
goog.loadModule=function(c){var d=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:void 0,declareLegacyNamespace:!1};var e;if(goog.isFunction(c))e=c.call(void 0,{});else if(goog.isString(c))e=goog.loadModuleFromSource_.call(void 0,c);else throw Error("Invalid module definition");var f=goog.moduleLoaderState_.moduleName;if(!goog.isString(f)||!f)throw Error('Invalid module name "'+f+'"');goog.moduleLoaderState_.declareLegacyNamespace?goog.constructNamespace_(f,e):goog.SEAL_MODULE_EXPORTS&&
Object.seal&&goog.isObject(e)&&Object.seal(e);goog.loadedModules_[f]=e}finally{goog.moduleLoaderState_=d}};goog.loadModuleFromSource_=function(c){eval(c);return{}};goog.normalizePath_=function(c){c=c.split("/");for(var d=0;d<c.length;)"."==c[d]?c.splice(d,1):d&&".."==c[d]&&c[d-1]&&".."!=c[d-1]?c.splice(--d,2):d++;return c.join("/")};
goog.loadFileSync_=function(c){if(goog.global.CLOSURE_LOAD_FILE_SYNC)return goog.global.CLOSURE_LOAD_FILE_SYNC(c);try{var d=new goog.global.XMLHttpRequest;d.open("get",c,!1);d.send();return 0==d.status||200==d.status?d.responseText:null}catch(e){return null}};
goog.retrieveAndExec_=function(c,d,e){if(!COMPILED){var f=c;c=goog.normalizePath_(c);var g=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_,h=goog.loadFileSync_(c);if(null==h)throw Error('Load of "'+c+'" failed');e&&(h=goog.transpile_.call(goog.global,h,c));h=d?goog.wrapModule_(c,h):h+("\n//# sourceURL="+c);goog.IS_OLD_IE_?(goog.dependencies_.deferred[f]=h,goog.queuedModules_.push(f)):g(c,h)}};
goog.transpile_=function(c,d){var e=goog.global.$jscomp;e||(goog.global.$jscomp=e={});var f=e.transpile;if(!f){var g=goog.basePath+goog.TRANSPILER,h=goog.loadFileSync_(g);h&&(eval(h+"\n//# sourceURL="+g),e=goog.global.$jscomp,f=e.transpile)}f||(f=e.transpile=function(c,d){goog.logToConsole_(d+" requires transpilation but no transpiler was found.");return c});return f(c,d)};
goog.typeOf=function(c){var d=typeof c;if("object"==d)if(c){if(c instanceof Array)return"array";if(c instanceof Object)return d;var e=Object.prototype.toString.call(c);if("[object Window]"==e)return"object";if("[object Array]"==e||"number"==typeof c.length&&"undefined"!=typeof c.splice&&"undefined"!=typeof c.propertyIsEnumerable&&!c.propertyIsEnumerable("splice"))return"array";if("[object Function]"==e||"undefined"!=typeof c.call&&"undefined"!=typeof c.propertyIsEnumerable&&!c.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==d&&"undefined"==typeof c.call)return"object";return d};goog.isNull=function(c){return null===c};goog.isDefAndNotNull=function(c){return null!=c};goog.isArray=function(c){return"array"==goog.typeOf(c)};goog.isArrayLike=function(c){var d=goog.typeOf(c);return"array"==d||"object"==d&&"number"==typeof c.length};goog.isDateLike=function(c){return goog.isObject(c)&&"function"==typeof c.getFullYear};goog.isString=function(c){return"string"==typeof c};
goog.isBoolean=function(c){return"boolean"==typeof c};goog.isNumber=function(c){return"number"==typeof c};goog.isFunction=function(c){return"function"==goog.typeOf(c)};goog.isObject=function(c){var d=typeof c;return"object"==d&&null!=c||"function"==d};goog.getUid=function(c){return c[goog.UID_PROPERTY_]||(c[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(c){return!!c[goog.UID_PROPERTY_]};
goog.removeUid=function(c){null!==c&&"removeAttribute"in c&&c.removeAttribute(goog.UID_PROPERTY_);try{delete c[goog.UID_PROPERTY_]}catch(d){}};goog.UID_PROPERTY_="closure_uid_"+(1E9*Math.random()>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(c){var d=goog.typeOf(c);if("object"==d||"array"==d){if(c.clone)return c.clone();var d="array"==d?[]:{},e;for(e in c)d[e]=goog.cloneObject(c[e]);return d}return c};
goog.bindNative_=function(c,d,e){return c.call.apply(c.bind,arguments)};goog.bindJs_=function(c,d,e){if(!c)throw Error();if(2<arguments.length){var f=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(e,f);return c.apply(d,e)}}return function(){return c.apply(d,arguments)}};
goog.bind=function(c,d,e){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_;return goog.bind.apply(null,arguments)};goog.partial=function(c,d){var e=Array.prototype.slice.call(arguments,1);return function(){var d=e.slice();d.push.apply(d,arguments);return c.apply(this,d)}};goog.mixin=function(c,d){for(var e in d)c[e]=d[e]};goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date};
goog.globalEval=function(c){if(goog.global.execScript)goog.global.execScript(c,"JavaScript");else if(goog.global.eval){if(null==goog.evalWorksForGlobals_)if(goog.global.eval("var _evalTest_ = 1;"),"undefined"!=typeof goog.global._evalTest_){try{delete goog.global._evalTest_}catch(f){}goog.evalWorksForGlobals_=!0}else goog.evalWorksForGlobals_=!1;if(goog.evalWorksForGlobals_)goog.global.eval(c);else{var d=goog.global.document,e=d.createElement("SCRIPT");e.type="text/javascript";e.defer=!1;e.appendChild(d.createTextNode(c));
d.body.appendChild(e);d.body.removeChild(e)}}else throw Error("goog.globalEval not available");};goog.evalWorksForGlobals_=null;
goog.getCssName=function(c,d){if("."==String(c).charAt(0))throw Error('className passed in goog.getCssName must not start with ".". You passed: '+c);var e=function(c){return goog.cssNameMapping_[c]||c},f=function(c){c=c.split("-");for(var d=[],f=0;f<c.length;f++)d.push(e(c[f]));return d.join("-")},f=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?e:f:function(c){return c},f=d?c+"-"+f(d):f(c);return goog.global.CLOSURE_CSS_NAME_MAP_FN?goog.global.CLOSURE_CSS_NAME_MAP_FN(f):f};
goog.setCssNameMapping=function(c,d){goog.cssNameMapping_=c;goog.cssNameMappingStyle_=d};!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING);goog.getMsg=function(c,d){d&&(c=c.replace(/\{\$([^}]+)}/g,function(c,f){return null!=d&&f in d?d[f]:c}));return c};goog.getMsgWithFallback=function(c,d){return c};goog.exportSymbol=function(c,d,e){goog.exportPath_(c,d,e)};goog.exportProperty=function(c,d,e){c[d]=e};
goog.inherits=function(c,d){function e(){}e.prototype=d.prototype;c.superClass_=d.prototype;c.prototype=new e;c.prototype.constructor=c;c.base=function(c,e,h){for(var k=Array(arguments.length-2),m=2;m<arguments.length;m++)k[m-2]=arguments[m];return d.prototype[e].apply(c,k)}};
goog.base=function(c,d,e){var f=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||goog.DEBUG&&!f)throw Error("arguments.caller not defined.  goog.base() cannot be used with strict mode code. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(f.superClass_){for(var g=Array(arguments.length-1),h=1;h<arguments.length;h++)g[h-1]=arguments[h];return f.superClass_.constructor.apply(c,g)}g=Array(arguments.length-2);for(h=2;h<arguments.length;h++)g[h-2]=arguments[h];for(var h=!1,k=c.constructor;k;k=
k.superClass_&&k.superClass_.constructor)if(k.prototype[d]===f)h=!0;else if(h)return k.prototype[d].apply(c,g);if(c[d]===f)return c.constructor.prototype[d].apply(c,g);throw Error("goog.base called from a method of one name to a method of a different name");};goog.scope=function(c){if(goog.isInModuleLoader_())throw Error("goog.scope is not supported within a goog.module.");c.call(goog.global)};COMPILED||(goog.global.COMPILED=COMPILED);
goog.defineClass=function(c,d){var e=d.constructor,f=d.statics;e&&e!=Object.prototype.constructor||(e=function(){throw Error("cannot instantiate an interface (no constructor defined).");});e=goog.defineClass.createSealingConstructor_(e,c);c&&goog.inherits(e,c);delete d.constructor;delete d.statics;goog.defineClass.applyProperties_(e.prototype,d);null!=f&&(f instanceof Function?f(e):goog.defineClass.applyProperties_(e,f));return e};goog.defineClass.SEAL_CLASS_INSTANCES=goog.DEBUG;
goog.defineClass.createSealingConstructor_=function(c,d){if(!goog.defineClass.SEAL_CLASS_INSTANCES)return c;var e=!goog.defineClass.isUnsealable_(d),f=function(){var d=c.apply(this,arguments)||this;d[goog.UID_PROPERTY_]=d[goog.UID_PROPERTY_];this.constructor===f&&e&&Object.seal instanceof Function&&Object.seal(d);return d};return f};goog.defineClass.isUnsealable_=function(c){return c&&c.prototype&&c.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]};goog.defineClass.OBJECT_PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
goog.defineClass.applyProperties_=function(c,d){for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(c[e]=d[e]);for(var f=0;f<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;f++)e=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[f],Object.prototype.hasOwnProperty.call(d,e)&&(c[e]=d[e])};goog.tagUnsealableClass=function(c){!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES&&(c.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=!0)};goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable";var og={QueueArray:function(){this._array=Array(2048);this._shiftIndex=this._popIndex=1024;this.length=0}};og.QueueArray.prototype.clear=function(){this._array.length=0;this._array=Array(2048);this._shiftIndex=this._popIndex=1024;this.length=0};og.QueueArray.prototype.push=function(c){this.length++;this._array[++this._popIndex]=c};og.QueueArray.prototype.unshift=function(c){this.length++;this._array[this._shiftIndex--]=c};
og.QueueArray.prototype.pop=function(){this.length--;var c=this._array[this._popIndex];this._array[this._popIndex]=null;this._popIndex--;return c};og.Events=function(c){this._eventNames=c?[].concat(c):[];c&&this.registerNames(c);this._counter=0;this._stopPropagation=!1};og.Events.prototype.registerNames=function(c){for(var d=0;d<c.length;d++)this[c[d]]={active:!0,handlers:[]},this._eventNames.push(c[d])};og.Events.prototype._stamp=function(c){return c._openglobus_id?!1:(c._openglobus_id=++this._counter,!0)};og.Events.prototype.on=function(c,d,e){this._stamp(e)&&this[c]&&this[c].handlers.unshift({sender:d||this,callback:e})};
og.Events.prototype.off=function(c,d){if(d._openglobus_id){for(var e=this[c].handlers,f=e.length,g=-1;f--;)if(e[f].callback._openglobus_id==d._openglobus_id){g=f;break}-1!=g&&(e.splice(g,1),d._openglobus_id=null)}};og.Events.prototype.dispatch=function(c,d){if(c&&c.active)for(var e=c.handlers,f=e.length;f--&&!this._stopPropagation;){var g=e[f];g.callback.call(g.sender,d)}this._stopPropagation=!1};og.Events.prototype.stopPropagation=function(){this._stopPropagation=!0};
og.Events.prototype.clear=function(){for(var c=0;c<this._eventNames.length;c++){var d=this[this._eventNames[c]];d.handlers.length=0;d.handlers=[]}this._eventNames.length=0;this._eventNames=[]};og.ajax={ReadyState:{Uninitialized:0,Loading:1,Loaded:2,Interactive:3,Complete:4},Status:{OK:200,Created:201,Accepted:202,NoContent:204,BadRequest:400,Forbidden:403,NotFound:404,Gone:410,ServerError:500},Method:{Get:"GET",Post:"POST"},Asynchronous:!0,Synchronous:!1};og.ajax.Xhr=function(c){this.abort=function(){c.aborted=!0;c.abort()}};og.ajax.defaultParams={type:og.ajax.Method.Get,async:og.ajax.Asynchronous,data:null,sender:null,responseType:"text"};og.ajax.createXMLHttp=function(){return new XMLHttpRequest};
og.ajax.request=function(c,d){d=d||{};var e={},f;for(f in og.ajax.defaultParams)e[f]=og.ajax.defaultParams[f];for(f in d)e[f]=d[f];var g=og.ajax.createXMLHttp(),h=new og.ajax.Xhr(g);g.open(e.type,c,e.async);e.type===og.ajax.Method.Post&&g.setRequestHeader("Content-Type","application/x-www-form-urlencoded");e.async&&(g.responseType=e.responseType);g.overrideMimeType("text/plain");g.onreadystatechange=function(){g.readyState===og.ajax.ReadyState.Complete&&(g.status===og.ajax.Status.OK?d.success&&d.success.call(d.sender||
h,g.response):g.aborted?d.abort&&d.abort.call(d.sender||h,g.response,g.status):d.error&&d.error.call(d.sender||h,g.response,g.status))};g.send(d.data||og.ajax.defaultParams.data);return h};og.mercator={};og.mercator.POLE=2.003750834E7;og.mercator.POLE_DOUBLE=2*og.mercator.POLE;og.mercator.ONE_BY_POLE_DOUBLE=1/og.mercator.POLE_DOUBLE;og.mercator.forward_lon=function(c){return c*og.mercator.POLE/180};og.mercator.forward_lat=function(c){return Math.log(Math.tan((90+c)*Math.PI/360))/Math.PI*og.mercator.POLE};og.mercator.inverse_lon=function(c){return 180*c/og.mercator.POLE};
og.mercator.inverse_lat=function(c){return 180/Math.PI*(2*Math.atan(Math.exp(c/og.mercator.POLE*Math.PI))-Math.PI/2)};og.mercator.getTileX=function(c,d){return Math.floor((c+180)/360*Math.pow(2,d))};og.mercator.getTileY=function(c,d){return Math.floor((1-Math.log(Math.tan(c*Math.PI/180)+1/Math.cos(c*Math.PI/180))/Math.PI)/2*Math.pow(2,d))};og.mercator.forwardArray=function(c){for(var d=[],e=0;e<c.length;e++)d.push(c[e].forwardMercator());return d};og.mercator.MAX_LAT=og.mercator.inverse_lat(og.mercator.POLE);
og.mercator.MIN_LAT=-og.mercator.MAX_LAT;og.LonLat=function(c,d,e){this.lon=c||0;this.lat=d||0;this.height=e||0};og.lonLat=function(c,d,e){return new og.LonLat(c,d,e)};og.lonLatArray=function(c){for(var d=[],e=0;e<c.length;e++){var f=c[e];d[e]=new og.LonLat(f[0],f[1],f[2])}return d};og.LonLat.createFromArray=function(c){return new og.LonLat(c[0],c[1],c[2])};og.LonLat.forwardMercator=function(c,d,e){return new og.LonLat(c*og.mercator.POLE/180,Math.log(Math.tan((90+d)*Math.PI/360))/Math.PI*og.mercator.POLE,e)};
og.LonLat.inverseMercator=function(c,d,e){return new og.LonLat(180*c/og.mercator.POLE,180/Math.PI*(2*Math.atan(Math.exp(d/og.mercator.POLE*Math.PI))-Math.PI/2),e)};og.LonLat.prototype.set=function(c,d,e){this.lon=c||0;this.lat=d||0;this.height=e||0;return this};og.LonLat.prototype.clone=function(){return new og.LonLat(this.lon,this.lat,this.height)};og.LonLat.prototype.forwardMercator=function(){return og.LonLat.forwardMercator(this.lon,this.lat,this.height)};
og.LonLat.prototype.forwardMercatorEPS01=function(){var c=this.lat;89.9<c?c=89.9:-89.9>c&&(c=-89.9);return new og.LonLat(this.lon*og.mercator.POLE/180,Math.log(Math.tan((90+c)*Math.PI/360))/Math.PI*og.mercator.POLE)};og.LonLat.prototype.inverseMercator=function(){return og.LonLat.inverseMercator(this.lon,this.lat,this.height)};og.LonLat.prototype.equal=function(c){return c.height?this.lon==c.lon&&this.lat==c.lat&&this.height==c.height:this.lon==c.lon&&this.lat==c.lat};og.math={};og.math.TWO_PI=2*Math.PI;og.math.PI_TWO=Math.PI/2;og.math.X=0;og.math.Y=1;og.math.Z=2;og.math.W=3;og.math.LOG2=Math.log(2);og.math.MAX32=2147483647;og.math.MAX=549755748352;og.math.MIN=-og.math.MAX;og.math.RADIANS=Math.PI/180;og.math.DEGREES=180/Math.PI;og.math.DEGREES_DOUBLE=2*og.math.DEGREES;og.math.RADIANS_HALF=.5*og.math.RADIANS;og.math.ARCSECONDS_TO_RADIANS=4.84813681109536E-6;og.math.RADIANS_TO_HOURS=3.819718634205488;og.math.HOURS_TO_RADIANS=.26179938779914946;
og.math.HOURS_TO_DEGREES=15;og.math.DEGREES_TO_HOURS=1/15;og.math.SQRT_HALF=Math.sqrt(.5);og.math.EPSILON1=.1;og.math.EPSILON2=.01;og.math.EPSILON3=.001;og.math.EPSILON4=1E-4;og.math.EPSILON5=1E-5;og.math.EPSILON6=1E-6;og.math.EPSILON7=1E-7;og.math.EPSILON8=1E-8;og.math.EPSILON9=1E-9;og.math.EPSILON10=1E-10;og.math.EPSILON11=1E-11;og.math.EPSILON12=1E-12;og.math.EPSILON13=1E-13;og.math.EPSILON14=1E-14;og.math.EPSILON15=1E-15;og.math.EPSILON16=1E-16;og.math.EPSILON17=1E-17;og.math.EPSILON18=1E-18;
og.math.EPSILON19=1E-19;og.math.EPSILON20=1E-20;og.math.log=function(c,d){return Math.log(c)/Math.log(d)};og.math.clamp=function(c,d,e){return Math.max(d,Math.min(c,e))};og.math.DEG2RAD=function(c){return c*og.math.RADIANS};og.math.RAD2DEG=function(c){return c*og.math.DEGREES};og.math.isPowerOfTwo=function(c){return 0==(c&c-1)};og.math.nextHighestPowerOfTwo=function(c){--c;for(var d=1;32>d;d<<=1)c|=c>>d;return c+1};og.math.randomi=function(c,d){return Math.floor(Math.random()*(d-c))+c};
og.math.random=function(c,d){return Math.random()*(d-c)+c};og.math.degToDec=function(c,d,e,f){return f?c+d/60+e/3600:-c-d/60-e/3600};og.math.mod=function(c,d){return(c%d+d)%d};og.math.zeroTwoPI=function(c){var d=og.math.mod(c,og.math.TWO_PI);return Math.abs(d)<og.math.EPSILON14&&Math.abs(c)>og.math.EPSILON14?og.math.TWO_PI:d};og.math.step=function(c,d){return d<c?0:1};og.math.frac=function(c){return c-Math.floor(c)};og.math.log2=function(c){return Math.log(c)/og.math.LOG2};
og.math.exp2=function(c){return Math.pow(2,c)};og.math.pow2i=function(c){return 2<<c-1};og.math.slice=function(c,d,e){return c*(d-e)};og.math.lerp=function(c,d,e){return e+c*(d-e)};og.math.bezier=function(c,d,e,f,g){var h=1-c,k=c*c,m=h*h,l=k*c;return d.scaleTo(m*h).addA(e.scaleTo(3*m*c)).addA(f.scaleTo(3*h*k)).addA(g.scaleTo(l))};og.math.rev=function(c){return c-360*Math.floor(c/360)};og.math.norm_lon=function(c){return Math.asin(Math.sin(c*og.math.RADIANS_HALF))*og.math.DEGREES_DOUBLE};
og.math.negativePItoPI=function(c){return og.math.zeroTwoPI(c+Math.PI)-Math.PI};og.math.solve_iteration_fixed=function(c,d,e){var f;f=d;for(d=0;d<e;d++)f=c(f);return f};og.math.solve_iteration=function(c,d,e,f){f=f||50;for(var g=d,h=0;h<f&&!(d=g,g=c(d),Math.abs(g-d)<e);h++);return g};og.Extent=function(c,d){this.southWest=c||new og.LonLat;this.northEast=d||new og.LonLat};og.Extent.FULL_MERC=new og.Extent(og.LonLat.SW_MERC,og.LonLat.NE_MERC);og.Extent.NORTH_POLE_DEG=new og.Extent(og.LonLat.NW_MERC_DEG,new og.LonLat(180,90));og.Extent.SOUTH_POLE_DEG=new og.Extent(new og.LonLat(-180,-90),og.LonLat.SE_MERC_DEG);og.extent=function(c,d){return new og.Extent(c,d)};og.Extent.createFromArray=function(c){return new og.Extent(new og.LonLat(c[0],c[1]),new og.LonLat(c[2],c[3]))};
og.Extent.createByCoordinates=function(c){for(var d=og.math.MAX,e=og.math.MIN,f=og.math.MAX,g=og.math.MIN,h=0;h<c.length;h++){var k=c[h];k.lon<d&&(d=k.lon);k.lon>e&&(e=k.lon);k.lat<f&&(f=k.lat);k.lat>g&&(g=k.lat)}return new og.Extent(new og.LonLat(d,f),new og.LonLat(e,g))};og.Extent.fromTile=function(c,d,e){var f=360/Math.pow(2,e);e=180/Math.pow(2,e);c=-180+c*f;d=90-d*e;f=c+f;return new og.Extent(new og.LonLat(c,d-e),new og.LonLat(f,d))};
og.Extent.prototype.setByCoordinates=function(c){for(var d=og.math.MAX,e=og.math.MIN,f=og.math.MAX,g=og.math.MIN,h=0;h<c.length;h++){var k=c[h];k.lon<d&&(d=k.lon);k.lon>e&&(e=k.lon);k.lat<f&&(f=k.lat);k.lat>g&&(g=k.lat)}this.southWest.lon=d;this.southWest.lat=f;this.northEast.lon=e;this.northEast.lat=g;return this};og.Extent.prototype.isInside=function(c){var d=this.southWest,e=this.northEast;return c.lon>=d.lon&&c.lon<=e.lon&&c.lat>=d.lat&&c.lat<=e.lat};
og.Extent.prototype.overlaps=function(c){var d=this.southWest,e=this.northEast;return d.lon<c.northEast.lon&&e.lon>c.southWest.lon&&d.lat<c.northEast.lat&&e.lat>c.southWest.lat};og.Extent.prototype.getWidth=function(){return this.northEast.lon-this.southWest.lon};og.Extent.prototype.getHeight=function(){return this.northEast.lat-this.southWest.lat};og.Extent.prototype.clone=function(){return new og.Extent(this.southWest.clone(),this.northEast.clone())};
og.Extent.prototype.getCenter=function(){var c=this.southWest,d=this.northEast;return new og.LonLat(c.lon+.5*(d.lon-c.lon),c.lat+.5*(d.lat-c.lat))};og.Extent.prototype.getNorthWest=function(){return new og.LonLat(this.southWest.lon,this.northEast.lat)};og.Extent.prototype.getNorthEast=function(){return new og.LonLat(this.northEast.lon,this.northEast.lat)};og.Extent.prototype.getSouthWest=function(){return new og.LonLat(this.southWest.lon,this.southWest.lat)};
og.Extent.prototype.getSouthEast=function(){return new og.LonLat(this.northEast.lon,this.southWest.lat)};og.Extent.prototype.getNorth=function(){return this.northEast.lat};og.Extent.prototype.getEast=function(){return this.northEast.lon};og.Extent.prototype.getWest=function(){return this.southWest.lon};og.Extent.prototype.getSouth=function(){return this.southWest.lat};
og.Extent.prototype.equals=function(c){return this.southWest.lon==c.southWest.lon&&this.southWest.lat==c.southWest.lat&&this.northEast.lon==c.northEast.lon&&this.northEast.lat==c.northEast.lat};og.Extent.prototype.forwardMercator=function(){return new og.Extent(this.southWest.forwardMercator(),this.northEast.forwardMercator())};og.Extent.prototype.inverseMercator=function(){return new og.Extent(this.southWest.inverseMercator(),this.northEast.inverseMercator())};
og.Extent.prototype.getCartesianBounds=function(c){for(var d=og.math.MAX,e=og.math.MIN,f=og.math.MAX,g=og.math.MIN,h=og.math.MAX,k=og.math.MIN,m=[new og.LonLat(this.southWest.lon,this.southWest.lat),new og.LonLat(this.southWest.lon,this.northEast.lat),new og.LonLat(this.northEast.lon,this.northEast.lat),new og.LonLat(this.northEast.lon,this.southWest.lat)],l=0;l<m.length;l++){var n=c.lonLatToCartesian(m[l]),p=n.x,q=n.y,n=n.z;p<d&&(d=p);p>e&&(e=p);q<f&&(f=q);q>g&&(g=q);n<h&&(h=n);n>k&&(k=n)}return[d,
e,f,g,h,k]};og.Extent.prototype.toString=function(){return"["+this.southWest.lon+", "+this.southWest.lat+", "+this.northEast.lon+", "+this.northEast.lat+"]"};og.math.Vector3=function(c,d,e){this.x=c||0;this.y=d||0;this.z=e||0};og.math.Vector3.UP=new og.math.Vector3(0,1,0);og.math.Vector3.DOWN=new og.math.Vector3(0,-1,0);og.math.Vector3.RIGHT=new og.math.Vector3(1,0,0);og.math.Vector3.LEFT=new og.math.Vector3(-1,0,0);og.math.Vector3.FORWARD=new og.math.Vector3(0,0,-1);og.math.Vector3.BACKWARD=new og.math.Vector3(0,0,1);og.math.Vector3.ZERO=new og.math.Vector3;og.math.vector3=function(c,d,e){return new og.math.Vector3(c,d,e)};
og.math.Vector3.fromVec=function(c){return new og.math.Vector3(c[0],c[1],c[2])};og.math.Vector3.angle=function(c,d){return Math.acos(c.dot(d)/Math.sqrt(c.length2()*d.length2()))};og.math.Vector3.lerp=function(c,d,e){return new og.math.Vector3(c.x+(d.x-c.x)*e,c.y+(d.y-c.y)*e,c.z+(d.z-c.z)*e)};og.math.Vector3.add=function(c,d){var e=new og.math.Vector3(c.x,c.y,c.z);e.addA(d);return e};og.math.Vector3.sub=function(c,d){var e=new og.math.Vector3(c.x,c.y,c.z);e.subA(d);return e};
og.math.Vector3.scale=function(c,d){var e=new og.math.Vector3(c.x,c.y,c.z);e.scale(d);return e};og.math.Vector3.mul=function(c,d){var e=new og.math.Vector3(c.x,c.y,c.z);e.mulA(d);return e};og.math.Vector3.noncollinear=function(c,d){return c.y*d.z-c.z*d.y||c.z*d.x-c.x*d.z||c.x*d.y-c.y*d.z};og.math.Vector3.proj_b_to_plane=function(c,d,e){c=c.sub(d.scaleTo(d.dot(c)/d.dot(d)));return e&&c.isZero()?new og.math.Vector3(e.x,e.y,e.z):c};
og.math.Vector3.proj_b_to_a=function(c,d){return d.scaleTo(d.dot(c)/d.dot(d))};og.math.Vector3.orthoNormalize=function(c,d){c=c.normal();c.scale(d.dot(c));return d.subA(c).normalize()};og.math.Vector3.div=function(c,d){var e=new og.math.Vector3(c.x,c.y,c.z);e.divA(d);return e};og.math.Vector3.prototype.toVector4=function(){return new og.math.Vector4(this.x,this.y,this.z,1)};og.math.Vector3.prototype.clone=function(){return new og.math.Vector3(this.x,this.y,this.z)};
og.math.Vector3.prototype.toString=function(){return"("+this.x+","+this.y+","+this.z+")"};og.math.Vector3.prototype.isZero=function(){return!(this.x||this.y||this.z)};og.math.Vector3.prototype.equal=function(c){return this.x===c.x&&this.y===c.y&&this.z===c.z};og.math.Vector3.prototype.copy=function(c){this.x=c.x;this.y=c.y;this.z=c.z;return this};og.math.Vector3.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};
og.math.Vector3.prototype.length2=function(){return this.x*this.x+this.y*this.y+this.z*this.z};og.math.Vector3.prototype.getQuaternion=function(){return new og.math.Quaternion(this.x,this.y,this.z)};og.math.Vector3.prototype.addA=function(c){this.x+=c.x;this.y+=c.y;this.z+=c.z;return this};og.math.Vector3.prototype.add=function(c){return new og.math.Vector3(this.x+c.x,this.y+c.y,this.z+c.z)};og.math.Vector3.prototype.subA=function(c){this.x-=c.x;this.y-=c.y;this.z-=c.z;return this};
og.math.Vector3.prototype.sub=function(c){return new og.math.Vector3(this.x-c.x,this.y-c.y,this.z-c.z)};og.math.Vector3.prototype.scale=function(c){this.x*=c;this.y*=c;this.z*=c;return this};og.math.Vector3.prototype.scaleTo=function(c){return new og.math.Vector3(this.x*c,this.y*c,this.z*c)};og.math.Vector3.prototype.mulA=function(c){this.x*=c.x;this.y*=c.y;this.z*=c.z;return this};og.math.Vector3.prototype.mul=function(c){return new og.math.Vector3(this.x*c.x,this.y*c.y,this.z*c.z)};
og.math.Vector3.prototype.divA=function(c){this.x/=c.x;this.y/=c.y;this.z/=c.z;return this};og.math.Vector3.prototype.div=function(c){return new og.math.Vector3(this.x/c.x,this.y/c.y,this.z/c.z)};og.math.Vector3.prototype.dot=function(c){return c.x*this.x+c.y*this.y+c.z*this.z};og.math.Vector3.prototype.dotArr=function(c){return c[0]*this.x+c[1]*this.y+c[2]*this.z};
og.math.Vector3.prototype.cross=function(c){var d=new og.math.Vector3;d.set(this.y*c.z-this.z*c.y,this.z*c.x-this.x*c.z,this.x*c.y-this.y*c.x);return d};og.math.Vector3.prototype.clear=function(){this.x=this.y=this.z=0;return this};og.math.Vector3.prototype.normal=function(){var c=new og.math.Vector3;c.copy(this);var d=1/c.length();c.x*=d;c.y*=d;c.z*=d;return c};og.math.Vector3.prototype.normalize=function(){var c=1/this.length();this.x*=c;this.y*=c;this.z*=c;return this};
og.math.Vector3.prototype.toVec=function(){return[this.x,this.y,this.z]};og.math.Vector3.prototype.distance=function(c){return og.math.Vector3.sub(this,c).length()};og.math.Vector3.prototype.set=function(c,d,e){this.x=c;this.y=d;this.z=e;return this};og.math.Vector3.prototype.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};og.math.Vector3.prototype.negateTo=function(){return new og.math.Vector3(-this.x,-this.y,-this.z)};
og.math.Vector3.prototype.projToRay=function(c,d){var e=og.math.Vector3.proj_b_to_a(og.math.Vector3.sub(this,c),d);e.addA(c);return e};og.math.Vector3.prototype.angle=function(c){return og.math.Vector3.angle(this,c)};og.math.Vector3.prototype.lerp=function(c,d){return new og.math.Vector3(this.x+(c.x-this.x)*d,this.y+(c.y-this.y)*d,this.z+(c.z-this.z)*d)};og.math.Vector3.prototype.smerp=function(c,d){var e=1-d;return new og.math.Vector3(this.x*d+c.x*e,this.y*d+c.y*e,this.z*d+c.z*e)};
og.math.Vector3.LERP_DELTA=1E-6;og.math.Vector3.prototype.slerp=function(c,d){var e=new og.math.Vector3;if(0>=d)e.copy(this);else if(1<=d)e.copy(c);else{var f,g,e=this.dot(c);1-e>og.math.Vector3.LERP_DELTA?(f=Math.acos(e),g=Math.sin(f),e=Math.sin((1-d)*f)/g,f=Math.sin(d*f)/g):(e=1-d,f=d);return og.math.Vector3.add(this.scaleTo(e),c.scale(f))}};og.math.Vector2=function(c,d){this.x=c||0;this.y=d||0};og.math.vector2=function(c,d){return new og.math.Vector2(c,d)};og.math.Vector2.UP=new og.math.Vector2(0,1);og.math.Vector2.DOWN=new og.math.Vector2(0,-1);og.math.Vector2.RIGHT=new og.math.Vector2(1,0);og.math.Vector2.LEFT=new og.math.Vector2(-1,0);og.math.Vector2.ZERO=new og.math.Vector2;og.math.Vector2.add=function(c,d){var e=new og.math.Vector2(c.x,c.y);e.addA(d);return e};
og.math.Vector2.sub=function(c,d){var e=new og.math.Vector2(c.x,c.y);e.subA(d);return e};og.math.Vector2.scale=function(c,d){var e=new og.math.Vector2(c.x,c.y);e.scale(d);return e};og.math.Vector2.mul=function(c,d){var e=new og.math.Vector2(c.x,c.y);e.mulA(d);return e};og.math.Vector2.div=function(c,d){var e=new og.math.Vector2(c.x,c.y);e.divA(d);return e};og.math.Vector2.proj_b_to_a=function(c,d){return d.scaleTo(d.dot(c)/d.dot(d))};
og.math.Vector2.angle=function(c,d){return Math.acos(c.dot(d)/Math.sqrt(c.length2()*d.length2()))};og.math.Vector2.orthoNormalize=function(c,d){c=c.norm();c.scale(d.dot(c));return d.sub(c).normalize()};og.math.Vector2.prototype.toVector3=function(){return new og.math.Vector3(this.x,this.y,0)};og.math.Vector2.prototype.clone=function(){return new og.math.Vector2(this.x,this.y)};og.math.Vector2.prototype.equal=function(c){return this.x===c.x&&this.y===c.y};
og.math.Vector2.prototype.copy=function(c){this.x=c.x;this.y=c.y;return this};og.math.Vector2.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};og.math.Vector2.prototype.length2=function(){return this.x*this.x+this.y*this.y};og.math.Vector2.prototype.addA=function(c){this.x+=c.x;this.y+=c.y;return this};og.math.Vector2.prototype.subA=function(c){this.x-=c.x;this.y-=c.y;return this};og.math.Vector2.prototype.scale=function(c){this.x*=c;this.y*=c;return this};
og.math.Vector2.prototype.scaleTo=function(c){return new og.math.Vector2(this.x*c,this.y*c)};og.math.Vector2.prototype.mulA=function(c){this.x*=c.x;this.y*=c.y;return this};og.math.Vector2.prototype.divA=function(c){this.x/=c.x;this.y/=c.y;return this};og.math.Vector2.prototype.dot=function(c){return c.x*this.x+c.y*this.y};og.math.Vector2.prototype.dotArr=function(c){return c[0]*this.x+c[1]*this.y};og.math.Vector2.prototype.cross=function(c){return this.x*c.y-this.y*c.x};
og.math.Vector2.prototype.clear=function(){this.x=this.y=0;return this};og.math.Vector2.prototype.normal=function(){var c=new og.math.Vector2;c.copy(this);var d=1/c.length();c.x*=d;c.y*=d;return c};og.math.Vector2.prototype.normalize=function(){var c=1/this.length();this.x*=c;this.y*=c;return this};og.math.Vector2.prototype.toVec=function(){var c=new og.math.GLArray(2);c[0]=this.x;c[1]=this.y;return c};og.math.Vector2.prototype.distance=function(c){return og.math.Vector2.sub(this,c).length()};
og.math.Vector2.prototype.set=function(c,d){this.x=c;this.y=d;return this};og.math.Vector2.prototype.negate=function(){this.x=-this.x;this.y=-this.y;return this};og.math.Vector2.prototype.negateTo=function(){return new og.math.Vector2(-this.x,-this.y)};og.math.Vector2.prototype.projToRay=function(c,d){var e=og.math.Vector2.proj_b_to_a(og.math.Vector2.sub(this,c),d);e.add(c);return e};og.math.Vector2.prototype.angle=function(c){return og.math.Vector2.angle(this,c)};
og.math.Vector2.prototype.lerp=function(c,d,e){var f=og.math.Vector2.clone(this);0>=e?f.copy(c):1<=e?f.copy(d):f=og.math.Vector2.add(c,og.math.Vector2.sub(d,c).scale(e));return f};og.math.Vector2.LERP_DELTA=1E-6;
og.math.Vector2.prototype.slerp=function(c,d){var e=new og.math.Vector2;if(0>=d)e.copy(this);else if(1<=d)e.copy(c);else{var f,g,e=this.dot(c);1-e>Vector2.LERP_DELTA?(f=Math.acos(e),g=Math.sin(f),e=Math.sin((1-d)*f)/g,f=Math.sin(d*f)/g):(e=1-d,f=d);return og.math.Vector2.add(this.scale(e),c.scale(f))}};og.math.Vector4=function(c,d,e,f){this.x=c||0;this.y=d||0;this.z=e||0;this.w=f||0};og.math.Vector4.identity=new og.math.Vector4(0,0,0,1);og.math.vector4=function(c,d,e,f){return new og.math.Vector4(c,d,e,f)};og.math.Vector4.fromVec=function(c){return new og.math.Vector4(c[0],c[1],c[2],c[3])};og.math.Vector4.prototype.toVector3=function(){return new og.math.Vector3(this.x,this.y,this.z)};og.math.Vector4.prototype.clone=function(c){return new og.math.Vector4(this.x,this.y,this.z,this.w)};
og.math.Vector4.prototype.equal=function(c){return this.x===c.x&&this.y===c.y&&this.z===c.z&&this.w===c.w};og.math.Vector4.prototype.copy=function(c){this.x=c.x;this.y=c.y;this.z=c.z;this.w=c.w;return this};og.math.Vector4.prototype.toVec=function(){var c=new og.math.GLArray(4);c[0]=this.x;c[1]=this.y;c[2]=this.z;c[3]=this.w;return c};og.math.Vector4.prototype.set=function(c,d,e,f){this.x=c;this.y=d;this.z=e;this.w=f;return this};
og.math.Vector4.prototype.addA=function(c){this.x+=c.x;this.y+=c.y;this.z+=c.z;this.w+=c.w;return this};og.math.Vector4.prototype.subA=function(c){this.x-=c.x;this.y-=c.y;this.z-=c.z;this.w-=c.w;return this};og.math.Vector4.prototype.scale=function(c){this.x*=c;this.y*=c;this.z*=c;this.w*=c;return this};og.math.Vector4.prototype.affinity=function(){var c=1/this.w;this.x*=c;this.y*=c;this.z*=c;this.w=1;return this};
og.math.Vector4.prototype.scaleTo=function(c){return new og.math.Vector4(this.x*c,this.y*c,this.z*c,this.w*c)};og.math.Vector4.prototype.getStep=function(c){return new og.math.Vector4(this.x<c?0:1,this.y<c?0:1,this.z<c?0:1,this.w<c?0:1)};og.math.Vector4.prototype.getFrac=function(c){return new og.math.Vector4(og.math.frac(c.x),og.math.frac(c.y),og.math.frac(c.z),og.math.frac(c.w))};og.utils={};og.utils.readTextFile=function(c){var d="";og.ajax.request(c,{async:!1,success:function(c){d=c}});return d};
og.utils.htmlColorToRgba=function(c,d){if("#"==c[0]){var e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(c,d,e,k){return d+d+e+e+k+k}),e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return new og.math.Vector4(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),void 0==d?1:d)}void 0==d&&(d=1);e=c.split(",");return new og.math.Vector4(parseInt(e[0].split("(")[1]),parseInt(e[1]),parseInt(e[2]),void 0!=parseFloat(e[3])?parseFloat(e[3]):d)};
og.utils.htmlColorToRgb=function(c){if("#"==c[0]){var d=d.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(c,d,g,h){return d+d+g+g+h+h});c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(d);return new og.math.Vector4(parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16))}c=c.split(",");return new og.math.Vector3(parseInt(c[0].split("(")[1]),parseInt(c[1]),parseInt(c[2]))};og.utils.stringTemplate=function(c,d){return c.replace(/{[^{}]+}/g,function(c){return d[c.replace(/[{}]+/g,"")]||""})};
function print2d(c,d,e,f){c=document.getElementById(c);c.innerHTML=d;c.style.left=e;c.style.top=f}og.utils.defaultString=function(c,d){return c?c.trim().toLowerCase():d};og.utils.createVector3=function(c,d){if(c){if(c instanceof og.math.Vector3)return c.clone();if(c instanceof Array)return og.math.Vector3.fromVec(c)}else if(d)return d;return new og.math.Vector3};
og.utils.createVector4=function(c,d){if(c){if(c instanceof og.math.Vector4)return c.clone();if(c instanceof Array)return og.math.Vector4.fromVec(c)}else if(d)return d;return new og.math.Vector4};og.utils.createColorRGBA=function(c,d){if(c){if(c instanceof String)return og.utils.htmlColorToRgba(c);if(c instanceof Array)return new og.math.Vector4.fromVec(c);if(c instanceof og.math.Vector4)return c.clone()}else if(d)return d;return new og.math.Vector4(1,1,1,1)};
og.utils.createColorRGB=function(c,d){if(c){if(c instanceof String)return og.utils.htmlColorToRgb(c);if(c instanceof Array)return new og.math.Vector3.fromVec(c);if(c instanceof og.math.Vector3)return c.clone()}else if(d)return d;return new og.math.Vector3(1,1,1)};og.utils.createExtent=function(c,d){if(c){if(c instanceof Array)return new og.Extent(og.utils.createLonLat(c[0]),og.utils.createLonLat(c[1]));if(c instanceof og.Extent)return c.clone()}else if(d)return d;return new og.Extent};
og.utils.createLonLat=function(c,d){if(c){if(c instanceof Array)return new og.LonLat(c[0],c[1],c[2]);if(c instanceof og.LonLat)return c.clone()}else if(d)return d;return og.LonLat()};og.utils.binarySearch=function(c,d,e){for(var f=0,g=c.length-1;f<=g;){var h=g+f>>1,k=e(d,c[h]);if(0<k)f=h+1;else if(0>k)g=h-1;else return h}return-f-1};og.utils.binaryInsert=function(c,d,e){e=og.utils.binarySearch(c,d,e);0>e&&(e=~e);c.splice(e,0,d);return e};
og.utils.getLinesIntersection2v=function(c,d,e,f,g){var h=d.sub(c),k=f.sub(e),m=-h.y,l=+h.x,n=-(m*c.x+l*c.y),p=-k.y,q=+k.x,r=-(p*e.x+q*e.y),k=p*c.x+q*c.y+r;d=p*d.x+q*d.y+r;e=m*e.x+l*e.y+n;f=m*f.x+l*f.y+n;if(g&&(0<k*d||0<e*f))return null;g=k/(k-d);return new og.math.Vector2(c.x+g*h.x,c.y+g*h.y)};
og.utils.getLinesIntersectionLonLat=function(c,d,e,f,g){var h=new og.LonLat(d.lon-c.lon,d.lat-c.lat),k=new og.LonLat(f.lon-e.lon,f.lat-e.lat),m=-h.lat,l=+h.lon,n=-(m*c.lon+l*c.lat),p=-k.lat,q=+k.lon,r=-(p*e.lon+q*e.lat),k=p*c.lon+q*c.lat+r;d=p*d.lon+q*d.lat+r;e=m*e.lon+l*e.lat+n;f=m*f.lon+l*f.lat+n;if(g&&(0<k*d||0<e*f))return null;g=k/(k-d);return new og.LonLat(c.lon+g*h.lon,c.lat+g*h.lat)};og.layer={};og.layer.MAXIMUM_OVERLAYS=8;
og.layer.Layer=function(c,d){d=d||{};this.name=c||"noname";this.displayInLayerSwitcher=void 0!=d.displayInLayerSwitcher?d.displayInLayerSwitcher:!0;this.opacity=d.opacity||1;this.transparentColor=d.transparentColor||[-1,-1,-1];this.minZoom=d.minZoom||0;this.maxZoom=d.maxZoom||50;this.ambient=og.utils.createColorRGB(d.ambient,new og.math.Vector3(.1,.1,.21));this.diffuse=og.utils.createColorRGB(d.diffuse,new og.math.Vector3(1,1,1));this.specular=og.utils.createColorRGB(d.specular,new og.math.Vector3(2.5E-4,
1.5E-4,1E-4));this.shininess=d.shininess||100;this._planet=null;this._id=og.layer.__layersCounter++;this._attribution=d.attribution||"";this._zIndex=d.zIndex||0;this._isBaseLayer=d.isBaseLayer||!1;this._visibility=void 0!=d.visibility?d.visibility:!0;this._height=d.height||0;this._extentMerc=this._extent=null;this.setExtent(og.utils.createExtent(d.extent,new og.Extent(new og.LonLat(-180,-90),new og.LonLat(180,90))));this._pickingColor=new og.math.Vector3;this.events=new og.Events;this.events.registerNames(og.layer.Layer.EVENT_NAMES)};
og.layer.Layer.EVENT_NAMES="visibilitychange add remove mousemove mouseenter mouseleave mouselbuttonclick mouserbuttonclick mousembuttonclick mouselbuttondoubleclick mouserbuttondoubleclick mousembuttondoubleclick mouselbuttonup mouserbuttonup mousembuttonup mouselbuttondown mouserbuttondown mousembuttondown mouselbuttonhold mouserbuttonhold mousembuttonhold mousewheel touchmove touchstart touchend doubletouch touchleave touchenter".split(" ");og.layer.__layersCounter=0;
og.layer.Layer.prototype.getID=function(){return this._id};og.layer.Layer.prototype.isEqual=function(c){return c._id==this._id};og.layer.Layer.prototype._assignPlanet=function(c){c.layers.push(this);this._planet=c;this.events.on("visibilitychange",c,c._onLayerVisibilityChanged);this._isBaseLayer&&this._visibility&&c.setBaseLayer(this);c.events.dispatch(c.events.layeradd,this);this.events.dispatch(this.events.add,c);c.updateVisibleLayers();c.renderer.assignPickingColor(this)};
og.layer.Layer.prototype.addTo=function(c){this._assignPlanet(c)};og.layer.Layer.prototype.remove=function(){var c=this._planet;if(c)for(var d=this._id,e=0;e<c.layers.length;e++)if(c.layers[e]._id==d)return c.renderer.clearPickingColor(this),c.layers.splice(e,1),c.updateVisibleLayers(),this.clear(),c.events.dispatch(c.events.layerremove,this),this.events.dispatch(this.events.remove,c),this._planet=null,this};og.layer.Layer.prototype.clear=function(){this._planet&&this._planet._clearLayerMaterial(this)};
og.layer.Layer.prototype.setAttribution=function(c){this._attribution=c;this._planet.updateAttributionsList()};og.layer.Layer.prototype.setHeight=function(c){this._height=c;this._planet.updateVisibleLayers()};og.layer.Layer.prototype.getHeight=function(){return this._height};og.layer.Layer.prototype.setZIndex=function(c){this._zIndex=c;this._planet.updateVisibleLayers()};og.layer.Layer.prototype.getZIndex=function(){return this._zIndex};og.layer.Layer.prototype.isBaseLayer=function(){return this._isBaseLayer};
og.layer.Layer.prototype.setBaseLayer=function(c){this._isBaseLayer=c;this._planet&&!c&&this.isEqual(this._planet.baseLayer)&&(this._planet.baseLayer=null);this._planet.updateVisibleLayers()};og.layer.Layer.prototype.setVisibility=function(c){c!=this._visibility&&(this._visibility=c,this._isBaseLayer&&c&&this._planet.setBaseLayer(this),this._planet.updateVisibleLayers(),this.events.dispatch(this.events.visibilitychange,this))};og.layer.Layer.prototype.getVisibility=function(){return this._visibility};
og.layer.Layer.prototype.setExtent=function(c){var d=c.southWest.clone(),e=c.northEast.clone();d.lat<og.mercator.MIN_LAT&&(d.lat=og.mercator.MIN_LAT);e.lat>og.mercator.MAX_LAT&&(e.lat=og.mercator.MAX_LAT);this._extent=c.clone();this._extentMerc=new og.Extent(d.forwardMercator(),e.forwardMercator());this._correctFullExtent()};og.layer.Layer.prototype.getExtent=function(){return this._extent};
og.layer.Layer.prototype._correctFullExtent=function(){var c=this._extent,d=this._extentMerc,e=og.mercator.POLE+5E4,f=og.mercator.POLE+5E4;90===c.northEast.lat&&(d.northEast.lat=f);180===c.northEast.lon&&(d.northEast.lon=e);-90===c.southWest.lat&&(d.southWest.lat=-f);-180===c.southWest.lon&&(d.southWest.lon=-e)};og.proj={};og.Units={};og.proj.Units={DEGREES:"degrees",FEET:"ft",METERS:"m",KILOMETERS:"km"};og.proj.METERS_PER_UNIT={};og.proj.METERS_PER_UNIT[og.proj.Units.FEET]=.3048;og.proj.METERS_PER_UNIT[og.proj.Units.METERS]=1;og.proj.METERS_PER_UNIT[og.proj.Units.KILOMETERS]=1E3;og.proj.Projection=function(c){this.code=c.code;this.units=c.units;this.id=og.proj.Projection._counter++};og.proj.Projection.prototype.equal=function(c){return c.id==this.id};og.proj.Projection._counter=0;og.proj.EPSG3857=new og.proj.Projection({code:"epsg:3857",units:og.Units.METERS});og.inheritance={};og.inheritance.extend=function(c,d){var e=function(){};e.prototype=d.prototype;c.prototype=new e;c.prototype.constructor=c;c.superclass=d.prototype;c.superclass.constructor=d};og.inheritance.base=function(c){arguments.callee.caller.superclass.constructor.apply(c,Array.prototype.slice.call(arguments,1))};og.quadTree={};og.quadTree.NW=0;og.quadTree.NE=1;og.quadTree.SW=2;og.quadTree.SE=3;og.quadTree.N=0;og.quadTree.E=1;og.quadTree.S=2;og.quadTree.W=3;og.quadTree.WALKTHROUGH=0;og.quadTree.RENDERING=1;og.quadTree.NOTRENDERING=2;og.quadTree.OPSIDE=[og.quadTree.S,og.quadTree.W,og.quadTree.N,og.quadTree.E];
og.quadTree.NOPS=[[og.quadTree.NE,og.quadTree.NW,og.quadTree.SE,og.quadTree.SW],[og.quadTree.SW,og.quadTree.SE,og.quadTree.NW,og.quadTree.NE],[og.quadTree.NE,og.quadTree.NW,og.quadTree.SE,og.quadTree.SW],[og.quadTree.SW,og.quadTree.SE,og.quadTree.NW,og.quadTree.NE]];og.quadTree.NOPSORD=[[0,1,0,1],[0,0,1,1],[0,1,0,1],[0,0,1,1]];og.layer.XYZ=function(c,d){og.inheritance.base(this,c,d);this.events.registerNames(og.layer.XYZ.EVENT_NAMES);d.extent||this.setExtent(new og.Extent(new og.LonLat(-180,og.mercator.MIN_LAT),new og.LonLat(180,og.mercator.MAX_LAT)));this.transparentColor=d.transparentColor||[-1,-1,-1];this.url=d.url||"";this._counter=0;this._pendingsQueue=[];this._urlRewriteCallback=null};og.inheritance.extend(og.layer.XYZ,og.layer.Layer);og.layer.XYZ.__requestsCounter=0;og.layer.XYZ.MAX_REQUESTS=7;
og.layer.XYZ.EVENT_NAMES=["load","loadend"];og.layer.xyz=function(c,d){return new og.layer.XYZ(c,d)};og.layer.XYZ.prototype.abortLoading=function(){for(var c=this._pendingsQueue,d=c._shiftIndex+1;d<c._popIndex+1;d++)c._array[d]&&this.abortMaterialLoading(c._array[d]);this._pendingsQueue=[]};
og.layer.XYZ.prototype.setVisibility=function(c){c!=this._visibility&&(this._visibility=c,this._isBaseLayer&&c?this._planet.setBaseLayer(this):c||this.abortLoading(),this._planet.updateVisibleLayers(),this.events.dispatch(this.events.visibilitychange,this))};og.layer.XYZ.prototype.setUrl=function(c){this.url=c};
og.layer.XYZ.prototype.loadMaterial=function(c){var d=c.segment;c.texture=this._isBaseLayer?d._isNorth?d.planet.solidTextureOne:d.planet.solidTextureTwo:d.planet.transparentTexture;this._planet.layersActivity&&(c.isReady=!1,c.isLoading=!0,c.segment._projection.id===og.proj.EPSG3857.id?og.layer.XYZ.__requestsCounter>=og.layer.XYZ.MAX_REQUESTS&&this._counter?this._pendingsQueue.push(c):this._exec(c):c.textureNotExists())};
og.layer.XYZ.prototype._createUrl=function(c){return og.utils.stringTemplate(this.url,{x:c.tileX.toString(),y:c.tileY.toString(),z:c.tileZoom.toString()})};og.layer.XYZ.prototype._getHTTPRequestString=function(c){var d=this._createUrl(c);return this._urlRewriteCallback?this._urlRewriteCallback(c,d):d};og.layer.XYZ.prototype.setUrlRewriteCallback=function(c){this._urlRewriteCallback=c};
og.layer.XYZ.prototype._exec=function(c){og.layer.XYZ.__requestsCounter++;this._counter++;var d=this;c.image=new Image;c.image.crossOrigin="";c.image.onload=function(){d._counter--;og.layer.XYZ.__requestsCounter--;var e=d.events.load;e.length&&d.events.dispatch(e,c);c.applyTexture.call(c,this);d._dequeueRequest()};c.image.onerror=function(){c.isLoading&&c.image&&(d._counter--,og.layer.XYZ.__requestsCounter--,c.textureNotExists.call(c));d._dequeueRequest()};c.image.src=this._getHTTPRequestString(c.segment)};
og.layer.XYZ.prototype.abortMaterialLoading=function(c){c.isLoading&&c.image&&(c.image.src="",this._counter--,og.layer.XYZ.__requestsCounter--,this._dequeueRequest());c.isLoading=!1;c.isReady=!1};og.layer.XYZ.prototype._dequeueRequest=function(){if(this._pendingsQueue.length){if(og.layer.XYZ.__requestsCounter<og.layer.XYZ.MAX_REQUESTS){var c;(c=this._whilePendings())&&this._exec.call(this,c)}}else 0===this._counter&&this.events.dispatch(this.events.loadend)};
og.layer.XYZ.prototype._whilePendings=function(){for(;this._pendingsQueue.length;){var c=this._pendingsQueue.pop();if(c.segment.node){if(c.segment.ready&&c.segment.node.getState()===og.quadTree.RENDERING)return c;c.isLoading=!1}}return null};
og.layer.XYZ.prototype.applyMaterial=function(c){if(c.isReady)return[0,0,1,1];!c.isLoading&&this.loadMaterial(c);for(var d=c.segment,e=d.node,f=!1,g=this._id,h=c;e.parentNode;){if(h&&h.isReady){f=!0;break}e=e.parentNode;h=e.planetSegment.materials[g]}if(f)return h.appliedNodeId=d.node.nodeId,c.texture=h.texture,c=1/(2<<d.tileZoom-e.planetSegment.tileZoom-1),[d.tileX*c-e.planetSegment.tileX,d.tileY*c-e.planetSegment.tileY,c,c];c.texture=d.planet.transparentTexture;return[0,0,1,1]};
og.layer.XYZ.prototype.clearMaterial=function(c){c.isReady&&(c.isReady=!1,!c.texture["default"]&&c.segment.handler.gl.deleteTexture(c.texture),c.texture=null);this.abortMaterialLoading(c);c.isLoading=!1;c.textureExists=!1;c.image&&(c.image.src="",c.image=null)};
og.layer.XYZ.prototype._correctFullExtent=function(){var c=this._extent,d=this._extentMerc,e=og.mercator.POLE+5E4,f=og.mercator.POLE+5E4;90===c.northEast.lat&&(d.northEast.lat=f);180===c.northEast.lon&&(d.northEast.lon=e);-90===c.southWest.lat&&(d.southWest.lat=-f);-180===c.southWest.lon&&(d.southWest.lon=-e);c.northEast.lat>=og.mercator.MAX_LAT&&(c.northEast.lat=og.mercator.MAX_LAT);c.northEast.lat<=og.mercator.MIN_LAT&&(c.northEast.lat=og.mercator.MIN_LAT)};og.RESOURCES_URL=COMPILED?"./resources/":"../../resources/";og.SHADERS_URL=COMPILED?"./shaders/":"../../src/og/shaders/";og.shaderProgram={};og.shaderProgram.types={};og.shaderProgram.types._declarations="FLOAT DOUBLE BOOL INT UINT VEC2 VEC3 VEC4 DVEC2 DVEC3 DVEC4 BVEC2 BVEC3 BVEC4 IVEC2 IVEC3 IVEC4 UVEC2 UVEC3 UVEC4 MAT2 DMAT2 MAT3 DMAT3 MAT4 DMAT4 MAT2X3 MAT2X4 MAT3X2 MAT3X4 MAT4X2 MAT4X3 DMAT2X3 DMAT2X4 DMAT3X2 DMAT3X4 DMAT4X2 DMAT4X3 SAMPLER1D SAMPLER2D SAMPLER3D SAMPLERCUBE SAMPLER2DSHADOW SAMPLER2DXX INTXX FLOATXX".split(" ");
(function(){for(var c=0;c<og.shaderProgram.types._declarations.length;c++)og.shaderProgram.types[og.shaderProgram.types._declarations[c]]=c})();og.shaderProgram.callbacks={};og.shaderProgram.bindBuffer=function(c,d){var e=c.gl;e.bindBuffer(e.ARRAY_BUFFER,d.value);e.vertexAttribPointer(d._pName,d.value.itemSize,e.FLOAT,!1,0,0)};og.shaderProgram.callbacks.u=[];og.shaderProgram.callbacks.u[og.shaderProgram.types.MAT4]=function(c,d){c.gl.uniformMatrix4fv(d._pName,!1,d.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.MAT3]=function(c,d){c.gl.uniformMatrix3fv(d._pName,!1,d.value)};
og.shaderProgram.callbacks.u[og.shaderProgram.types.FLOAT]=function(c,d){c.gl.uniform1f(d._pName,d.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.INT]=function(c,d){c.gl.uniform1i(d._pName,d.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.VEC2]=function(c,d){c.gl.uniform2fv(d._pName,d.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.VEC3]=function(c,d){c.gl.uniform3fv(d._pName,d.value)};
og.shaderProgram.callbacks.u[og.shaderProgram.types.VEC4]=function(c,d){c.gl.uniform4fv(d._pName,d.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.SAMPLER2D]=function(c,d){var e=c.gl;e.activeTexture(e.TEXTURE0+c._textureID);e.bindTexture(e.TEXTURE_2D,d.value);e.uniform1i(d._pName,c._textureID);c._textureID++};
og.shaderProgram.callbacks.u[og.shaderProgram.types.SAMPLERCUBE]=function(c,d){var e=c.gl;e.activeTexture(e.TEXTURE0+c._textureID);e.bindTexture(e.TEXTURE_CUBE_MAP,d.value);e.uniform1i(d._pName,c._textureID);c._textureID++};og.shaderProgram.callbacks.u[og.shaderProgram.types.SAMPLER2DXX]=function(c,d){for(var e=c.gl,f=d.value.length,g=new Int32Array(f),h=0;h<f;h++)e.activeTexture(e.TEXTURE0+c._textureID+h),e.bindTexture(e.TEXTURE_2D,d.value[h]),g[h]=h;e.uniform1iv(d._pName,g)};
og.shaderProgram.callbacks.u[og.shaderProgram.types.INTXX]=function(c,d){pgl.uniform1iv(d._pName,d.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.FLOATXX]=function(c,d){c.gl.uniform1fv(d._pName,d.value)};og.shaderProgram.callbacks.a=[];og.shaderProgram.callbacks.a[og.shaderProgram.types.FLOAT]=function(c,d){c.gl.vertexAttrib1f(d._pName,d.value)};og.shaderProgram.callbacks.a[og.shaderProgram.types.VEC2]=function(c,d){c.gl.vertexAttrib2fv(d._pName,d.value)};
og.shaderProgram.callbacks.a[og.shaderProgram.types.VEC3]=function(c,d){c.gl.vertexAttrib3fv(d._pName,d.value)};og.shaderProgram.callbacks.a[og.shaderProgram.types.VEC4]=function(c,d){c.gl.vertexAttrib4fv(d._pName,d.value)};og.shaderProgram.ShaderProgram=function(c,d){this.name=c;this.attributes=d.attributes;this.uniforms=d.uniforms;this.vertexShader=d.vertexShader;this.fragmentShader=d.fragmentShader;this.gl=null;this._variables={};this._p=null;this._textureID=0;this._attribArrays=[]};og.shaderProgram.ShaderProgram.prototype.use=function(){this.gl.useProgram(this._p)};
og.shaderProgram.ShaderProgram.prototype.set=function(c){this._textureID=0;for(var d in c)this._variables[d].value=c[d],this._variables[d]._callback(this,this._variables[d])};og.shaderProgram.ShaderProgram.prototype.apply=function(){this._textureID=0;var c=this._variables,d;for(d in c)c[d]._callback(this,c[d])};og.shaderProgram.ShaderProgram.prototype.drawIndexBuffer=function(c,d){this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,d);this.gl.drawElements(c,d.numItems,this.gl.UNSIGNED_SHORT,0)};
og.shaderProgram.ShaderProgram.prototype.drawArray=function(c,d){this.gl.drawArrays(c,0,d)};og.shaderProgram.ShaderProgram.prototype._getShaderCompileStatus=function(c,d){this.gl.shaderSource(c,d);this.gl.compileShader(c);return this.gl.getShaderParameter(c,this.gl.COMPILE_STATUS)?!0:(og.console.logErr("og.shaderProgram.ShaderProgram:"+this.name+" - "+this.gl.getShaderInfoLog(c)+"."),!1)};
og.shaderProgram.ShaderProgram.prototype._createVertexShader=function(c){var d=this.gl.createShader(this.gl.VERTEX_SHADER);return this._getShaderCompileStatus(d,c)?d:null};og.shaderProgram.ShaderProgram.prototype._createFragmentShader=function(c){var d=this.gl.createShader(this.gl.FRAGMENT_SHADER);return this._getShaderCompileStatus(d,c)?d:null};og.shaderProgram.ShaderProgram.prototype.disableAttribArrays=function(){for(var c=this.gl,d=this._attribArrays,e=d.length;e--;)c.disableVertexAttribArray(d[e])};
og.shaderProgram.ShaderProgram.prototype.enableAttribArrays=function(){for(var c=this.gl,d=this._attribArrays,e=d.length;e--;)c.enableVertexAttribArray(d[e])};og.shaderProgram.ShaderProgram.prototype["delete"]=function(){this.gl.deleteProgram(this._p)};
og.shaderProgram.ShaderProgram.prototype.createProgram=function(c){this.gl=c;this._p=this.gl.createProgram();var d=this._createFragmentShader(this.fragmentShader),e=this._createVertexShader(this.vertexShader);c.attachShader(this._p,d);c.attachShader(this._p,e);c.linkProgram(this._p);if(c.getProgramParameter(this._p,c.LINK_STATUS)){this.use();c.detachShader(this._p,d);c.detachShader(this._p,e);for(var f in this.attributes){this.attributes[f]._name=f;this._variables[f]=this.attributes[f];this.attributes[f]._callback=
this.attributes[f].enableArray?og.shaderProgram.bindBuffer:og.shaderProgram.callbacks.a[this.attributes[f].type];this._p[f]=c.getAttribLocation(this._p,f);if(void 0==this._p[f]){og.console.logErr("og.shaderProgram.ShaderProgram:"+this.name+" - attribute "+f+" is not exists.");c.deleteProgram(this._p);return}this.attributes[f].enableArray&&(this._attribArrays.push(this._p[f]),c.enableVertexAttribArray(this._p[f]));this.attributes[f]._pName=this._p[f]}for(var g in this.uniforms){this.uniforms[g]._name=
g;this.uniforms[g]._callback=og.shaderProgram.callbacks.u[this.uniforms[g].type];this._variables[g]=this.uniforms[g];this._p[g]=c.getUniformLocation(this._p,g);if(void 0==this._p[g]){og.console.logErr("og.shaderProgram.ShaderProgram:"+this.name+" - uniform "+g+" is not exists.");c.deleteProgram(this._p);break}this.uniforms[g]._pName=this._p[g]}}else og.console.logErr("og.shaderProgram.ShaderProgram:"+this.name+" - couldn't initialise shaders. "+c.getProgramInfoLog(this._p)+"."),c.deleteProgram(this._p)};og.shaderProgram.pointCloud=function(){return new og.shaderProgram.ShaderProgram("pointCloud",{uniforms:{projectionViewMatrix:{type:og.shaderProgram.types.MAT4},opacity:{type:og.shaderProgram.types.FLOAT},pointSize:{type:og.shaderProgram.types.FLOAT}},attributes:{coordinates:{type:og.shaderProgram.types.VEC3,enableArray:!0},colors:{type:og.shaderProgram.types.VEC3,enableArray:!0}},vertexShader:"attribute vec3 coordinates;\r\n            attribute vec4 colors;\r\n            uniform mat4 projectionViewMatrix;\r\n            uniform float opacity;\r\n            uniform float pointSize;\r\n            varying vec4 color;\r\n            const float C = 0.1;\r\n            const float far = 149.6e+9;\r\n            float logc = 2.0 / log( C * far + 1.0 );\r\n            void main() {\r\n                color = colors;\r\n                color.a *= opacity;\r\n                gl_Position = projectionViewMatrix * vec4(coordinates, 1.0);\r\n                gl_Position.z = ( log( C * gl_Position.w + 1.0 ) * logc - 1.0 ) * gl_Position.w;\r\n                gl_PointSize = pointSize;\r\n            }",
fragmentShader:"#ifdef GL_ES\n\r\n            #ifdef GL_FRAGMENT_PRECISION_HIGH\n\r\n            precision highp float;\n\r\n            #else\n\r\n            precision mediump float;\n\r\n            #endif // GL_FRAGMENT_PRECISION_HIGH\n\r\n            #endif // GL_ES\n\r\n            varying vec4 color;\r\n            void main(void) {\r\n                gl_FragColor = color;\r\n            }"})};og.PointCloudHandler=function(c){this.pickingEnabled=!0;this._entityCollection=c;this._renderer=null;this._pointClouds=[];this.__staticId=og.PointCloudHandler.staticCounter++};og.PointCloudHandler.staticCounter=0;og.PointCloudHandler.prototype._initShaderProgram=function(){this._renderer.handler&&(this._renderer.handler.shaderPrograms.pointCloud||this._renderer.handler.addShaderProgram(og.shaderProgram.pointCloud()))};
og.PointCloudHandler.prototype.setRenderNode=function(c){this._renderer=c.renderer;this._initShaderProgram();for(var d=0;d<this._pointClouds.length;d++)this._pointClouds[d].setRenderNode(c)};og.PointCloudHandler.prototype.add=function(c){-1==c._handlerIndex&&(c._handler=this,c._handlerIndex=this._pointClouds.length,this._pointClouds.push(c),this._entityCollection&&this._entityCollection.renderNode&&c.setRenderNode(this._entityCollection.renderNode))};
og.PointCloudHandler.prototype.remove=function(c){var d=c._handlerIndex;-1!==d&&(c._deleteBuffers(),c._handlerIndex=-1,c._handler=null,this._pointClouds.splice(d,1),this.reindexPointCloudArray(d))};og.PointCloudHandler.prototype.reindexPointCloudArray=function(c){for(var d=this._pointClouds;c<d.length;c++)d[c]._handlerIndex=c};og.PointCloudHandler.prototype.draw=function(){for(var c=this._pointClouds.length;c--;)this._pointClouds[c].draw()};
og.PointCloudHandler.prototype.drawPicking=function(){if(this.pickingEnabled)for(var c=this._pointClouds.length;c--;)this._pointClouds[c].drawPicking()};og.PointCloudHandler.prototype.clear=function(){for(var c=this._pointClouds.length;c--;)this._pointClouds[c]._deleteBuffers(),this._pointClouds[c]._handler=null,this._pointClouds[c]._handlerIndex=-1;this._pointClouds.length=0;this._pointClouds=[]};og.shaderProgram.billboard=function(){return new og.shaderProgram.ShaderProgram("billboard",{uniforms:{u_texture:{type:og.shaderProgram.types.SAMPLER2D},projectionMatrix:{type:og.shaderProgram.types.MAT4},viewMatrix:{type:og.shaderProgram.types.MAT4},uCamPos:{type:og.shaderProgram.types.VEC3},uFloatParams:{type:og.shaderProgram.types.VEC2},uScaleByDistance:{type:og.shaderProgram.types.VEC3},uOpacity:{type:og.shaderProgram.types.FLOAT}},attributes:{a_vertices:{type:og.shaderProgram.types.VEC2,enableArray:!0},
a_texCoord:{type:og.shaderProgram.types.VEC2,enableArray:!0},a_positions:{type:og.shaderProgram.types.VEC4,enableArray:!0},a_size:{type:og.shaderProgram.types.VEC2,enableArray:!0},a_offset:{type:og.shaderProgram.types.VEC3,enableArray:!0},a_rgba:{type:og.shaderProgram.types.VEC4,enableArray:!0},a_rotation:{type:og.shaderProgram.types.FLOAT,enableArray:!0},a_alignedAxis:{type:og.shaderProgram.types.VEC3,enableArray:!0}},vertexShader:"#ifdef GL_ES\n\r\n            #ifdef GL_FRAGMENT_PRECISION_HIGH\n\r\n            precision highp float;\n\r\n            #else\n\r\n            precision mediump float;\n\r\n            #endif // GL_FRAGMENT_PRECISION_HIGH\n\r\n            #endif // GL_ES\n\r\n            attribute vec2 a_vertices;\r\n            attribute vec2 a_texCoord;\r\n            attribute vec4 a_positions;\r\n            attribute vec3 a_offset;\r\n            attribute vec2 a_size;\r\n            attribute float a_rotation;\r\n            attribute vec4 a_rgba;\r\n            attribute vec3 a_alignedAxis;\r\n            varying vec2 v_texCoords;\r\n            varying vec4 v_rgba;\r\n            uniform mat4 viewMatrix;\r\n            uniform mat4 projectionMatrix;\r\n            uniform vec3 uCamPos;\r\n            uniform vec2 uFloatParams;\r\n            uniform vec3 uScaleByDistance;\r\n            uniform float uOpacity;\r\n            const vec3 ZERO3 = vec3(0.0);\r\n            const float C = 0.1;\r\n            const float far = 149.6e+9;\r\n            float logc = 2.0 / log( C * far + 1.0 );\r\n            void main() {\r\n                v_texCoords = a_texCoord;\r\n                vec3 look = a_positions.xyz - uCamPos;\r\n                float lookLength = length(look);\r\n                v_rgba = a_rgba;\r\n                /*v_rgba.a *= uOpacity * step(lookLength, sqrt(dot(uCamPos,uCamPos) - uFloatParams[0]) + sqrt(dot(a_positions.xyz,a_positions.xyz) - uFloatParams[0]));*/\r\n                if(uOpacity * step(lookLength, sqrt(dot(uCamPos,uCamPos) - uFloatParams[0]) + sqrt(dot(a_positions.xyz,a_positions.xyz) - uFloatParams[0])) == 0.0){\r\n                    return;\r\n                }\r\n                vec3 right, up;\r\n                if(a_alignedAxis == ZERO3){\r\n                    up = vec3( viewMatrix[0][1], viewMatrix[1][1], viewMatrix[2][1] );\r\n                    right = vec3( viewMatrix[0][0], viewMatrix[1][0], viewMatrix[2][0] );\r\n                }else{\r\n                    up = normalize(a_alignedAxis);\r\n                    right = normalize(cross(look,up));\r\n                    look = cross(up,right);\r\n                }\r\n                float dist = dot(uCamPos - a_positions.xyz, vec3(viewMatrix[0][2], viewMatrix[1][2], viewMatrix[2][2]));\r\n                float focalSize = 2.0 * dist * uFloatParams[1];\r\n                vec2 offset = a_offset.xy * focalSize;\r\n                float scd = a_positions.w * (1.0 - smoothstep(uScaleByDistance[0], uScaleByDistance[1], lookLength)) * (1.0 - step(uScaleByDistance[2], lookLength));\r\n                vec2 scale = a_size * focalSize * scd;\r\n                float cosRot = cos(a_rotation);\r\n                float sinRot = sin(a_rotation);\r\n                vec3 rr = (right * cosRot - up * sinRot) * (scale.x * a_vertices.x + scd * offset.x) + (right * sinRot + up * cosRot) * (scale.y * a_vertices.y + scd * offset.y) + a_positions.xyz;\r\n                gl_Position = projectionMatrix * viewMatrix * vec4(rr, 1);\r\n                gl_Position.z = ( log( C * gl_Position.w + 1.0 ) * logc - 1.0 ) * gl_Position.w;\r\n                gl_Position.z += a_offset.z;\r\n            }",
fragmentShader:"#extension GL_EXT_draw_buffers : require\n\r\n            #ifdef GL_ES\n\r\n            #ifdef GL_FRAGMENT_PRECISION_HIGH\n\r\n            precision highp float;\n\r\n            #else\n\r\n            precision mediump float;\n\r\n            #endif // GL_FRAGMENT_PRECISION_HIGH\n\r\n            #endif // GL_ES\n\r\n            uniform sampler2D u_texture;\r\n            varying vec2 v_texCoords;\r\n            varying vec4 v_rgba;\r\n            varying vec3 v_pickingColor;\r\n            void main () {\r\n                vec4 color = texture2D(u_texture, v_texCoords);\r\n                if(color.a < 0.1)\r\n                    discard;\r\n                gl_FragData[0] = color * v_rgba;\r\n                gl_FragData[1] = vec4(0.0);\r\n            }"})};
og.shaderProgram.billboardPicking=function(){return new og.shaderProgram.ShaderProgram("billboardPicking",{uniforms:{projectionMatrix:{type:og.shaderProgram.types.MAT4},viewMatrix:{type:og.shaderProgram.types.MAT4},uCamPos:{type:og.shaderProgram.types.VEC3},uFloatParams:{type:og.shaderProgram.types.VEC2},uScaleByDistance:{type:og.shaderProgram.types.VEC3},uOpacity:{type:og.shaderProgram.types.FLOAT}},attributes:{a_vertices:{type:og.shaderProgram.types.VEC2,enableArray:!0},a_positions:{type:og.shaderProgram.types.VEC4,
enableArray:!0},a_size:{type:og.shaderProgram.types.VEC2,enableArray:!0},a_offset:{type:og.shaderProgram.types.VEC3,enableArray:!0},a_pickingColor:{type:og.shaderProgram.types.VEC3,enableArray:!0},a_rotation:{type:og.shaderProgram.types.FLOAT,enableArray:!0},a_alignedAxis:{type:og.shaderProgram.types.VEC3,enableArray:!0}},vertexShader:"#ifdef GL_ES\n\r\n            #ifdef GL_FRAGMENT_PRECISION_HIGH\n\r\n            precision highp float;\n\r\n            #else\n\r\n            precision mediump float;\n\r\n            #endif // GL_FRAGMENT_PRECISION_HIGH\n\r\n            #endif // GL_ES\n\r\n            attribute vec2 a_vertices;\r\n            attribute vec4 a_positions;\r\n            attribute vec3 a_offset;\r\n            attribute vec2 a_size;\r\n            attribute float a_rotation;\r\n            attribute vec3 a_pickingColor;\r\n            attribute vec3 a_alignedAxis;\r\n            varying vec4 v_color;\r\n            uniform mat4 viewMatrix;\r\n            uniform mat4 projectionMatrix;\r\n            uniform vec3 uCamPos;\r\n            uniform vec2 uFloatParams;\r\n            uniform vec3 uScaleByDistance;\r\n            uniform float uOpacity;\r\n            const vec3 ZERO3 = vec3(0.0);\r\n            const float C = 0.1;\r\n            const float far = 149.6e+9;\r\n            float logc = 2.0 / log( C * far + 1.0 );\r\n            void main() {\r\n                vec3 look = a_positions.xyz - uCamPos;\r\n                float lookLength = length(look);\r\n                if( uOpacity == 0.0 ) {\r\n                    gl_Position = vec4(0.0);\r\n                    return;\r\n                }\r\n                v_color = vec4(a_pickingColor.rgb, 1.0) * step(lookLength, sqrt(dot(uCamPos,uCamPos) - uFloatParams[0]) + sqrt(dot(a_positions.xyz, a_positions.xyz) - uFloatParams[0]));\r\n                vec3 right, up;\r\n                if(a_alignedAxis == ZERO3){\r\n                    up = vec3( viewMatrix[0][1], viewMatrix[1][1], viewMatrix[2][1] );\r\n                    right = vec3( viewMatrix[0][0], viewMatrix[1][0], viewMatrix[2][0] );\r\n                }else{\r\n                    up = normalize(a_alignedAxis);\r\n                    right = normalize(cross(look,up));\r\n                    look = cross(up,right);\r\n                }\r\n                float dist = dot(uCamPos - a_positions.xyz, vec3(viewMatrix[0][2], viewMatrix[1][2], viewMatrix[2][2]));\r\n                float focalSize = 2.0 * dist * uFloatParams[1];\r\n                vec2 offset = a_offset.xy * focalSize;\r\n                float scd = a_positions.w * (1.0 - smoothstep(uScaleByDistance[0], uScaleByDistance[1], lookLength)) *(1.0 - step(uScaleByDistance[2], lookLength));\r\n                vec2 scale = a_size * focalSize * scd;\r\n                float cosRot = cos(a_rotation);\r\n                float sinRot = sin(a_rotation);\r\n                vec3 rr = (right * cosRot - up * sinRot) * (scale.x * a_vertices.x + scd * offset.x) + (right * sinRot + up * cosRot) * (scale.y * a_vertices.y + scd * offset.y) + a_positions.xyz;\r\n                gl_Position = projectionMatrix * viewMatrix * vec4(rr, 1);\r\n                gl_Position.z = ( log( C * gl_Position.w + 1.0 ) * logc - 1.0 ) * gl_Position.w;\r\n                gl_Position.z += a_offset.z;\r\n            }",
fragmentShader:"#ifdef GL_ES\n\r\n            #ifdef GL_FRAGMENT_PRECISION_HIGH\n\r\n            precision highp float;\n\r\n            #else\n\r\n            precision mediump float;\n\r\n            #endif // GL_FRAGMENT_PRECISION_HIGH\n\r\n            #endif // GL_ES\n\r\n            varying vec4 v_color;\r\n            void main () {\r\n                gl_FragColor = v_color;\r\n            }"})};og.BillboardHandler=function(c){this.pickingEnabled=!0;this._entityCollection=c;this._renderer=null;this._billboards=[];this._alignedAxisBuffer=this._vertexBuffer=this._texCoordBuffer=this._rotationBuffer=this._rgbaBuffer=this._offsetBuffer=this._sizeBuffer=this._positionBuffer=null;this._texCoordArr=[];this._vertexArr=[];this._positionArr=[];this._sizeArr=[];this._offsetArr=[];this._rgbaArr=[];this._rotationArr=[];this._alignedAxisArr=[];this._pickingColorBuffer=null;this._pickingColorArr=[];this._buffersUpdateCallbacks=
[];this._buffersUpdateCallbacks[og.BillboardHandler.PICKINGCOLOR_BUFFER]=this.createPickingColorBuffer;this._buffersUpdateCallbacks[og.BillboardHandler.POSITION_BUFFER]=this.createPositionBuffer;this._buffersUpdateCallbacks[og.BillboardHandler.SIZE_BUFFER]=this.createSizeBuffer;this._buffersUpdateCallbacks[og.BillboardHandler.OFFSET_BUFFER]=this.createOffsetBuffer;this._buffersUpdateCallbacks[og.BillboardHandler.RGBA_BUFFER]=this.createRgbaBuffer;this._buffersUpdateCallbacks[og.BillboardHandler.ROTATION_BUFFER]=
this.createRotationBuffer;this._buffersUpdateCallbacks[og.BillboardHandler.TEXCOORD_BUFFER]=this.createTexCoordBuffer;this._buffersUpdateCallbacks[og.BillboardHandler.VERTEX_BUFFER]=this.createVertexBuffer;this._buffersUpdateCallbacks[og.BillboardHandler.ALIGNEDAXIS_BUFFER]=this.createAlignedAxisBuffer;this._changedBuffers=Array(this._buffersUpdateCallbacks.length);this.__staticId=og.BillboardHandler.staticCounter++};og.BillboardHandler.staticCounter=0;og.BillboardHandler.PICKINGCOLOR_BUFFER=0;
og.BillboardHandler.POSITION_BUFFER=1;og.BillboardHandler.SIZE_BUFFER=2;og.BillboardHandler.OFFSET_BUFFER=3;og.BillboardHandler.RGBA_BUFFER=4;og.BillboardHandler.ROTATION_BUFFER=5;og.BillboardHandler.TEXCOORD_BUFFER=6;og.BillboardHandler.VERTEX_BUFFER=7;og.BillboardHandler.ALIGNEDAXIS_BUFFER=8;
og.BillboardHandler.prototype.initShaderProgram=function(){this._renderer.handler&&(this._renderer.handler.shaderPrograms.billboard||this._renderer.handler.addShaderProgram(og.shaderProgram.billboard()),this._renderer.handler.shaderPrograms.billboardPicking||this._renderer.handler.addShaderProgram(og.shaderProgram.billboardPicking()))};og.BillboardHandler.prototype.setRenderer=function(c){this._renderer=c;this.initShaderProgram()};
og.BillboardHandler.prototype.refresh=function(){for(var c=this._changedBuffers.length;c--;)this._changedBuffers[c]=!0};og.BillboardHandler.prototype._removeBillboards=function(){for(var c=this._billboards.length;c--;){var d=this._billboards[c];d._handlerIndex=-1;d._handler=null}this._billboards.length=0;this._billboards=[]};
og.BillboardHandler.prototype.clear=function(){this._texCoordArr.length=0;this._vertexArr.length=0;this._positionArr.length=0;this._sizeArr.length=0;this._offsetArr.length=0;this._rgbaArr.length=0;this._rotationArr.length=0;this._alignedAxisArr.length=0;this._pickingColorArr.length=0;this._texCoordArr=[];this._vertexArr=[];this._positionArr=[];this._sizeArr=[];this._offsetArr=[];this._rgbaArr=[];this._rotationArr=[];this._alignedAxisArr=[];this._pickingColorArr=[];this._removeBillboards();this._deleteBuffers();
this.refresh()};
og.BillboardHandler.prototype._deleteBuffers=function(){var c=this._renderer.handler.gl;c.deleteBuffer(this._positionBuffer);c.deleteBuffer(this._sizeBuffer);c.deleteBuffer(this._offsetBuffer);c.deleteBuffer(this._rgbaBuffer);c.deleteBuffer(this._rotationBuffer);c.deleteBuffer(this._vertexBuffer);c.deleteBuffer(this._texCoordBuffer);c.deleteBuffer(this._alignedAxisBuffer);c.deleteBuffer(this._pickingColorBuffer);this._pickingColorBuffer=this._alignedAxisBuffer=this._texCoordBuffer=this._vertexBuffer=
this._rotationBuffer=this._rgbaBuffer=this._offsetBuffer=this._sizeBuffer=this._positionBuffer=null};og.BillboardHandler.prototype.update=function(){if(this._renderer)for(var c=this._changedBuffers.length;c--;)this._changedBuffers[c]&&(this._buffersUpdateCallbacks[c].call(this),this._changedBuffers[c]=!1)};
og.BillboardHandler.prototype.add=function(c){-1==c._handlerIndex&&(c._handler=this,c._handlerIndex=this._billboards.length,this._billboards.push(c),this._addBillboardToArrays(c),this.refresh(),c.setSrc(c._src))};
og.BillboardHandler.prototype._addBillboardToArrays=function(c){c._visibility?og.BillboardHandler.concArr(this._vertexArr,[-.5,.5,-.5,-.5,.5,-.5,.5,-.5,.5,.5,-.5,.5]):og.BillboardHandler.concArr(this._vertexArr,[0,0,0,0,0,0,0,0,0,0,0,0]);og.BillboardHandler.concArr(this._texCoordArr,[0,0,0,0,0,0,0,0,0,0,0,0]);var d=c._position.x,e=c._position.y,f=c._position.z,g=c._scale;og.BillboardHandler.concArr(this._positionArr,[d,e,f,g,d,e,f,g,d,e,f,g,d,e,f,g,d,e,f,g,d,e,f,g]);d=c._width;e=c._height;og.BillboardHandler.concArr(this._sizeArr,
[d,e,d,e,d,e,d,e,d,e,d,e]);d=c._offset.x;e=c._offset.y;f=c._offset.z;og.BillboardHandler.concArr(this._offsetArr,[d,e,f,d,e,f,d,e,f,d,e,f,d,e,f,d,e,f]);d=c._color.x;e=c._color.y;f=c._color.z;g=c._color.w;og.BillboardHandler.concArr(this._rgbaArr,[d,e,f,g,d,e,f,g,d,e,f,g,d,e,f,g,d,e,f,g,d,e,f,g]);d=c._rotation;og.BillboardHandler.concArr(this._rotationArr,[d,d,d,d,d,d]);d=c._alignedAxis.x;e=c._alignedAxis.y;f=c._alignedAxis.z;og.BillboardHandler.concArr(this._alignedAxisArr,[d,e,f,d,e,f,d,e,f,d,e,
f,d,e,f,d,e,f]);d=c._entity._pickingColor.x/255;e=c._entity._pickingColor.y/255;f=c._entity._pickingColor.z/255;og.BillboardHandler.concArr(this._pickingColorArr,[d,e,f,d,e,f,d,e,f,d,e,f,d,e,f,d,e,f])};og.BillboardHandler.concArr=function(c,d){for(var e=0;e<d.length;e++)c.push(d[e])};
og.BillboardHandler.prototype._displayPASS=function(){var c=this._renderer,d=c.handler;d.shaderPrograms.billboard.activate();var e=d.shaderPrograms.billboard._program,f=e.attributes,e=e.uniforms,d=d.gl;d.uniform1i(e.u_texture._pName,0);d.uniformMatrix4fv(e.viewMatrix._pName,!1,c.activeCamera._viewMatrix._m);d.uniformMatrix4fv(e.projectionMatrix._pName,!1,c.activeCamera._projectionMatrix._m);d.uniform3fv(e.uCamPos._pName,c.activeCamera.eye.toVec());d.uniform3fv(e.uScaleByDistance._pName,this._entityCollection.scaleByDistance);
d.uniform1f(e.uOpacity._pName,this._entityCollection._animatedOpacity);d.uniform2fv(e.uFloatParams._pName,[this._entityCollection.renderNode._planetRadius2||0,c.activeCamera._tanViewAngle_hradOneByHeight]);d.bindBuffer(d.ARRAY_BUFFER,this._texCoordBuffer);d.vertexAttribPointer(f.a_texCoord._pName,this._texCoordBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._vertexBuffer);d.vertexAttribPointer(f.a_vertices._pName,this._vertexBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,
this._positionBuffer);d.vertexAttribPointer(f.a_positions._pName,this._positionBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._rgbaBuffer);d.vertexAttribPointer(f.a_rgba._pName,this._rgbaBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._sizeBuffer);d.vertexAttribPointer(f.a_size._pName,this._sizeBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._offsetBuffer);d.vertexAttribPointer(f.a_offset._pName,this._offsetBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,
this._rotationBuffer);d.vertexAttribPointer(f.a_rotation._pName,this._rotationBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._alignedAxisBuffer);d.vertexAttribPointer(f.a_alignedAxis._pName,this._alignedAxisBuffer.itemSize,d.FLOAT,!1,0,0);d.drawArrays(d.TRIANGLES,0,this._vertexBuffer.numItems)};
og.BillboardHandler.prototype._pickingPASS=function(){var c=this._renderer,d=c.handler;d.shaderPrograms.billboardPicking.activate();var e=d.shaderPrograms.billboardPicking._program,f=e.attributes,e=e.uniforms,d=d.gl;d.uniformMatrix4fv(e.viewMatrix._pName,!1,c.activeCamera._viewMatrix._m);d.uniformMatrix4fv(e.projectionMatrix._pName,!1,c.activeCamera._projectionMatrix._m);d.uniform3fv(e.uCamPos._pName,c.activeCamera.eye.toVec());d.uniform3fv(e.uScaleByDistance._pName,this._entityCollection.scaleByDistance);
d.uniform1f(e.uOpacity._pName,this._entityCollection._animatedOpacity);d.uniform2fv(e.uFloatParams._pName,[this._entityCollection.renderNode._planetRadius2||0,c.activeCamera._tanViewAngle_hradOneByHeight]);d.bindBuffer(d.ARRAY_BUFFER,this._vertexBuffer);d.vertexAttribPointer(f.a_vertices._pName,this._vertexBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._positionBuffer);d.vertexAttribPointer(f.a_positions._pName,this._positionBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,
this._pickingColorBuffer);d.vertexAttribPointer(f.a_pickingColor._pName,this._pickingColorBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._sizeBuffer);d.vertexAttribPointer(f.a_size._pName,this._sizeBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._offsetBuffer);d.vertexAttribPointer(f.a_offset._pName,this._offsetBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._rotationBuffer);d.vertexAttribPointer(f.a_rotation._pName,this._rotationBuffer.itemSize,
d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._alignedAxisBuffer);d.vertexAttribPointer(f.a_alignedAxis._pName,this._alignedAxisBuffer.itemSize,d.FLOAT,!1,0,0);d.drawArrays(d.TRIANGLES,0,this._vertexBuffer.numItems)};og.BillboardHandler.prototype.draw=function(){this._billboards.length&&(this.update(),this._displayPASS())};og.BillboardHandler.prototype.drawPicking=function(){this._billboards.length&&this.pickingEnabled&&this._pickingPASS()};
og.BillboardHandler.prototype.reindexBillbordsArray=function(c){for(var d=this._billboards;c<d.length;c++)d[c]._handlerIndex=c};
og.BillboardHandler.prototype._removeBillboard=function(c){var d=c._handlerIndex;this._billboards.splice(d,1);var e=24*d;this._rgbaArr.splice(e,24);this._positionArr.splice(e,24);e=18*d;this._offsetArr.splice(e,18);this._alignedAxisArr.splice(e,18);this._pickingColorArr.splice(e,18);e=12*d;this._vertexArr.splice(e,12);this._sizeArr.splice(e,12);this._texCoordArr.splice(e,12);this._rotationArr.splice(6*d,6);this.reindexBillbordsArray(d);this.refresh();c._handlerIndex=-1;c._handler=null};
og.BillboardHandler.prototype.remove=function(c){c._handler&&this.__staticId==c._handler.__staticId&&this._removeBillboard(c)};og.BillboardHandler.prototype.setPositionArr=function(c,d){var e=24*c,f=this._positionArr,g=d.x,h=d.y,k=d.z;f[e]=g;f[e+1]=h;f[e+2]=k;f[e+4]=g;f[e+5]=h;f[e+6]=k;f[e+8]=g;f[e+9]=h;f[e+10]=k;f[e+12]=g;f[e+13]=h;f[e+14]=k;f[e+16]=g;f[e+17]=h;f[e+18]=k;f[e+20]=g;f[e+21]=h;f[e+22]=k;this._changedBuffers[og.BillboardHandler.POSITION_BUFFER]=!0};
og.BillboardHandler.prototype.setScaleArr=function(c,d){var e=24*c,f=this._positionArr;f[e+3]=d;f[e+7]=d;f[e+11]=d;f[e+15]=d;f[e+19]=d;f[e+23]=d;this._changedBuffers[og.BillboardHandler.POSITION_BUFFER]=!0};
og.BillboardHandler.prototype.setPickingColorArr=function(c,d){var e=18*c,f=this._pickingColorArr,g=d.x/255,h=d.y/255,k=d.z/255;f[e]=g;f[e+1]=h;f[e+2]=k;f[e+3]=g;f[e+4]=h;f[e+5]=k;f[e+6]=g;f[e+7]=h;f[e+8]=k;f[e+9]=g;f[e+10]=h;f[e+11]=k;f[e+12]=g;f[e+13]=h;f[e+14]=k;f[e+15]=g;f[e+16]=h;f[e+17]=k;this._changedBuffers[og.BillboardHandler.PICKINGCOLOR_BUFFER]=!0};
og.BillboardHandler.prototype.setSizeArr=function(c,d,e){c*=12;var f=this._sizeArr;f[c]=d;f[c+1]=e;f[c+2]=d;f[c+3]=e;f[c+4]=d;f[c+5]=e;f[c+6]=d;f[c+7]=e;f[c+8]=d;f[c+9]=e;f[c+10]=d;f[c+11]=e;this._changedBuffers[og.BillboardHandler.SIZE_BUFFER]=!0};
og.BillboardHandler.prototype.setOffsetArr=function(c,d){var e=18*c,f=this._offsetArr,g=d.x,h=d.y,k=d.z;f[e]=g;f[e+1]=h;f[e+2]=k;f[e+3]=g;f[e+4]=h;f[e+5]=k;f[e+6]=g;f[e+7]=h;f[e+8]=k;f[e+9]=g;f[e+10]=h;f[e+11]=k;f[e+12]=g;f[e+13]=h;f[e+14]=k;f[e+15]=g;f[e+16]=h;f[e+17]=k;this._changedBuffers[og.BillboardHandler.OFFSET_BUFFER]=!0};
og.BillboardHandler.prototype.setRgbaArr=function(c,d){var e=24*c,f=this._rgbaArr,g=d.x,h=d.y,k=d.z,m=d.w;f[e]=g;f[e+1]=h;f[e+2]=k;f[e+3]=m;f[e+4]=g;f[e+5]=h;f[e+6]=k;f[e+7]=m;f[e+8]=g;f[e+9]=h;f[e+10]=k;f[e+11]=m;f[e+12]=g;f[e+13]=h;f[e+14]=k;f[e+15]=m;f[e+16]=g;f[e+17]=h;f[e+18]=k;f[e+19]=m;f[e+20]=g;f[e+21]=h;f[e+22]=k;f[e+23]=m;this._changedBuffers[og.BillboardHandler.RGBA_BUFFER]=!0};
og.BillboardHandler.prototype.setRotationArr=function(c,d){var e=6*c,f=this._rotationArr;f[e]=d;f[e+1]=d;f[e+2]=d;f[e+3]=d;f[e+4]=d;f[e+5]=d;this._changedBuffers[og.BillboardHandler.ROTATION_BUFFER]=!0};og.BillboardHandler.prototype.setTexCoordArr=function(c,d){var e=12*c,f=this._texCoordArr;f[e]=d[0];f[e+1]=d[1];f[e+2]=d[2];f[e+3]=d[3];f[e+4]=d[4];f[e+5]=d[5];f[e+6]=d[6];f[e+7]=d[7];f[e+8]=d[8];f[e+9]=d[9];f[e+10]=d[10];f[e+11]=d[11];this._changedBuffers[og.BillboardHandler.TEXCOORD_BUFFER]=!0};
og.BillboardHandler.prototype.setVisibility=function(c,d){this.setVertexArr(c,d?[-.5,.5,-.5,-.5,.5,-.5,.5,-.5,.5,.5,-.5,.5]:[0,0,0,0,0,0,0,0,0,0,0,0])};og.BillboardHandler.prototype.setVertexArr=function(c,d){var e=12*c,f=this._vertexArr;f[e]=d[0];f[e+1]=d[1];f[e+2]=d[2];f[e+3]=d[3];f[e+4]=d[4];f[e+5]=d[5];f[e+6]=d[6];f[e+7]=d[7];f[e+8]=d[8];f[e+9]=d[9];f[e+10]=d[10];f[e+11]=d[11];this._changedBuffers[og.BillboardHandler.VERTEX_BUFFER]=!0};
og.BillboardHandler.prototype.setAlignedAxisArr=function(c,d){var e=18*c,f=this._alignedAxisArr,g=d.x,h=d.y,k=d.z;f[e]=g;f[e+1]=h;f[e+2]=k;f[e+3]=g;f[e+4]=h;f[e+5]=k;f[e+6]=g;f[e+7]=h;f[e+8]=k;f[e+9]=g;f[e+10]=h;f[e+11]=k;f[e+12]=g;f[e+13]=h;f[e+14]=k;f[e+15]=g;f[e+16]=h;f[e+17]=k;this._changedBuffers[og.BillboardHandler.ALIGNEDAXIS_BUFFER]=!0};
og.BillboardHandler.prototype.createPositionBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._positionBuffer);this._positionBuffer=c.createArrayBuffer(new Float32Array(this._positionArr),4,this._positionArr.length/4)};og.BillboardHandler.prototype.createSizeBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._sizeBuffer);this._sizeBuffer=c.createArrayBuffer(new Float32Array(this._sizeArr),2,this._sizeArr.length/2)};
og.BillboardHandler.prototype.createOffsetBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._offsetBuffer);this._offsetBuffer=c.createArrayBuffer(new Float32Array(this._offsetArr),3,this._offsetArr.length/3)};og.BillboardHandler.prototype.createRgbaBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._rgbaBuffer);this._rgbaBuffer=c.createArrayBuffer(new Float32Array(this._rgbaArr),4,this._rgbaArr.length/4)};
og.BillboardHandler.prototype.createRotationBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._rotationBuffer);this._rotationBuffer=c.createArrayBuffer(new Float32Array(this._rotationArr),1,this._rotationArr.length)};og.BillboardHandler.prototype.createVertexBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._vertexBuffer);this._vertexBuffer=c.createArrayBuffer(new Float32Array(this._vertexArr),2,this._vertexArr.length/2)};
og.BillboardHandler.prototype.createTexCoordBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._texCoordBuffer);this._texCoordBuffer=c.createArrayBuffer(new Float32Array(this._texCoordArr),2,this._texCoordArr.length/2)};og.BillboardHandler.prototype.createAlignedAxisBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._alignedAxisBuffer);this._alignedAxisBuffer=c.createArrayBuffer(new Float32Array(this._alignedAxisArr),3,this._alignedAxisArr.length/3)};
og.BillboardHandler.prototype.createPickingColorBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._pickingColorBuffer);this._pickingColorBuffer=c.createArrayBuffer(new Float32Array(this._pickingColorArr),3,this._pickingColorArr.length/3)};
og.BillboardHandler.prototype.refreshTexCoordsArr=function(){var c=this._entityCollection;if(c&&c.renderNode)for(var c=c.renderNode.billboardsTextureAtlas,d=0;d<this._billboards.length;d++){var e=this._billboards[d];if(e._image){var f=c.nodes[e._image.__nodeIndex];f&&this.setTexCoordArr(e._handlerIndex,f.texCoords)}}};og.shaderProgram.label=function(){return new og.shaderProgram.ShaderProgram("label",{uniforms:{u_fontTextureArr:{type:og.shaderProgram.types.SAMPLER2DXX},projectionMatrix:{type:og.shaderProgram.types.MAT4},viewMatrix:{type:og.shaderProgram.types.MAT4},uCamPos:{type:og.shaderProgram.types.VEC3},uFloatParams:{type:og.shaderProgram.types.VEC2},uZ:{type:og.shaderProgram.types.FLOAT},uScaleByDistance:{type:og.shaderProgram.types.VEC3},uOpacity:{type:og.shaderProgram.types.FLOAT}},attributes:{a_vertices:{type:og.shaderProgram.types.VEC2,
enableArray:!0},a_texCoord:{type:og.shaderProgram.types.VEC4,enableArray:!0},a_positions:{type:og.shaderProgram.types.VEC4,enableArray:!0},a_size:{type:og.shaderProgram.types.FLOAT,enableArray:!0},a_offset:{type:og.shaderProgram.types.VEC3,enableArray:!0},a_rgba:{type:og.shaderProgram.types.VEC4,enableArray:!0},a_rotation:{type:og.shaderProgram.types.FLOAT,enableArray:!0},a_alignedAxis:{type:og.shaderProgram.types.VEC3,enableArray:!0},a_fontIndex:{type:og.shaderProgram.types.FLOAT,enableArray:!0},
a_bufferAA:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:"attribute vec2 a_vertices;\r\n            attribute vec4 a_texCoord;\r\n            attribute vec4 a_positions;\r\n            attribute vec3 a_offset;\r\n            attribute float a_size;\r\n            attribute float a_rotation;\r\n            attribute vec4 a_rgba;\r\n            attribute vec3 a_alignedAxis;\r\n            attribute float a_fontIndex;\r\n            attribute vec2 a_bufferAA;\r\n            varying vec2 v_texCoords;\r\n            varying vec4 v_rgba;\r\n            varying float v_fontIndex;\r\n            varying vec3 v_bufferAA;\r\n            uniform mat4 viewMatrix;\r\n            uniform mat4 projectionMatrix;\r\n            uniform vec3 uCamPos;\r\n            /*0 - planetRadius^2, 1 - tan(fov), 2 - screen ratio*/\r\n            uniform vec2 uFloatParams;\r\n            uniform float uZ;\r\n            uniform vec3 uScaleByDistance;\r\n            uniform float uOpacity;\r\n            const vec3 ZERO3 = vec3(0.0);\r\n            const float C = 0.1;\r\n            const float far = 149.6e+9;\r\n            float logc = 2.0 / log( C * far + 1.0 );\r\n            void main() {\r\n                if(a_texCoord.z == -1.0 || a_bufferAA.x == 1.0){\r\n                    gl_Position = vec4(0.0);\r\n                    return;\r\n                }\r\n                v_fontIndex = a_fontIndex;\r\n                v_texCoords = a_texCoord.xy;\r\n                vec3 look = a_positions.xyz - uCamPos;\r\n                float lookDist = length(look);\r\n                v_rgba = a_rgba;\r\n                /*v_rgba.a *= uOpacity * step(lookDist, sqrt(dot(uCamPos,uCamPos) - uFloatParams[0]) + sqrt(dot(a_positions.xyz,a_positions.xyz) - uFloatParams[0]));*/\r\n                if(uOpacity * step(lookDist, sqrt(dot(uCamPos,uCamPos) - uFloatParams[0]) + sqrt(dot(a_positions.xyz,a_positions.xyz) - uFloatParams[0]))==0.0){\r\n                    return;\r\n                }\r\n                vec3 right, up;\r\n                if(a_alignedAxis == ZERO3){\r\n                    up = vec3( viewMatrix[0][1], viewMatrix[1][1], viewMatrix[2][1] );\r\n                    right = vec3( viewMatrix[0][0], viewMatrix[1][0], viewMatrix[2][0] );\r\n                }else{\r\n                    up = normalize(a_alignedAxis);\r\n                    right = normalize(cross(look,up));\r\n                    look = cross(up,right);\r\n                }\r\n                v_bufferAA = vec3(a_bufferAA, 8.0 * a_bufferAA.y / a_size);\r\n                float dist = dot(uCamPos - a_positions.xyz, vec3(viewMatrix[0][2], viewMatrix[1][2], viewMatrix[2][2]));\r\n                float focalSize = 2.0 * dist * uFloatParams[1];\r\n                vec2 offset = a_offset.xy * focalSize;\r\n                float scd = a_positions.w * (1.0 - smoothstep(uScaleByDistance[0], uScaleByDistance[1], lookDist)) * (1.0 - step(uScaleByDistance[2], lookDist));\r\n                float scale = a_size * focalSize * scd;\r\n                float cosRot = cos(a_rotation);\r\n                float sinRot = sin(a_rotation);\r\n                vec3 rr = (right * cosRot - up * sinRot) * (scale * (a_vertices.x + a_texCoord.z + a_texCoord.w) + scd * offset.x) + (right * sinRot + up * cosRot) * (scale * a_vertices.y + scd * offset.y) + a_positions.xyz;\r\n                gl_Position = projectionMatrix * viewMatrix * vec4(rr, 1);\r\n                gl_Position.z = ( log( C * gl_Position.w + 1.0 ) * logc - 1.0 ) * gl_Position.w;\r\n                gl_Position.z += a_offset.z + uZ;\r\n            }",
fragmentShader:"#extension GL_OES_standard_derivatives : enable\n\r\n            #extension GL_EXT_draw_buffers : require\n\r\n            #ifdef GL_ES\n\r\n            #ifdef GL_FRAGMENT_PRECISION_HIGH\n\r\n            precision highp float;\n\r\n            #else\n\r\n            precision mediump float;\n\r\n            #endif // GL_FRAGMENT_PRECISION_HIGH\n\r\n            #endif // GL_ES\n\r\n            const int MAX_SIZE = 12;\r\n            uniform sampler2D u_fontTextureArr[MAX_SIZE];\r\n            varying float v_fontIndex;\r\n            varying vec2 v_texCoords;\r\n            varying vec4 v_rgba;\r\n            varying vec3 v_bufferAA;\r\n            varying vec3 v_pickingColor;\r\n            void main () {\r\n                int fi = int(v_fontIndex);\r\n                vec4 color;\r\n                if (fi == 0) {\r\n                    color = texture2D(u_fontTextureArr[0], v_texCoords);\r\n                } else if (fi == 1) {\r\n                    color = texture2D(u_fontTextureArr[1], v_texCoords);\r\n                } else if (fi == 2) {\r\n                    color = texture2D(u_fontTextureArr[2], v_texCoords);\r\n                } else if (fi == 3) {\r\n                    color = texture2D(u_fontTextureArr[3], v_texCoords);\r\n                } else if (fi == 4) {\r\n                    color = texture2D(u_fontTextureArr[4], v_texCoords);\r\n                } else if (fi == 5) {\r\n                    color = texture2D(u_fontTextureArr[5], v_texCoords);\r\n                } else if (fi == 6) {\r\n                    color = texture2D(u_fontTextureArr[6], v_texCoords);\r\n                } else if (fi == 7) {\r\n                    color = texture2D(u_fontTextureArr[7], v_texCoords);\r\n                } else if (fi == 8) {\r\n                    color = texture2D(u_fontTextureArr[8], v_texCoords);\r\n                } else if (fi == 9) {\r\n                    color = texture2D(u_fontTextureArr[9], v_texCoords);\r\n                }else{\r\n                    color = texture2D(u_fontTextureArr[10], v_texCoords);\r\n                }\r\n                float afwidth = step(0.5, v_bufferAA.x) * (1.0 - v_bufferAA.y) * v_bufferAA.x * fwidth( color.r );\r\n                float alpha = smoothstep ( v_bufferAA.x - afwidth - v_bufferAA.z, v_bufferAA.x + afwidth + v_bufferAA.z, color.r );\r\n                if( alpha < 0.2 )\r\n                    discard;\r\n                gl_FragData[0] = vec4(v_rgba.rgb, alpha * v_rgba.a);\r\n                gl_FragData[1] = vec4(0.0);\r\n            }"})};
og.shaderProgram.labelPicking=function(){return new og.shaderProgram.ShaderProgram("labelPicking",{uniforms:{projectionMatrix:{type:og.shaderProgram.types.MAT4},viewMatrix:{type:og.shaderProgram.types.MAT4},uCamPos:{type:og.shaderProgram.types.VEC3},uFloatParams:{type:og.shaderProgram.types.VEC2},uScaleByDistance:{type:og.shaderProgram.types.VEC3},uOpacity:{type:og.shaderProgram.types.FLOAT}},attributes:{a_vertices:{type:og.shaderProgram.types.VEC2,enableArray:!0},a_texCoord:{type:og.shaderProgram.types.VEC4,
enableArray:!0},a_positions:{type:og.shaderProgram.types.VEC4,enableArray:!0},a_size:{type:og.shaderProgram.types.FLOAT,enableArray:!0},a_offset:{type:og.shaderProgram.types.VEC3,enableArray:!0},a_pickingColor:{type:og.shaderProgram.types.VEC3,enableArray:!0},a_rotation:{type:og.shaderProgram.types.FLOAT,enableArray:!0},a_alignedAxis:{type:og.shaderProgram.types.VEC3,enableArray:!0}},vertexShader:"#ifdef GL_ES\n\r\n            #ifdef GL_FRAGMENT_PRECISION_HIGH\n\r\n            precision highp float;\n\r\n            #else\n\r\n            precision mediump float;\n\r\n            #endif // GL_FRAGMENT_PRECISION_HIGH\n\r\n            #endif // GL_ES\n\r\n            attribute vec2 a_vertices;\r\n            attribute vec4 a_texCoord;\r\n            attribute vec4 a_positions;\r\n            attribute vec3 a_offset;\r\n            attribute float a_size;\r\n            attribute float a_rotation;\r\n            attribute vec3 a_pickingColor;\r\n            attribute vec3 a_alignedAxis;\r\n            varying vec4 v_color;\r\n            uniform mat4 viewMatrix;\r\n            uniform mat4 projectionMatrix;\r\n            uniform vec3 uCamPos;\r\n            /*0 - planetRadius^2, 1 - tan(fov), 2 - screen ratio*/\r\n            uniform vec2 uFloatParams;\r\n            uniform vec3 uScaleByDistance;\r\n            uniform float uOpacity;\r\n            const vec3 ZERO3 = vec3(0.0);\r\n            const float C = 0.1;\r\n            const float far = 149.6e+9;\r\n            float logc = 2.0 / log( C * far + 1.0 );\r\n            void main() {\r\n                if( uOpacity == 0.0 ){\r\n                    gl_Position = vec4(0.0);\r\n                    return;\r\n                }\r\n                if(a_texCoord.z == -1.0){\r\n                    gl_Position = vec4(0.0);\r\n                    return;\r\n                }\r\n                vec3 look = a_positions.xyz - uCamPos;\r\n                float lookLength = length(look);\r\n                v_color = vec4(a_pickingColor.rgb, 1.0) * step(lookLength, sqrt(dot(uCamPos,uCamPos) - uFloatParams[0]) + sqrt(dot(a_positions.xyz, a_positions.xyz) - uFloatParams[0]));\r\n                vec3 right, up;\r\n                if(a_alignedAxis == ZERO3){\r\n                    up = vec3( viewMatrix[0][1], viewMatrix[1][1], viewMatrix[2][1] );\r\n                    right = vec3( viewMatrix[0][0], viewMatrix[1][0], viewMatrix[2][0] );\r\n                }else{\r\n                    up = normalize(a_alignedAxis);\r\n                    right = normalize(cross(look,up));\r\n                    look = cross(up,right);\r\n                }\r\n                float dist = dot(uCamPos - a_positions.xyz, vec3(viewMatrix[0][2], viewMatrix[1][2], viewMatrix[2][2]));\r\n                float focalSize = 2.0 * dist * uFloatParams[1];\r\n                vec2 offset = a_offset.xy * focalSize;\r\n                float scd = a_positions.w * (1.0 - smoothstep(uScaleByDistance[0], uScaleByDistance[1], lookLength)) *(1.0 - step(uScaleByDistance[2], lookLength));\r\n                float scale = a_size * focalSize * scd;\r\n                float cosRot = cos(a_rotation);\r\n                float sinRot = sin(a_rotation);\r\n                vec3 rr = (right * cosRot - up * sinRot) * (scale * (a_vertices.x + a_texCoord.z + a_texCoord.w) + scd * offset.x) + (right * sinRot + up * cosRot) * (scale * a_vertices.y + scd * offset.y) + a_positions.xyz;\r\n                gl_Position = projectionMatrix * viewMatrix * vec4(rr, 1);\r\n                gl_Position.z = ( log( C * gl_Position.w + 1.0 ) * logc - 1.0 ) * gl_Position.w;\r\n                gl_Position.z += a_offset.z;\r\n            }",
fragmentShader:"#ifdef GL_ES\n\r\n            #ifdef GL_FRAGMENT_PRECISION_HIGH\n\r\n            precision highp float;\n\r\n            #else\n\r\n            precision mediump float;\n\r\n            #endif // GL_FRAGMENT_PRECISION_HIGH\n\r\n            #endif // GL_ES\n\r\n            varying vec4 v_color;\r\n            void main () {\r\n                gl_FragColor = v_color;\r\n            }"})};og.BaseBillboard=function(c){c=c||{};this.id=og.BaseBillboard.__staticId++;this._position=og.utils.createVector3(c.position);this._rotation=c.rotation||0;this._color=og.utils.createColorRGBA(c.color);this._alignedAxis=og.utils.createVector3(c.algnedAxis);this._offset=og.utils.createVector3(c.offset);this._visibility=void 0!=c.visibility?c.visibility:!0;this._scale=c.scale||1;this._handler=this._entity=null;this._handlerIndex=-1};og.BaseBillboard.__staticId=0;
og.BaseBillboard.prototype.setPosition=function(c,d,e){this._position.x=c;this._position.y=d;this._position.z=e;this._handler&&this._handler.setPositionArr(this._handlerIndex,this._position)};og.BaseBillboard.prototype.setPosition3v=function(c){this._position.x=c.x;this._position.y=c.y;this._position.z=c.z;this._handler&&this._handler.setPositionArr(this._handlerIndex,c)};og.BaseBillboard.prototype.getPosition=function(){return this._position};
og.BaseBillboard.prototype.setOffset=function(c,d,e){this._offset.x=c;this._offset.y=d;void 0!=e&&(this._offset.z=e);this._handler&&this._handler.setOffsetArr(this._handlerIndex,this._offset)};og.BaseBillboard.prototype.setScale=function(c){this._scale=c;this._handler&&this._handler.setScaleArr(this._handlerIndex,c)};og.BaseBillboard.prototype.getScale=function(){return this._scale};
og.BaseBillboard.prototype.setOffset3v=function(c){this._offset.x=c.x;this._offset.y=c.y;void 0!=c.z&&(this._offset.z=c.z);this._handler&&this._handler.setOffsetArr(this._handlerIndex,c)};og.BaseBillboard.prototype.getOffset=function(){return this._offset};og.BaseBillboard.prototype.setRotation=function(c){this._rotation=c;this._handler&&this._handler.setRotationArr(this._handlerIndex,c)};og.BaseBillboard.prototype.getRotation=function(){return this._rotation};
og.BaseBillboard.prototype.setOpacity=function(c){this._color.w=c;this.setColor(this._color.x,this._color.y,this._color.z,c)};og.BaseBillboard.prototype.setColor=function(c,d,e,f){this._color.x=c;this._color.y=d;this._color.z=e;void 0!=f&&(this._color.w=f);this._handler&&this._handler.setRgbaArr(this._handlerIndex,this._color)};
og.BaseBillboard.prototype.setColor4v=function(c){this._color.x=c.x;this._color.y=c.y;this._color.z=c.z;void 0!=c.w&&(this._color.w=c.w);this._handler&&this._handler.setRgbaArr(this._handlerIndex,c)};og.BaseBillboard.prototype.setColorHTML=function(c){this.setColor4v(og.utils.htmlColorToRgba(c))};og.BaseBillboard.prototype.getColor=function(){return this._color};og.BaseBillboard.prototype.setVisibility=function(c){this._visibility=c;this._handler&&this._handler.setVisibility(this._handlerIndex,c)};
og.BaseBillboard.prototype.getVisibility=function(){return this._visibility};og.BaseBillboard.prototype.setAlignedAxis=function(c,d,e){this._alignedAxis.x=c;this._alignedAxis.y=d;this._alignedAxis.z=e;this._handler&&this._handler.setAlignedAxisArr(this._handlerIndex,this._alignedAxis)};og.BaseBillboard.prototype.setAlignedAxis3v=function(c){this._alignedAxis.x=c.x;this._alignedAxis.y=c.y;this._alignedAxis.z=c.z;this._handler&&this._handler.setAlignedAxisArr(this._handlerIndex,c)};
og.BaseBillboard.prototype.getAlignedAxis=function(){return this._alignedAxis};og.BaseBillboard.prototype.remove=function(){this._entity=null;this._handler&&this._handler.remove(this)};og.BaseBillboard.prototype.setPickingColor3v=function(c){this._handler&&this._handler.setPickingColorArr(this._handlerIndex,c)};og.Label=function(c){c=c||{};og.inheritance.base(this,c);this._text=c.text;this._face=og.utils.defaultString(c.face,null);this._size=c.size||32;this._style=og.utils.defaultString(c.style,null);this._weight=og.utils.defaultString(c.weight,null);this._outline=void 0!=c.outline?c.outline:.58;this._outlineColor=og.utils.createColorRGBA(c.outlineColor,new og.math.Vector4(0,0,0,1));this._align=c.align?og.Label.ALIGN[c.align.trim().toLowerCase()]||og.Label.RIGHT:og.Label.RIGHT;this._fontIndex=0;this._fontAtlas=
null};og.inheritance.extend(og.Label,og.BaseBillboard);og.Label.RIGHT=0;og.Label.LEFT=1;og.Label.CENTER=2;og.Label.ALIGN={left:og.Label.LEFT,right:og.Label.RIGHT,center:og.Label.CENTER};og.Label.prototype.setText=function(c){this._text=c;this._handler&&this._handler.setText(this._handlerIndex,c,this._fontIndex,this._align)};og.Label.prototype.getText=function(){return this._text};
og.Label.prototype.setAlign=function(c){this._align=og.Label.ALIGN[c.trim().toLowerCase()];this._handler&&this._handler.setText(this._handlerIndex,this._text,this._fontIndex,this._align)};og.Label.prototype.getAlign=function(){return this._align};og.Label.prototype.setFace=function(c){this._face=c.trim().toLowerCase();this.update()};og.Label.prototype.getFace=function(){return this._face};
og.Label.prototype.setSize=function(c){this._size=c;this._handler&&this._handler.setSizeArr(this._handlerIndex,c)};og.Label.prototype.getSize=function(){return this._size};og.Label.prototype.setStyle=function(c){this._style=c.trim().toLowerCase();this.update()};og.Label.prototype.getStyle=function(){return this._style};og.Label.prototype.setWeight=function(c){this._weight=c.trim().toLowerCase();this.update()};og.Label.prototype.getWeight=function(){return this._wight};
og.Label.prototype.setOutline=function(c){this._outline=c;this._handler&&this._handler.setOutlineArr(this._handlerIndex,1-c)};og.Label.prototype.getOutline=function(){return this._outline};og.Label.prototype.setOpacity=function(c){this._color.w=c;this.setColor4v(this._color);this._outlineColor.w=c;this.setOutlineColor4v(this._outlineColor)};
og.Label.prototype.setOutlineColor=function(c,d,e,f){this._outlineColor.x=c;this._outlineColor.y=d;this._outlineColor.z=e;this._outlineColor.w=f;this._handler&&this._handler.setOutlineColorArr(this._handlerIndex,this._outlineColor)};og.Label.prototype.setOutlineColor4v=function(c){this._outlineColor.x=c.x;this._outlineColor.y=c.y;this._outlineColor.z=c.z;this._outlineColor.w=c.w;this._handler&&this._handler.setOutlineColorArr(this._handlerIndex,c)};og.Label.prototype.setOutlineColorHTML=function(c){this.setOutlineColor4v(og.utils.htmlColorToRgba(c))};
og.Label.prototype.getOutlineColor=function(){return this._outlineColor};og.Label.prototype.setOutlineOpacity=function(c){this._outlineColor.w=c;this._handler&&this._handler.setOutlineColorArr(this._handlerIndex,this._outlineColor)};og.Label.prototype.getOutlineOpacity=function(){return this._outlineColor.w};
og.Label.prototype.update=function(){if(this._fontAtlas){var c=this._fontAtlas.getFontIndex(this._face,this._style,this._weight);void 0==c?this._fontAtlas.createFontAsync(this._face,this._style,this._weight,this._applyFontIndex.bind(this)):this._applyFontIndex(c)}};og.Label.prototype._applyFontIndex=function(c){this._fontIndex=c;this._handler&&(this._handler.setFontIndexArr(this._handlerIndex,this._fontIndex),this._handler.setText(this._handlerIndex,this._text,this._fontIndex,this._align))};
og.Label.prototype.assignFontAtlas=function(c){!this._fontAtlas&&(this._fontAtlas=c);this.update()};og.LabelHandler=function(c){og.inheritance.base(this,c);this._outlineColorBuffer=this._outlineBuffer=this._noOutlineBuffer=this._fontIndexBuffer=null;this._fontIndexArr=[];this._noOutlineArr=[];this._outlineArr=[];this._outlineColorArr=[];this._buffersUpdateCallbacks[og.LabelHandler.FONTINDEX_BUFFER]=this.createFontIndexBuffer;this._buffersUpdateCallbacks[og.LabelHandler.OUTLINE_BUFFER]=this.createOutlineBuffer;this._buffersUpdateCallbacks[og.LabelHandler.OUTLINECOLOR_BUFFER]=this.createOutlineColorBuffer;
this._changedBuffers=Array(this._buffersUpdateCallbacks.length);this._maxLetters=25};og.inheritance.extend(og.LabelHandler,og.BillboardHandler);og.LabelHandler.FONTINDEX_BUFFER=9;og.LabelHandler.OUTLINE_BUFFER=10;og.LabelHandler.OUTLINECOLOR_BUFFER=11;og.LabelHandler.prototype.initShaderProgram=function(){this._renderer.handler&&(this._renderer.handler.shaderPrograms.label||this._renderer.handler.addShaderProgram(og.shaderProgram.label()),this._renderer.handler.shaderPrograms.labelPicking||this._renderer.handler.addShaderProgram(og.shaderProgram.labelPicking()))};
og.LabelHandler.prototype.add=function(c){-1==c._handlerIndex&&(c._handler=this,c._handlerIndex=this._billboards.length,this._billboards.push(c),this._addBillboardToArrays(c),this.refresh(),this.assignFontAtlas(c))};og.LabelHandler.prototype.assignFontAtlas=function(c){this._entityCollection&&this._entityCollection.renderNode&&c.assignFontAtlas(this._entityCollection.renderNode.fontAtlas)};
og.LabelHandler.prototype.clear=function(){this._texCoordArr.length=0;this._vertexArr.length=0;this._positionArr.length=0;this._sizeArr.length=0;this._offsetArr.length=0;this._rgbaArr.length=0;this._rotationArr.length=0;this._alignedAxisArr.length=0;this._fontIndexArr.length=0;this._noOutlineArr.length=0;this._outlineArr.length=0;this._outlineColorArr.length=0;this._texCoordArr=[];this._vertexArr=[];this._positionArr=[];this._sizeArr=[];this._offsetArr=[];this._rgbaArr=[];this._rotationArr=[];this._alignedAxisArr=
[];this._fontIndexArr=[];this._noOutlineArr=[];this._outlineArr=[];this._outlineColorArr=[];this._removeBillboards();this._deleteBuffers();this.refresh()};
og.LabelHandler.prototype._deleteBuffers=function(){var c=this._renderer.handler.gl;c.deleteBuffer(this._sizeBuffer);c.deleteBuffer(this._fontIndexBuffer);c.deleteBuffer(this._texCoordBuffer);c.deleteBuffer(this._outlineBuffer);c.deleteBuffer(this._noOutlineBuffer);c.deleteBuffer(this._outlineColorBuffer);c.deleteBuffer(this._positionBuffer);c.deleteBuffer(this._sizeBuffer);c.deleteBuffer(this._offsetBuffer);c.deleteBuffer(this._rgbaBuffer);c.deleteBuffer(this._rotationBuffer);c.deleteBuffer(this._vertexBuffer);
c.deleteBuffer(this._texCoordBuffer);c.deleteBuffer(this._alignedAxisBuffer);c.deleteBuffer(this._pickingColorBuffer);this._pickingColorBuffer=this._alignedAxisBuffer=this._texCoordBuffer=this._vertexBuffer=this._rotationBuffer=this._rgbaBuffer=this._offsetBuffer=this._sizeBuffer=this._positionBuffer=this._outlineColorBuffer=this._outlineBuffer=this._fontIndexBuffer=null};
og.LabelHandler.prototype._addBillboardToArrays=function(c){for(var d=0;d<this._maxLetters;d++){c._visibility?og.BillboardHandler.concArr(this._vertexArr,[-.5,.5,-.5,-.5,.5,-.5,.5,-.5,.5,.5,-.5,.5]):og.BillboardHandler.concArr(this._vertexArr,[0,0,0,0,0,0,0,0,0,0,0,0]);og.BillboardHandler.concArr(this._texCoordArr,[0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0]);var e=c._position.x,f=c._position.y,g=c._position.z,h=c._scale;og.BillboardHandler.concArr(this._positionArr,[e,f,g,h,e,f,g,h,e,
f,g,h,e,f,g,h,e,f,g,h,e,f,g,h]);e=c._size;og.BillboardHandler.concArr(this._sizeArr,[e,e,e,e,e,e]);e=c._offset.x;f=c._offset.y;g=c._offset.z-.05;og.BillboardHandler.concArr(this._offsetArr,[e,f,g,e,f,g,e,f,g,e,f,g,e,f,g,e,f,g]);e=c._color.x;f=c._color.y;g=c._color.z;h=c._color.w;og.BillboardHandler.concArr(this._rgbaArr,[e,f,g,h,e,f,g,h,e,f,g,h,e,f,g,h,e,f,g,h,e,f,g,h]);e=c._rotation;og.BillboardHandler.concArr(this._rotationArr,[e,e,e,e,e,e]);e=c._alignedAxis.x;f=c._alignedAxis.y;g=c._alignedAxis.z;
og.BillboardHandler.concArr(this._alignedAxisArr,[e,f,g,e,f,g,e,f,g,e,f,g,e,f,g,e,f,g]);og.BillboardHandler.concArr(this._fontIndexArr,[0,0,0,0,0,0]);e=1-c._outline;f=0;og.BillboardHandler.concArr(this._outlineArr,[e,f,e,f,e,f,e,f,e,f,e,f]);e=.75;f=.7;og.BillboardHandler.concArr(this._noOutlineArr,[e,f,e,f,e,f,e,f,e,f,e,f]);e=c._outlineColor.x;f=c._outlineColor.y;g=c._outlineColor.z;h=c._outlineColor.w;og.BillboardHandler.concArr(this._outlineColorArr,[e,f,g,h,e,f,g,h,e,f,g,h,e,f,g,h,e,f,g,h,e,f,
g,h]);e=c._entity._pickingColor.x/255;f=c._entity._pickingColor.y/255;g=c._entity._pickingColor.z/255;og.BillboardHandler.concArr(this._pickingColorArr,[e,f,g,e,f,g,e,f,g,e,f,g,e,f,g,e,f,g])}};
og.LabelHandler.prototype._displayPASS=function(){var c=this._renderer,d=c.handler;d.shaderPrograms.label.activate();var e=d.shaderPrograms.label._program,f=e.attributes,e=e.uniforms,d=d.gl,g=this._entityCollection,h=g.renderNode;d.uniform1iv(e.u_fontTextureArr._pName,h.fontAtlas.samplerArr);d.uniformMatrix4fv(e.viewMatrix._pName,!1,c.activeCamera._viewMatrix._m);d.uniformMatrix4fv(e.projectionMatrix._pName,!1,c.activeCamera._projectionMatrix._m);d.uniform3fv(e.uCamPos._pName,c.activeCamera.eye.toVec());
d.uniform3fv(e.uScaleByDistance._pName,g.scaleByDistance);d.uniform1f(e.uOpacity._pName,g._animatedOpacity);d.uniform2fv(e.uFloatParams._pName,[h._planetRadius2||0,c.activeCamera._tanViewAngle_hradOneByHeight]);d.bindBuffer(d.ARRAY_BUFFER,this._texCoordBuffer);d.vertexAttribPointer(f.a_texCoord._pName,this._texCoordBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._vertexBuffer);d.vertexAttribPointer(f.a_vertices._pName,this._vertexBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,
this._positionBuffer);d.vertexAttribPointer(f.a_positions._pName,this._positionBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._sizeBuffer);d.vertexAttribPointer(f.a_size._pName,this._sizeBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._offsetBuffer);d.vertexAttribPointer(f.a_offset._pName,this._offsetBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._rotationBuffer);d.vertexAttribPointer(f.a_rotation._pName,this._rotationBuffer.itemSize,d.FLOAT,!1,
0,0);d.bindBuffer(d.ARRAY_BUFFER,this._alignedAxisBuffer);d.vertexAttribPointer(f.a_alignedAxis._pName,this._alignedAxisBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._fontIndexBuffer);d.vertexAttribPointer(f.a_fontIndex._pName,this._fontIndexBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._outlineColorBuffer);d.vertexAttribPointer(f.a_rgba._pName,this._outlineColorBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._outlineBuffer);d.vertexAttribPointer(f.a_bufferAA._pName,
this._outlineBuffer.itemSize,d.FLOAT,!1,0,0);d.uniform1f(e.uZ._pName,-2);d.drawArrays(d.TRIANGLES,0,this._vertexBuffer.numItems);d.bindBuffer(d.ARRAY_BUFFER,this._rgbaBuffer);d.vertexAttribPointer(f.a_rgba._pName,this._rgbaBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._noOutlineBuffer);d.vertexAttribPointer(f.a_bufferAA._pName,this._noOutlineBuffer.itemSize,d.FLOAT,!1,0,0);d.uniform1f(e.uZ._pName,-10);d.drawArrays(d.TRIANGLES,0,this._vertexBuffer.numItems)};
og.LabelHandler.prototype._pickingPASS=function(){var c=this._renderer,d=c.handler;d.shaderPrograms.labelPicking.activate();var e=d.shaderPrograms.labelPicking._program,f=e.attributes,e=e.uniforms,d=d.gl;d.uniformMatrix4fv(e.viewMatrix._pName,!1,c.activeCamera._viewMatrix._m);d.uniformMatrix4fv(e.projectionMatrix._pName,!1,c.activeCamera._projectionMatrix._m);d.uniform3fv(e.uCamPos._pName,c.activeCamera.eye.toVec());d.uniform3fv(e.uScaleByDistance._pName,this._entityCollection.scaleByDistance);d.uniform1f(e.uOpacity._pName,
this._entityCollection._animatedOpacity);d.uniform2fv(e.uFloatParams._pName,[this._entityCollection.renderNode._planetRadius2||0,c.activeCamera._tanViewAngle_hradOneByHeight]);d.bindBuffer(d.ARRAY_BUFFER,this._vertexBuffer);d.vertexAttribPointer(f.a_vertices._pName,this._vertexBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._texCoordBuffer);d.vertexAttribPointer(f.a_texCoord._pName,this._texCoordBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._positionBuffer);d.vertexAttribPointer(f.a_positions._pName,
this._positionBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._sizeBuffer);d.vertexAttribPointer(f.a_size._pName,this._sizeBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._offsetBuffer);d.vertexAttribPointer(f.a_offset._pName,this._offsetBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._rotationBuffer);d.vertexAttribPointer(f.a_rotation._pName,this._rotationBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._alignedAxisBuffer);d.vertexAttribPointer(f.a_alignedAxis._pName,
this._alignedAxisBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this._pickingColorBuffer);d.vertexAttribPointer(f.a_pickingColor._pName,this._pickingColorBuffer.itemSize,d.FLOAT,!1,0,0);d.drawArrays(d.TRIANGLES,0,this._vertexBuffer.numItems)};
og.LabelHandler.prototype._removeBillboard=function(c){var d=c._handlerIndex;this._billboards.splice(d,1);var e=24*this._maxLetters,f=d*e;this._rgbaArr.splice(f,e);this._outlineColorArr.splice(f,e);this._texCoordArr.splice(f,e);this._positionArr.splice(f,e);e=18*this._maxLetters;f=d*e;this._offsetArr.splice(f,e);this._alignedAxisArr.splice(f,e);this._pickingColorArr.splice(f,e);e=12*this._maxLetters;f=d*e;this._vertexArr.splice(f,e);this._outlineArr.splice(f,e);this._noOutlineArr.splice(f,e);e=6*
this._maxLetters;f=d*e;this._sizeArr.splice(f,e);this._rotationArr.splice(f,e);this._fontIndexArr.splice(f,e);this.reindexBillbordsArray(d);this.refresh();c._handlerIndex=-1;c._handler=null};
og.LabelHandler.prototype.setText=function(c,d,e,f){if(e=this._entityCollection.renderNode.fontAtlas.atlasesArr[e]){c=24*c*this._maxLetters;var g=this._texCoordArr,h,k,m=e.nodes[d[0]],l=m?m.emptySize:0,n=l;for(h=0;h<d.length;h++){k=c+24*h;var m=e.nodes[d[h]]||e.nodes[" "],p=m.texCoords;g[k]=p[0];g[k+1]=p[1];g[k+2]=n;g[k+3]=0;g[k+4]=p[2];g[k+5]=p[3];g[k+6]=n;g[k+7]=0;g[k+8]=p[4];g[k+9]=p[5];g[k+10]=n;g[k+11]=0;g[k+12]=p[6];g[k+13]=p[7];g[k+14]=n;g[k+15]=0;g[k+16]=p[8];g[k+17]=p[9];g[k+18]=n;g[k+19]=
0;g[k+20]=p[10];g[k+21]=p[11];g[k+22]=n;g[k+23]=0;n+=m.emptySize}if(f==og.Label.CENTER)for(n=.5*(l+49/512-n),h=0;h<d.length;h++)k=c+24*h,g[k+3]=n,g[k+7]=n,g[k+11]=n,g[k+15]=n,g[k+19]=n,g[k+23]=n;else if(f==og.Label.LEFT)for(n=l+49/512-n,h=0;h<d.length;h++)k=c+24*h,g[k+3]=n,g[k+7]=n,g[k+11]=n,g[k+15]=n,g[k+19]=n,g[k+23]=n;for(;h<this._maxLetters;h++)k=c+24*h,g[k+2]=-1,g[k+6]=-1,g[k+10]=-1,g[k+14]=-1,g[k+18]=-1,g[k+17]=-1;this._changedBuffers[og.BillboardHandler.TEXCOORD_BUFFER]=!0}};
og.LabelHandler.prototype.setPositionArr=function(c,d){for(var e=24*c*this._maxLetters,f=this._positionArr,g=d.x,h=d.y,k=d.z,m=0;m<this._maxLetters;m++){var l=e+24*m;f[l]=g;f[l+1]=h;f[l+2]=k;f[l+4]=g;f[l+5]=h;f[l+6]=k;f[l+8]=g;f[l+9]=h;f[l+10]=k;f[l+12]=g;f[l+13]=h;f[l+14]=k;f[l+16]=g;f[l+17]=h;f[l+18]=k;f[l+20]=g;f[l+21]=h;f[l+22]=k}this._changedBuffers[og.BillboardHandler.POSITION_BUFFER]=!0};
og.LabelHandler.prototype.setScaleArr=function(c,d){for(var e=24*c*this._maxLetters,f=this._positionArr,g=0;g<this._maxLetters;g++){var h=e+24*g;f[h+3]=d;f[h+7]=d;f[h+11]=d;f[h+15]=d;f[h+19]=d;f[h+23]=d}this._changedBuffers[og.BillboardHandler.POSITION_BUFFER]=!0};
og.LabelHandler.prototype.setPickingColorArr=function(c,d){for(var e=18*c*this._maxLetters,f=this._pickingColorArr,g=d.x/255,h=d.y/255,k=d.z/255,m=0;m<this._maxLetters;m++){var l=e+18*m;f[l]=g;f[l+1]=h;f[l+2]=k;f[l+3]=g;f[l+4]=h;f[l+5]=k;f[l+6]=g;f[l+7]=h;f[l+8]=k;f[l+9]=g;f[l+10]=h;f[l+11]=k;f[l+12]=g;f[l+13]=h;f[l+14]=k;f[l+15]=g;f[l+16]=h;f[l+17]=k}this._changedBuffers[og.BillboardHandler.PICKINGCOLOR_BUFFER]=!0};
og.LabelHandler.prototype.setSizeArr=function(c,d){for(var e=6*c*this._maxLetters,f=this._sizeArr,g=0;g<this._maxLetters;g++){var h=e+6*g;f[h]=d;f[h+1]=d;f[h+2]=d;f[h+3]=d;f[h+4]=d;f[h+5]=d}this._changedBuffers[og.BillboardHandler.SIZE_BUFFER]=!0};
og.LabelHandler.prototype.setOffsetArr=function(c,d){for(var e=18*c*this._maxLetters,f=this._offsetArr,g=d.x,h=d.y,k=d.z,m=0;m<this._maxLetters;m++){var l=e+18*m;f[l]=g;f[l+1]=h;f[l+2]=k;f[l+3]=g;f[l+4]=h;f[l+5]=k;f[l+6]=g;f[l+7]=h;f[l+8]=k;f[l+9]=g;f[l+10]=h;f[l+11]=k;f[l+12]=g;f[l+13]=h;f[l+14]=k;f[l+15]=g;f[l+16]=h;f[l+17]=k}this._changedBuffers[og.BillboardHandler.OFFSET_BUFFER]=!0};
og.LabelHandler.prototype.setRgbaArr=function(c,d){for(var e=24*c*this._maxLetters,f=this._rgbaArr,g=d.x,h=d.y,k=d.z,m=d.w,l=0;l<this._maxLetters;l++){var n=e+24*l;f[n]=g;f[n+1]=h;f[n+2]=k;f[n+3]=m;f[n+4]=g;f[n+5]=h;f[n+6]=k;f[n+7]=m;f[n+8]=g;f[n+9]=h;f[n+10]=k;f[n+11]=m;f[n+12]=g;f[n+13]=h;f[n+14]=k;f[n+15]=m;f[n+16]=g;f[n+17]=h;f[n+18]=k;f[n+19]=m;f[n+20]=g;f[n+21]=h;f[n+22]=k;f[n+23]=m}this._changedBuffers[og.BillboardHandler.RGBA_BUFFER]=!0};
og.LabelHandler.prototype.setOutlineColorArr=function(c,d){for(var e=24*c*this._maxLetters,f=this._outlineColorArr,g=d.x,h=d.y,k=d.z,m=d.w,l=0;l<this._maxLetters;l++){var n=e+24*l;f[n]=g;f[n+1]=h;f[n+2]=k;f[n+3]=m;f[n+4]=g;f[n+5]=h;f[n+6]=k;f[n+7]=m;f[n+8]=g;f[n+9]=h;f[n+10]=k;f[n+11]=m;f[n+12]=g;f[n+13]=h;f[n+14]=k;f[n+15]=m;f[n+16]=g;f[n+17]=h;f[n+18]=k;f[n+19]=m;f[n+20]=g;f[n+21]=h;f[n+22]=k;f[n+23]=m}this._changedBuffers[og.LabelHandler.OUTLINECOLOR_BUFFER]=!0};
og.LabelHandler.prototype.setOutlineArr=function(c,d){for(var e=12*c*this._maxLetters,f=this._outlineArr,g=0;g<this._maxLetters;g++){var h=e+12*g;f[h]=d;f[h+2]=d;f[h+4]=d;f[h+6]=d;f[h+8]=d;f[h+10]=d}this._changedBuffers[og.LabelHandler.OUTLINE_BUFFER]=!0};
og.LabelHandler.prototype.setRotationArr=function(c,d){for(var e=6*c*this._maxLetters,f=this._rotationArr,g=0;g<this._maxLetters;g++){var h=e+6*g;f[h]=d;f[h+1]=d;f[h+2]=d;f[h+3]=d;f[h+4]=d;f[h+5]=d}this._changedBuffers[og.BillboardHandler.ROTATION_BUFFER]=!0};
og.LabelHandler.prototype.setVertexArr=function(c,d){for(var e=12*c*this._maxLetters,f=this._vertexArr,g=0;g<this._maxLetters;g++){var h=e+12*g;f[h]=d[0];f[h+1]=d[1];f[h+2]=d[2];f[h+3]=d[3];f[h+4]=d[4];f[h+5]=d[5];f[h+6]=d[6];f[h+7]=d[7];f[h+8]=d[8];f[h+9]=d[9];f[h+10]=d[10];f[h+11]=d[11]}this._changedBuffers[og.BillboardHandler.VERTEX_BUFFER]=!0};
og.LabelHandler.prototype.setAlignedAxisArr=function(c,d){for(var e=18*c*this._maxLetters,f=this._alignedAxisArr,g=d.x,h=d.y,k=d.z,m=0;m<this._maxLetters;m++){var l=e+18*m;f[l]=g;f[l+1]=h;f[l+2]=k;f[l+3]=g;f[l+4]=h;f[l+5]=k;f[l+6]=g;f[l+7]=h;f[l+8]=k;f[l+9]=g;f[l+10]=h;f[l+11]=k;f[l+12]=g;f[l+13]=h;f[l+14]=k;f[l+15]=g;f[l+16]=h;f[l+17]=k}this._changedBuffers[og.BillboardHandler.ALIGNEDAXIS_BUFFER]=!0};
og.LabelHandler.prototype.setFontIndexArr=function(c,d){for(var e=6*c*this._maxLetters,f=this._fontIndexArr,g=0;g<this._maxLetters;g++){var h=e+6*g;f[h]=d;f[h+1]=d;f[h+2]=d;f[h+3]=d;f[h+4]=d;f[h+5]=d}this._changedBuffers[og.LabelHandler.FONTINDEX_BUFFER]=!0};og.LabelHandler.prototype.createSizeBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._sizeBuffer);this._sizeBuffer=c.createArrayBuffer(new Float32Array(this._sizeArr),1,this._sizeArr.length)};
og.LabelHandler.prototype.createFontIndexBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._fontIndexBuffer);this._fontIndexBuffer=c.createArrayBuffer(new Float32Array(this._fontIndexArr),1,this._fontIndexArr.length)};og.LabelHandler.prototype.createTexCoordBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._texCoordBuffer);this._texCoordBuffer=c.createArrayBuffer(new Float32Array(this._texCoordArr),4,this._texCoordArr.length/4)};
og.LabelHandler.prototype.createOutlineBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._outlineBuffer);this._outlineBuffer=c.createArrayBuffer(new Float32Array(this._outlineArr),2,this._outlineArr.length/2);c.gl.deleteBuffer(this._noOutlineBuffer);this._noOutlineBuffer=c.createArrayBuffer(new Float32Array(this._noOutlineArr),2,this._noOutlineArr.length/2)};
og.BillboardHandler.prototype.createOutlineColorBuffer=function(){var c=this._renderer.handler;c.gl.deleteBuffer(this._outlineColorBuffer);this._outlineColorBuffer=c.createArrayBuffer(new Float32Array(this._outlineColorArr),4,this._outlineColorArr.length/4)};og.LabelHandler.prototype.setMaxLetters=function(c){this._maxLetters=c};og.LabelHandler.prototype.refreshTexCoordsArr=function(){return null};og.shaderProgram.lineString=function(){return new og.shaderProgram.ShaderProgram("lineString",{uniforms:{proj:{type:og.shaderProgram.types.MAT4},view:{type:og.shaderProgram.types.MAT4},viewport:{type:og.shaderProgram.types.VEC2},thickness:{type:og.shaderProgram.types.FLOAT},color:{type:og.shaderProgram.types.VEC4},uCamPos:{type:og.shaderProgram.types.VEC3},uFloatParams:{type:og.shaderProgram.types.VEC2},pickingColor:{type:og.shaderProgram.types.VEC3}},attributes:{prev:{type:og.shaderProgram.types.VEC3,
enableArray:!0},current:{type:og.shaderProgram.types.VEC3,enableArray:!0},next:{type:og.shaderProgram.types.VEC3,enableArray:!0},order:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:"attribute vec3 prev;\r\n            attribute vec3 current;\r\n            attribute vec3 next;\r\n            attribute vec2 order;\r\n            uniform mat4 proj;\r\n            uniform mat4 view;\r\n            uniform vec2 viewport;\r\n            uniform float thickness;\r\n            vec2 project(vec4 p){\r\n                return (0.5 * p.xyz / p.w + 0.5).xy * viewport;\r\n            }\r\n            const float C = 0.1;\r\n            const float far = 149.6e+9;\r\n            float logc = 2.0 / log( C * far + 1.0 );\r\n            const float NEAR = -1.0;\r\n            varying vec3 vPos;\r\n            void main(){\r\n                vPos = current;\r\n                vec4 vCurrent = view * vec4(current, 1.0);\r\n                vec4 vPrev = view * vec4(prev, 1.0);\r\n                vec4 vNext = view * vec4(next, 1.0);\r\n                /*Clip near plane*/\r\n                if(vCurrent.z > NEAR) {\r\n                    if(vPrev.z < NEAR){\r\n                        /*to the begining path view*/\r\n                        vCurrent = vPrev + (vCurrent - vPrev) * (NEAR - vPrev.z) / (vCurrent.z - vPrev.z);\r\n                    }else if(vNext.z < NEAR){\r\n                        /*to the end path view*/\r\n                        vPrev = vPrev + (vCurrent - vPrev) * (NEAR - vPrev.z) / (vCurrent.z - vPrev.z);\r\n                        vCurrent = vNext + (vCurrent - vNext) * (NEAR - vNext.z) / (vCurrent.z - vNext.z);\r\n                    }\r\n                } else if( vPrev.z > NEAR) {\r\n                    /*to the end path view*/\r\n                    vPrev = vPrev + (vCurrent - vPrev) * (NEAR - vPrev.z) / (vCurrent.z - vPrev.z);\r\n                } else if( vNext.z > NEAR) {\r\n                    /*to the begining path view*/\r\n                    vNext = vNext + (vCurrent - vNext) * (NEAR - vNext.z) / (vCurrent.z - vNext.z);\r\n                }\r\n                vec4 dCurrent = proj * vCurrent;\r\n                vec2 sCurrent = project(dCurrent);\r\n                vec2 dirNext = project(proj * vNext) - sCurrent;\r\n                vec2 sNormalNext = normalize(vec2(-dirNext.y, dirNext.x));\r\n                vec2 dirPrev = normalize(project(proj * vPrev) - sCurrent);\r\n                vec2 sNormalPrev = normalize(vec2(-dirPrev.y, dirPrev.x));\r\n                vec2 dir = sNormalNext - sNormalPrev;\r\n                float sinA = dirPrev.x * dir.y - dirPrev.y * dir.x;\r\n                if( abs(sinA) < 0.2 ) {\r\n                    if(order.x == 1.0){\r\n                        dir = sNormalPrev;\r\n                    } else {\r\n                        dir = sNormalNext;\r\n                    }\r\n                } else {\r\n                    dir *= order.x / sinA;\r\n                }\r\n                gl_Position = vec4((2.0 * (sCurrent + dir * thickness * order.y) / viewport - 1.0) * dCurrent.w, dCurrent.z, dCurrent.w);\r\n                gl_Position.z = ( log( C * gl_Position.w + 1.0 ) * logc - 1.0 ) * gl_Position.w;\r\n            }",
fragmentShader:"#extension GL_EXT_draw_buffers : require\n\r\n            #ifdef GL_ES\n\r\n            #ifdef GL_FRAGMENT_PRECISION_HIGH\n\r\n            precision highp float;\n\r\n            #else\n\r\n            precision mediump float;\n\r\n            #endif // GL_FRAGMENT_PRECISION_HIGH\n\r\n            #endif // GL_ES\n\r\n            uniform vec3 pickingColor;\r\n            uniform vec4 color;\r\n            uniform vec2 uFloatParams;\r\n            uniform vec3 uCamPos;\r\n            varying vec3 vPos;\r\n            void main(void) {\r\n                vec3 look = vPos - uCamPos;\r\n                float lookLength = length(look);\r\n                float a = color.a * step(lookLength, sqrt(dot(uCamPos,uCamPos) - uFloatParams[0]) + sqrt(dot(vPos,vPos) - uFloatParams[0]));\r\n                gl_FragData[0] = vec4(color.rgb, a);\r\n                gl_FragData[1] = vec4(pickingColor, 1.0);\r\n            }"})};og.LineStringHandler=function(c){this._entityCollection=c;this._renderer=null;this._lineStrings=[];this.__staticId=og.LineStringHandler.staticCounter++};og.LineStringHandler.staticCounter=0;og.LineStringHandler.prototype._initShaderProgram=function(){this._renderer.handler&&(this._renderer.handler.shaderPrograms.lineString||this._renderer.handler.addShaderProgram(og.shaderProgram.lineString()))};
og.LineStringHandler.prototype.setRenderNode=function(c){this._renderer=c.renderer;this._initShaderProgram();for(var d=0;d<this._lineStrings.length;d++)this._lineStrings[d].setRenderNode(c)};og.LineStringHandler.prototype.add=function(c){-1==c._handlerIndex&&(c._handler=this,c._handlerIndex=this._lineStrings.length,this._lineStrings.push(c),this._entityCollection&&this._entityCollection.renderNode&&c.setRenderNode(this._entityCollection.renderNode))};
og.LineStringHandler.prototype.remove=function(c){var d=c._handlerIndex;-1!==d&&(c._deleteBuffers(),c._handlerIndex=-1,c._handler=null,this._lineStrings.splice(d,1),this.reindexLineStringArray(d))};og.LineStringHandler.prototype.reindexLineStringArray=function(c){for(var d=this._lineStrings;c<d.length;c++)d[c]._handlerIndex=c};og.LineStringHandler.prototype.draw=function(){for(var c=this._lineStrings.length;c--;)this._lineStrings[c].draw()};
og.LineStringHandler.prototype.clear=function(){for(var c=this._lineStrings.length;c--;)this._lineStrings[c]._deleteBuffers(),this._lineStrings[c]._handler=null,this._lineStrings[c]._handlerIndex=-1;this._lineStrings.length=0;this._lineStrings=[]};og.shaderProgram.shape_wl=function(){return new og.shaderProgram.ShaderProgram("shape_wl",{uniforms:{viewMatrix:{type:og.shaderProgram.types.MAT4},projectionMatrix:{type:og.shaderProgram.types.MAT4},modelMatrix:{type:og.shaderProgram.types.MAT4},normalMatrix:{type:og.shaderProgram.types.MAT4},lightsPositions:{type:og.shaderProgram.types.VEC4},lightsParamsv:{type:og.shaderProgram.types.VEC3},lightsParamsf:{type:og.shaderProgram.types.FLOAT},uColor:{type:og.shaderProgram.types.VEC4},uSampler:{type:og.shaderProgram.types.SAMPLER2D}},
attributes:{aVertexNormal:{type:og.shaderProgram.types.VEC3,enableArray:!0},aVertexPosition:{type:og.shaderProgram.types.VEC3,enableArray:!0},aTextureCoord:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:"attribute vec3 aVertexNormal;\r\n            attribute vec3 aVertexPosition;\r\n            attribute vec2 aTextureCoord;\r\n            uniform mat4 projectionMatrix;\r\n            uniform mat4 viewMatrix;\r\n            uniform mat4 modelMatrix;\r\n            uniform mat3 normalMatrix;\r\n            varying vec2 vTextureCoord;\r\n            varying vec3 vNormal;\r\n            varying vec4 vPosition;\r\n            const float C = 0.1;\r\n            const float far = 149.6e+9;\r\n            float logc = 2.0 / log( C * far + 1.0 );\r\n            void main(void) {\r\n                vTextureCoord = aTextureCoord;\r\n                vNormal = normalMatrix * aVertexNormal;\r\n                vPosition = viewMatrix * modelMatrix * vec4(aVertexPosition, 1.0);\r\n                gl_Position = projectionMatrix * vPosition;\r\n                gl_Position.z = ( log( C * gl_Position.w + 1.0 ) * logc - 1.0 ) * gl_Position.w;\r\n            }",
fragmentShader:"#ifdef GL_ES\n\r\n            #ifdef GL_FRAGMENT_PRECISION_HIGH\n\r\n            precision highp float;\n\r\n            #else\n\r\n            precision mediump float;\n\r\n            #endif // GL_FRAGMENT_PRECISION_HIGH\n\r\n            #endif // GL_ES\n\r\n            varying vec2 vTextureCoord;\r\n            varying vec3 vNormal;\r\n            varying vec4 vPosition;\r\n            uniform vec4 uColor;\r\n            uniform sampler2D uSampler;\n\r\n            #define MAX_POINT_LIGHTS 1\n\r\n            uniform int lightsQuantity;\r\n            uniform vec4 lightsPositions[MAX_POINT_LIGHTS];\r\n            uniform vec3 lightsParamsv[MAX_POINT_LIGHTS * 3];\r\n            uniform float lightsParamsf[MAX_POINT_LIGHTS];\r\n            void main(void) {\r\n                vec3 lightWeighting;\r\n                vec3 lightDirection;\r\n                vec3 normal;\r\n                vec3 eyeDirection;\r\n                vec3 reflectionDirection;\r\n                float specularLightWeighting;\r\n                float diffuseLightWeighting;\r\n                lightDirection = normalize(lightsPositions[0].xyz - vPosition.xyz * lightsPositions[0].w);\r\n                normal = normalize(vNormal);\r\n                eyeDirection = normalize(-vPosition.xyz);\r\n                reflectionDirection = reflect(-lightDirection, normal);\r\n                specularLightWeighting = pow(max(dot(reflectionDirection, eyeDirection), 0.0), lightsParamsf[0]);\r\n                diffuseLightWeighting = max(dot(normal, lightDirection), 0.0);\r\n                lightWeighting = lightsParamsv[0] + lightsParamsv[1] * diffuseLightWeighting + lightsParamsv[2] * specularLightWeighting;\r\n                vec4 cc = texture2D( uSampler, vTextureCoord.st );\r\n                gl_FragColor = vec4(lightWeighting, uColor.a) * cc * uColor;\r\n            }"})};
og.shaderProgram.shape_nl=function(){return new og.shaderProgram.ShaderProgram("shape_nl",{uniforms:{projectionViewMatrix:{type:og.shaderProgram.types.MAT4},modelMatrix:{type:og.shaderProgram.types.MAT4},uColor:{type:og.shaderProgram.types.VEC4},uSampler:{type:og.shaderProgram.types.SAMPLER2D}},attributes:{aVertexPosition:{type:og.shaderProgram.types.VEC3,enableArray:!0},aTextureCoord:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:"attribute vec3 aVertexPosition;\r\n            attribute vec2 aTextureCoord;\r\n            uniform mat4 projectionViewMatrix;\r\n            uniform mat4 modelMatrix;\r\n            varying vec2 vTextureCoord;\r\n            const float C = 0.1;\r\n            const float far = 149.6e+9;\r\n            float logc = 2.0 / log( C * far + 1.0 );\r\n            void main(void) {\r\n                gl_Position = projectionViewMatrix * (modelMatrix * vec4(aVertexPosition, 1.0));\r\n                gl_Position.z = ( log( C * gl_Position.w + 1.0 ) * logc - 1.0 ) * gl_Position.w;\r\n                vTextureCoord = aTextureCoord;\r\n            }",
fragmentShader:"#ifdef GL_ES\n\r\n            #ifdef GL_FRAGMENT_PRECISION_HIGH\n\r\n            precision highp float;\n\r\n            #else\n\r\n            precision mediump float;\n\r\n            #endif // GL_FRAGMENT_PRECISION_HIGH\n\r\n            #endif // GL_ES\n\r\n            uniform vec4 uColor;\r\n            uniform sampler2D uSampler;\r\n            varying vec2 vTextureCoord;\r\n            void main(void) {\r\n                gl_FragColor = uColor*texture2D( uSampler, vTextureCoord.st );\r\n            }"})};og.math.Matrix3=function(){this._m=Array(9)};og.math.Matrix3.prototype.set=function(c){this._m[0]=c[0];this._m[1]=c[1];this._m[2]=c[2];this._m[3]=c[3];this._m[4]=c[4];this._m[5]=c[5];this._m[6]=c[6];this._m[7]=c[7];this._m[8]=c[8];return this};og.math.Matrix3.prototype.clone=function(){var c=new og.math.Matrix3;c.set(this);return c};og.math.Matrix3.prototype.copy=function(c){return this.set(c._m)};
og.math.Matrix3.prototype.transposeTo=function(){var c=new og.math.Matrix3,d=this._m;c._m[0]=d[0];c._m[1]=d[3];c._m[2]=d[6];c._m[3]=d[1];c._m[4]=d[4];c._m[5]=d[7];c._m[6]=d[2];c._m[7]=d[5];c._m[8]=d[8];return c};og.math.Matrix3.prototype.setIdentity=function(){this._m[0]=1;this._m[1]=0;this._m[2]=0;this._m[3]=0;this._m[4]=1;this._m[5]=0;this._m[6]=0;this._m[7]=0;this._m[8]=1;return this};
og.math.Matrix3.prototype.mulVec=function(c){var d=c.x,e=c.y;c=c.z;var f=this._m;return new og.math.Vector3(f[0]*d+f[3]*e+f[6]*c,f[1]*d+f[4]*e+f[7]*c,f[2]*d+f[5]*e+f[8]*c)};og.math.Matrix3.prototype.toMatrix4=function(){var c=new og.math.Matrix4,d=c._m,e=this._m;d[0]=e[0];d[1]=e[1];d[2]=e[2];d[3]=0;d[4]=e[3];d[5]=e[4];d[6]=e[5];d[7]=0;d[8]=e[6];d[9]=e[7];d[10]=e[8];d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return c};og.math.Matrix4=function(){this._m=Array(16)};og.math.Matrix4.identity=function(){var c=new og.math.Matrix4;c._m[0]=1;c._m[1]=0;c._m[2]=0;c._m[3]=0;c._m[4]=0;c._m[5]=1;c._m[6]=0;c._m[7]=0;c._m[8]=0;c._m[9]=0;c._m[10]=1;c._m[11]=0;c._m[12]=0;c._m[13]=0;c._m[14]=0;c._m[15]=1;return c};
og.math.Matrix4.prototype.set=function(c){this._m[0]=c[0];this._m[1]=c[1];this._m[2]=c[2];this._m[3]=c[3];this._m[4]=c[4];this._m[5]=c[5];this._m[6]=c[6];this._m[7]=c[7];this._m[8]=c[8];this._m[9]=c[9];this._m[10]=c[10];this._m[11]=c[11];this._m[12]=c[12];this._m[13]=c[13];this._m[14]=c[14];this._m[15]=c[15];return this};og.math.Matrix4.prototype.clone=function(){var c=new og.math.Matrix4;c.set(this);return c};og.math.Matrix4.prototype.copy=function(c){this.set(c._m)};
og.math.Matrix4.prototype.toMatrix3=function(){var c=new og.math.Matrix3,d=this._m,e=c._m;e[0]=d[0];e[1]=d[1];e[2]=d[2];e[3]=d[4];e[4]=d[5];e[5]=d[6];e[6]=d[8];e[7]=d[9];e[8]=d[10];return c};og.math.Matrix4.prototype.mulVec3=function(c){var d=c.x,e=c.y;c=c.z;return new og.math.Vector3(this._m[0]*d+this._m[4]*e+this._m[8]*c+this._m[12],this._m[1]*d+this._m[5]*e+this._m[9]*c+this._m[13],this._m[2]*d+this._m[6]*e+this._m[10]*c+this._m[14])};
og.math.Matrix4.prototype.mulVec4=function(c){var d=c.x,e=c.y,f=c.z;c=c.w;return new og.math.Vector4(this._m[0]*d+this._m[4]*e+this._m[8]*f+this._m[12]*c,this._m[1]*d+this._m[5]*e+this._m[9]*f+this._m[13]*c,this._m[2]*d+this._m[6]*e+this._m[10]*f+this._m[14]*c,this._m[3]*d+this._m[7]*e+this._m[11]*f+this._m[15]*c)};
og.math.Matrix4.prototype.toInverseMatrix3=function(){var c=this._m,d=c[0],e=c[1],f=c[2],g=c[4],h=c[5],k=c[6],m=c[8],l=c[9],c=c[10],n=c*h-k*l,p=-c*g+k*m,q=l*g-h*m,r=d*n+e*p+f*q;if(!r)return null;var r=1/r,t=new og.math.Matrix3;t._m[0]=n*r;t._m[1]=(-c*e+f*l)*r;t._m[2]=(k*e-f*h)*r;t._m[3]=p*r;t._m[4]=(c*d-f*m)*r;t._m[5]=(-k*d+f*g)*r;t._m[6]=q*r;t._m[7]=(-l*d+e*m)*r;t._m[8]=(h*d-e*g)*r;return t};
og.math.Matrix4.prototype.inverseTo=function(){var c=this._m[0],d=this._m[1],e=this._m[2],f=this._m[3],g=this._m[4],h=this._m[5],k=this._m[6],m=this._m[7],l=this._m[8],n=this._m[9],p=this._m[10],q=this._m[11],r=this._m[12],t=this._m[13],u=this._m[14],B=this._m[15],v=c*h-d*g,E=c*k-e*g,F=c*m-f*g,H=d*k-e*h,J=d*m-f*h,C=e*m-f*k,A=l*t-n*r,D=l*u-p*r,I=l*B-q*r,G=n*u-p*t,L=n*B-q*t,K=p*B-q*u,N=1/(v*K-E*L+F*G+H*I-J*D+C*A),M=new og.math.Matrix4;M._m[0]=(h*K-k*L+m*G)*N;M._m[1]=(-d*K+e*L-f*G)*N;M._m[2]=(t*C-u*
J+B*H)*N;M._m[3]=(-n*C+p*J-q*H)*N;M._m[4]=(-g*K+k*I-m*D)*N;M._m[5]=(c*K-e*I+f*D)*N;M._m[6]=(-r*C+u*F-B*E)*N;M._m[7]=(l*C-p*F+q*E)*N;M._m[8]=(g*L-h*I+m*A)*N;M._m[9]=(-c*L+d*I-f*A)*N;M._m[10]=(r*J-t*F+B*v)*N;M._m[11]=(-l*J+n*F-q*v)*N;M._m[12]=(-g*G+h*D-k*A)*N;M._m[13]=(c*G-d*D+e*A)*N;M._m[14]=(-r*H+t*E-u*v)*N;M._m[15]=(l*H-n*E+p*v)*N;return M};
og.math.Matrix4.prototype.transposeTo=function(){var c=new og.math.Matrix4;c._m[0]=this._m[0];c._m[1]=this._m[4];c._m[2]=this._m[8];c._m[3]=this._m[12];c._m[4]=this._m[1];c._m[5]=this._m[5];c._m[6]=this._m[9];c._m[7]=this._m[13];c._m[8]=this._m[2];c._m[9]=this._m[6];c._m[10]=this._m[10];c._m[11]=this._m[14];c._m[12]=this._m[3];c._m[13]=this._m[7];c._m[14]=this._m[11];c._m[15]=this._m[15];return c};
og.math.Matrix4.prototype.setIdentity=function(){this._m[0]=1;this._m[1]=0;this._m[2]=0;this._m[3]=0;this._m[4]=0;this._m[5]=1;this._m[6]=0;this._m[7]=0;this._m[8]=0;this._m[9]=0;this._m[10]=1;this._m[11]=0;this._m[12]=0;this._m[13]=0;this._m[14]=0;this._m[15]=1;return this};
og.math.Matrix4.prototype.mul=function(c){var d=this._m[0],e=this._m[1],f=this._m[2],g=this._m[3],h=this._m[4],k=this._m[5],m=this._m[6],l=this._m[7],n=this._m[8],p=this._m[9],q=this._m[10],r=this._m[11],t=this._m[12],u=this._m[13],B=this._m[14];a=this._m[15];var v=c._m[0],E=c._m[1],F=c._m[2],H=c._m[3],J=c._m[4],C=c._m[5],A=c._m[6],D=c._m[7],I=c._m[8],G=c._m[9],L=c._m[10],K=c._m[11],N=c._m[12],M=c._m[13],O=c._m[14];b=c._m[15];c=new og.math.Matrix4;c._m[0]=v*d+E*h+F*n+H*t;c._m[1]=v*e+E*k+F*p+H*u;c._m[2]=
v*f+E*m+F*q+H*B;c._m[3]=v*g+E*l+F*r+H*a;c._m[4]=J*d+C*h+A*n+D*t;c._m[5]=J*e+C*k+A*p+D*u;c._m[6]=J*f+C*m+A*q+D*B;c._m[7]=J*g+C*l+A*r+D*a;c._m[8]=I*d+G*h+L*n+K*t;c._m[9]=I*e+G*k+L*p+K*u;c._m[10]=I*f+G*m+L*q+K*B;c._m[11]=I*g+G*l+L*r+K*a;c._m[12]=N*d+M*h+O*n+b*t;c._m[13]=N*e+M*k+O*p+b*u;c._m[14]=N*f+M*m+O*q+b*B;c._m[15]=N*g+M*l+O*r+b*a;return c};
og.math.Matrix4.prototype.translate=function(c){var d=c.x,e=c.y;c=c.z;var f=this._m;f[12]=f[0]*d+f[4]*e+f[8]*c+f[12];f[13]=f[1]*d+f[5]*e+f[9]*c+f[13];f[14]=f[2]*d+f[6]*e+f[10]*c+f[14];f[15]=f[3]*d+f[7]*e+f[11]*c+f[15];return this};og.math.Matrix4.prototype.translateToPosition=function(c){var d=this._m;d[12]=c.x;d[13]=c.y;d[14]=c.z;return this};
og.math.Matrix4.prototype.rotate=function(c,d){var e=Math.cos(d),f=Math.sin(d),g=this._m;g[0]=e+(1-e)*c.x*c.x;g[1]=(1-e)*c.y*c.x-f*c.z;g[2]=(1-e)*c.z*c.x+f*c.y;g[3]=0;g[4]=(1-e)*c.x*c.y+f*c.z;g[5]=e+(1-e)*c.y*c.y;g[6]=(1-e)*c.z*c.y-f*c.x;g[7]=0;g[8]=(1-e)*c.x*c.z-f*c.y;g[9]=(1-e)*c.y*c.z+f*c.x;g[10]=e+(1-e)*c.z*c.z;g[11]=0;g[12]=0;g[13]=0;g[14]=0;g[15]=1;return this};og.math.Matrix4.prototype.rotateBetweenVectors=function(c,d){return og.math.Quaternion.getRotationBetweenVectors(c,d).getMatrix4()};
og.math.Matrix4.prototype.scale=function(c){var d=this._m;d[0]*=c.x;d[1]*=c.x;d[2]*=c.x;d[3]*=c.x;d[4]*=c.y;d[5]*=c.y;d[6]*=c.y;d[7]*=c.y;d[8]*=c.z;d[9]*=c.z;d[10]*=c.z;d[11]*=c.z;d[12]=d[12];d[13]=d[13];d[14]=d[14];d[15]=d[15];return this};
og.math.Matrix4.prototype.setFrustum=function(c,d,e,f,g,h){this.left=c;this.right=d;this.bottom=e;this.top=f;this.near=g;this.far=h;var k=d-c,m=f-e,l=h-g;this._m[0]=2*g/k;this._m[1]=0;this._m[2]=0;this._m[3]=0;this._m[4]=0;this._m[5]=2*g/m;this._m[6]=0;this._m[7]=0;this._m[8]=(d+c)/k;this._m[9]=(f+e)/m;this._m[10]=-(h+g)/l;this._m[11]=-1;this._m[12]=0;this._m[13]=0;this._m[14]=-(h*g*2)/l;this._m[15]=0;return this};
og.math.Matrix4.prototype.setPerspective=function(c,d,e,f){c=e*Math.tan(c*Math.PI/360);d*=c;return this.setFrustum(-d,d,-c,c,e,f)};og.math.Matrix4.prototype.setOrtho=function(c,d,e,f,g,h){this.left=c;this.right=d;this.bottom=e;this.top=f;this.near=g;this.far=h;var k=1/(c-d),m=1/(e-f),l=1/(g-h),n=this._m;n[0]=-2*k;n[1]=0;n[2]=0;n[3]=0;n[4]=0;n[5]=-2*m;n[6]=0;n[7]=0;n[8]=0;n[9]=0;n[10]=2*l;n[11]=0;n[12]=(c+d)*k;n[13]=(f+e)*m;n[14]=(h+g)*l;n[15]=1;return this};
og.math.Matrix4.prototype.eulerToMatrix=function(c,d,e){var f=Math.cos(c);c=Math.sin(c);var g=Math.cos(d);d=Math.sin(d);var h=Math.cos(e);e=Math.sin(e);var k=f*d,m=c*d,l=this._m;l[0]=g*h;l[1]=-g*e;l[2]=-d;l[4]=-m*h+f*e;l[5]=m*e+f*h;l[6]=-c*g;l[8]=k*h+c*e;l[9]=-k*e+c*h;l[10]=f*g;l[3]=l[7]=l[11]=l[12]=l[13]=l[14]=0;l[15]=1;return this};og.math.Matrix4.prototype.getEulerAngles=function(){};og.math.Quaternion=function(c,d,e,f){this.x=c||0;this.y=d||0;this.z=e||0;this.w=f||0};og.math.quaternion=function(c,d,e,f){return new og.math.Quaternion(c,d,e,f)};og.math.Quaternion.IDENTITY=new og.math.Quaternion(0,0,0,1);og.math.Quaternion.xRotation=function(c){c*=.5;return new og.math.Quaternion(Math.sin(c),0,0,Math.cos(c))};og.math.Quaternion.yRotation=function(c){c*=.5;return new og.math.Quaternion(0,Math.sin(c),0,Math.cos(c))};
og.math.Quaternion.zRotation=function(c){c*=.5;return new og.math.Quaternion(0,0,Math.sin(c),Math.cos(c))};og.math.Quaternion.axisAngleToQuat=function(c,d){var e=new og.math.Quaternion,f=c.normal(),g=.5*d,h=Math.sin(g);e.set(f.x*h,f.y*h,f.z*h,Math.cos(g));return e};
og.math.Quaternion.getLookAtTargetUp=function(c,d){var e=c.normal(),e=og.math.Vector3.OrthoNormalize(d,e),f=d.cross(e),g=new og.math.Quaternion;g.w=.5*Math.sqrt(1+f.x+d.y+e.z);var h=1/(4*g.w);g.x=(e.y-d.z)*h;g.y=(f.z-e.x)*h;g.z=(d.x-f.y)*h;return g};
og.math.Quaternion.getLookAtSourceDest=function(c,d){var e=d.subA(c).normalize(),f=og.math.Vector3.FORWARD.dot(e);if(1E-6>Math.abs(f- -1))return og.math.Quaternion.axisAngleToQuat(og.math.Vector3.UP,Math.PI);if(1E-6>Math.abs(f-1))return new og.math.Quaternion(0,0,0,1);f=Math.acos(f);e=og.math.Vector3.FORWARD.cross(e).normalize();return og.math.Quaternion.axisAngleToQuat(e,f)};og.math.Quaternion.getRotationBetweenVectors=function(c,d){var e=c.cross(d);return(new og.math.Quaternion(e.x,e.y,e.z,1+c.dot(d))).normalize()};
og.math.Quaternion.getRotationBetweenVectorsUp=function(c,d,e){var f=c.dot(d);if(1E-6>Math.abs(f+1))return og.math.Quaternion.axisAngleToQuat(e,Math.PI);if(1E-6>Math.abs(f-1))return new og.math.Quaternion(0,0,0,1);e=Math.acos(f);c=c.cross(d).normalize();return og.math.Quaternion.axisAngleToQuat(c,e)};og.math.Quaternion.prototype.clear=function(){this.x=this.y=this.z=this.w=0;return this};og.math.Quaternion.prototype.set=function(c,d,e,f){this.x=c;this.y=d;this.z=e;this.w=f;return this};
og.math.Quaternion.prototype.copy=function(c){this.x=c.x;this.y=c.y;this.z=c.z;this.w=c.w;return this};og.math.Quaternion.prototype.setIdentity=function(){this.z=this.y=this.x=0;this.w=1;return this};og.math.Quaternion.prototype.clone=function(){return new og.math.Quaternion(this.x,this.y,this.z,this.w)};og.math.Quaternion.prototype.add=function(c){return new og.math.Quaternion(this.x+c.x,this.y+c.y,this.z+c.z,this.w+c.w)};
og.math.Quaternion.prototype.sub=function(c){return new og.math.Quaternion(this.x-c.x,this.y-c.y,this.z-c.z,this.w-c.w)};og.math.Quaternion.prototype.scaleTo=function(c){return new og.math.Quaternion(this.x*c,this.y*c,this.z*c,this.w*c)};og.math.Quaternion.prototype.toVec=function(){var c=new og.math.GLArray(4);c[0]=this.x;c[1]=this.y;c[2]=this.z;c[3]=this.w;return c};
og.math.Quaternion.prototype.setFromSphericalCoords=function(c,d,e){var f=Math.sin(e/2);e=Math.cos(e/2);var g=Math.sin(c),h=Math.cos(d);this.x=f*Math.cos(c)*Math.sin(d);this.y=f*g;this.z=f*g*h;this.w=e;return this};og.math.Quaternion.prototype.toSphericalCoords=function(){var c=this.w,d=Math.sqrt(1-c*c);5E-4>Math.abs(d)&&(d=1);var e=this.x/d,f=this.z/d,d=-Math.asin(this.y/d),e=5E-4>e*e+f*f?0:Math.atan2(e,f);0>e&&(e+=360);return{lat:d,lon:e,alpha:Math.acos(c)}};
og.math.Quaternion.prototype.setFromAxisAngle=function(c,d){var e=c.normal(),f=.5*d,g=Math.sin(f);this.set(e.x*g,e.y*g,e.z*g,Math.cos(f));return this};og.math.Quaternion.prototype.getAxisAngle=function(){var c=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z),d;1E-7<c?(d=1/c,d=new og.math.Vector3(x*d,y*d,z*d),c=0>this.w?2*Math.atan2(-c,-w):2*Math.atan2(c,w)):(d=new og.math.Vector3(0,0,0),c=0);return{axis:d,angle:c}};
og.math.Quaternion.prototype.setFromEulerAngles=function(c,d,e){var f,g,h,k,m;f=c*og.math.RADIANS/2;g=d*og.math.RADIANS/2;h=e*og.math.RADIANS/2;e=Math.cos(f);d=Math.cos(g);c=Math.cos(h);f=Math.sin(f);g=Math.sin(g);h=Math.sin(h);k=d*c;m=g*h;this.w=e*k+f*m;this.x=f*k-e*m;this.y=e*g*c+f*d*h;this.z=e*d*h-f*g*c;return this.normalize()};og.math.Quaternion.prototype.getEulerAngles=function(){return this.getMatrix4().getEulerAngles()};
og.math.Quaternion.prototype.setFromMatrix4=function(c){var d,e,f=[],g,h;c=c._m;e=[1,2,0];d=c[0]+c[5]+c[10];0<d?(e=Math.sqrt(d+1),this.w=e/2,e=.5/e,this.x=(c[6]-c[9])*e,this.y=(c[8]-c[2])*e,this.z=(c[1]-c[4])*e):(d=0,c[5]>c[0]&&(d=1),c[10]>c[5*d]&&(d=2),g=e[d],h=e[g],e=Math.sqrt(c[5*d]-(c[5*g]+c[5*h])+1),f[d]=.5*e,0!=e&&(e=.5/e),f[3]=(c[4*g+h]-c[4*h+g])*e,f[g]=(c[4*d+g]+c[4*g+d])*e,f[h]=(c[4*d+h]+c[4*h+d])*e,this.x=f[0],this.y=f[1],this.z=f[2],this.w=f[3]);return this};
og.math.Quaternion.prototype.getMatrix4=function(){var c=new og.math.Matrix4,d=c._m,e=this.x,f=this.y,g=this.z,h=this.w,k=e+e,m=f+f,l=g+g,n=e*k,p=e*m,e=e*l,q=f*m,f=f*l,g=g*l,k=h*k,m=h*m,h=h*l;d[0]=1-(q+g);d[1]=p-h;d[2]=e+m;d[3]=0;d[4]=p+h;d[5]=1-(n+g);d[6]=f-k;d[7]=0;d[8]=e-m;d[9]=f+k;d[10]=1-(n+q);d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return c};
og.math.Quaternion.prototype.mulVec3=function(c){var d=c.x,e=c.y;c=c.z;var f=this.x,g=this.y,h=this.z,k=this.w,m=k*d+g*c-h*e,l=k*e+h*d-f*c,n=k*c+f*e-g*d,d=-f*d-g*e-h*c;return new og.math.Vector3(m*k+d*-f+l*-h-n*-g,l*k+d*-g+n*-f-m*-h,n*k+d*-h+m*-g-l*-f)};og.math.Quaternion.prototype.mul=function(c){var d=this.x,e=this.y,f=this.z,g=this.w,h=c.x,k=c.y,m=c.z;c=c.w;return new og.math.Quaternion(d*c+g*h+e*m-f*k,e*c+g*k+f*h-d*m,f*c+g*m+d*k-e*h,g*c-d*h-e*k-f*m)};
og.math.Quaternion.prototype.conjugate=function(){return new og.math.Quaternion(-this.x,-this.y,-this.z,this.w)};og.math.Quaternion.prototype.inverse=function(){var c=1/this.magnitude2();return new og.math.Quaternion(-this.x*c,-this.y*c,-this.z*c,this.w*c)};og.math.Quaternion.prototype.magnitude=function(){var c=this.x,d=this.y,e=this.z,f=this.w;return Math.sqrt(c*c+d*d+e*e+f*f)};og.math.Quaternion.prototype.magnitude2=function(){var c=this.x,d=this.y,e=this.z,f=this.w;return c*c+d*d+e*e+f*f};
og.math.Quaternion.prototype.dot=function(c){return this.x*c.x+this.y*c.y+this.z*c.z};og.math.Quaternion.prototype.normalize=function(){var c=this.x,d=this.y,e=this.z,f=this.w,g=Math.sqrt(c*c+d*d+e*e+f*f);if(0==g)return this.w=this.z=this.y=this.x=0,this;g=1/g;this.x=c*g;this.y=d*g;this.z=e*g;this.w=f*g;return this};og.math.Quaternion.prototype.isEqual=function(c){c=this.dot(c);return.001>Math.abs(c-1)?!0:!1};
og.math.Quaternion.prototype.slerp=function(c,d){var e=this.x,f=this.y,g=this.z,h=this.w,k=c.x,m=c.y,l=c.z,n=c.w,p,q,r;q=e*k+f*m+g*l+h*n;0>q&&(q=-q,k=-k,m=-m,l=-l,n=-n);1E-6<1-q?(p=Math.acos(q),r=Math.sin(p),q=Math.sin((1-d)*p)/r,p=Math.sin(d*p)/r):(q=1-d,p=d);return new og.math.Quaternion(q*e+p*k,q*f+p*m,q*g+p*l,q*h+p*n)};
og.math.Quaternion.prototype.getRoll=function(c){var d=this.x,e=this.y,f=this.z,g=this.w;if(c){c=2*e;var h=2*f;return Math.atan2(c*d+h*g,1-(c*e+h*f))}return Math.atan2(2*(d*e+g*f),g*g+d*d-e*e-f*f)};og.math.Quaternion.prototype.getPitch=function(c){var d=this.x,e=this.y,f=this.z,g=this.w;if(c){c=2*d;var h=2*f;return Math.atan2(h*e+c*g,1-(c*d+h*f))}return Math.atan2(2*(e*f+g*d),g*g-d*d-e*e+f*f)};
og.math.Quaternion.prototype.getYaw=function(c){var d=this.x,e=this.y,f=this.z,g=this.w;return c?(c=2*e,Math.atan2(2*f*d+c*g,1-(2*d*d+c*e))):Math.asin(-2*(d*f-g*e))};og.shape={};
og.shape.BaseShape=function(c){c=c||{};this.id=og.shape.BaseShape.__staticId++;this.position=c.position||new og.math.Vector3;this.orientation=c.orientation||new og.math.Quaternion(0,0,0,1);this.scale=c.scale||new og.math.Vector3(1,1,1);this.color=c.color||[1,1,1,1];this.visibility=void 0!=c.visibility?c.visibility:!0;this._src=c.src||null;this._textureCoordBuffer=this._indexBuffer=this._normalBuffer=this._positionBuffer=null;this._positionData=[];this._normalData=[];this._indexData=[];this._textureCoordData=
[];this._mxScale=(new og.math.Matrix4).setIdentity();this._mxTranslation=(new og.math.Matrix4).setIdentity();this._mxModel=(new og.math.Matrix4).setIdentity();this._renderNode=this.texture=null;this._pickingColor=[0,0,0,0];this._handler=this._entity=null;this._handlerIndex=-1};og.shape.BaseShape.__staticId=0;
og.shape.BaseShape.prototype.clear=function(){this.position.set(0,0,0);this.orientation.set(0,0,0,1);this.scale.set(1,1,1);this._positionData.length=0;this._normalData.length=0;this._indexData.length=0;this._mxScale.setIdentity();this._mxTranslation.setIdentity();this._mxModel.setIdentity();this._renderNode.handler.gl.deleteTexture(this.texture);this.texture=null;this._deleteBuffers()};
og.shape.BaseShape.prototype.setColor=function(c){this.color[0]=c[0];this.color[1]=c[1];this.color[2]=c[2];this.color[3]=c[3]};og.shape.BaseShape.prototype.setColor4v=function(c){this.color[0]=c.x;this.color[1]=c.y;this.color[2]=c.z;this.color[3]=c.w};og.shape.BaseShape.prototype.setOpacity=function(c){this.color[3]=c};
og.shape.BaseShape.prototype._deleteBuffers=function(){var c=this._renderNode.renderer.handler.gl;c.deleteBuffer(this._positionBuffer);c.deleteBuffer(this._normalBuffer);c.deleteBuffer(this._indexBuffer);this._indexBuffer=this._normalBuffer=this._positionBuffer=null};og.shape.BaseShape.prototype.setVisibility=function(c){this.visibility=c};og.shape.BaseShape.prototype.getVisibility=function(){return this.visibility};
og.shape.BaseShape.prototype.setRenderNode=function(c){this._renderNode=c;this._createBuffers();if(this._src){var d=new Image,e=this;d.onload=function(){e.texture=c.renderer.handler.createTexture_af(this)};d.src=this._src}};og.shape.BaseShape.prototype.setPosition3v=function(c){this.position.copy(c);this._mxTranslation.translateToPosition(c);this.refresh()};og.shape.BaseShape.prototype.translate3v=function(c){this.position.addA(c);this._mxTranslation.translate(c)};
og.shape.BaseShape.prototype.setScale3v=function(c){this.scale.copy(c);this._mxScale.scale(c)};og.shape.BaseShape.prototype.remove=function(){this._entity=null;this._handler&&this._handler.remove(this)};og.shape.BaseShape.prototype.setPickingColor3v=function(c){this._pickingColor[0]=c.x/255;this._pickingColor[1]=c.y/255;this._pickingColor[2]=c.z/255;this._pickingColor[3]=1};
og.shape.BaseShape.prototype._createBuffers=function(){this._deleteBuffers();var c=this._renderNode.renderer;this._positionBuffer=c.handler.createArrayBuffer(new Float32Array(this._positionData),3,this._positionData.length/3);this._normalBuffer=c.handler.createArrayBuffer(new Float32Array(this._normalData),3,this._normalData.length/3);this._indexBuffer=c.handler.createElementArrayBuffer(new Uint16Array(this._indexData),1,this._indexData.length);this._textureCoordBuffer=c.handler.createArrayBuffer(new Float32Array(this._textureCoordData),
2,this._textureCoordData.length/2)};og.shape.BaseShape.prototype.refresh=function(){this._mxModel=this._mxTranslation.mul(this.orientation.getMatrix4().mul(this._mxScale))};
og.shape.BaseShape.prototype.draw=function(){if(this.visibility){var c=this._renderNode,d=c.renderer,e,f,g=d.handler.gl;c.lightEnabled?(e=d.handler.shaderPrograms.shape_wl,f=e._program,sha=f.attributes,shu=f.uniforms,e.activate(),g.uniform4fv(shu.lightsPositions._pName,c._lightsTransformedPositions),g.uniform3fv(shu.lightsParamsv._pName,c._lightsParamsv),g.uniform1fv(shu.lightsParamsf._pName,c._lightsParamsf),g.uniformMatrix4fv(shu.projectionMatrix._pName,!1,d.activeCamera._projectionMatrix._m),g.uniformMatrix4fv(shu.viewMatrix._pName,
!1,d.activeCamera._viewMatrix._m),g.uniformMatrix3fv(shu.normalMatrix._pName,!1,d.activeCamera._normalMatrix._m),g.bindBuffer(g.ARRAY_BUFFER,this._normalBuffer),g.vertexAttribPointer(sha.aVertexNormal._pName,this._normalBuffer.itemSize,g.FLOAT,!1,0,0)):(e=d.handler.shaderPrograms.shape_nl,f=e._program,sha=f.attributes,shu=f.uniforms,e.activate(),g.uniformMatrix4fv(shu.projectionViewMatrix._pName,!1,d.activeCamera._projectionViewMatrix._m));g.uniform4fv(shu.uColor._pName,this.color);g.bindBuffer(g.ARRAY_BUFFER,
this._positionBuffer);g.vertexAttribPointer(sha.aVertexPosition._pName,this._positionBuffer.itemSize,g.FLOAT,!1,0,0);g.uniformMatrix4fv(shu.modelMatrix._pName,!1,this._mxModel._m);g.activeTexture(g.TEXTURE0);g.bindTexture(g.TEXTURE_2D,this.texture);g.uniform1i(shu.uSampler._pName,0);g.bindBuffer(g.ARRAY_BUFFER,this._textureCoordBuffer);g.vertexAttribPointer(sha.aTextureCoord._pName,this._textureCoordBuffer.itemSize,g.FLOAT,!1,0,0);g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this._indexBuffer);g.drawElements(d.handler.gl.TRIANGLES,
this._indexBuffer.numItems,g.UNSIGNED_SHORT,0)}};og.shape.Sphere=function(c){og.shape.BaseShape.call(this,c);this._radius=c.radius||100;this._latBands=c.latBands||16;this._lonBands=c.lonBands||16;this._createData()};goog.inherits(og.shape.Sphere,og.shape.BaseShape);
og.shape.Sphere.prototype._createData=function(){for(var c=0;c<=this._latBands;c++)for(var d=c*Math.PI/this._latBands,e=Math.sin(d),f=Math.cos(d),d=0;d<=this._lonBands;d++){var g=2*d*Math.PI/this._lonBands,h=Math.cos(g)*e,k=f,g=Math.sin(g)*e,m=1-d/this._lonBands,l=c/this._latBands;this._normalData.push(h);this._normalData.push(k);this._normalData.push(g);this._textureCoordData.push(m);this._textureCoordData.push(l);this._positionData.push(this._radius*h);this._positionData.push(this._radius*k);this._positionData.push(this._radius*
g)}for(c=0;c<this._latBands;c++)for(d=0;d<this._lonBands;d++)e=c*(this._lonBands+1)+d,f=e+this._lonBands+1,this._indexData.push(e),this._indexData.push(e+1),this._indexData.push(f),this._indexData.push(f),this._indexData.push(e+1),this._indexData.push(f+1)};og.ShapeHandler=function(c){this.pickingEnabled=!0;this._entityCollection=c;this._renderer=null;this._shapes=[];this.__staticId=og.ShapeHandler.staticCounter++};og.ShapeHandler.staticCounter=0;og.ShapeHandler.prototype._initShaderProgram=function(){this._renderer.handler&&(this._renderer.handler.shaderPrograms.shape_nl||this._renderer.handler.addShaderProgram(og.shaderProgram.shape_nl()),this._renderer.handler.shaderPrograms.shape_wl||this._renderer.handler.addShaderProgram(og.shaderProgram.shape_wl()))};
og.ShapeHandler.prototype.setRenderNode=function(c){this._renderer=c.renderer;this._initShaderProgram();for(var d=0;d<this._shapes.length;d++)this._shapes[d].setRenderNode(c)};og.ShapeHandler.prototype.add=function(c){-1==c._handlerIndex&&(c._handler=this,c._handlerIndex=this._shapes.length,this._shapes.push(c),this._entityCollection&&this._entityCollection.renderNode&&c.setRenderNode(this._entityCollection.renderNode))};og.ShapeHandler.prototype.remove=function(c){};
og.ShapeHandler.prototype.draw=function(){for(var c=this._shapes.length;c--;)this._shapes[c].draw()};og.ShapeHandler.prototype.drawPicking=function(){};og.ShapeHandler.prototype.clear=function(){};og.EntityCollection=function(c){c=c||{};this.id=og.EntityCollection.__staticCounter++;this._renderNodeIndex=-1;this.renderNode=null;this._visibility=void 0==c.visibility?!0:c.visibility;this.billboardHandler=new og.BillboardHandler(this);this.labelHandler=new og.LabelHandler(this);this.shapeHandler=new og.ShapeHandler(this);this.lineStringHandler=new og.LineStringHandler(this);this.pointCloudHandler=new og.PointCloudHandler(this);void 0!=c.pickingEnabled&&this.setPickingEnabled(c.pickingEnabled);
this._entities=[];this.scaleByDistance=c.scaleByDistance||[og.math.MAX32,og.math.MAX32,og.math.MAX32];this._animatedOpacity=this._opacity=void 0==c.opacity?1:c.opacity;this.events=new og.Events;this.events.registerNames(og.EntityCollection.EVENT_NAMES)};og.EntityCollection.__staticCounter=0;og.EntityCollection.EVENT_NAMES="entitymove draw drawend add remove entityadd entityremove visibilitychange mousemove mouseenter mouseleave mouselbuttonclick mouserbuttonclick mousembuttonclick mouselbuttondoubleclick mouserbuttondoubleclick mousembuttondoubleclick mouselbuttonup mouserbuttonup mousembuttonup mouselbuttondown mouserbuttondown mousembuttondown mouselbuttonhold mouserbuttonhold mousembuttonhold mousewheel touchmove touchstart touchend doubletouch touchleave touchenter".split(" ");
og.EntityCollection.prototype.setVisibility=function(c){this._visibility=c;this._animatedOpacity=this._opacity*(c?1:0);this.events.dispatch(this.events.visibilitychange,this)};og.EntityCollection.prototype.getVisibility=function(){return this._visibility};og.EntityCollection.prototype.setOpacity=function(c){this._opacity=c};
og.EntityCollection.prototype.setPickingEnabled=function(c){this.billboardHandler.pickingEnabled=c;this.labelHandler.pickingEnabled=c;this.lineStringHandler.pickingEnabled=c;this.shapeHandler.pickingEnabled=c;this.pointCloudHandler.pickingEnabled=c};og.EntityCollection.prototype.getOpacity=function(){return this._opacity};og.EntityCollection.prototype.setScaleByDistance=function(c,d,e){this.scaleByDistance[0]=c;this.scaleByDistance[1]=d;this.scaleByDistance[2]=e||og.math.MAX32};
og.EntityCollection.prototype._addRecursively=function(c){c.billboard&&this.billboardHandler.add(c.billboard);c.label&&this.labelHandler.add(c.label);c.shape&&this.shapeHandler.add(c.shape);c.lineString&&this.lineStringHandler.add(c.lineString);c.pointCloud&&this.pointCloudHandler.add(c.pointCloud);this.events.dispatch(this.events.entityadd,c);for(var d=0;d<c.childrenNodes.length;d++)c.childrenNodes[d]._entityCollection=this,c.childrenNodes[d]._entityCollectionIndex=c._entityCollectionIndex,c.childrenNodes[d]._pickingColor=
c._pickingColor,this._addRecursively(c.childrenNodes[d])};og.EntityCollection.prototype.add=function(c){if(!c._entityCollection){c._entityCollection=this;c._entityCollectionIndex=this._entities.length;this._entities.push(c);var d=this.renderNode;d&&(d.renderer&&d.renderer.assignPickingColor(c),d.ellipsoid&&c._lonlat&&c.setCartesian3v(d.ellipsoid.lonLatToCartesian(c._lonlat)));this._addRecursively(c)}return this};
og.EntityCollection.prototype.addEntities=function(c){for(var d=c.length;d--;)this.add(c[d]);return this};og.EntityCollection.prototype.belongs=function(c){return c._entityCollection&&this._renderNodeIndex==c._entityCollection._renderNodeIndex};
og.EntityCollection.prototype._removeRecursively=function(c){c._entityCollection=null;c._entityCollectionIndex=-1;c.billboard&&this.billboardHandler.remove(c.billboard);c.label&&this.labelHandler.remove(c.label);c.shape&&this.shapeHandler.remove(c.shape);c.lineString&&this.lineStringHandler.remove(c.lineString);c.pointCloud&&this.pointCloudHandler.remove(c.pointCloud);for(var d=0;d<c.childrenNodes.length;d++)this._removeRecursively(c.childrenNodes[d])};
og.EntityCollection.prototype.removeEntity=function(c){this._entities.splice(c._entityCollectionIndex,1);this.reindexEntitiesArray(c._entityCollectionIndex);this.renderNode&&this.renderNode.renderer&&(this.renderNode.renderer.clearPickingColor(c),c._pickingColor.clear());this.belongs(c)&&this._removeRecursively(c);this.events.dispatch(this.events.entityremove,c)};
og.EntityCollection.prototype._removeEntitySilent=function(c){this._entities.splice(c._entityCollectionIndex,1);this.reindexEntitiesArray(c._entityCollectionIndex);this.renderNode&&this.renderNode.renderer&&(this.renderNode.renderer.clearPickingColor(c),c._pickingColor.clear());this.belongs(c)&&this._removeRecursively(c)};og.EntityCollection.prototype.createPickingColors=function(){for(var c=this._entities,d=0;d<c.length;d++)c[d].parent||(this.renderNode.renderer.assignPickingColor(c[d]),c[d].setPickingColor())};
og.EntityCollection.prototype.reindexEntitiesArray=function(c){for(var d=this._entities;c<d.length;c++)d[c]._entityCollectionIndex=c};
og.EntityCollection.prototype.addTo=function(c,d){this.renderNode||(this.renderNode=c,d||(this._renderNodeIndex=c.entityCollections.length,c.entityCollections.push(this)),c.ellipsoid&&this._updateGeodeticCoordinates(c.ellipsoid),this.setRenderer(c.renderer),this.shapeHandler.setRenderNode(c),this.lineStringHandler.setRenderNode(c),this.pointCloudHandler.setRenderNode(c),this.events.dispatch(this.events.add,this));return this};
og.EntityCollection.prototype._updateGeodeticCoordinates=function(c){for(var d=this._entities,e=d.length;e--;){var f=d[e];f._lonlat&&f.setCartesian3v(c.lonLatToCartesian(f._lonlat))}};og.EntityCollection.prototype.setRenderer=function(c){c&&(this.billboardHandler.setRenderer(c),this.labelHandler.setRenderer(c),this.updateBillboardsTextureAtlas(),this.updateLabelsFontAtlas(),this.createPickingColors())};
og.EntityCollection.prototype.updateBillboardsTextureAtlas=function(){for(var c=this.billboardHandler._billboards,d=0;d<c.length;d++)c[d].setSrc(c[d]._src)};og.EntityCollection.prototype.updateLabelsFontAtlas=function(){if(this.renderNode)for(var c=this.labelHandler._billboards,d=0;d<c.length;d++)c[d].assignFontAtlas(this.renderNode.fontAtlas)};
og.EntityCollection.prototype.remove=function(){if(this.renderNode){if(-1!=this._renderNodeIndex){this.renderNode.entityCollections.splice(this._renderNodeIndex,1);for(var c=this._renderNodeIndex;c<this.renderNode.entityCollections.length;c++)this.renderNode.entityCollections._renderNodeIndex=c}this.renderNode=null;this._renderNodeIndex=-1;this.events.dispatch(this.events.remove,this)}};og.EntityCollection.prototype.getEntities=function(){return[].concat(this._entities)};
og.EntityCollection.prototype.each=function(c){for(var d=this._entities.length;d--;){var e=this._entities[d];e&&c(e)}};
og.EntityCollection.prototype.clear=function(){this.billboardHandler.clear();this.labelHandler.clear();this.shapeHandler.clear();this.lineStringHandler.clear();this.pointCloudHandler.clear();for(var c=this._entities.length;c--;){var d=this._entities[c];this.renderNode&&this.renderNode.renderer&&(this.renderNode.renderer.clearPickingColor(d),d._pickingColor.clear());this._clearEntity(d)}this._entities.length=0;this._entities=[]};
og.EntityCollection.prototype._clearEntity=function(c){c._entityCollection=null;c._entityCollectionIndex=-1;for(var d=0;d<c.childrenNodes.length;d++)this._clearEntity(c.childrenNodes[d])};og.input={};og.input.KEY_SHIFT=16;og.input.KEY_SPACE=32;og.input.KEY_LEFT=37;og.input.KEY_UP=38;og.input.KEY_RIGHT=39;og.input.KEY_DOWN=40;og.input.KEY_A=65;og.input.KEY_C=67;og.input.KEY_D=68;og.input.KEY_E=69;og.input.KEY_F=70;og.input.KEY_H=72;og.input.KEY_L=76;og.input.KEY_Q=81;og.input.KEY_S=83;og.input.KEY_V=86;og.input.KEY_W=87;og.input.KEY_X=88;og.input.KEY_F1=112;og.input.MB_LEFT=0;og.input.MB_RIGHT=2;og.input.MB_MIDDLE=1;og.control={};og.control.BaseControl=function(c){c=c||{};this._initialized=!1;this.renderer=null;this.autoActivate=void 0!=c.autoActivate?c.autoActivate:!0;this.active=c.active||!1};og.control.BaseControl.prototype.oninit=function(){};og.control.BaseControl.prototype.onadd=function(){};og.control.BaseControl.prototype.onremove=function(){};og.control.BaseControl.prototype.onactivate=function(){};og.control.BaseControl.prototype.ondeactivate=function(){};
og.control.BaseControl.prototype.addTo=function(c){this.renderer=c;c.controls.push(this);this.onadd&&this.onadd();this.autoActivate&&(this.oninit&&this.oninit(),this.active=this._initialized=!0)};og.control.BaseControl.prototype.remove=function(){this.onremove&&this.onremove();this.renderer=null;this._initialized=this.active=!1};og.control.BaseControl.prototype.activate=function(){this.active=!0;this.onactivate&&this.onactivate()};
og.control.BaseControl.prototype.deactivate=function(){this.active=!1;this.ondeactivate&&this.ondeactivate()};og.control.KeyboardNavigation=function(c){og.inheritance.base(this,c)};og.inheritance.extend(og.control.KeyboardNavigation,og.control.BaseControl);og.control.keyboardNavigation=function(c){return new og.control.KeyboardNavigation(c)};
og.control.KeyboardNavigation.prototype.oninit=function(){this.renderer.events.on("keypress",this,this.onCameraMoveForward,og.input.KEY_W);this.renderer.events.on("keypress",this,this.onCameraMoveBackward,og.input.KEY_S);this.renderer.events.on("keypress",this,this.onCameraStrifeLeft,og.input.KEY_A);this.renderer.events.on("keypress",this,this.onCameraStrifeRight,og.input.KEY_D);this.renderer.events.on("keypress",this,this.onCameraLookUp,og.input.KEY_UP);this.renderer.events.on("keypress",this,this.onCameraLookDown,
og.input.KEY_DOWN);this.renderer.events.on("keypress",this,this.onCameraTurnLeft,og.input.KEY_LEFT);this.renderer.events.on("keypress",this,this.onCameraTurnRight,og.input.KEY_RIGHT);this.renderer.events.on("keypress",this,this.onCameraRollLeft,og.input.KEY_Q);this.renderer.events.on("keypress",this,this.onCameraRollRight,og.input.KEY_E);this.renderer.events.on("keypress",this,this.onCameraGrowAlt,og.input.KEY_SPACE)};og.control.KeyboardNavigation.prototype.onCameraGrowAlt=function(c){};var ss=1E4;
og.control.KeyboardNavigation.prototype.onCameraMoveForward=function(c){DY+=ss;update()};og.control.KeyboardNavigation.prototype.onCameraMoveBackward=function(c){DY-=ss;update()};og.control.KeyboardNavigation.prototype.onCameraStrifeLeft=function(c){DX-=ss;update()};function update(){var c=globus.planet.layers[8];c.opacity=1;c.setCornersLonLat(c._cornersWgs84)}og.control.KeyboardNavigation.prototype.onCameraStrifeRight=function(c){DX+=ss;update()};
og.control.KeyboardNavigation.prototype.onCameraLookUp=function(c){c=this.renderer.activeCamera;this.renderer.events.isKeyPressed(og.input.KEY_SHIFT)?c.pitch(5):c.rotateVertical(c._lonLat.height/3E6*og.math.RADIANS,og.math.Vector3.ZERO);c.update()};og.control.KeyboardNavigation.prototype.onCameraLookDown=function(c){c=this.renderer.activeCamera;this.renderer.events.isKeyPressed(og.input.KEY_SHIFT)?c.pitch(-5):c.rotateVertical(-c._lonLat.height/3E6*og.math.RADIANS,og.math.Vector3.ZERO);c.update()};
og.control.KeyboardNavigation.prototype.onCameraTurnLeft=function(c){c=this.renderer.activeCamera;this.renderer.events.isKeyPressed(og.input.KEY_SHIFT)?c.yaw(5):c.rotateHorizontal(c._lonLat.height/3E6*og.math.RADIANS,!1,og.math.Vector3.ZERO);c.update()};og.control.KeyboardNavigation.prototype.onCameraTurnRight=function(c){c=this.renderer.activeCamera;this.renderer.events.isKeyPressed(og.input.KEY_SHIFT)?c.yaw(-5):c.rotateHorizontal(-c._lonLat.height/3E6*og.math.RADIANS,!1,og.math.Vector3.ZERO);c.update()};
og.control.KeyboardNavigation.prototype.onCameraRollLeft=function(c){this.renderer.activeCamera.roll(-5);this.renderer.activeCamera.update()};og.control.KeyboardNavigation.prototype.onCameraRollRight=function(c){this.renderer.activeCamera.roll(5);this.renderer.activeCamera.update()};og.bv={};og.bv.Sphere=function(c,d){this.radius=c||0;this.center=d?d.clone():new og.math.Vector3};og.bv.Sphere.prototype.setFromBounds=function(c){this.center.set(c[0]+(c[1]-c[0])/2,c[2]+(c[3]-c[2])/2,c[4]+(c[5]-c[4])/2);this.radius=this.center.distance(new og.math.Vector3(c[0],c[2],c[4]))};og.bv.Sphere.prototype.setFromExtent=function(c,d){this.setFromBounds(d.getCartesianBounds(c))};og.math.Pixel=function(c,d){this.x=c||0;this.y=d||0};og.math.Ray=function(c,d){this.origin=c.clone();this.direction=d.clone()};og.math.ray=function(c,d){return new og.math.Ray(c,d)};og.math.Ray.OUTSIDE=0;og.math.Ray.INSIDE=1;og.math.Ray.INPLANE=2;og.math.Ray.AWAY=3;og.math.Ray.prototype.set=function(c,d){this.origin=c.clone();this.direction=d.clone();return this};og.math.Ray.prototype.getPoint=function(c){return og.Vector3.add(this.origin,this.direction.scaleTo(c))};
og.math.Ray.prototype.hitTriangle=function(c,d,e,f){d=d.sub(c);e=e.sub(c);var g=d.cross(e),h=this.origin.sub(c),h=-g.dot(h),g=g.dot(this.direction);if(Math.abs(g)<og.math.EPSILON10)return 0===h?(f.copy(this.origin),og.math.Ray.INPLANE):og.math.Ray.OUTSIDE;g=h/g;f.copy(this.origin.add(this.direction.scaleTo(g)));if(0>g)return og.math.Ray.AWAY;var g=d.dot(d),h=d.dot(e),k=e.dot(e);f=f.sub(c);c=f.dot(d);f=f.dot(e);d=h*h-g*k;e=(h*f-k*c)/d;if(0>e||1<e)return og.math.Ray.OUTSIDE;c=(h*c-g*f)/d;return 0>c||
1<e+c?og.math.Ray.OUTSIDE:og.math.Ray.INSIDE};og.math.Ray.prototype.hitPlane=function(c,d,e,f){d=og.math.Vector3.sub(d,c);e=og.math.Vector3.sub(e,c);e=d.cross(e);c=og.math.Vector3.sub(this.origin,c);c=-e.dot(c);e=e.dot(this.direction);if(Math.abs(e)<og.math.EPSILON10&&0===c)return og.math.Ray.OUTSIDE;c/=e;if(0>c)return og.math.Ray.OUTSIDE;c=this.direction.scaleTo(c);f.x=this.origin.x+c.x;f.y=this.origin.y+c.y;f.z=this.origin.z+c.z;return og.math.Ray.INSIDE};
og.math.Ray.prototype.hitSphere=function(c){var d=c.radius,e=c.center,f=this.origin,g=this.direction,h=og.math.Vector3.sub(e,f);if(0>h.dot(g)){var k=h.length();if(k>d)return null;if(k===d)return f.clone();k=e.projToRay(f,h);h=og.math.Vector3.sub(k,e).length();c=Math.sqrt(d*d-h*h);d=c-og.math.Vector3.sub(k,f).length();return f=og.math.Vector3.add(f,g.scaleTo(d))}k=e.projToRay(f,g);e=og.math.Vector3.sub(e,k).length();if(e>c.radius)return null;c=Math.sqrt(d*d-e*e);k.subA(f);d=h.length()>d?k.length()-
c:k.length()+c;return f=og.math.Vector3.add(f,g.scaleTo(d))};og.math.Ray.prototype.hitBox=function(c){};og.control.TouchNavigation=function(c){og.inheritance.base(this,c);this.grabbedPoint=new og.math.Vector3;this.inertia=.007;this.grabbedSpheroid=new og.bv.Sphere;this.planet=null;this.qRot=new og.math.Quaternion;this.scaleRot=0;this.rot=1;this._eye0=new og.math.Vector3;this.distDiff=.57;this.stepsCount=5;this.stepsForward=null;this.stepIndex=0;c=function(){this.prev_y=this.prev_x=this.y=this.x=0;this.grabbedPoint=new og.math.Vector3;this.grabbedSpheroid=new og.bv.Sphere;this.dX=function(){return this.x-
this.prev_x};this.dY=function(){return this.y-this.prev_y}};this.earthUp=this.pointOnEarth=null;this.touches=[new c,new c]};og.inheritance.extend(og.control.TouchNavigation,og.control.BaseControl);og.control.touchNavigation=function(c){return new og.control.TouchNavigation(c)};
og.control.TouchNavigation.prototype.oninit=function(){this.planet=this.renderer.renderNodes.Earth;this.renderer.events.on("touchstart",this,this.onTouchStart);this.renderer.events.on("touchend",this,this.onTouchEnd);this.renderer.events.on("doubletouch",this,this.onDoubleTouch);this.renderer.events.on("touchcancel",this,this.onTouchCancel);this.renderer.events.on("touchmove",this,this.onTouchMove);this.renderer.events.on("draw",this,this.onDraw)};
og.control.TouchNavigation.prototype.onTouchStart=function(c){this._touching=!0;if(2===c.sys.touches.length){var d=this.touches[0],e=this.touches[1];d.x=c.sys.touches.item(0).pageX-c.sys.offsetLeft;d.y=c.sys.touches.item(0).pageY-c.sys.offsetTop;d.prev_x=c.sys.touches.item(0).pageX-c.sys.offsetLeft;d.prev_y=c.sys.touches.item(0).pageY-c.sys.offsetTop;d.grabbedPoint=this.planet.getCartesianFromPixelTerrain(d,!0);e.x=c.sys.touches.item(1).pageX-c.sys.offsetLeft;e.y=c.sys.touches.item(1).pageY-c.sys.offsetTop;
e.prev_x=c.sys.touches.item(1).pageX-c.sys.offsetLeft;e.prev_y=c.sys.touches.item(1).pageY-c.sys.offsetTop;e.grabbedPoint=this.planet.getCartesianFromPixelTerrain(e,!0);if(this.pointOnEarth=this.planet.getCartesianFromPixelTerrain(this.renderer.handler.getCenter(),!0))this.earthUp=this.pointOnEarth.normal();d.grabbedPoint&&e.grabbedPoint&&(d.grabbedSpheroid.radius=d.grabbedPoint.length(),e.grabbedSpheroid.radius=e.grabbedPoint.length(),this.stopRotation())}else 1===c.sys.touches.length&&this._startTouchOne(c)};
og.control.TouchNavigation.prototype._startTouchOne=function(c){var d=this.touches[0];d.x=c.sys.touches.item(0).pageX-c.sys.offsetLeft;d.y=c.sys.touches.item(0).pageY-c.sys.offsetTop;d.prev_x=c.sys.touches.item(0).pageX-c.sys.offsetLeft;d.prev_y=c.sys.touches.item(0).pageY-c.sys.offsetTop;d.grabbedPoint=this.planet.getCartesianFromPixelTerrain(d,!0);this._eye0.copy(this.renderer.activeCamera.eye);d.grabbedPoint&&(d.grabbedSpheroid.radius=d.grabbedPoint.length(),this.stopRotation())};
og.control.TouchNavigation.prototype.stopRotation=function(){this.qRot.clear()};
og.control.TouchNavigation.prototype.onDoubleTouch=function(c){this.stepIndex||(this.planet.stopFlying(),this.stopRotation(),c=this.planet.getLonLatFromPixelTerrain(c,!0),this.renderer.events.isKeyPressed(og.input.KEY_SHIFT)?this.planet.flyLonLat(new og.LonLat(c.lon,c.lat,this.renderer.activeCamera.getAltitude()*(1+this.distDiff)*1.7)):this.planet.flyLonLat(new og.LonLat(c.lon,c.lat,this.renderer.activeCamera.getAltitude()*this.distDiff*1.7)))};
og.control.TouchNavigation.prototype.onTouchEnd=function(c){0===c.sys.touches.length&&(this._touching=!1);1===c.sys.touches.length&&this._startTouchOne(c);3>Math.abs(this.touches[0].x-this.touches[0].prev_x)&&3>Math.abs(this.touches[0].y-this.touches[0].prev_y)&&(this.scaleRot=0)};og.control.TouchNavigation.prototype.onTouchCancel=function(c){};
og.control.TouchNavigation.prototype.onTouchMove=function(c){var d=this.renderer.activeCamera;if(2===c.sys.touches.length){this.renderer.controlsBag.scaleRot=1;var e=this.touches[0],f=this.touches[1];if(e.grabbedPoint&&f.grabbedPoint){this.planet.stopFlying();e.prev_x=e.x;e.prev_y=e.y;e.x=c.sys.touches.item(0).pageX-c.sys.offsetLeft;e.y=c.sys.touches.item(0).pageY-c.sys.offsetTop;f.prev_x=f.x;f.prev_y=f.y;f.x=c.sys.touches.item(1).pageX-c.sys.offsetLeft;f.y=c.sys.touches.item(1).pageY-c.sys.offsetTop;
if(0<e.dY()&&0<f.dY()||0>e.dY()&&0>f.dY()||0<e.dX()&&0<f.dX()||0>e.dX()&&0>f.dX())c=.5/d.eye.distance(this.pointOnEarth)*d._lonLat.height*og.math.RADIANS,.007<c&&(c=.007),d.rotateHorizontal(c*e.dX(),!1,this.pointOnEarth,this.earthUp),d.rotateVertical(c*e.dY(),this.pointOnEarth),d.update();this.scaleRot=0}}else if(1===c.sys.touches.length&&(e=this.touches[0],e.prev_x=e.x,e.prev_y=e.y,e.x=c.sys.touches.item(0).pageX-c.sys.offsetLeft,e.y=c.sys.touches.item(0).pageY-c.sys.offsetTop,e.grabbedPoint&&(this.planet.stopFlying(),
c=d.unproject(e.x,e.y),c=(new og.math.Ray(d.eye,c)).hitSphere(e.grabbedSpheroid))))if(.15<d._n.dot(d.eye.normal()))e=this.qRot=og.math.Quaternion.getRotationBetweenVectors(c.normal(),e.grabbedPoint.normal()),d.eye=e.mulVec3(d.eye),d._v=e.mulVec3(d._v),d._u=e.mulVec3(d._u),d._n=e.mulVec3(d._n),d.update(),this.scaleRot=1;else{c=e.grabbedPoint;var f=og.math.Vector3.add(c,d._u),g=og.math.Vector3.add(c,c.normal()),e=d.unproject(e.x,e.y),h=new og.math.Vector3;(new og.math.Ray(d.eye,e)).hitPlane(c,f,g,h)===
og.math.Ray.INSIDE&&(d.eye=this._eye0.addA(h.subA(c).negate()),d.update(),this.scaleRot=0)}};
og.control.TouchNavigation.prototype.onDraw=function(c){this.renderer.controlsBag.scaleRot=this.scaleRot;if(!this._touching){var d=this.renderer;if(this.stepIndex){d.controlsBag.scaleRot=1;var e=this.stepsForward[this.stepsCount-this.stepIndex--];c=this.renderer.activeCamera;c.eye=e.eye;c._v=e.v;c._u=e.u;c._n=e.n;c.update()}!d.events.mouseState.leftButtonDown&&this.scaleRot&&(this.scaleRot-=this.inertia,0>=this.scaleRot?this.scaleRot=0:(d.controlsBag.scaleRot=this.scaleRot,c=d.activeCamera,d=this.qRot.slerp(og.math.Quaternion.IDENTITY,
1-this.scaleRot*this.scaleRot*this.scaleRot).normalize(),d.x||d.y||d.z||(this.scaleRot=0),c.eye=d.mulVec3(c.eye),c._v=d.mulVec3(c._v),c._u=d.mulVec3(c._u),c._n=d.mulVec3(c._n),c.update()))}};og.rotation={};og.rotation.getRotationMatrix=function(c,d){xAxis.x=Math.cos(c+og.math.PI_TWO);xAxis.y=Math.sin(c+og.math.PI_TWO);xAxis.z=0;var e=Math.cos(d);zAxis.x=e*Math.cos(c);zAxis.y=e*Math.sin(c);zAxis.z=Math.sin(d);e=zAxis.cross(xAxis);res._m[0]=xAxis.x;res._m[1]=e.x;res._m[2]=zAxis.x;res._m[3]=xAxis.y;res._m[4]=e.y;res._m[5]=zAxis.y;res._m[6]=xAxis.z;res._m[7]=e.z;res._m[8]=zAxis.z;return result};og.jd={};og.jd.SECONDS_PER_MILLISECOND=.001;og.jd.MILLISECONDS_PER_SECOND=1E3;og.jd.SECONDS_PER_MINUTE=60;og.jd.ONE_BY_SECONDS_PER_MINUTE=1/og.jd.SECONDS_PER_MINUTE;og.jd.MINUTES_PER_HOUR=60;og.jd.HOURS_PER_DAY=24;og.jd.ONE_BY_HOURS_PER_DAY=1/og.jd.HOURS_PER_DAY;og.jd.SECONDS_PER_HOUR=3600;og.jd.ONE_BY_SECONDS_PER_HOUR=1/og.jd.SECONDS_PER_HOUR;og.jd.SECONDS_PER_12_HOURS=12*og.jd.SECONDS_PER_HOUR;og.jd.MINUTES_PER_DAY=1440;og.jd.ONE_BY_MINUTES_PER_DAY=1/og.jd.MINUTES_PER_DAY;
og.jd.SECONDS_PER_DAY=86400;og.jd.MILLISECONDS_PER_DAY=864E5;og.jd.ONE_BY_MILLISECONDS_PER_DAY=1/og.jd.MILLISECONDS_PER_DAY;og.jd.ONE_BY_SECONDS_PER_DAY=1/og.jd.SECONDS_PER_DAY;og.jd.DAYS_PER_JULIAN_CENTURY=36525;og.jd.DAYS_PER_JULIAN_YEAR=365.25;og.jd.PICOSECOND=1E-9;og.jd.MODIFIED_JULIAN_DATE_DIFFERENCE=2400000.5;og.jd.J2000=2451545;og.jd.T=function(c){return(c-og.jd.J2000)/og.jd.DAYS_PER_JULIAN_CENTURY};
og.jd.getDayNumber=function(c,d,e){var f=(d-14)/12|0;c=c+4800+f;return(1461*c/4|0)+(367*(d-2-12*f)/12|0)-(3*((c+100)/100|0)/4|0)+e-32075};
og.jd.DateToUTC=function(c){var d=og.jd.getDayNumber(c.getUTCFullYear(),c.getUTCMonth()+1,c.getUTCDate()),e=c.getUTCHours()-12;0>e&&(e+=24);c=c.getUTCSeconds()+e*og.jd.SECONDS_PER_HOUR+c.getUTCMinutes()*og.jd.SECONDS_PER_MINUTE+c.getUTCMilliseconds()*og.jd.SECONDS_PER_MILLISECOND;c>=og.jd.SECONDS_PER_12_HOURS&&d--;e=c*og.jd.ONE_BY_SECONDS_PER_DAY|0;d+=e;c-=og.jd.SECONDS_PER_DAY*e;0>c&&(d--,c+=og.jd.SECONDS_PER_DAY);return d+c*og.jd.ONE_BY_SECONDS_PER_DAY};og.jd.DateToTAI=function(c){return og.jd.UTCtoTAI(og.jd.DateToUTC(c))};
og.jd.UTCtoTAI=function(c){var d=og.jd.leapSecondsTable,e=og.utils.binarySearch(d,c,function(c,d){return c-d.jd});0>e&&(e=~e);e>=d.length&&(e=d.length-1);var f=d[e].leapSeconds;0!==e&&(d[e].jd-c)*og.jd.SECONDS_PER_DAY>f&&(f=d[e-1].leapSeconds);return c+f*og.jd.ONE_BY_SECONDS_PER_DAY};
og.jd.TAItoUTC=function(c){var d=og.jd.leapSecondsTable,e=og.utils.binarySearch(d,c,function(c,d){return c-d.jd});0>e&&(e=~e);if(e>=d.length)return c-d[e-1].leapSeconds*og.jd.ONE_BY_SECONDS_PER_DAY;if(0===e)return c-d[0].leapSeconds*og.jd.ONE_BY_SECONDS_PER_DAY;var f=(d[e].jd-c)*og.jd.SECONDS_PER_DAY;return 0===f?c-d[e].leapSeconds*og.jd.ONE_BY_SECONDS_PER_DAY:1>=f?null:c-d[e-1].leapSeconds*og.jd.ONE_BY_SECONDS_PER_DAY};
og.jd.UTCtoDate=function(c){var d=c|0,e=(c-d)*og.jd.SECONDS_PER_DAY;e>=og.jd.SECONDS_PER_12_HOURS&&d++;d=d+68569|0;c=4*d/146097|0;var d=d-((146097*c+3)/4|0)|0,f=4E3*(d+1)/1461001|0,d=d-(1461*f/4|0)+31|0,g=80*d/2447|0,h=d-(2447*g/80|0)|0,d=g/11|0,k=e*og.jd.ONE_BY_SECONDS_PER_HOUR|0,m=e-k*og.jd.SECONDS_PER_HOUR,e=m*og.jd.ONE_BY_SECONDS_PER_MINUTE|0,m=m-e*og.jd.SECONDS_PER_MINUTE,l=m|0,m=(m-l)*og.jd.MILLISECONDS_PER_SECOND|0,k=k+12;23<k&&(k-=24);return new Date(Date.UTC(100*(c-49)+f+d|0,(g+2-12*d|0)-
1,h,k,e,l,m))};og.jd.TAItoDate=function(c){var d=og.jd.TAItoUTC(c);d||(d=og.jd.TAItoUTC(og.jd.addSeconds(c,-1)),og.console.logWrn("og.jd.TAItoDate:136 - can't conv utc."));return og.jd.UTCtoDate(d)};og.jd.addMilliseconds=function(c,d){return c+d*og.jd.ONE_BY_MILLISECONDS_PER_DAY};og.jd.addSeconds=function(c,d){return c+d*og.jd.ONE_BY_SECONDS_PER_DAY};og.jd.addHours=function(c,d){return c+d*og.jd.ONE_BY_HOURS_PER_DAY};og.jd.addMinutes=function(c,d){return c+d*og.jd.MINUTES_PER_DAY};
og.jd.addDays=function(c,d){return c+d};og.jd.getMilliseconds=function(c){c=(c-(c|0))*og.jd.SECONDS_PER_DAY;return(c-(c|0))*og.jd.MILLISECONDS_PER_SECOND|0};og.jd.getSeconds=function(c){return(c-(c|0))*og.jd.SECONDS_PER_DAY};
og.jd.getHours=function(c){var d=(c-(c|0))*og.jd.SECONDS_PER_DAY;c=d*og.jd.ONE_BY_SECONDS_PER_HOUR|0;var d=d-c*og.jd.SECONDS_PER_HOUR,e=d*og.jd.ONE_BY_SECONDS_PER_MINUTE|0,d=d-e*og.jd.SECONDS_PER_MINUTE,f=d|0;c+=12+e/60+f/3600+((d-f)*og.jd.MILLISECONDS_PER_SECOND|0)/1E3;23<c&&(c-=24);return c};og.jd.getMinutes=function(c){return(c-(c|0))*og.jd.MINUTES_PER_DAY|0};og.jd.getDays=function(c){return c|0};og.jd.secondsToDays=function(c){return c*og.jd.ONE_BY_SECONDS_PER_DAY};
og.jd.daysToSeconds=function(c){return c*og.jd.SECONDS_PER_DAY};og.jd.__ls=function(c,d){return{jd:c,leapSeconds:d}};
og.jd.leapSecondsTable=[og.jd.__ls(2441317.5,10),og.jd.__ls(2441499.5,11),og.jd.__ls(2441683.5,12),og.jd.__ls(2442048.5,13),og.jd.__ls(2442413.5,14),og.jd.__ls(2442778.5,15),og.jd.__ls(2443144.5,16),og.jd.__ls(2443509.5,17),og.jd.__ls(2443874.5,18),og.jd.__ls(2444239.5,19),og.jd.__ls(2444786.5,20),og.jd.__ls(2445151.5,21),og.jd.__ls(2445516.5,22),og.jd.__ls(2446247.5,23),og.jd.__ls(2447161.5,24),og.jd.__ls(2447892.5,25),og.jd.__ls(2448257.5,26),og.jd.__ls(2448804.5,27),og.jd.__ls(2449169.5,28),og.jd.__ls(2449534.5,
29),og.jd.__ls(2450083.5,30),og.jd.__ls(2450630.5,31),og.jd.__ls(2451179.5,32),og.jd.__ls(2453736.5,33),og.jd.__ls(2454832.5,34),og.jd.__ls(2456109.5,35),og.jd.__ls(2457204.5,36)];og.jd.J2000TAI=og.jd.UTCtoTAI(og.jd.J2000);og.astro={};og.astro.J2000_OBLIQUITY=23.4392911;og.astro.AU_TO_METERS=14959787E4;og.astro.TDT_TAI=32.184;og.astro.EARTH_GRAVITATIONAL_PARAMETER=398600435E6;og.astro.SUN_GRAVITATIONAL_PARAMETER=1.32712440018E20;og.astro.TAItoTDB=function(c){c+=og.astro.TDT_TAI*og.jd.ONE_BY_SECONDS_PER_DAY;var d=6.239996+.0172019696544*(c-og.jd.J2000);return c+.001658*Math.sin(d+.01671*Math.sin(d))*og.jd.ONE_BY_SECONDS_PER_DAY};og.orbit={};og.orbit.getEccentricAnomaly=function(c,d){if(0==d)return c;if(.2>d)return og.math.solve_iteration_fixed(og.orbit.SolveKeplerFunc1(d,c),c,5);if(.9>d)return og.math.solve_iteration_fixed(og.orbit.SolveKeplerFunc2(d,c),c,6);if(1>d){var e=c+.85*d*sign(sin(c));return og.math.solve_iteration_fixed(og.orbit.SolveKeplerLaguerreConway(d,c),e,8)}if(1==d)return c;e=log(2*c/d+1.85);return og.math.solve_iteration_fixed(og.orbit.SolveKeplerLaguerreConwayHyp(d,c),e,30)};
og.orbit.SolveKeplerFunc1=function(c,d){return function(e){return d+c*Math.sin(e)}};og.orbit.SolveKeplerFunc2=function(c,d){return function(e){return e+(d+c*Math.sin(e)-e)/(1-c*Math.cos(e))}};og.orbit.SolveKeplerLaguerreConway=function(c,d){return function(e){var f=c*Math.sin(e),g=e-f-d,h=1-c*Math.cos(e);return e+=-5*g/(h+Math.sign(h)*Math.sqrt(abs(16*h*h-20*g*f)))}};
og.orbit.SolveKeplerLaguerreConwayHyp=function(c,d){return function(e){var f=c*Math.sinh(e),g=f-e-d,h=c*Math.cosh(e)-1;return e+=-5*g/(h+Math.sign(h)*Math.sqrt(Math.abs(16*h*h-20*g*f)))}};og.orbit.getEllipticalEccentricAnomaly=function(c,d){for(var e=20,f=c-2*Math.PI*(c/(2*Math.PI)|0),g=1;1.745E-8<Math.abs(g)&&0<e;)g=f-d*Math.sin(f)-c,f-=g/(1-d*Math.cos(f)),e--;return f};
og.orbit.getTrueAnomaly=function(c,d){var e=Math.floor(c/og.math.TWO_PI);c-=e*og.math.TWO_PI;var f=Math.atan2(Math.sin(c)*Math.sqrt(1-d*d),Math.cos(c)-d),f=og.math.zeroTwoPI(f);0>c&&(f-=og.math.TWO_PI);return f+e*og.math.TWO_PI};
og.orbit.getPerifocalToCartesianMatrix=function(c,d,e){var f=new og.math.Matrix3,g=Math.cos(c);c=Math.sin(c);var h=Math.cos(d);d=Math.sin(d);var k=Math.cos(e);e=Math.sin(e);f._m[0]=k*g-e*c*h;f._m[1]=e*g+k*c*h;f._m[2]=c*d;f._m[3]=-k*c-e*g*h;f._m[4]=-e*c+k*g*h;f._m[5]=g*d;f._m[6]=e*d;f._m[7]=-k*d;f._m[8]=h;return f};og.astro.earth={};
og.astro.earth.getSunPosition=function(c){c-=og.jd.J2000;var d=282.9404+4.70935E-5*c,e=.016709-1.151E-9*c,f=og.math.rev(356.047+.9856002585*c),g=og.astro.J2000_OBLIQUITY-3.563E-7*c;og.math.rev(d+f);var h=f+og.math.DEGREES*e*Math.sin(f*og.math.RADIANS)*(1+e*Math.cos(f*og.math.RADIANS)),f=Math.cos(h*og.math.RADIANS)-e,e=Math.sin(h*og.math.RADIANS)*Math.sqrt(1-e*e),h=Math.sqrt(f*f+e*e),d=og.math.rev(Math.atan2(e,f)*og.math.DEGREES+d),f=h*Math.cos(d*og.math.RADIANS),e=h*Math.sin(d*og.math.RADIANS),d=
f,f=e*Math.cos(g*og.math.RADIANS),g=e*Math.sin(g*og.math.RADIANS);return og.math.Quaternion.yRotation(-(og.math.TWO_PI*(24*c/23.9344694-259.853/360))).mulVec3(new og.math.Vector3(-f*og.astro.AU_TO_METERS,g*og.astro.AU_TO_METERS,-d*og.astro.AU_TO_METERS))};og.LightSource=function(c,d){d=d||{};this._name=c||"light_"+og.LightSource._counter++;this._renderNode=null;this._position=d.position||new og.math.Vector3;this.directional=void 0!=d.derectional?d.derectional:!0;this._ambient=d.ambient||new og.math.Vector3;this._diffuse=d.diffuse||new og.math.Vector3(.8,.8,.8);this._specular=d.specular||new og.math.Vector3(.18,.18,.18);this._shininess=void 0!=d.shininess?d.shininess:3.3;this._active=!0;this._tempAmbient=this._ambient.clone();this._tempDiffuse=this._diffuse.clone();
this._tempSpecular=this._specular.clone();this._tempShininess=this._shininess};og.LightSource._counter=0;og.lightSource=function(c,d){return new og.LightSource(c,d)};og.LightSource.prototype.clone=function(){};
og.LightSource.prototype.setActive=function(c){if(c&&!this._active){if(c=this._renderNode){var d=c._lightsNames.indexOf(this._name);this._shininess=c._lightsParamsf[d]=this._tempShininess;-1!=d&&(d*=9,this._ambient.x=c._lightsParamsv[d]=this._tempAmbient.x,this._ambient.y=c._lightsParamsv[d+1]=this._tempAmbient.y,this._ambient.z=c._lightsParamsv[d+2]=this._tempAmbient.z,this._diffuse.x=c._lightsParamsv[d+3]=this._tempDiffuse.x,this._diffuse.y=c._lightsParamsv[d+4]=this._tempDiffuse.y,this._diffuse.z=
c._lightsParamsv[d+5]=this._tempDiffuse.z,this._specular.x=c._lightsParamsv[d+6]=this._tempSpecular.x,this._specular.y=c._lightsParamsv[d+7]=this._tempSpecular.y,this._specular.z=c._lightsParamsv[d+8]=this._tempSpecular.z)}this._active=!0}else!c&&this._active&&(this._tempAmbient=this._ambient.clone(),this._tempDiffuse=this._diffuse.clone(),this._tempSpecular=this._specular.clone(),this._tempShininess=this._shininess,this.setBlack(),this._active=!1)};og.LightSource.prototype.isActive=function(){return this._active};
og.LightSource.prototype.setPosition=function(c){this._position.x=c.x;this._position.y=c.y;this._position.z=c.z;return this};og.LightSource.prototype.getPosition=function(){return this._position.clone()};og.LightSource.prototype.setAmbient=function(c){this._ambient=c;var d=this._renderNode;if(d){var e=9*d._lightsNames.indexOf(this._name);-1!=e&&(d._lightsParamsv[e]=c.x,d._lightsParamsv[e+1]=c.y,d._lightsParamsv[e+2]=c.z)}return this};
og.LightSource.prototype.setDiffuse=function(c){this._diffuse=c;var d=this._renderNode;if(d){var e=9*d._lightsNames.indexOf(this._name);-1!=e&&(d._lightsParamsv[e+3]=c.x,d._lightsParamsv[e+4]=c.y,d._lightsParamsv[e+5]=c.z)}return this};og.LightSource.prototype.setSpecular=function(c){this._specular=c;var d=this._renderNode;if(d){var e=9*d._lightsNames.indexOf(this._name);-1!=e&&(d._lightsParamsv[e+6]=c.x,d._lightsParamsv[e+7]=c.y,d._lightsParamsv[e+8]=c.z)}return this};
og.LightSource.prototype.setShininess=function(c){this._shininess=c;var d=this._renderNode;if(d){var e=d._lightsNames.indexOf(this._name);-1!=e&&(d._lightsParamsf[e]=c)}return this};
og.LightSource.prototype.setBlack=function(){this._ambient.clear();this._diffuse.clear();this._specular.clear();this._shininess=0;var c=this._renderNode;if(c){var d=9*c._lightsNames.indexOf(this._name);-1!=d&&(c._lightsParamsv[d]=c._lightsParamsv[d+1]=c._lightsParamsv[d+2]=c._lightsParamsv[d+3]=c._lightsParamsv[d+4]=c._lightsParamsv[d+5]=c._lightsParamsv[d+6]=c._lightsParamsv[d+7]=c._lightsParamsv[d+8]=0)}return this};
og.LightSource.prototype.addTo=function(c){this._renderNode=c;c._lights.push(this);c._lightsNames.push(this._name);c._lightsParamsf.push(this._shininess);c._lightsParamsv.push.apply(c._lightsParamsv,this._ambient.toVec());c._lightsParamsv.push.apply(c._lightsParamsv,this._diffuse.toVec());c._lightsParamsv.push.apply(c._lightsParamsv,this._specular.toVec());return this};
og.LightSource.prototype.remove=function(){var c=this.renderNode;if(c){var d=c.getLightById(this._name);-1!=d&&(c._lights.splice(d,1),c._lightsNames.splice(d,1),c._lightsParamsf.splice(d,1),c._lightsParamsv.splice(d,9))}this._renderNode=null};og.control.Sun=function(c){og.inheritance.base(this,c);c=c||{};this.offsetVertical=c.offsetVertical||5E6;this.offsetHorizontal=c.offsetHorizontal||5E6;this.sunlight=null;this._prevDate=this._currDate=0;this._lightOn=!1};og.inheritance.extend(og.control.Sun,og.control.BaseControl);og.control.sun=function(c){return new og.control.Sun(c)};
og.control.Sun.prototype.oninit=function(){this.planet=this.renderer.renderNodes.Earth;this.planet._sunControl=this;this.planet.lightEnabled=!0;this.sunlight=new og.LightSource("Sun",{ambient:new og.math.Vector3(.15,.15,.25),diffuse:new og.math.Vector3(.9,.9,.8),specular:new og.math.Vector3(.1,.1,.06),shininess:110});this.sunlight.addTo(this.planet);var c=this;this.renderer.events.on("draw",this,this._draw);this.renderer.events.on("charkeypress",this,function(){c.planet.lightEnabled=!c.planet.lightEnabled},
og.input.KEY_L)};
og.control.Sun.prototype._draw=function(){this._currDate=this.renderer.handler.clock.currentDate;var c=this.renderer.activeCamera;if(465E4>c.getHeight()){this._lightOn=!0;this._f=1;var d=c.eye.normal(),e=og.math.Vector3.proj_b_to_plane(c._v,d,c._v).normalize().scale(this.offsetVertical),d=og.math.Vector3.proj_b_to_plane(c._u,d,c._u).normalize().scale(this.offsetHorizontal),e=e.add(d),c=c.eye.add(e);0<this._k?(this._k-=.01,c=og.math.Quaternion.getRotationBetweenVectors(this.sunlight._position.normal(),c.normal()),
c=c.slerp(og.math.Quaternion.IDENTITY,this._k).normalize(),this.sunlight.setPosition(c.mulVec3(this.sunlight._position))):this.sunlight.setPosition(c)}else if(this._k=1,0<this._f)this._f-=.01,c=og.math.Quaternion.getRotationBetweenVectors(this.sunlight._position.normal(),og.astro.earth.getSunPosition(this._currDate).normal()),c=c.slerp(og.math.Quaternion.IDENTITY,this._f).normalize(),this.sunlight.setPosition(c.mulVec3(this.sunlight._position));else if(3.4E-4<Math.abs(this._currDate-this._prevDate)&&
this.active||this._lightOn)this._lightOn=!1,this._prevDate=this._currDate,this.sunlight.setPosition(og.astro.earth.getSunPosition(this._currDate)),this._f=0};og.layer.BaseGeoImage=function(c,d){og.inheritance.base(this,c,d);this._projType=0;this._frameHeight=this._frameWidth=256;this._sourceReady=!1;this._extentWgs84Params=this._gridBuffer=this._materialTexture=this._sourceTexture=null;this._refreshFrame=!0;this._isRendering=this._creationProceeding=this._ready=this._animate=this._sourceCreated=this._frameCreated=!1;this._extentWgs84=new og.Extent;this.rendering=this._cornersWgs84=null;d.corners&&this.setCorners(d.corners)};
og.inheritance.extend(og.layer.BaseGeoImage,og.layer.Layer);og.layer.BaseGeoImage.prototype.getCornersLonLat=function(){var c=this._cornersWgs84;return[new og.LonLat(c[0].lon,c[0].lat),new og.LonLat(c[1].lon,c[1].lat),new og.LonLat(c[2].lon,c[2].lat),new og.LonLat(c[3].lon,c[3].lat)]};og.layer.BaseGeoImage.prototype.getCorners=function(){var c=this._cornersWgs84;return[[c[0].lon,c[0].lat],[c[1].lon,c[1].lat],[c[2].lon,c[2].lat],[c[3].lon,c[3].lat]]};og.layer.BaseGeoImage.prototype.setCorners=function(c){this.setCornersLonLat(og.lonLatArray(c))};
og.layer.BaseGeoImage.prototype.setCornersLonLat=function(c){this._refreshFrame=!0;this._cornersWgs84=[c[0].clone(),c[1].clone(),c[2].clone(),c[3].clone()];for(c=0;c<this._cornersWgs84.length;c++)89.9<=this._cornersWgs84[c].lat&&(this._cornersWgs84[c].lat=89.9),-89.9>=this._cornersWgs84[c].lat&&(this._cornersWgs84[c].lat=-89.9);this._extent.setByCoordinates(this._cornersWgs84);c=this._extent;c.southWest.lat>og.mercator.MAX_LAT||c.northEast.lat<og.mercator.MIN_LAT?(this._projType=0,this.rendering=
this._renderingProjType0):(this._projType=1,this.rendering=this._renderingProjType1);this._ready&&!this._creationProceeding&&this._planet._geoImageCreator.add(this)};
og.layer.BaseGeoImage.prototype._createFrame=function(){this._extentWgs84=this._extent.clone();this._cornersMerc=[this._cornersWgs84[0].forwardMercatorEPS01(),this._cornersWgs84[1].forwardMercatorEPS01(),this._cornersWgs84[2].forwardMercatorEPS01(),this._cornersWgs84[3].forwardMercatorEPS01()];this._extentMerc=new og.Extent(this._extentWgs84.southWest.forwardMercatorEPS01(),this._extentWgs84.northEast.forwardMercatorEPS01());0==this._projType?this._extentWgs84Params=[this._extentWgs84.southWest.lon,
this._extentWgs84.southWest.lat,2/this._extentWgs84.getWidth(),2/this._extentWgs84.getHeight()]:this._extentMercParams=[this._extentMerc.southWest.lon,this._extentMerc.southWest.lat,2/this._extentMerc.getWidth(),2/this._extentMerc.getHeight()];if(this._planet){var c=this._planet.renderer.handler;c.gl.deleteTexture(this._materialTexture);this._materialTexture=c.createEmptyTexture_l(this._frameWidth,this._frameHeight);this._gridBuffer=this._planet._geoImageCreator.createGridBuffer(this._cornersWgs84,
this._projType);this._refreshFrame=!1}};og.layer.BaseGeoImage.prototype.abortMaterialLoading=function(c){this._creationProceeding=!1;c.isLoading=!1;c.isReady=!1};
og.layer.BaseGeoImage.prototype.clear=function(){var c=this._planet;if(c){var d=c.renderer.handler.gl;this._creationProceeding&&c._geoImageCreator.remove(this);c._clearLayerMaterial(this);d.deleteBuffer(this._gridBuffer);d.deleteTexture(this._sourceTexture);!this._materialTexture["default"]&&d.deleteTexture(this._materialTexture)}this._gridBuffer=this._materialTexture=this._sourceTexture=null;this._refreshFrame=!0;this._creationProceeding=this._ready=this._sourceCreated=!1};
og.layer.BaseGeoImage.prototype.setVisibility=function(c){c!=this._visibility&&(this._visibility=c,this._isBaseLayer&&c&&this._planet.setBaseLayer(this),this._planet.updateVisibleLayers(),this.events.dispatch(this.events.visibilitychange,this),c?this._sourceReady&&this._planet._geoImageCreator.add(this):this._sourceReady&&this._planet._geoImageCreator.remove(this))};og.layer.BaseGeoImage.prototype.clearMaterial=function(c){c.image=null;c.texture=null;c.isLoading=!1;c.isReady=!1};
og.layer.BaseGeoImage.prototype.applyMaterial=function(c){var d=c.segment;this._ready?(c.isReady=!0,c.isLoading=!1,c.texture=this._materialTexture):(c.texture=this._planet.transparentTexture,!this._creationProceeding&&this.loadMaterial(c));0===this._projType?(c=this._extentWgs84,d=d._extent):(c=this._extentMerc,d=d.getExtentMerc());var e=c.northEast.lon-c.southWest.lon,f=c.northEast.lat-c.southWest.lat;return[(d.southWest.lon-c.southWest.lon)/e,(c.northEast.lat-d.northEast.lat)/f,(d.northEast.lon-
d.southWest.lon)/e,(d.northEast.lat-d.southWest.lat)/f]};og.layer.GeoImage=function(c,d){og.inheritance.base(this,c,d);this._image=d.image||null;this._src=d.src||null};og.inheritance.extend(og.layer.GeoImage,og.layer.BaseGeoImage);og.layer.GeoImage.prototype.setSrc=function(c){this._planet&&this._planet._geoImageCreator.remove(this);this._src=c;this._sourceReady=!1};og.layer.GeoImage.prototype.setImage=function(c){this._planet&&this._planet._geoImageCreator.remove(this);this._image=c;this._src=c.src;this._sourceReady=!1};
og.layer.GeoImage.prototype._createSourceTexture=function(){this._sourceCreated||(this._sourceTexture=this._planet.renderer.handler.createTexture_n(this._image),this._sourceCreated=!0)};og.layer.GeoImage.prototype._onLoad=function(c){this._frameWidth=c.width;this._frameHeight=c.height;this._sourceReady=!0;this._planet._geoImageCreator.add(this)};
og.layer.GeoImage.prototype.loadMaterial=function(c){this._creationProceeding=c.isLoading=!0;if(!this._sourceReady&&this._src)if(this._image)if(this._image.complete)this._onLoad(this._image);else{if(this._image.src){var d=this;this._image.addEventListener("load",function(c){d._onLoad(this)})}}else d=this,this._image=new Image,this._image.addEventListener("load",function(c){d._onLoad(this)}),this._image.src=this._src;else this._planet._geoImageCreator.add(this)};
og.layer.GeoImage.prototype.abortMaterialLoading=function(c){this._image&&(this._image.src="");this._creationProceeding=!1;c.isLoading=!1;c.isReady=!1};
og.layer.GeoImage.prototype._renderingProjType1=function(){var c=this._planet,d=c.renderer.handler,e=d.gl,c=c._geoImageCreator;this._refreshFrame&&this._createFrame();this._createSourceTexture();var f=c._framebuffer;f.setSize(this._frameWidth,this._frameHeight);f.activate();d.shaderPrograms.geoImageTransform.activate();var d=d.shaderPrograms.geoImageTransform._program,g=d.attributes,h=d.uniforms,k=this.transparentColor[0],m=this.transparentColor[1],l=this.transparentColor[2];e.disable(e.CULL_FACE);
f.bindOutputTexture(this._materialTexture);e.clearColor(k,m,l,0);e.clear(e.COLOR_BUFFER_BIT);e.bindBuffer(e.ARRAY_BUFFER,c._texCoordsBuffer);e.vertexAttribPointer(g.texCoords._pName,c._texCoordsBuffer.itemSize,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,this._gridBuffer);e.vertexAttribPointer(g.corners._pName,this._gridBuffer.itemSize,e.FLOAT,!1,0,0);e.uniform4fv(h.extentParams._pName,this._extentMercParams);e.activeTexture(e.TEXTURE0);e.bindTexture(e.TEXTURE_2D,this._sourceTexture);e.uniform1i(h.sourceTexture._pName,
0);d.drawIndexBuffer(e.TRIANGLE_STRIP,c._indexBuffer);f.deactivate();e.enable(e.CULL_FACE);this._ready=!0;this._creationProceeding=!1};
og.layer.GeoImage.prototype._renderingProjType0=function(){var c=this._planet,d=c.renderer.handler,e=d.gl,c=c._geoImageCreator;this._refreshFrame&&this._createFrame();this._createSourceTexture();var f=c._framebuffer;f.setSize(this._frameWidth,this._frameHeight);f.activate();d.shaderPrograms.geoImageTransform.activate();var d=d.shaderPrograms.geoImageTransform._program,g=d.attributes,h=d.uniforms,k=this.transparentColor[0],m=this.transparentColor[1],l=this.transparentColor[2];e.disable(e.CULL_FACE);
f.bindOutputTexture(this._materialTexture);e.clearColor(k,m,l,0);e.clear(e.COLOR_BUFFER_BIT);e.bindBuffer(e.ARRAY_BUFFER,c._texCoordsBuffer);e.vertexAttribPointer(g.texCoords._pName,c._texCoordsBuffer.itemSize,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,this._gridBuffer);e.vertexAttribPointer(g.corners._pName,this._gridBuffer.itemSize,e.FLOAT,!1,0,0);e.uniform4fv(h.extentParams._pName,this._extentWgs84Params);e.activeTexture(e.TEXTURE0);e.bindTexture(e.TEXTURE_2D,this._sourceTexture);e.uniform1i(h.sourceTexture._pName,
0);d.drawIndexBuffer(e.TRIANGLE_STRIP,c._indexBuffer);f.deactivate();e.enable(e.CULL_FACE);this._ready=!0;this._creationProceeding=!1};og.webgl={};og.webgl.vendorPrefixes=["","WEBKIT_","MOZ_"];og.webgl.getExtension=function(c,d){var e,f;for(e in og.webgl.vendorPrefixes)if(f=c.getExtension(og.webgl.vendorPrefixes[e]+d))return f;return null};og.webgl.getContext=function(c,d){var e;try{e=c.getContext("experimental-webgl",d),e.canvas=c}catch(f){og.console.logErr("exception during the GL context initialization")}e||og.console.logErr("could not initialise WebGL");return e};og.control.ToggleWireframe=function(c){og.inheritance.base(this,c)};og.inheritance.extend(og.control.ToggleWireframe,og.control.BaseControl);og.control.ToggleWireframe.prototype.oninit=function(){this.renderer.events.on("charkeypress",this,this.toogleWireframe,og.input.KEY_X)};
og.control.ToggleWireframe.prototype.toogleWireframe=function(c){this.renderer.renderNodes.Earth.drawMode===this.renderer.handler.gl.LINE_STRIP?this.renderer.renderNodes.Earth.setDrawMode(this.renderer.handler.gl.TRIANGLE_STRIP):this.renderer.renderNodes.Earth.setDrawMode(this.renderer.handler.gl.LINE_STRIP)};og.layer.WMS=function(c,d){og.inheritance.base(this,c,d);d.extent||this.setExtent(new og.Extent(new og.LonLat(-180,-90),new og.LonLat(180,90)));this.layers=d.layers;this.imageWidth=d.imageWidth||256;this.imageHeight=d.imageHeight||256;this.setVersion(d.version)};og.inheritance.extend(og.layer.WMS,og.layer.XYZ);og.layer.wms=function(c,d){return new og.layer.WMS(c,d)};
og.layer.WMS.prototype.loadMaterial=function(c){!c.isLoading&&this._planet.layersActivity&&(c.isReady=!1,c.isLoading=!0,og.layer.XYZ.__requestsCounter>=og.layer.XYZ.MAX_REQUESTS&&this.counter?this.pendingsQueue.push(c):this._exec(c))};og.layer.WMS.prototype._createUrl=function(c){return this.url+"wms?LAYERS="+this.layers+"&FORMAT=image/jpeg&SERVICE=WMS&VERSION="+this._version+"&REQUEST=GetMap&SRS="+c._projection.code+"&BBOX="+this._getBbox(c)+"&WIDTH="+this.imageWidth+"&HEIGHT="+this.imageHeight};
og.layer.WMS.prototype.setVersion=function(c){this._version=c?c:"1.1.1";"1.1.1"===this._version?this._getBbox=this._getBbox111:"1.3.0"===c&&(this._getBbox=this._getBbox130)};og.layer.WMS.prototype._getBbox111=function(c){return c._extent.getWest()+","+c._extent.getSouth()+","+c._extent.getEast()+","+c._extent.getNorth()};og.layer.WMS.prototype._getBbox130=function(c){return c._extent.getSouth()+","+c._extent.getWest()+","+c._extent.getNorth()+","+c._extent.getEast()};
og.layer.WMS.prototype._correctFullExtent=function(){var c=this._extent,d=this._extentMerc,e=og.mercator.POLE+5E4,f=og.mercator.POLE+5E4;90===c.northEast.lat&&(d.northEast.lat=f);180===c.northEast.lon&&(d.northEast.lon=e);-90===c.southWest.lat&&(d.southWest.lat=-f);-180===c.southWest.lon&&(d.southWest.lon=-e)};og.shaderProgram.skybox=function(){return new og.shaderProgram.ShaderProgram("skybox",{uniforms:{projectionViewMatrix:{type:og.shaderProgram.types.MAT4},uSampler:{type:og.shaderProgram.types.SAMPLERCUBE},pos:{type:og.shaderProgram.types.VEC3}},attributes:{aVertexPosition:{type:og.shaderProgram.types.VEC3,enableArray:!0}},vertexShader:"attribute vec3 aVertexPosition;\r\n            uniform mat4 projectionViewMatrix;\r\n            uniform vec3 pos;\r\n            varying vec3 vTextureCoord;\r\n            void main(void) {\r\n                vTextureCoord = aVertexPosition;\r\n                gl_Position = projectionViewMatrix * vec4(aVertexPosition + pos, 1.0);\r\n            }",
fragmentShader:"precision lowp float;\r\n            varying vec3 vTextureCoord;\r\n            uniform samplerCube uSampler;\r\n            void main(void) {\r\n                gl_FragColor = textureCube(uSampler, vTextureCoord);\r\n            }"})};og.FontDetector=function(){var c=["monospace","sans-serif","serif"],d=document.getElementsByTagName("body")[0],e=document.createElement("span");e.style.fontSize="72px";e.innerHTML="mmmmmmmmmmlli";var f={},g={},h;for(h in c)e.style.fontFamily=c[h],d.appendChild(e),f[c[h]]=e.offsetWidth,g[c[h]]=e.offsetHeight,d.removeChild(e);this.detect=function(h){var m=!1,l;for(l in c){e.style.fontFamily=h+","+c[l];d.appendChild(e);var n=e.offsetWidth!=f[c[l]]||e.offsetHeight!=g[c[l]];d.removeChild(e);m=m||n}return m}};og.Rectangle=function(c,d,e,f){this.left=c||0;this.right=e||0;this.top=d||0;this.bottom=f||0};og.Rectangle.prototype.clone=function(){return new og.Rectangle(this.left,this.top,this.right,this.bottom)};og.Rectangle.prototype.getWidth=function(){return Math.abs(this.right-this.left)};og.Rectangle.prototype.getHeight=function(){return Math.abs(this.bottom-this.top)};og.Rectangle.prototype.getSquare=function(){return this.getHeight()*this.getWidth()};
og.Rectangle.prototype.getDiagonal=function(){var c=this.getWidth(),d=this.getHeight();return Math.sqrt(d*d+c*c)};og.Rectangle.prototype.fit=function(c,d){return this.getWidth()==c&&this.getHeight()==d};og.ImageCanvas=function(c,d){this._canvas=document.createElement("canvas");this._canvas.width=c||256;this._canvas.height=d||256;this._context=this._canvas.getContext("2d")};og.ImageCanvas.prototype.getCanvas=function(){return this._canvas};og.ImageCanvas.prototype.getContext=function(){return this._context};
og.ImageCanvas.prototype.fillEmpty=function(){for(var c=this._context.getImageData(0,0,this._canvas.width,this._canvas.height),d=c.data,e=0,f=d.length;e<f;e+=4)d[e]=d[e+1]=d[e+2]=d[e+3]=0;this._context.putImageData(c,0,0)};og.ImageCanvas.prototype.getData=function(){return this._context.getImageData(0,0,this._canvas.width,this._canvas.height).data};og.ImageCanvas.prototype.fillColor=function(c){this._context.fillStyle=c;this._context.fillRect(0,0,this._canvas.width,this._canvas.height)};
og.ImageCanvas.prototype.setData=function(c){var d=this._context.createImageData(this._canvas.width,this._canvas.height);d.data.set(c);this._context.putImageData(d,0,0)};og.ImageCanvas.prototype.resize=function(c,d){this._canvas.width=c;this._canvas.height=d;this._context=this._canvas.getContext("2d")};og.ImageCanvas.prototype.drawImage=function(c,d,e,f,g){this._context=this._canvas.getContext("2d");this._context.drawImage(c,d||0,e||0,f||c.width,g||c.height)};
og.ImageCanvas.prototype.getImage=function(){var c=new Image;c.width=this.getWidth();c.height=this.getHeight();c.src=this._canvas.toDataURL("image/png");return c};og.ImageCanvas.prototype.getTextWidth=function(c){c=this._context.measureText(c);return Math.round(c.width)};og.ImageCanvas.prototype.drawText=function(c,d,e,f,g){this._context.fillStyle=g||"black";this._context.font=f||"normal 14px Verdana";this._context.fillText(c,d||0,e||14)};og.ImageCanvas.prototype.getWidth=function(){return this._canvas.width};
og.ImageCanvas.prototype.getHeight=function(){return this._canvas.height};og.ImageCanvas.prototype.loadImage=function(c,d){var e=new Image,f=this;e.onload=function(){f.resize(e.width,e.height);f._context.drawImage(e,0,0,e.width,e.height);d&&d(e)};e.src=c};
og.ImageCanvas.prototype.openImage=function(){var c=this.getImage(),d;d="<!DOCTYPE html><html><head><title>Print</title></head><body>"+('<img src="'+c.src+'">')+"</body>";d+="</html>";c=window.open("","","width="+c.width+"px ,height="+c.height+"px");c.document.open();c.document.write(d);c.document.close();c.focus()};og.utils.ImagesCacheManager=function(){this.imagesCache={};this._counter=0;this._pendingsQueue=new og.QueueArray;this._imageIndexCounter=0};og.utils.ImagesCacheManager.MAX_SRC_LENGTH=64;og.utils.ImagesCacheManager.prototype.load=function(c,d){if(c.length<og.utils.ImagesCacheManager.MAX_SRC_LENGTH&&this.imagesCache[c])d(this.imagesCache[c]);else{var e={src:c,success:d};1<=this._counter?this._pendingsQueue.push(e):this._exec(e)}};
og.utils.ImagesCacheManager.prototype._exec=function(c){this._counter++;var d=this,e=new Image;e.crossOrigin="";e.onload=function(){c.src.length<og.utils.ImagesCacheManager.MAX_SRC_LENGTH&&(d.imagesCache[c.src]=e);this.__nodeIndex=d._imageIndexCounter++;c.success(this);d._dequeueRequest()};e.onerror=function(){d._dequeueRequest()};e.src=c.src};
og.utils.ImagesCacheManager.prototype._dequeueRequest=function(){this._counter--;if(this._pendingsQueue.length&&1>this._counter)for(;this._pendingsQueue.length;){var c=this._pendingsQueue.pop();if(c)if(c.src.length<og.utils.ImagesCacheManager.MAX_SRC_LENGTH&&this.imagesCache[c.src])0>=this._counter?this._counter=0:this._counter--,c.success(this.imagesCache[c.src]);else{this._exec(c);break}}};og.utils.TextureAtlas=function(c,d){this.nodes=[];this.texture=null;this.canvas=new og.ImageCanvas(c||1024,d||1024);this.clearCanvas();this._handler=null;this._images=[];this._btree=null;this._imagesCacheManager=new og.utils.ImagesCacheManager;this.borderSize=4};og.utils.TextureAtlas.BORDER_SIZE=4;og.utils.TextureAtlas.prototype.getImage=function(){return this.canvas.getImage()};og.utils.TextureAtlas.prototype.getCanvas=function(){return this.canvas._canvas};
og.utils.TextureAtlas.prototype.clearCanvas=function(){this.canvas.fillEmpty("black")};og.utils.TextureAtlas.prototype.assignHandler=function(c){this._handler=c;this.createTexture()};og.utils.TextureAtlas.getDiagonal=function(c){var d=c.atlasWidth||c.width;c=c.atlasHeight||c.height;return Math.sqrt(d*d+c*c)};og.utils.TextureAtlas.prototype.addImage=function(c,d){if(c.width&&c.height)return this._images.push(c),this._makeAtlas(d),this.nodes[c.__nodeIndex]};
og.utils.TextureAtlas.prototype._completeNode=function(c,d){if(d){var e=this.canvas.getWidth(),f=this.canvas.getHeight(),g=d.image,h=d.rect,k=Math.round(.5*this.borderSize);this.canvas.drawImage(g,h.left+k,h.top+k,g.atlasWidth,g.atlasHeight);var m=d.texCoords;m[0]=(h.left+k)/e;m[1]=(h.top+k)/f;m[2]=(h.left+k)/e;m[3]=(h.bottom-k)/f;m[4]=(h.right-k)/e;m[5]=(h.bottom-k)/f;m[6]=(h.right-k)/e;m[7]=(h.bottom-k)/f;m[8]=(h.right-k)/e;m[9]=(h.top+k)/f;m[10]=(h.left+k)/e;m[11]=(h.top+k)/f;c[g.__nodeIndex]=
d}};
og.utils.TextureAtlas.prototype._makeAtlas=function(c){if(c&&this._btree)c=this._images[this._images.length-1],this._completeNode(this.nodes,this._btree.insert(c));else{c=this._images.slice(0);c.sort(function(c,d){return(d.atlasWidth||d.width)-(c.atlasWidth||c.width)||(d.atlasHeight||d.height)-(c.atlasHeight||c.height)});this._btree=new og.utils.TextureAtlasNode(new og.Rectangle(0,0,this.canvas.getWidth(),this.canvas.getHeight()));this._btree.atlas=this;this.clearCanvas();for(var d=[],e=0;e<c.length;e++)this._completeNode(d,this._btree.insert(c[e]));
this.nodes=[];this.nodes=d}};og.utils.TextureAtlas.prototype.createTexture=function(){this._handler&&(this._handler.gl.deleteTexture(this.texture),this.texture=this._handler.createTexture(this.canvas._canvas))};og.utils.TextureAtlas.prototype.loadImage=function(c,d){this._imagesCacheManager.load(c,d)};og.utils.TextureAtlasNode=function(c){this.image=this.childNodes=null;this.rect=c;this.texCoords=Array(8);this.atlas=null};
og.utils.TextureAtlasNode.prototype.insert=function(c){if(this.childNodes){var d=this.childNodes[0].insert(c);return null!=d?d:this.childNodes[1].insert(c)}if(null!=this.image)return null;var d=this.rect,e=(c.atlasWidth||c.width)+this.atlas.borderSize,f=(c.atlasHeight||c.height)+this.atlas.borderSize;if(e>d.getWidth()||f>d.getHeight())return null;if(d.fit(e,f))return this.image=c,this;this.childNodes=Array(2);this.childNodes[0]=new og.utils.TextureAtlasNode;this.childNodes[0].atlas=this.atlas;this.childNodes[1]=
new og.utils.TextureAtlasNode;this.childNodes[1].atlas=this.atlas;var g=d.getWidth()-e,h=d.getHeight()-f;g>h?(this.childNodes[0].rect=new og.Rectangle(d.left,d.top,d.left+e,d.bottom),this.childNodes[1].rect=new og.Rectangle(d.left+e,d.top,d.right,d.bottom)):(this.childNodes[0].rect=new og.Rectangle(d.left,d.top,d.right,d.top+f),this.childNodes[1].rect=new og.Rectangle(d.left,d.top+f,d.right,d.bottom));return this.childNodes[0].insert(c)};og.webgl.Framebuffer=function(c,d){d=d||{};this.handler=c;this._rbo=this._fbo=null;this._width=d.width||c.canvas.width;this._height=d.height||c.canvas.height;this._useDepth=void 0!=d.useDepth?d.useDepth:!0;this.texture=d.texture||null;this._initialize()};og.webgl.Framebuffer.prototype.destroy=function(){var c=this.handler.gl;c.deleteTexture(this.texture);c.deleteFramebuffer(this._fbo);c.deleteRenderbuffer(this._rbo);this._fbo=this._rbo=this.texture=null};
og.webgl.Framebuffer.prototype._initialize=function(){var c=this.handler.gl;this._fbo=c.createFramebuffer();c.bindFramebuffer(c.FRAMEBUFFER,this._fbo);!this.texture&&this.bindOutputTexture(this.handler.createEmptyTexture_l(this._width,this._height));this._useDepth&&(this._rbo=c.createRenderbuffer(),c.bindRenderbuffer(c.RENDERBUFFER,this._rbo),c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,this._width,this._height),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,
this._rbo),c.bindRenderbuffer(c.RENDERBUFFER,null));c.bindFramebuffer(c.FRAMEBUFFER,null)};og.webgl.Framebuffer.prototype.bindOutputTexture=function(c){var d=this.handler.gl;this.texture=c;d.bindTexture(d.TEXTURE_2D,c);d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,this.texture,0);d.bindTexture(d.TEXTURE_2D,null)};og.webgl.Framebuffer.prototype.setSize=function(c,d){this._width=c;this._height=d;this._useDepth&&(this.destroy(),this._initialize())};
og.webgl.Framebuffer.prototype.isComplete=function(){var c=this.handler.gl;return c.checkFramebufferStatus(c.FRAMEBUFFER)==c.FRAMEBUFFER_COMPLETE?!0:!1};og.webgl.Framebuffer.prototype.readAllPixels=function(){var c=this.handler.gl;c.bindFramebuffer(c.FRAMEBUFFER,this._fbo);var d=new Uint8Array(4*this._width*this._height);c.readPixels(0,0,this._width,this._height,c.RGBA,c.UNSIGNED_BYTE,d);c.bindFramebuffer(c.FRAMEBUFFER,null);return d};
og.webgl.Framebuffer.prototype.readPixel=function(c,d){var e=this.handler.gl;e.bindFramebuffer(e.FRAMEBUFFER,this._fbo);var f=new Uint8Array(4);e.readPixels(c*this._width,d*this._height,1,1,e.RGBA,e.UNSIGNED_BYTE,f);e.bindFramebuffer(e.FRAMEBUFFER,null);return f};og.webgl.Framebuffer.prototype.activate=function(){var c=this.handler.gl;c.bindFramebuffer(c.FRAMEBUFFER,null);c.bindFramebuffer(c.FRAMEBUFFER,this._fbo);c.viewport(0,0,this._width,this._height);this.handler.framebufferStack.push(this)};
og.webgl.Framebuffer.prototype.deactivate=function(){var c=this.handler,d=c.gl;d.bindFramebuffer(d.FRAMEBUFFER,null);var e=this.handler.framebufferStack.popPrev();e?(d.bindFramebuffer(d.FRAMEBUFFER,e._fbo),d.viewport(0,0,e._width,e._height)):d.viewport(0,0,c.canvas.width,c.canvas.height)};og.webgl.Framebuffer.prototype.getImage=function(){var c=this.readAllPixels(),d=new og.ImageCanvas(this._width,this._height);d.setData(c);return d.getImage()};
og.webgl.Framebuffer.prototype.openImage=function(){var c=this.getImage(),d;d="<!DOCTYPE html><html><head><title>Print</title></head><body>"+('<img src="'+c.src+'">')+"</body>";d+="</html>";c=window.open("","","width="+c.width+"px ,height="+c.height+"px");c.document.open();c.document.write(d);c.document.close();c.focus()};og.Stack=function(c){c=c||256;for(var d=function(){this.data=this.prev=this.next=null},e=new d,f=e,g=0;g<c;g++){var h=new d;h.prev=e;e=e.next=h}e=f;this.push=function(c){e=e.next;e.data=c};this.pop=function(c){e=e.prev;return e.next.data};this.popPrev=function(c){e=e.prev;return e.data}};og.webgl.ShaderController=function(c,d){this._program=d;this._handler=c;this._activated=!1};og.webgl.ShaderController.prototype.initialize=function(){this._program.createProgram(this._handler.gl)};og.webgl.ShaderController.prototype.getProgram=function(){return this._program};
og.webgl.ShaderController.prototype.activate=function(){if(!this._activated){this._handler.activeShaderProgram.deactivate();this._handler.activeShaderProgram=this;var c=this._program;this._activated=!0;c.enableAttribArrays();c.use()}};og.webgl.ShaderController.prototype.remove=function(){var c=this._handler.shaderPrograms;c[this._program.name]&&(this._activated&&this.deactivate(),this._program["delete"](),c[this._program.name]=null,delete c[this._program.name])};
og.webgl.ShaderController.prototype.deactivate=function(){this._program.disableAttribArrays();this._activated=!1};og.webgl.ShaderController.prototype.isActive=function(){return this._activated};og.webgl.ShaderController.prototype.set=function(c){this._program.set(c)};og.webgl.ShaderController.prototype.drawIndexBuffer=function(c,d){this._program.drawIndexBuffer(c,d)};og.webgl.ShaderController.prototype.drawArray=function(c,d){this._program.drawArray(c,d)};og.Console=function(){var c=function(){var c=document.createElement("div");c.classList.add("ogConsole");c.style.display="none";document.body.appendChild(c);this.show=function(){c.style.display="block"};this.hide=function(){c.style.display="none"};this.logErr=function(d){var g=document.createElement("div");g.classList.add("ogConsole-text");g.classList.add("ogConsole-error");g.innerHTML="error: "+d;c.appendChild(g);this.show()};this.logWrn=function(d){var g=document.createElement("div");g.classList.add("ogConsole-text");
g.classList.add("ogConsole-warning");g.innerHTML="warning: "+d;c.appendChild(g);this.show()};this.log=function(d,g){var h=document.createElement("div");h.classList.add("ogConsole-text");if(g)for(var k in g)h.style[k]=g[k];h.innerHTML=d;c.appendChild(h);this.show()}},d;return{getInstance:function(){d||(d=new c);return d}}}();og.Clock=function(c){this.endDate=this.startDate=0;this.currentDate=c||og.jd.DateToUTC(new Date);this.multiplier=1;this.deltaTicks=0;this.active=!0};og.Clock.prototype.setDate=function(c){this.currentDate=og.jd.DateToUTC(c)};og.Clock.prototype.getDate=function(){return og.jd.UTCtoDate(this.currentDate)};og.Clock.prototype._tick=function(c){this.deltaTicks=c*this.multiplier;this.active&&(this.currentDate=og.jd.addMilliseconds(this.currentDate,this.deltaTicks))};og.webgl.Handler=function(c,d){this.clock=new og.Clock;this.deltaTime=0;this.gl=this.canvas=null;this.shaderPrograms={};this.activeShaderProgram=null;this._params=d||{};this._params.anisotropy=this._params.anisotropy||8;var e=this._params.width;e>og.webgl.Handler.MAX_SIZE&&(e=og.webgl.Handler.MAX_SIZE);this._params.width=e||256;e=this._params.height;e>og.webgl.Handler.MAX_SIZE&&(e=og.webgl.Handler.MAX_SIZE);this._params.height=e||256;this._params.context=this._params.context||{};this._params.extensions=
this._params.extensions||[];this._oneByHeight=1/this._params.height;this.extensions={};this._id=c;this._lastAnimationFrameTime=0;this._initialized=!1;this._frameCallback=function(){};this.transparentTexture=null;this.framebufferStack=new og.Stack};og.webgl.Handler.MAX_SIZE=4096;og.webgl.Handler.prototype.setFrameCallback=function(c){c&&(this._frameCallback=c)};
og.webgl.Handler.prototype.createTexture_n=function(c){var d=this.gl,e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,c);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.bindTexture(d.TEXTURE_2D,null);
return e};
og.webgl.Handler.prototype.createEmptyTexture_n=function(c,d){var e=this.gl,f=e.createTexture();e.bindTexture(e.TEXTURE_2D,f);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,c,d,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.bindTexture(e.TEXTURE_2D,null);
return f};
og.webgl.Handler.prototype.createEmptyTexture_l=function(c,d){var e=this.gl,f=e.createTexture();e.bindTexture(e.TEXTURE_2D,f);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,c,d,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.bindTexture(e.TEXTURE_2D,null);
return f};og.webgl.Handler.prototype.createTexture_l=function(c){var d=this.gl,e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e);d.texImage2D(d.TEXTURE_2D,0,d.LUMINANCE,d.LUMINANCE,d.UNSIGNED_BYTE,c);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.bindTexture(d.TEXTURE_2D,null);return e};
og.webgl.Handler.prototype.createTexture_mm=function(c){var d=this.gl,e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,c);d.generateMipmap(d.TEXTURE_2D);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.bindTexture(d.TEXTURE_2D,null);return e};
og.webgl.Handler.prototype.createTexture_af=function(c){var d=this.gl,e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,c);d.generateMipmap(d.TEXTURE_2D);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_LINEAR);d.texParameterf(d.TEXTURE_2D,this.extensions.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._params.anisotropy);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);
d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.bindTexture(d.TEXTURE_2D,null);return e};og.webgl.Handler.prototype.createTexture=og.webgl.Handler.prototype.createTexture_af;
og.webgl.Handler.prototype.loadCubeMapTexture=function(c){var d=this.gl,e=d.createTexture();d.bindTexture(d.TEXTURE_CUBE_MAP,e);d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MIN_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MAG_FILTER,d.LINEAR);c=[[c.px,d.TEXTURE_CUBE_MAP_POSITIVE_X],[c.nx,d.TEXTURE_CUBE_MAP_NEGATIVE_X],[c.py,d.TEXTURE_CUBE_MAP_POSITIVE_Y],
[c.ny,d.TEXTURE_CUBE_MAP_NEGATIVE_Y],[c.pz,d.TEXTURE_CUBE_MAP_POSITIVE_Z],[c.nz,d.TEXTURE_CUBE_MAP_NEGATIVE_Z]];var f=new og.ImageCanvas;f.fillEmpty();for(var g=f.getImage(),f=0;f<c.length;f++){var h=c[f][1];d.bindTexture(d.TEXTURE_CUBE_MAP,e);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1);d.texImage2D(h,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,g)}for(f=0;f<c.length;f++)h=c[f][1],g=new Image,g.crossOrigin="",g.onload=function(c,e,f){return function(){d.bindTexture(d.TEXTURE_CUBE_MAP,c);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,
!1);d.texImage2D(e,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,f)}}(e,h,g),g.src=c[f][0];return e};og.webgl.Handler.prototype.addShaderProgram=function(c,d){if(this.shaderPrograms[c.name])og.console.logWrn("og.webgl.Handler:284 - shader program: '"+c.name+"' is allready exists.");else{var e=new og.webgl.ShaderController(this,c);this.shaderPrograms[c.name]=e;this._initShaderController(e);d&&(e._activated=!1)}};og.webgl.Handler.prototype.removeShaderProgram=function(c){this.shaderPrograms[c.name].remove()};
og.webgl.Handler.prototype.addShaderPrograms=function(c){for(var d=0;d<c.length;d++)this.addShaderProgram(c[d])};og.webgl.Handler.prototype._initShaderController=function(c){this._initialized&&(c.initialize(),this.activeShaderProgram?(c.deactivate(),this.activeShaderProgram._program.enableAttribArrays(),this.activeShaderProgram._program.use()):(this.activeShaderProgram=c,c.activate()))};og.webgl.Handler.prototype._initShaderPrograms=function(){for(var c in this.shaderPrograms)this._initShaderController(this.shaderPrograms[c])};
og.webgl.Handler.prototype._initExtension=function(c){if(!this.extensions||!this.extensions[c]){var d=og.webgl.getExtension(this.gl,c);d&&(this.extensions[c]=d)}};
og.webgl.Handler.prototype.init=function(){this._id?this.canvas=document.getElementById(this._id):(this.canvas=document.createElement("canvas"),this.canvas.width=this._params.width,this.canvas.height=this._params.height);og.console=og.Console.getInstance();this.gl=og.webgl.getContext(this.canvas,this._params.context);this._initialized=!0;this._params.extensions.push("OES_standard_derivatives");this._params.extensions.push("EXT_texture_filter_anisotropic");this._params.extensions.push("WEBGL_draw_buffers");
for(var c=this._params.extensions.length;c--;)this._initExtension(this._params.extensions[c]);this.extensions.EXT_texture_filter_anisotropic||(this.createTexture=this.createTexture_mm);this._initShaderPrograms();this._setDefaults()};
og.webgl.Handler.prototype._setDefaults=function(){this.activateDepthTest();this.setSize(this._params.width,this._params.height);this.gl.frontFace(this.gl.CCW);this.gl.cullFace(this.gl.BACK);this.activateFaceCulling();this.deactivateBlending();var c=this;this.createDefaultTexture({color:"rgba(0,0,0,0.0)"},function(d){c.transparentTexture=d})};og.webgl.Handler.prototype.activateDepthTest=function(){this.gl.enable(this.gl.DEPTH_TEST)};og.webgl.Handler.prototype.deactivateDepthTest=function(){this.gl.disable(this.gl.DEPTH_TEST)};
og.webgl.Handler.prototype.activateFaceCulling=function(){this.gl.enable(this.gl.CULL_FACE)};og.webgl.Handler.prototype.deactivateFaceCulling=function(){this.gl.disable(this.gl.CULL_FACE)};og.webgl.Handler.prototype.activateBlending=function(){this.gl.enable(this.gl.BLEND)};og.webgl.Handler.prototype.deactivateBlending=function(){this.gl.disable(this.gl.BLEND)};
og.webgl.Handler.prototype.createArrayBuffer=function(c,d,e){var f=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,f);this.gl.bufferData(this.gl.ARRAY_BUFFER,c,this.gl.STATIC_DRAW);f.itemSize=d;f.numItems=e;return f};og.webgl.Handler.prototype.createElementArrayBuffer=function(c,d,e){var f=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,f);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,c,this.gl.STATIC_DRAW);f.itemSize=d;f.numItems=e;return f};
og.webgl.Handler.prototype.setSize=function(c,d){c>og.webgl.Handler.MAX_SIZE&&(c=og.webgl.Handler.MAX_SIZE);d>og.webgl.Handler.MAX_SIZE&&(d=og.webgl.Handler.MAX_SIZE);this._params.width=c;this._params.height=d;this.canvas.width=c;this.canvas.height=d;this._oneByHeight=1/d;this.gl&&this.gl.viewport(0,0,c,d);this.onCanvasResize&&this.onCanvasResize(this.canvas)};og.webgl.Handler.prototype.getClientAspect=function(){return this.canvas.clientWidth/this.canvas.clientHeight};
og.webgl.Handler.prototype.getCenter=function(){var c=this.canvas;return new og.math.Pixel(Math.round(.5*c.width),Math.round(.5*c.height))};og.webgl.Handler.prototype.drawFrame=function(){var c=(new Date).getTime();this.deltaTime=c-this._lastAnimationFrameTime;this._lastAnimationFrameTime=c;this.clock._tick(this.deltaTime);c=this.canvas;c.clientWidth===c.width&&c.clientHeight===c.height||this.setSize(c.clientWidth,c.clientHeight);this._frameCallback()};
og.webgl.Handler.prototype.clearFrame=function(){var c=this.gl;this.gl.clearColor(0,0,0,1);c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT)};og.webgl.Handler.prototype.start=function(){var c=new Date;this._lastAnimationFrameTime=c.getTime();this.clock.setDate(c);this._animationFrameCallback()};og.webgl.Handler.prototype._animationFrameCallback=function(){var c=this;window.requestAnimationFrame(function(){c.drawFrame();c._animationFrameCallback()})};
og.webgl.Handler.prototype.createDefaultTexture=function(c,d){var e,f;if(c&&c.color)e=new og.ImageCanvas(2,2),e.fillColor(c.color),f=this.createTexture_n(e._canvas),f["default"]=!0,d(f);else if(c&&c.url){e=new Image;var g=this;e.onload=function(){f=g.createTexture(this);f["default"]=!0;d(f)};e.src=c.url}else e=new og.ImageCanvas(2,2),e.fillColor("#C5C5C5"),f=this.createTexture_n(e._canvas),f["default"]=!0,d(f)};og.utils.SDFCreator=function(c,d){this._vertexBuffer=this._framebuffer2=this._framebuffer1=this._framebuffer0=this._handler=null;this._width=c||512;this._height=d||512;var e=Math.max(this._width,this._height);this._outsideDistance=Math.round(80*e/512);this._insideDistance=Math.round(10*e/512);this._outsideMix=.71;this._insideMix=.679;this._sourceTexture=null;this.initialize()};og.utils.SDFCreator.prototype.initialize=function(){this._initHandler(this._width,this._height);this._initShaders()};
og.utils.SDFCreator.prototype._initHandler=function(c,d){this._handler=new og.webgl.Handler(null,{width:c,height:d,context:{alpha:!0,depth:!1}});this._handler.init();this._handler.deactivateFaceCulling();this._handler.deactivateDepthTest();this._vertexBuffer=this._handler.createArrayBuffer(new Float32Array([-1,-1,-1,1,1,-1,1,1]),2,4);this._framebuffer0=new og.webgl.Framebuffer(this._handler,{useDepth:!1});this._framebuffer1=new og.webgl.Framebuffer(this._handler,{useDepth:!1});this._framebuffer2=
new og.webgl.Framebuffer(this._handler,{useDepth:!1})};
og.utils.SDFCreator.prototype._initShaders=function(){var c=new og.shaderProgram.ShaderProgram("vfield",{uniforms:{uTexSize:{type:og.shaderProgram.types.VEC2},uTex1:{type:og.shaderProgram.types.SAMPLER2D},uDistance:{type:og.shaderProgram.types.INT},uNeg:{type:og.shaderProgram.types.VEC2}},attributes:{aPos:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:"attribute vec2 aPos;\n\r\n            uniform vec2 uTexSize;\n\r\n            varying vec2 TexCoord;\n\r\n            varying vec2 vTexSize;\n\r\n            void main() {\n\r\n                TexCoord = (aPos + 1.0) * 0.5;\n\r\n                TexCoord *= uTexSize;\n\r\n                vTexSize = uTexSize;\n\r\n                gl_Position.xy = aPos;\n\r\n                gl_Position.zw = vec2(0.0, 1.0);\n\r\n            }",fragmentShader:"#ifdef GL_ES\n\r\n            #ifdef GL_FRAGMENT_PRECISION_HIGH\n\r\n            precision highp float;\n\r\n            #else\n\r\n            precision mediump float;\n\r\n            #endif // GL_FRAGMENT_PRECISION_HIGH\n\r\n            #endif // GL_ES\n\r\n            uniform sampler2D uTex1;\n\r\n            uniform int uDistance;\n\r\n            uniform vec2 uNeg;\n\r\n            varying vec2 TexCoord;\n\r\n            varying vec2 vTexSize;\n\r\n            const int maxDistance = "+
this._outsideDistance+";\n\r\n            void main() {\n\r\n                if ( uNeg.x - uNeg.y * texture2D(uTex1, TexCoord / vTexSize).r > 0.5 ) {\n\r\n                    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\r\n                    return;\n\r\n                }\n\r\n                for ( int i=1; i <= maxDistance; i++ ) {\n\r\n                    if(i > uDistance) break;\n\r\n                    if ( uNeg.x - uNeg.y * texture2D(uTex1, ( TexCoord + vec2(0.0, i) ) / vTexSize ).r > 0.5 ) {\n\r\n                        gl_FragColor = vec4( vec3(float(i)/float(uDistance)), 1.0 );\n\r\n                        return;\n\r\n                    }\n\r\n                    if ( uNeg.x - uNeg.y * texture2D(uTex1, ( TexCoord - vec2(0.0, i)) / vTexSize ).r > 0.5 ) {\n\r\n                        gl_FragColor = vec4(vec3(float(i)/float(uDistance)), 1.0);\n\r\n                        return;\n\r\n                    }\n\r\n                }\n\r\n                gl_FragColor = vec4(1.0);\n\r\n            }"}),
d=new og.shaderProgram.ShaderProgram("hfield",{uniforms:{uTexSize:{type:og.shaderProgram.types.VEC2},uTex1:{type:og.shaderProgram.types.SAMPLER2D},uDistance:{type:og.shaderProgram.types.INT}},attributes:{aPos:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:"attribute vec2 aPos;\n\r\n            uniform vec2 uTexSize;\n\r\n            varying vec2 TexCoord;\n\r\n            varying vec2 vTexSize;\n\r\n            void main() {\n\r\n                TexCoord = (aPos + 1.0) * 0.5;\n\r\n                TexCoord *= uTexSize;\n\r\n                vTexSize = uTexSize;\n\r\n                gl_Position.xy = aPos;\n\r\n                gl_Position.zw = vec2(0.0, 1.0);\n\r\n            }",
fragmentShader:"#ifdef GL_ES\n\r\n            #ifdef GL_FRAGMENT_PRECISION_HIGH\n\r\n            precision highp float;\n\r\n            #else\n\r\n            precision mediump float;\n\r\n            #endif // GL_FRAGMENT_PRECISION_HIGH\n\r\n            #endif // GL_ES\n\r\n            uniform sampler2D uTex1;\n\r\n            uniform int uDistance;\n\r\n            varying vec2 TexCoord;\n\r\n            varying vec2 vTexSize;\n\r\n            const int maxDistance = "+this._outsideDistance+";\n\r\n            float CalcC(float H, float V) {\n\r\n                return ( sqrt( H * H + V * V ) );\n\r\n            }\n\r\n            void main(){\n\r\n                float dist = CalcC( 0.0, texture2D( uTex1, TexCoord / vTexSize ).r );\n\r\n                for ( int i = 1; i <= maxDistance; i++ ) {\n\r\n                    if(i > uDistance) break;\n\r\n                    float H = float(i) / float(uDistance);\n\r\n                    dist = min( dist, CalcC( H, texture2D( uTex1, ( TexCoord + vec2( float(i), 0.0) ) / vTexSize ).r ) );\n\r\n                    dist = min( dist, CalcC( H, texture2D( uTex1, ( TexCoord - vec2( float(i), 0.0) ) / vTexSize ).r ) );\n\r\n                }\n\r\n                gl_FragColor = vec4(dist);\n\r\n                gl_FragColor.w = 1.0;\n\r\n            }"}),
e=new og.shaderProgram.ShaderProgram("sum",{uniforms:{outside:{type:og.shaderProgram.types.SAMPLER2D},inside:{type:og.shaderProgram.types.SAMPLER2D},source:{type:og.shaderProgram.types.SAMPLER2D}},attributes:{aPos:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:"attribute vec2 aPos;\n\r\n                        varying vec2 TexCoord;\n\r\n                        void main(){\n\r\n                            TexCoord = (aPos * vec2(1.0,-1.0) + 1.0) * 0.5;\n\r\n                            gl_Position.xy = aPos;\n\r\n                            gl_Position.zw = vec2(0.0, 1.0);\n\r\n                        }",
fragmentShader:"#ifdef GL_ES\n\r\n                        #ifdef GL_FRAGMENT_PRECISION_HIGH\n\r\n                        precision highp float;\n\r\n                        #else\n\r\n                        precision mediump float;\n\r\n                        #endif // GL_FRAGMENT_PRECISION_HIGH\n\r\n                        #endif // GL_ES\n\r\n                        uniform sampler2D outside;\n\r\n                        uniform sampler2D inside;\n\r\n                        uniform sampler2D source;\n\r\n                        varying vec2 TexCoord;\n\r\n                        void main(){\n\r\n                            float o = texture2D(outside, TexCoord).r;\n\r\n                            float i = 1.0 - texture2D(inside, TexCoord).r;\n\r\n                            float s = texture2D(source, TexCoord).r;\n\r\n                            gl_FragColor = vec4( vec3(1.0 - mix(i, o, step(0.5, s) * "+
this._outsideMix+" + (1.0 - step(0.5, s)) * "+this._insideMix+" )), 1.0);\n\r\n                        }"});this._handler.addShaderPrograms([c,d,e])};og.utils.SDFCreator.prototype.setSize=function(c,d){if(c!=this._width||d!=this._height)this._width=c,this._height=d,this._handler.setSize(c,d),this._framebuffer0.setSize(c,d),this._framebuffer1.setSize(c,d)};
og.utils.SDFCreator.prototype.createSDF=function(c,d,e){var f=this._handler,g=f.gl;f.setSize(this._width,this._height);g.deleteTexture(this._sourceTexture);this._sourceTexture=f.createTexture_l(c);f.shaderPrograms.vfield.activate();var h=f.shaderPrograms.vfield._program;c=h.attributes;h=h.uniforms;g.activeTexture(g.TEXTURE0);g.bindTexture(g.TEXTURE_2D,this._sourceTexture);g.uniform1i(h.uTex1._pName,0);g.uniform2fv(h.uTexSize._pName,[this._width,this._height]);g.bindBuffer(g.ARRAY_BUFFER,this._vertexBuffer);
g.vertexAttribPointer(c.aPos._pName,this._vertexBuffer.itemSize,g.FLOAT,!1,0,0);this._framebuffer0.activate();g.uniform1i(h.uDistance._pName,this._outsideDistance);g.uniform2fv(h.uNeg._pName,[0,-1]);g.drawArrays(g.TRIANGLE_STRIP,0,4);this._framebuffer0.deactivate();this._framebuffer2.activate();g.uniform2fv(h.uNeg._pName,[1,1]);g.uniform1i(h.uDistance._pName,this._insideDistance);g.drawArrays(g.TRIANGLE_STRIP,0,4);this._framebuffer2.deactivate();f.shaderPrograms.hfield.activate();h=f.shaderPrograms.hfield._program;
c=h.attributes;h=h.uniforms;g.uniform2fv(h.uTexSize._pName,[this._width,this._height]);g.bindBuffer(g.ARRAY_BUFFER,this._vertexBuffer);g.vertexAttribPointer(c.aPos._pName,this._vertexBuffer.itemSize,g.FLOAT,!1,0,0);this._framebuffer1.activate();g.activeTexture(g.TEXTURE0);g.bindTexture(g.TEXTURE_2D,this._framebuffer0.texture);g.uniform1i(h.uTex1._pName,0);g.uniform1i(h.uDistance._pName,this._outsideDistance);g.drawArrays(g.TRIANGLE_STRIP,0,4);this._framebuffer1.deactivate();this._framebuffer0.activate();
g.activeTexture(g.TEXTURE0);g.bindTexture(g.TEXTURE_2D,this._framebuffer2.texture);g.uniform1i(h.uTex1._pName,0);g.uniform1i(h.uDistance._pName,this._insideDistance);g.drawArrays(g.TRIANGLE_STRIP,0,4);this._framebuffer0.deactivate();f.setSize(d||this._width,e||this._height);g.clearColor(0,0,0,0);g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT);f.shaderPrograms.sum.activate();h=f.shaderPrograms.sum._program;c=h.attributes;h=h.uniforms;g.activeTexture(g.TEXTURE0);g.bindTexture(g.TEXTURE_2D,this._framebuffer1.texture);
g.uniform1i(h.outside._pName,0);g.activeTexture(g.TEXTURE1);g.bindTexture(g.TEXTURE_2D,this._framebuffer0.texture);g.uniform1i(h.inside._pName,1);g.activeTexture(g.TEXTURE2);g.bindTexture(g.TEXTURE_2D,this._sourceTexture);g.uniform1i(h.source._pName,2);g.bindBuffer(g.ARRAY_BUFFER,this._vertexBuffer);g.vertexAttribPointer(c.aPos._pName,this._vertexBuffer.itemSize,g.FLOAT,!1,0,0);g.drawArrays(g.TRIANGLE_STRIP,0,4);return f.canvas};og.utils.FontAtlas=function(){this.atlasesArr=[];this.atlasIndexes={};this.tokenImageSize=64;this.samplerArr=[0];this._handler=null;this.defaultFace="arial";this._counter=0;this._pendingsQueue=new og.QueueArray;this.fontDetector=new og.FontDetector;this._sdfCreator=new og.utils.SDFCreator(256,256)};
og.utils.FontAtlas.tokens=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","\u0430","\u0431","\u0432","\u0433","\u0434","\u0435","\u0451","\u0436","\u0437","\u0438","\u043a","\u043b","\u043c","\u043d","\u043e","\u043f","\u0440","\u0441","\u0442","\u0443","\u0444","\u0445","\u0446","\u0447","\u0448","\u0449","\u044c","\u044d","\u044a","\u044e",
"\u044f","\u0439","\u0410","\u0411","\u0412","\u0413","\u0414","\u0415","\u0401","\u0416","\u0417","\u0418","\u041a","\u041b","\u041c","\u041d","\u041e","\u041f","\u0420","\u0421","\u0422","\u0423","\u0424","\u0425","\u0426","\u0427","\u0428","\u0429","\u042c","\u042d","\u042a","\u042e","\u042f","\u0419","1","2","3","4","5","6","7","8","9","0","`","!","@","#","$","%","^","&","*","(",")","_","+","-","=","[","]","{","}","\\","|",";",":",'"',",",".","/","<",">","?"," ","    ","'"];
og.utils.FontAtlas.prototype.assignHandler=function(c){this._handler=c};og.utils.FontAtlas.prototype.getFontIndex=function(c,d,e){return this.atlasIndexes[this.getFullIndex(c,d,e)]};og.utils.FontAtlas.prototype.getFullIndex=function(c,d,e){c=c&&c.trim().toLowerCase();if(!c||c&&!this.fontDetector.detect(c))c=this.defaultFace;return c+" "+(d&&d.toLowerCase()||"normal")+" "+(e&&e.toLowerCase()||"normal")};
og.utils.FontAtlas.prototype.createFont=function(c,d,e){var f=this.getFontIndex(c,d,e);if(void 0==f){var g=this.tokenImageSize,f=this.getFullIndex(c,d,e),f=this.atlasIndexes[f]=this.atlasesArr.length,h=new og.utils.TextureAtlas(1024,1024);h.assignHandler(this._handler);h.borderSize=6;this.samplerArr[this.atlasesArr.length]=this.atlasesArr.length;this.atlasesArr.push(h);h.canvas.fillColor("black");var k=og.utils.FontAtlas.tokens,m=new og.ImageCanvas(512,512),l=this._sdfCreator,n=Math.round(337.92);
c=(d||"normal")+" "+(e||"normal")+" "+n+"px "+(c||this.defaultFace);for(d=0;d<k.length;d++){e=k[d];m.fillColor("black");m.drawText(e,49,n,c,"white");var p=l.createSDF(m._canvas,g,g);p.__nodeIndex=e;p=h.addImage(p,!0,!0);e=m.getTextWidth(e);p.emptySize=e/512}h.createTexture()}return f};og.utils.FontAtlas.prototype.createFontAsync=function(c,d,e,f){c={face:c,style:d,weight:e,callback:f};1<=this._counter?this._pendingsQueue.push(c):this._exec(c)};
og.utils.FontAtlas.prototype._exec=function(c){this._counter++;var d=this;setTimeout(function(){var e=d.createFont(c.face,c.style,c.weight);c.callback(e);d._dequeueRequest()},0)};og.utils.FontAtlas.prototype._dequeueRequest=function(){this._counter--;if(this._pendingsQueue.length&&1>this._counter){var c;(c=this._whilePendings())&&this._exec(c)}};
og.utils.FontAtlas.prototype._whilePendings=function(){for(;this._pendingsQueue.length;){var c=this._pendingsQueue.pop(),d=this.getFontIndex(c.face,c.style,c.weight);if(void 0!=d)c.callback(d);else return c}};og.scene={};og.scene.Node=function(c){this.name=c;this.topNode=this;this._dictionary=[];this._dictionary[c]=this;this.childNodes=[];this.parentNode=null;this.__staticId=og.scene.Node.__staticCounter++};og.scene.Node.__staticCounter=0;og.scene.Node.prototype={name:"",childNodes:[],parentNode:null,topNode:null,_dictionary:[]};
og.scene.Node.prototype.addNode=function(c){c.topNode=null==this.parentNode?this:this.topNode;c.parentNode=this;c._dictionary=this.topNode._dictionary;this.childNodes.push(c);this.topNode._dictionary[c.name]=c};og.scene.Node.prototype.destroy=function(){for(var c=0;c<this.childNodes.length;c++)this.childNodes[c].destroy();this._clear()};og.scene.Node.prototype.getNodeByName=function(c){return this._dictionary[c]};
og.scene.Node.prototype._clear=function(){this.name="";this.topNode=this.parentNode=null;this.childNodes.length=0};og.scene.RenderNode=function(c){og.inheritance.base(this,c);this.drawMode=this.renderer=null;this._isActive=this.show=!0;this.lightEnabled=!1;this._lights=[];this._lightsTransformedPositions=[];this._lightsParamsv=[];this._lightsParamsf=[];this._lightsNames=[];this.entityCollections=[];this.billboardsTextureAtlas=new og.utils.TextureAtlas;this.fontAtlas=new og.utils.FontAtlas;this.events=new og.Events};og.inheritance.extend(og.scene.RenderNode,og.scene.Node);
og.scene.RenderNode.prototype.assignRenderer=function(c){this.renderer=c;this.billboardsTextureAtlas.assignHandler(c.handler);this.fontAtlas.assignHandler(c.handler);c.addPickingCallback(this,this._entityCollectionPickingCallback);for(var d=0;d<this.entityCollections.length;d++)this.entityCollections[d].setRenderer(c);this.initialization&&this.initialization()};og.scene.RenderNode.prototype.addEntityCollection=function(c,d){c.addTo(this,d);return this};
og.scene.RenderNode.prototype.removeEntityCollection=function(c){c.remove()};og.scene.RenderNode.prototype.addLight=function(c){c.addTo(this);return this};og.scene.RenderNode.prototype.getLightByName=function(c){c=this._lightsNames.indexOf(c);return this._lights[c]};og.scene.RenderNode.prototype.removeLight=function(c){c.remove()};og.scene.RenderNode.prototype.drawNode=function(){this._isActive&&this._drawNodes()};og.scene.RenderNode.prototype.isActive=function(){return this._isActive};
og.scene.RenderNode.prototype.setActive=function(c){this._isActive=c;for(var d=0;d<this.childNodes.length;d++)this.childNodes[d].setActive(c)};og.scene.RenderNode.prototype.setDrawMode=function(c){this.drawMode=c;for(var d=0;d<this.childNodes.length;d++)this.childNodes[d].setDrawMode(c)};
og.scene.RenderNode.prototype.transformLights=function(){for(var c=this.renderer,d=0;d<this._lights.length;d++){var e=4*d,f;this._lights[d].directional?(f=c.activeCamera._normalMatrix.mulVec(this._lights[d]._position),this._lightsTransformedPositions[e+3]=0):(f=c.activeCamera._viewMatrix.mulVec3(this._lights[d]._position),this._lightsTransformedPositions[e+3]=1);this._lightsTransformedPositions[e]=f.x;this._lightsTransformedPositions[e+1]=f.y;this._lightsTransformedPositions[e+2]=f.z}};
og.scene.RenderNode.prototype.updateBillboardsTexCoords=function(){for(var c=0;c<this.entityCollections.length;c++)this.entityCollections[c].billboardHandler.refreshTexCoordsArr()};og.scene.RenderNode.prototype._drawNodes=function(){for(var c=0;c<this.childNodes.length;c++)this.childNodes[c]._isActive&&this.childNodes[c]._drawNodes();this.show&&(this.frame&&this.frame(),this.drawEntityCollections(this.entityCollections))};
og.scene.RenderNode.prototype.drawEntityCollections=function(c){if(c.length){var d=this.renderer.handler.gl;d.enable(d.BLEND);d.blendEquation(d.FUNC_ADD);d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE);d.disable(d.CULL_FACE);d.enable(d.POLYGON_OFFSET_FILL);d.polygonOffset(0,-637E3);d.activeTexture(d.TEXTURE0);d.bindTexture(d.TEXTURE_2D,this.billboardsTextureAtlas.texture);for(var e=c.length;e--;){var f=c[e];f._animatedOpacity&&(f.events.dispatch(f.events.draw,f),f.billboardHandler.draw())}f=
this.fontAtlas.atlasesArr;for(e=0;e<f.length;e++)d.activeTexture(d.TEXTURE0+e),d.bindTexture(d.TEXTURE_2D,f[e].texture);for(e=c.length;e--;)c[e]._animatedOpacity&&c[e].labelHandler.draw();d.polygonOffset(0,0);for(e=c.length;e--;)c[e]._animatedOpacity&&c[e].lineStringHandler.draw();d.disable(d.POLYGON_OFFSET_FILL);d.enable(d.CULL_FACE);for(e=c.length;e--;)f=c[e],f._animatedOpacity&&(f.shapeHandler.draw(),f.events.dispatch(f.events.drawend,f));for(e=c.length;e--;)c[e]._animatedOpacity&&c[e].pointCloudHandler.draw()}};
og.scene.RenderNode.prototype.drawPickingEntityCollections=function(c){if(c.length){var d=this.renderer.handler.gl;d.disable(d.CULL_FACE);d.enable(d.POLYGON_OFFSET_FILL);d.polygonOffset(0,-637E3);for(var e=c.length;e--;)c[e]._visibility&&c[e].billboardHandler.drawPicking();for(e=c.length;e--;)c[e]._visibility&&c[e].labelHandler.drawPicking();d.disable(d.POLYGON_OFFSET_FILL);d.enable(d.CULL_FACE)}};og.scene.RenderNode.prototype._entityCollectionPickingCallback=function(){this.drawPickingEntityCollections(this.entityCollections)};og.scene.defaultSkyBox=function(){return new og.scene.SkyBox({nx:og.RESOURCES_URL+"skybox/gal/_nx.jpg",px:og.RESOURCES_URL+"skybox/gal/_px.jpg",py:og.RESOURCES_URL+"skybox/gal/_py.jpg",ny:og.RESOURCES_URL+"skybox/gal/_ny.jpg",pz:og.RESOURCES_URL+"skybox/gal/_pz.jpg",nz:og.RESOURCES_URL+"skybox/gal/_nz.jpg"})};og.scene.SkyBox=function(c){og.inheritance.base(this,"skybox");this.params=c;this.texture=this.vertexPositionBuffer=null};og.inheritance.extend(og.scene.SkyBox,og.scene.RenderNode);
og.scene.SkyBox.prototype.initialization=function(){this.renderer.handler.addShaderProgram(og.shaderProgram.skybox(),!0);this.texture=this.renderer.handler.loadCubeMapTexture(this.params);this.createBuffers();this.drawMode=this.renderer.handler.gl.TRIANGLES};
og.scene.SkyBox.prototype.frame=function(){var c=this.renderer.handler,d=c.gl,e=this.renderer.activeCamera;d.disable(c.gl.DEPTH_TEST);c.shaderPrograms.skybox.activate();sh=c.shaderPrograms.skybox._program;var f=sh.uniforms;d.uniformMatrix4fv(f.projectionViewMatrix._pName,!1,e._projectionViewMatrix._m);d.uniform3fv(f.pos._pName,e.eye.toVec());d.activeTexture(d.TEXTURE0);d.bindTexture(d.TEXTURE_CUBE_MAP,this.texture);d.uniform1i(f.uSampler._pName,0);e=this.vertexPositionBuffer;d.bindBuffer(d.ARRAY_BUFFER,
e);d.vertexAttribPointer(sh.attributes.aVertexPosition._pName,e.itemSize,d.FLOAT,!1,0,0);d.drawArrays(this.drawMode,0,e.numItems);c.gl.enable(c.gl.DEPTH_TEST)};
og.scene.SkyBox.prototype.createBuffers=function(){var c=new Float32Array([-1E4,1E4,-1E4,-1E4,-1E4,-1E4,1E4,-1E4,-1E4,1E4,-1E4,-1E4,1E4,1E4,-1E4,-1E4,1E4,-1E4,-1E4,-1E4,1E4,-1E4,-1E4,-1E4,-1E4,1E4,-1E4,-1E4,1E4,-1E4,-1E4,1E4,1E4,-1E4,-1E4,1E4,1E4,-1E4,-1E4,1E4,-1E4,1E4,1E4,1E4,1E4,1E4,1E4,1E4,1E4,1E4,-1E4,1E4,-1E4,-1E4,-1E4,-1E4,1E4,-1E4,1E4,1E4,1E4,1E4,1E4,1E4,1E4,1E4,1E4,-1E4,1E4,-1E4,-1E4,1E4,-1E4,1E4,-1E4,1E4,1E4,-1E4,1E4,1E4,1E4,1E4,1E4,1E4,-1E4,1E4,1E4,-1E4,1E4,-1E4,-1E4,-1E4,-1E4,-1E4,-1E4,
1E4,1E4,-1E4,-1E4,1E4,-1E4,-1E4,-1E4,-1E4,1E4,1E4,-1E4,1E4]);this.vertexPositionBuffer=this.renderer.handler.createArrayBuffer(c,3,c.length/3)};og.control.MouseNavigation=function(c){og.inheritance.base(this,c);this.grabbedPoint=new og.math.Vector3;this._eye0=new og.math.Vector3;this.pointOnEarth=new og.math.Vector3;this.earthUp=new og.math.Vector3;this.inertia=.007;this.grabbedSpheroid=new og.bv.Sphere;this.planet=null;this.qRot=new og.math.Quaternion;this.scaleRot=0;this.distDiff=.33;this.stepsCount=5;this.stepsForward=null;this.stepIndex=0};og.inheritance.extend(og.control.MouseNavigation,og.control.BaseControl);
og.control.mouseNavigation=function(c){return new og.control.MouseNavigation(c)};
og.control.MouseNavigation.getMovePointsFromPixelTerrain=function(c,d,e,f,g,h,k){var m=[],l=c.eye.clone(),n=c._n.clone(),p=c._u.clone(),q=c._v.clone();d=d.getCartesianFromPixelTerrain(g,!0);k||(k=og.math.Vector3.sub(d,c.eye).normalize());g=d?f*c.eye.distance(d)/e:1E3;g=h?-g:2*g;f=n.scaleTo(g);if(d&&9E3<c._lonLat.height&&.6<n.dot(l.normal())){var r=new og.bv.Sphere;r.radius=d.length();g=[];var t=[],u=!1;for(h=0;h<e;h++){l.addA(f);var B=(new og.math.Ray(l,k)).hitSphere(r);t[h]=l.clone();if(B)g[h]=(new og.math.Matrix4).rotateBetweenVectors(d.normal(),
B.normal());else{u=!0;break}}if(u)for(l=c.eye.clone(),h=0;h<e;h++)m[h]={},m[h].eye=l.addA(f).clone(),m[h].v=q,m[h].u=p,m[h].n=n;else for(h=0;h<e;h++)c=g[h],m[h]={},m[h].eye=c.mulVec3(t[h]),m[h].v=c.mulVec3(q),m[h].u=c.mulVec3(p),m[h].n=c.mulVec3(n)}else for(h=0;h<e;h++)m[h]={},m[h].eye=l.addA(k.scaleTo(-g)).clone(),m[h].v=q,m[h].u=p,m[h].n=n;return m};
og.control.MouseNavigation.prototype.onactivate=function(){this.renderer.events.on("mousewheel",this,this.onMouseWheel);this.renderer.events.on("mouselbuttonhold",this,this.onMouseLeftButtonDown);this.renderer.events.on("mouserbuttonhold",this,this.onMouseRightButtonDown);this.renderer.events.on("mouselbuttondown",this,this.onMouseLeftButtonClick);this.renderer.events.on("mouselbuttonup",this,this.onMouseLeftButtonUp);this.renderer.events.on("mouserbuttondown",this,this.onMouseRightButtonClick);this.renderer.events.on("mouselbuttondoubleclick",
this,this.onMouseLeftButtonDoubleClick);this.renderer.events.on("draw",this,this.onDraw)};
og.control.MouseNavigation.prototype.ondeactivate=function(){this.renderer.events.off("mousewheel",this.onMouseWheel);this.renderer.events.off("mouselbuttonhold",this.onMouseLeftButtonDown);this.renderer.events.off("mouserbuttonhold",this.onMouseRightButtonDown);this.renderer.events.off("mouselbuttondown",this.onMouseLeftButtonClick);this.renderer.events.off("mouselbuttonup",this.onMouseLeftButtonUp);this.renderer.events.off("mouserbuttondown",this.onMouseRightButtonClick);this.renderer.events.off("mouselbuttondoubleclick",
this.onMouseLeftButtonDoubleClick);this.renderer.events.off("draw",this.onDraw)};
og.control.MouseNavigation.prototype.onMouseWheel=function(c){if(!this.stepIndex){this.planet.stopFlying();this.stopRotation();this._deactivate=!0;this.planet.layersActivity=!1;this.planet.terrainProvider.active=!1;this.planet.normalMapCreator.active=!1;var d=this.renderer.events.mouseState;this.stepIndex=this.stepsCount;this.stepsForward=og.control.MouseNavigation.getMovePointsFromPixelTerrain(this.renderer.activeCamera,this.planet,this.stepsCount,this.distDiff,d,0<c.wheelDelta,d.direction)}};
og.control.MouseNavigation.prototype.oninit=function(){this.planet=this.renderer.renderNodes.Earth;this.activate()};
og.control.MouseNavigation.prototype.onMouseLeftButtonDoubleClick=function(){this.planet.stopFlying();this.stopRotation();var c=this.planet.getLonLatFromPixelTerrain(this.renderer.events.mouseState,!0);this.renderer.events.isKeyPressed(og.input.KEY_SHIFT)?this.planet.flyLonLat(new og.LonLat(c.lon,c.lat,this.renderer.activeCamera.getAltitude()*(1+this.distDiff)*1.7)):this.planet.flyLonLat(new og.LonLat(c.lon,c.lat,this.renderer.activeCamera.getAltitude()*this.distDiff*1.7))};
og.control.MouseNavigation.prototype.onMouseLeftButtonClick=function(){this.active&&(this.renderer.handler.gl.canvas.classList.add("ogGrabbingPoiner"),this.grabbedPoint=this.planet.getCartesianFromMouseTerrain(!0))&&(this._eye0.copy(this.renderer.activeCamera.eye),this.grabbedSpheroid.radius=this.grabbedPoint.length(),this.stopRotation())};og.control.MouseNavigation.prototype.stopRotation=function(){this.qRot.clear()};og.control.MouseNavigation.prototype.onMouseLeftButtonUp=function(c){this.renderer.handler.gl.canvas.classList.remove("ogGrabbingPoiner")};
og.control.MouseNavigation.prototype.onMouseLeftButtonDown=function(c){if(this.active&&this.grabbedPoint)if(this.planet.stopFlying(),this.renderer.events.mouseState.moving){var d=this.renderer.activeCamera;if(.15<d._n.dot(d.eye.normal())){if(c=(new og.math.Ray(d.eye,c.direction)).hitSphere(this.grabbedSpheroid))this.scaleRot=1,c=this.qRot=og.math.Quaternion.getRotationBetweenVectors(c.normal(),this.grabbedPoint.normal()),d.eye=c.mulVec3(d.eye),d._v=c.mulVec3(d._v),d._u=c.mulVec3(d._u),d._n=c.mulVec3(d._n),
d.update()}else{var e=this.grabbedPoint,f=og.math.Vector3.add(e,d._u),g=og.math.Vector3.add(e,e.normal()),h=new og.math.Vector3;(new og.math.Ray(d.eye,c.direction)).hitPlane(e,f,g,h)===og.math.Ray.INSIDE&&(d.eye=this._eye0.addA(h.subA(e).negate()),d.update())}}else this.scaleRot=0};og.control.MouseNavigation.prototype.onMouseRightButtonClick=function(c){this.stopRotation();this.planet.stopFlying();if(this.pointOnEarth=this.planet.getCartesianFromPixelTerrain({x:c.x,y:c.y},!0))this.earthUp=this.pointOnEarth.normal()};
og.control.MouseNavigation.prototype.onMouseRightButtonDown=function(c){var d=this.renderer.activeCamera;if(this.renderer.events.mouseState.moving){this.renderer.controlsBag.scaleRot=1;var e=.5/d.eye.distance(this.pointOnEarth)*d._lonLat.height*og.math.RADIANS;.007<e&&(e=.007);d.rotateHorizontal(e*(c.x-c.prev_x),!1,this.pointOnEarth,this.earthUp);d.rotateVertical(e*(c.y-c.prev_y),this.pointOnEarth);d.update()}};
og.control.MouseNavigation.prototype.onDraw=function(c){if(this.active){var d=this.renderer;c=d.activeCamera;var e=c.eye.clone();if(this.stepIndex){d.controlsBag.scaleRot=1;var f=this.stepsForward[this.stepsCount-this.stepIndex--];c.eye=f.eye;c._v=f.v;c._u=f.u;c._n=f.n;c.update()}else this._deactivate&&(this._deactivate=!1,this.planet.layersActivity=!0,this.planet.terrainProvider.active=!0,this.planet.normalMapCreator.active=!0);!d.events.mouseState.leftButtonDown&&this.scaleRot&&(this.scaleRot-=
this.inertia,0>=this.scaleRot?this.scaleRot=0:(d.controlsBag.scaleRot=this.scaleRot,d=this.qRot.slerp(og.math.Quaternion.IDENTITY,1-this.scaleRot*this.scaleRot*this.scaleRot).normalize(),d.x||d.y||d.z||(this.scaleRot=0),c.eye=d.mulVec3(c.eye),c._v=d.mulVec3(c._v),c._u=d.mulVec3(c._u),c._n=d.mulVec3(c._n),c.update()),.01<c.eye.distance(e)/c._terrainAltitude?(this.planet.layersActivity=!1,this.planet.terrainProvider.active=!1,this.planet.normalMapCreator.active=!1):(this.planet.layersActivity=!0,this.planet.terrainProvider.active=
!0,this.planet.normalMapCreator.active=!0))}};og.PlanetSegmentHelper={};og.PlanetSegmentHelper.CURRENT_POWER=0;
og.PlanetSegmentHelper.initIndexesTables=function(c){c>og.PlanetSegmentHelper.CURRENT_POWER&&(og.PlanetSegmentHelper.CURRENT_POWER=c,og.PlanetSegmentHelper.centerIndexesTable=og.PlanetSegmentHelper.initIndexBodiesTable(c),og.PlanetSegmentHelper.textureCoordsTable=og.PlanetSegmentHelper.initTextureCoordsTable(c),og.PlanetSegmentHelper.skirtsIndexesTable=og.PlanetSegmentHelper.initIndexesBodySkirts(c));og.PlanetSegmentHelper.centerIndexesTable[0]=[];og.PlanetSegmentHelper.textureCoordsTable[0]=[]};
og.PlanetSegmentHelper.createSegmentIndexes=function(c,d){if(1!=c){var e=og.PlanetSegmentHelper.centerIndexesTable[c],f=og.PlanetSegmentHelper.skirtsIndexesTable[og.quadTree.W][c][d[og.quadTree.W]],g=og.PlanetSegmentHelper.skirtsIndexesTable[og.quadTree.N][c][d[og.quadTree.N]],h=og.PlanetSegmentHelper.skirtsIndexesTable[og.quadTree.E][c][d[og.quadTree.E]],k=og.PlanetSegmentHelper.skirtsIndexesTable[og.quadTree.S][c][d[og.quadTree.S]],m=new Uint16Array(e.length+f.length+g.length+h.length+k.length),
l,n=0;for(l=0;l<e.length;l++)m[n++]=e[l];for(l=0;l<f.length;l++)m[n++]=f[l];for(l=0;l<g.length;l++)m[n++]=g[l];for(l=0;l<h.length;l++)m[n++]=h[l];for(l=0;l<k.length;l++)m[n++]=k[l];return m}return new Uint16Array([0,2,1,3])};og.PlanetSegmentHelper.createCenterBodyIndexes=function(c,d){for(var e,f,g,h=1;h<c-1-1;h++){for(var k=1;k<c-1;k++)e=h*c+k,g=(h+1)*c,f=g+k,d.push(e,f);d.push(f,g+1)}d.push(d[d.length-1],c*c-c)};
og.PlanetSegmentHelper.createWestNeighborSkirt=function(c,d,e){for(var f=(c-1)/d,g=c*c-c,h=0,k=0;k<c-2;k++)0===k%f&&(h=k),e.push(g-c*h,g-c*k-c+1);d===c-1&&(e.push(c),e.push(0))};og.PlanetSegmentHelper.createNorthNeighborSkirt=function(c,d,e){for(var f=(c-1)/d,g=0,h=0;h<c-2;h++)0===h%f&&(g=h),e.push(g,c+h+1);d===c-1&&(e.push(c-2),e.push(c-1))};
og.PlanetSegmentHelper.createEastNeighborSkirt=function(c,d,e){for(var f=(c-1)/d,g=0,h=0;h<c-2;h++)0===h%f&&(g=h),e.push(c+c*g-1,c*(h+1)+c-2);d===c-1&&(e.push(c*(c-1)-1),e.push(c*c-1))};og.PlanetSegmentHelper.createSouthNeighborSkirt=function(c,d,e){for(var f=(c-1)/d,g=0,h=c*(c-1)-2,k=c*c-1,m=0;m<c-2;m++)0===m%f&&(g=m),e.push(k-g,h-m);d===c-1&&e.push(c*c-c+1);e.push(c*c-c)};
og.PlanetSegmentHelper.initIndexesBodySkirts=function(c){var d=[];d[og.quadTree.N]=[];d[og.quadTree.W]=[];d[og.quadTree.S]=[];d[og.quadTree.E]=[];d[og.quadTree.N][0]=[];d[og.quadTree.W][0]=[];d[og.quadTree.S][0]=[];d[og.quadTree.E][0]=[];for(var e=0;e<=c;e++){var f=Math.pow(2,e);d[og.quadTree.N][f]=[];d[og.quadTree.W][f]=[];d[og.quadTree.S][f]=[];d[og.quadTree.E][f]=[];d[og.quadTree.N][f][0]=[];d[og.quadTree.W][f][0]=[];d[og.quadTree.S][f][0]=[];d[og.quadTree.E][f][0]=[];for(var g=0;g<=c;g++){var h=
Math.pow(2,g),k=d[og.quadTree.N][f][h]=[],m=d[og.quadTree.W][f][h]=[],l=d[og.quadTree.S][f][h]=[],n=d[og.quadTree.E][f][h]=[];og.PlanetSegmentHelper.createWestNeighborSkirt(f+1,h,m);og.PlanetSegmentHelper.createNorthNeighborSkirt(f+1,h,k);og.PlanetSegmentHelper.createEastNeighborSkirt(f+1,h,n);og.PlanetSegmentHelper.createSouthNeighborSkirt(f+1,h,l)}}return d};og.PlanetSegmentHelper.initTextureCoordsTable=function(c){for(var d=[],e=0;e<=c;e++){var f=Math.pow(2,e);d[f]=og.PlanetSegmentHelper.createTextureCoords(f)}return d};
og.PlanetSegmentHelper.initIndexBodiesTable=function(c){for(var d=[],e=0;e<=c;e++){var f=Math.pow(2,e),g=d[f]=[];og.PlanetSegmentHelper.createCenterBodyIndexes(f+1,g)}return d};og.PlanetSegmentHelper.createTextureCoords=function(c){for(var d=[],e=0;e<=c;e++)for(var f=0;f<=c;f++)d.push(f/c,e/c);return new Float32Array(d)};og.bv.Box=function(){this.vertices=[new og.math.Vector3,new og.math.Vector3,new og.math.Vector3,new og.math.Vector3,new og.math.Vector3,new og.math.Vector3,new og.math.Vector3,new og.math.Vector3]};
og.bv.Box.prototype.setFromBounds=function(c){var d=c[0],e=c[1],f=c[2],g=c[3],h=c[4];c=c[5];this.vertices[0].set(d,f,h);this.vertices[1].set(e,f,h);this.vertices[2].set(e,f,c);this.vertices[3].set(d,f,c);this.vertices[4].set(d,g,h);this.vertices[5].set(e,g,h);this.vertices[6].set(e,g,c);this.vertices[7].set(d,g,c)};og.bv.Box.prototype.setFromExtent=function(c,d){this.setFromBounds(d.getCartesianBounds(c))};og.planetSegment={};
og.planetSegment.Segment=function(c,d,e,f){this.node=c;this.planet=d;this.handler=d.renderer.handler;this.bbox=new og.bv.Box;this.bsphere=new og.bv.Sphere;this._extent=f;this.gridSize=d.terrainProvider.gridSizeByZoom[e];this.tileZoom=e;this.tileY=this.tileX=null;this._assignTileIndexes();this.materials=[];this.terrainExists=this.terrainIsLoading=this.terrainReady=this.parentNormalMapReady=this.normalMapReady=this.ready=!1;this.plainIndexes=[];this.plainVertices=[];this.plainNormals=null;this.terrainVertices=
[];this.tempVertices=[];this.normalMapTexture=null;this.normalMapTextureBias=[0,0,1];this.normalMapVertices=[];this.vertexTextureCoordBuffer=this.vertexPositionBuffer=this.vertexNormalBuffer=this.normalMapNormals=null;this._globalTextureCoordinates=[0,0,0,0];this._projection=og.proj.EPSG3857;this._inTheQueue=!1;this._appliedNeighborsZoom=[0,0,0,0]};og.planetSegment.Segment.prototype.acceptForRendering=function(c){var d=this.bsphere;return c.projectedSize(d.center)>this.planet.RATIO_LOD*d.radius};
og.planetSegment.Segment.prototype.getEntityTerrainPoint=function(c,d){return this.getTerrainPoint(d,c._cartesian,c._lonlatMerc)};og.planetSegment.Segment.prototype.isEntityInside=function(c){return this._extent.isInside(c._lonlatMerc)};
og.planetSegment.Segment.prototype.getTerrainPoint=function(c,d,e){var f=this._extent.northEast,g=this._extent.southWest,h=this.gridSize,k=g.lon,g=g.lat,k=Math.floor((e.lon-k)/((f.lon-k)/h)),m=Math.floor(h-(e.lat-g)/((f.lat-g)/h)),f=this.terrainReady?this.terrainVertices:this.tempVertices;e=new og.math.Ray(d,d.negateTo());if(f.length){g=3*((h+1)*m+k);h=3*((h+1)*(m+1)+k);m=new og.math.Vector3(f[g],f[g+1],f[g+2]);k=new og.math.Vector3(f[g+3],f[g+4],f[g+5]);g=new og.math.Vector3(f[h],f[h+1],f[h+2]);
m=e.hitTriangle(m,k,g,c);if(m==og.math.Ray.INSIDE)return d.distance(c);h=new og.math.Vector3(f[h+3],f[h+4],f[h+5]);m=e.hitTriangle(k,h,g,c);return m==og.math.Ray.INSIDE?d.distance(c):m==og.math.Ray.AWAY?-d.distance(c):d.distance(c)}c.copy(this.planet.ellipsoid.hitRay(e.origin,e.direction));return d.distance(c)};og.planetSegment.Segment.prototype.projectNative=function(c){return c.forwardMercator()};
og.planetSegment.Segment.prototype.loadTerrain=function(){this.tileZoom>=this.planet.terrainProvider.minZoom?this.terrainIsLoading||this.terrainReady||this.planet.terrainProvider.handleSegmentTerrain(this):(this.terrainReady=!0,this.planet.normalMapCreator.queue(this))};
og.planetSegment.Segment.prototype.elevationsExists=function(c){if(this.ready&&this.terrainIsLoading){var d=og.math.MAX,e=og.math.MIN,f=og.math.MAX,g=og.math.MIN,h=og.math.MAX,k=og.math.MIN,m=this.planet.terrainProvider.gridSizeByZoom[this.tileZoom],l=this.planet.terrainProvider.fileGridSize||Math.sqrt(c.length)-1,n=l+1,p=m+1,q=this.planet._heightFactor,r=[],t=[],u=0,B=this.planet.terrainProvider.fileGridSize/m,v=new Float32Array(n*n*3),E=this.normalMapVertices,F=this.normalMapNormals;if(l>=m)for(var H=
0;H<n;H++)for(var J=0;J<n;J++){var C=H*n+J,p=3*C,C=q*c[C],A=new og.math.Vector3(E[p]+C*F[p],E[p+1]+C*F[p+1],E[p+2]+C*F[p+2]);t[p]=A.x;t[p+1]=A.y;t[p+2]=A.z;0==H%B&&0==J%B&&(r[u++]=A.x,r[u++]=A.y,r[u++]=A.z,A.x<d&&(d=A.x),A.x>e&&(e=A.x),A.y<f&&(f=A.y),A.y>g&&(g=A.y),A.z<h&&(h=A.z),A.z>k&&(k=A.z));if(H!=l&&J!=l){var D=H*n+J+1,C=3*D,D=q*c[D],I=new og.math.Vector3(E[C]+D*F[C],E[C+1]+D*F[C+1],E[C+2]+D*F[C+2]);t[C]=I.x;t[C+1]=I.y;t[C+2]=I.z;var G=(H+1)*n+J,D=3*G,G=q*c[G],L=new og.math.Vector3(E[D]+G*F[D],
E[D+1]+G*F[D+1],E[D+2]+G*F[D+2]);t[D]=L.x;t[D+1]=L.y;t[D+2]=L.z;var K=(H+1)*n+(J+1),G=3*K,K=q*c[K],K=new og.math.Vector3(E[G]+K*F[G],E[G+1]+K*F[G+1],E[G+2]+K*F[G+2]);t[G]=K.x;t[G+1]=K.y;t[G+2]=K.z;I=og.math.Vector3.sub(I,A);L=og.math.Vector3.sub(L,A);K=og.math.Vector3.sub(K,A);A=L.cross(K);I=K.cross(I);L=og.math.Vector3.add(I,A);v[p]+=L.x;v[p+1]+=L.y;v[p+2]+=L.z;v[C]+=I.x;v[C+1]+=I.y;v[C+2]+=I.z;v[D]+=A.x;v[D+1]+=A.y;v[D+2]+=A.z;v[G]+=L.x;v[G+1]+=L.y;v[G+2]+=L.z}}else{B=this.plainVertices;v=this.plainNormals;
l=m/l;for(H=0;H<p;H++)for(H==p-1?(E=l,F=Math.floor(H/l)-1):(E=H%l,F=Math.floor(H/l)),J=0;J<p;J++)J==p-1?(C=l,I=Math.floor(J/l)-1):(C=J%l,I=Math.floor(J/l)),D=c[F*n+I],A=c[F*n+I+1],G=c[(F+1)*n+I],I=c[(F+1)*n+I+1],A=E+C<l?q*(D+og.math.slice(C/l,A,D)+og.math.slice(E/l,G,D)):q*(I+og.math.slice((l-C)/l,G,I)+og.math.slice((l-E)/l,A,I)),C=B[u]+A*v[u],D=B[u+1]+A*v[u+1],A=B[u+2]+A*v[u+2],r[u]=C,r[u+1]=D,r[u+2]=A,u+=3,C<d&&(d=C),C>e&&(e=C),D<f&&(f=D),D>g&&(g=D),A<h&&(h=A),A>k&&(k=A);v=this.plainNormals}this.terrainExists=
!0;this.normalMapNormals=v;this.normalMapVertices=t;this.terrainVertices.length=0;this.terrainVertices=r;this.terrainReady=!0;this.terrainIsLoading=!1;this.planet.lightEnabled&&this.planet.normalMapCreator.queue(this);this.createCoordsBuffers(r,m);this.bsphere.setFromBounds([d,e,f,g,h,k]);this.gridSize=m;this.node.appliedTerrainNodeId=this.node.nodeId}c.length=0};
og.planetSegment.Segment.prototype.elevationsNotExists=function(){if(this.tileZoom<=this.planet.terrainProvider.maxZoom){this.ready&&this.terrainIsLoading&&(this.terrainIsLoading=!1,this.terrainReady=!0,this.terrainExists=!1,this.node.appliedTerrainNodeId=this.node.nodeId,this.gridSize=this.planet.terrainProvider.gridSizeByZoom[this.tileZoom],this.planet.lightEnabled&&this.planet.normalMapCreator.queue(this),this.createCoordsBuffers(this.terrainVertices,this.gridSize));for(var c=og.math.MAX,d=og.math.MIN,
e=og.math.MAX,f=og.math.MIN,g=og.math.MAX,h=og.math.MIN,k=this.terrainVertices,m=0;m<k.length;m+=3){var l=k[m],n=k[m+1],p=k[m+2];l<c&&(c=l);l>d&&(d=l);n<e&&(e=n);n>f&&(f=n);p<g&&(g=p);p>h&&(h=p)}this.bsphere.setFromBounds([c,d,e,f,g,h])}};
og.planetSegment.Segment.prototype._normalMapEdgeEqualize=function(c,d,e){var f=this.node.neighbors[c],g=f&&f.planetSegment;if(f&&g&&(this._appliedNeighborsZoom[c]=g.tileZoom,g.terrainReady&&g.terrainExists))if(!g._inTheQueue&&this.tileZoom>g._appliedNeighborsZoom[og.quadTree.OPSIDE[c]])this.planet.normalMapCreator.queue(g);else{var h=this.planet.terrainProvider.fileGridSize,k=h+1,m=h-d,l=this.normalMapNormals,n=g.normalMapNormals;if(l&&n)if(this.tileZoom===g.tileZoom)if(e){if(!(this._extent.getEast()===
og.mercator.POLE&&g._extent.getWest()===-og.mercator.POLE||this._extent.getWest()===-og.mercator.POLE&&g._extent.getEast()===og.mercator.POLE))for(e=0;e<=h;e++)g=3*(e*k+d),f=3*(e*k+m),n[f]=l[g]+=n[f],n[f+1]=l[g+1]+=n[f+1],n[f+2]=l[g+2]+=n[f+2]}else for(e=0;e<=h;e++)g=3*(d*k+e),f=3*(m*k+e),n[f]=l[g]+=n[f],n[f+1]=l[g+1]+=n[f+1],n[f+2]=l[g+2]+=n[f+2];else if(1===this.tileZoom-g.tileZoom)if(c=og.quadTree.NOPSORD[c][this.node.partId]*h*.5,e){if(!(this._extent.getEast()===og.mercator.POLE&&g._extent.getWest()===
-og.mercator.POLE||this._extent.getWest()===-og.mercator.POLE&&g._extent.getEast()===og.mercator.POLE))for(e=0;e<=h;e++)g=3*(e*k+d),f=3*((Math.floor(.5*e)+c)*k+m),n[f]=l[g]+=n[f],n[f+1]=l[g+1]+=n[f+1],n[f+2]=l[g+2]+=n[f+2]}else for(e=0;e<=h;e++)g=3*(d*k+e),f=3*(m*k+Math.floor(.5*e)+c),n[f]=l[g]+=n[f],n[f+1]=l[g+1]+=n[f+1],n[f+2]=l[g+2]+=n[f+2];else this.tileZoom<g.tileZoom&&(g._inTheQueue||this.planet.normalMapCreator.queue(g),(d=f.parentNode.nodes[og.quadTree.NOPS[c][this.node.partId]])&&!d.planetSegment._inTheQueue&&
this.planet.normalMapCreator.queue(d.planetSegment))}};
og.planetSegment.Segment.prototype.createNormalMapTexture=function(){if(this.planet&&!(this.tileZoom>this.planet.terrainProvider.maxZoom)&&this.normalMapNormals){var c=this.node.neighbors;if(c){var d=c[og.quadTree.N],e=c[og.quadTree.E],f=c[og.quadTree.S],c=c[og.quadTree.W];this.tileZoom>this.planet.terrainProvider.minZoom&&(d&&d.planetSegment&&d.planetSegment.terrainIsLoading||e&&e.planetSegment&&e.planetSegment.terrainIsLoading||f&&f.planetSegment&&f.planetSegment.terrainIsLoading||c&&c.planetSegment&&
c.planetSegment.terrainIsLoading)?this._inTheQueue||this.planet.normalMapCreator.shift(this):(d=this.planet.terrainProvider.fileGridSize,this._normalMapEdgeEqualize(og.quadTree.N,0),this._normalMapEdgeEqualize(og.quadTree.S,d),this._normalMapEdgeEqualize(og.quadTree.W,0,!0),this._normalMapEdgeEqualize(og.quadTree.E,d,!0),this.normalMapTexture=this.handler.createTexture_mm(this.planet.normalMapCreator.draw(this.normalMapNormals)),this.normalMapReady=!0,this.normalMapTextureBias=[0,0,1])}}};
og.planetSegment.Segment.prototype.applyTerrain=function(c){this.ready&&(c.length?this.elevationsExists(c):this.elevationsNotExists())};og.planetSegment.Segment.prototype.deleteBuffers=function(){var c=this.handler.gl;c.deleteBuffer(this.vertexNormalBuffer);c.deleteBuffer(this.vertexPositionBuffer);c.deleteBuffer(this.vertexTextureCoordBuffer);this.vertexTextureCoordBuffer=this.vertexPositionBuffer=this.vertexNormalBuffer=null};
og.planetSegment.Segment.prototype.deleteMaterials=function(){for(var c=this.materials,d=0;d<c.length;d++){var e=c[d];e&&e.clear()}c.length=0};
og.planetSegment.Segment.prototype.deleteElevations=function(){this.terrainIsLoading=this.terrainReady=this.terrainExists=!1;this.normalMapVertices.length=0;this.normalMapNormals=null;this.tempVertices.length=0;this.terrainVertices.length=0;this.plainVertices.length=0;this.plainNormals=null;this.normalMapReady&&this.handler.gl.deleteTexture(this.normalMapTexture);this.parentNormalMapReady=this.normalMapReady=!1;this._appliedNeighborsZoom=[0,0,0,0];this.normalMapTextureBias=[0,0,1];this._inTheQueue=
!1};og.planetSegment.Segment.prototype.clearSegment=function(){this.ready=!1;this.deleteBuffers();this.deleteMaterials();this.deleteElevations()};
og.planetSegment.Segment.prototype.destroySegment=function(){this.clearSegment();this._appliedNeighborsZoom=this._projection=this._visibleExtentOffsetArr=this._tileOffsetArr=this.vertexTextureCoordBuffer=this.vertexPositionBuffer=this.vertexNormalBuffer=this.normalMapNormals=this.normalMapVertices=this.normalMapTextureBias=this.normalMapTexture=this.tempVertices=this.terrainVertices=this.plainNormals=this.plainVertices=this.plainIndexes=this.materials=this._extent=this.bsphere=this.bbox=this.handler=
this.planet=this.node=null};
og.planetSegment.Segment.prototype.createBoundsByExtent=function(){for(var c=this.planet.ellipsoid,d=this._extent,e=og.math.MAX,f=og.math.MIN,g=og.math.MAX,h=og.math.MIN,k=og.math.MAX,m=og.math.MIN,d=[og.LonLat.inverseMercator(d.southWest.lon,d.southWest.lat),og.LonLat.inverseMercator(d.southWest.lon,d.northEast.lat),og.LonLat.inverseMercator(d.northEast.lon,d.northEast.lat),og.LonLat.inverseMercator(d.northEast.lon,d.southWest.lat)],l=0;l<d.length;l++){var n=c.lonLatToCartesian(d[l]),p=n.x,q=n.y,
n=n.z;p<e&&(e=p);p>f&&(f=p);q<g&&(g=q);q>h&&(h=q);n<k&&(k=n);n>m&&(m=n)}this.bsphere.setFromBounds([e,f,g,h,k,m])};og.planetSegment.Segment.prototype.createCoordsBuffers=function(c,d){var e=(d+1)*(d+1),f=this.handler;f.gl.deleteBuffer(this.vertexPositionBuffer);f.gl.deleteBuffer(this.vertexTextureCoordBuffer);this.vertexTextureCoordBuffer=f.createArrayBuffer(og.PlanetSegmentHelper.textureCoordsTable[d],2,e);var g=new Float32Array(c);this.vertexPositionBuffer=f.createArrayBuffer(g,3,e)};
og.planetSegment.Segment.prototype._addViewExtent=function(){var c=this._extent;if(this.planet._viewExtentMerc){var d=this.planet._viewExtentMerc;c.southWest.lon<d.southWest.lon&&(d.southWest.lon=c.southWest.lon);c.northEast.lon>d.northEast.lon&&(d.northEast.lon=c.northEast.lon);c.southWest.lat<d.southWest.lat&&(d.southWest.lat=c.southWest.lat);c.northEast.lat>d.northEast.lat&&(d.northEast.lat=c.northEast.lat)}else this.planet._viewExtentMerc=new og.Extent(new og.LonLat(c.southWest.lon,c.southWest.lat),
new og.LonLat(c.northEast.lon,c.northEast.lat))};og.planetSegment.Segment.prototype._assignTileIndexes=function(){var c=this._extent,d=og.mercator.POLE;this.tileX=Math.round(Math.abs(-d-c.southWest.lon)/(c.northEast.lon-c.southWest.lon));this.tileY=Math.round(Math.abs(d-c.northEast.lat)/(c.northEast.lat-c.southWest.lat))};
og.planetSegment.Segment.prototype.createPlainSegment=function(){var c=this.planet.terrainProvider.gridSizeByZoom[this.tileZoom],d=this.node;d.sideSize[0]=c;d.sideSize[1]=c;d.sideSize[2]=c;this.gridSize=d.sideSize[3]=c;this.createPlainVertices(c);this.createCoordsBuffers(this.plainVertices,c);this.ready=!0};
og.planetSegment.Segment.prototype.createPlainVertices=function(c){var d=this._extent,e=this.planet.terrainProvider.fileGridSize,f=d.getWidth()/Math.max(e,c),g=d.southWest.lon,h=d.northEast.lat,k=Math.max(e/c,1);c=Math.max(e,c)+1;var e=this.planet.ellipsoid._invRadii2,m=0,l=0,n=c*c*3;this.plainNormals=new Float32Array(n);this.normalMapNormals=new Float32Array(n);for(var n=this.plainVertices,p=this.plainNormals,q=this.normalMapVertices,r=this.normalMapNormals,t=0;t<c;t++)for(var u=0;u<c;u++){var B=
this.planet.ellipsoid.lonLatToCartesian(og.LonLat.inverseMercator(g+u*f,h-t*f)),v=B.x*e.x,E=B.y*e.y,F=B.z*e.z,H=1/Math.sqrt(v*v+E*E+F*F),v=v*H,E=E*H,F=F*H;q[l]=B.x;r[l++]=v;q[l]=B.y;r[l++]=E;q[l]=B.z;r[l++]=F;0==t%k&&0==u%k&&(n[m]=B.x,p[m++]=v,n[m]=B.y,p[m++]=E,n[m]=B.z,p[m++]=F)}this.normalMapTexture=this.planet.transparentTexture;this.tempVertices=this.terrainVertices=n;this._globalTextureCoordinates[0]=(d.southWest.lon+og.mercator.POLE)*og.mercator.ONE_BY_POLE_DOUBLE;this._globalTextureCoordinates[1]=
(og.mercator.POLE-d.northEast.lat)*og.mercator.ONE_BY_POLE_DOUBLE;this._globalTextureCoordinates[2]=(d.northEast.lon+og.mercator.POLE)*og.mercator.ONE_BY_POLE_DOUBLE;this._globalTextureCoordinates[3]=(og.mercator.POLE-d.southWest.lat)*og.mercator.ONE_BY_POLE_DOUBLE};og.planetSegment.Segment.prototype.getMaterialByLayer=function(c){for(var d=this.materials,e=0;e<d.length;e++)if(d[e].layer==c)return d[e]};
og.planetSegment.Segment.prototype.getMaterialByLayerName=function(c){for(var d=this.materials,e=0;e<d.length;e++)if(d[e].layer.name==c)return d[e]};og.planetSegment.Segment.prototype._getLayerExtentOffset=function(c){c=c._extentMerc;var d=this._extent,e=c.northEast.lon-c.southWest.lon,f=c.northEast.lat-c.southWest.lat;return[(d.southWest.lon-c.southWest.lon)/e,(c.northEast.lat-d.northEast.lat)/f,(d.northEast.lon-d.southWest.lon)/e,(d.northEast.lat-d.southWest.lat)/f]};
og.planetSegment.Segment.prototype._renderBase=function(c,d){if(this.ready){var e=this.handler.gl,f=c.attributes,g=c.uniforms,h=this.materials,k=this.planet;e.activeTexture(e.TEXTURE0+k.SLICE_SIZE+1);e.bindTexture(e.TEXTURE_2D,this._getDefaultTexture());e.uniform1i(g.defaultTexture._pName,k.SLICE_SIZE+1);for(var m=d[0],l=m._height,n=0,p=0;m;){if(this.layerOverlap(m)&&m.minZoom<=k.minCurrZoom&&m.maxZoom>=k.maxCurrZoom){var q=h[m._id];q||(q=h[m._id]=new og.planetSegment.Material(this,m));var r=4*n,
t=3*n,u=m.applyMaterial(q);k._tileOffsetArr[r]=u[0];k._tileOffsetArr[r+1]=u[1];k._tileOffsetArr[r+2]=u[2];k._tileOffsetArr[r+3]=u[3];u=this._getLayerExtentOffset(m);k._visibleExtentOffsetArr[r]=u[0];k._visibleExtentOffsetArr[r+1]=u[1];k._visibleExtentOffsetArr[r+2]=u[2];k._visibleExtentOffsetArr[r+3]=u[3];k._transparentColorArr[r]=m.transparentColor[0];k._transparentColorArr[r+1]=m.transparentColor[1];k._transparentColorArr[r+2]=m.transparentColor[2];k._transparentColorArr[r+3]=m.opacity;k._pickingColorArr[t]=
m._pickingColor.x/255;k._pickingColorArr[t+1]=m._pickingColor.y/255;k._pickingColorArr[t+2]=m._pickingColor.z/255;k._diffuseMaterialArr[t+3]=m.diffuse.x;k._diffuseMaterialArr[t+1+3]=m.diffuse.y;k._diffuseMaterialArr[t+2+3]=m.diffuse.z;k._ambientMaterialArr[t+3]=m.ambient.x;k._ambientMaterialArr[t+1+3]=m.ambient.y;k._ambientMaterialArr[t+2+3]=m.ambient.z;k._specularMaterialArr[r+4]=m.specular.x;k._specularMaterialArr[r+1+4]=m.specular.y;k._specularMaterialArr[r+2+4]=m.specular.z;k._specularMaterialArr[r+
3+4]=m.shininess;k._samplerArr[n]=n;e.activeTexture(e.TEXTURE0+n);e.bindTexture(e.TEXTURE_2D,q.texture||this.planet.transparentTexture);n++}p++;m=d[p]}k.lightEnabled&&(e.uniform3fv(g.uNormalMapBias._pName,this.normalMapTextureBias),e.activeTexture(e.TEXTURE0+k.SLICE_SIZE+2),e.bindTexture(e.TEXTURE_2D,this.normalMapTexture||this.planet.transparentTexture),e.uniform1i(g.uNormalMap._pName,k.SLICE_SIZE+2),e.uniform4fv(g.uGlobalTextureCoord._pName,this._globalTextureCoordinates),e.uniform3fv(g.diffuseMaterial._pName,
k._diffuseMaterialArr),e.uniform3fv(g.ambientMaterial._pName,k._ambientMaterialArr),e.uniform4fv(g.specularMaterial._pName,k._specularMaterialArr));e.uniform1i(g.samplerCount._pName,n);e.uniform1f(g.height._pName,l);e.uniform1iv(g.samplerArr._pName,k._samplerArr);e.uniform4fv(g.tileOffsetArr._pName,k._tileOffsetArr);e.uniform4fv(g.visibleExtentOffsetArr._pName,k._visibleExtentOffsetArr);e.uniform4fv(g.transparentColorArr._pName,k._transparentColorArr);e.uniform3fv(g.pickingColorArr._pName,k._pickingColorArr);
e.bindBuffer(e.ARRAY_BUFFER,this.vertexPositionBuffer);e.vertexAttribPointer(f.aVertexPosition._pName,this.vertexPositionBuffer.itemSize,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,this.vertexTextureCoordBuffer);e.vertexAttribPointer(f.aTextureCoord._pName,this.vertexTextureCoordBuffer.itemSize,e.FLOAT,!1,0,0);c.drawIndexBuffer(k.drawMode,this._getIndexBuffer())}this.node.hasNeighbor[0]=!1;this.node.hasNeighbor[1]=!1;this.node.hasNeighbor[2]=!1;this.node.hasNeighbor[3]=!1};
og.planetSegment.Segment.prototype._renderOverlay=function(c,d){if(this.ready){var e=this.handler.gl,f=c.attributes,g=c.uniforms,h=this.materials,k=this.planet;e.activeTexture(e.TEXTURE0+k.SLICE_SIZE+1);e.bindTexture(e.TEXTURE_2D,k.transparentTexture);e.uniform1i(g.defaultTexture._pName,k.SLICE_SIZE+1);for(var m=d[0],l=m._height,n=0,p=0,q=!1;m;){if(this.layerOverlap(m)&&m.minZoom<=k.minCurrZoom&&m.maxZoom>=k.maxCurrZoom){var q=!0,r=h[m._id];r||(r=h[m._id]=new og.planetSegment.Material(this,m));var t=
4*n,u=3*n,B=m.applyMaterial(r);k._tileOffsetArr[t]=B[0];k._tileOffsetArr[t+1]=B[1];k._tileOffsetArr[t+2]=B[2];k._tileOffsetArr[t+3]=B[3];B=this._getLayerExtentOffset(m);k._visibleExtentOffsetArr[t]=B[0];k._visibleExtentOffsetArr[t+1]=B[1];k._visibleExtentOffsetArr[t+2]=B[2];k._visibleExtentOffsetArr[t+3]=B[3];k._transparentColorArr[t]=m.transparentColor[0];k._transparentColorArr[t+1]=m.transparentColor[1];k._transparentColorArr[t+2]=m.transparentColor[2];k._transparentColorArr[t+3]=m.opacity;k._pickingColorArr[u]=
m._pickingColor.x/255;k._pickingColorArr[u+1]=m._pickingColor.y/255;k._pickingColorArr[u+2]=m._pickingColor.z/255;k._diffuseMaterialArr[u+3]=m.diffuse.x;k._diffuseMaterialArr[u+1+3]=m.diffuse.y;k._diffuseMaterialArr[u+2+3]=m.diffuse.z;k._ambientMaterialArr[u+3]=m.ambient.x;k._ambientMaterialArr[u+1+3]=m.ambient.y;k._ambientMaterialArr[u+2+3]=m.ambient.z;k._specularMaterialArr[t+4]=m.specular.x;k._specularMaterialArr[t+1+4]=m.specular.y;k._specularMaterialArr[t+2+4]=m.specular.z;k._specularMaterialArr[t+
3+4]=m.shininess;k._samplerArr[n]=n;e.activeTexture(e.TEXTURE0+n);e.bindTexture(e.TEXTURE_2D,r.texture||this.planet.transparentTexture);n++}p++;m=d[p]}q&&(k.lightEnabled&&(e.uniform3fv(g.uNormalMapBias._pName,this.normalMapTextureBias),e.activeTexture(e.TEXTURE0+k.SLICE_SIZE+2),e.bindTexture(e.TEXTURE_2D,this.normalMapTexture||this.planet.transparentTexture),e.uniform1i(g.uNormalMap._pName,k.SLICE_SIZE+2),e.uniform4fv(g.uGlobalTextureCoord._pName,this._globalTextureCoordinates),e.uniform3fv(g.diffuseMaterial._pName,
k._diffuseMaterialArr),e.uniform3fv(g.ambientMaterial._pName,k._ambientMaterialArr),e.uniform4fv(g.specularMaterial._pName,k._specularMaterialArr)),e.uniform1i(g.samplerCount._pName,n),e.uniform1f(g.height._pName,l),e.uniform1iv(g.samplerArr._pName,k._samplerArr),e.uniform4fv(g.tileOffsetArr._pName,k._tileOffsetArr),e.uniform4fv(g.visibleExtentOffsetArr._pName,k._visibleExtentOffsetArr),e.uniform4fv(g.transparentColorArr._pName,k._transparentColorArr),e.uniform3fv(g.pickingColorArr._pName,k._pickingColorArr),
e.bindBuffer(e.ARRAY_BUFFER,this.vertexPositionBuffer),e.vertexAttribPointer(f.aVertexPosition._pName,this.vertexPositionBuffer.itemSize,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.vertexTextureCoordBuffer),e.vertexAttribPointer(f.aTextureCoord._pName,this.vertexTextureCoordBuffer.itemSize,e.FLOAT,!1,0,0),c.drawIndexBuffer(k.drawMode,this._getIndexBuffer()))}};og.planetSegment.Segment.prototype._getIndexBuffer=function(){var c=this.node.sideSize;return this.planet._indexesBuffers[this.gridSize][c[0]][c[1]][c[2]][c[3]]};
og.planetSegment.Segment.prototype._collectRenderNodes=function(){this.planet._visibleNodes[this.node.nodeId]=this.node};og.planetSegment.Segment.prototype.layerOverlap=function(c){return this._extent.overlaps(c._extentMerc)};og.planetSegment.Segment.prototype._getDefaultTexture=function(){return this.planet.solidTextureOne};og.planetSegment.Segment.prototype.getExtentLonLat=function(){return this._extent.inverseMercator()};og.planetSegment.Segment.prototype.getExtentMerc=function(){return this._extent};og.control.EarthCoordinates=function(c){og.inheritance.base(this,c);this._displayType=c.type||0;this._converter=og.control.EarthCoordinates.DisplayTypesConverters[0];this._display=null;this._center=c.center||!1;this.position=null};og.control.earthCoordinates=function(c){return new og.control.EarthCoordinates(c)};og.inheritance.extend(og.control.EarthCoordinates,og.control.BaseControl);og.control.EarthCoordinates.toDecimal=function(c){return c.lat.toFixed(5)+", "+c.lon.toFixed(5)};
og.control.EarthCoordinates.toDegrees=function(c){return og.control.EarthCoordinates.dec2deg(c.lat)+", "+og.control.EarthCoordinates.dec2deg(c.lon)};og.control.EarthCoordinates.toMercator=function(c){c=c.forwardMercator();return c.lat.toFixed(5)+", "+c.lon.toFixed(5)};og.control.EarthCoordinates.DisplayTypesConverters=[og.control.EarthCoordinates.toDecimal,og.control.EarthCoordinates.toDegrees,og.control.EarthCoordinates.toMercator];
og.control.EarthCoordinates.dec2deg=function(c){var d,e=0>c?Math.ceil(c):Math.floor(c);c=Math.floor(d=60*Math.abs(c-e));d=Math.floor(6E3*(d-c));d/=100;return og.control.EarthCoordinates.numToFixedString(e,3)+"\u00b0"+og.control.EarthCoordinates.numToFixedString(c,2)+"'"+og.control.EarthCoordinates.numToFixedString(d.toFixed(2),2)+'"'};og.control.EarthCoordinates.numToFixedString=function(c,d){for(var e="&nbsp;",f=c.toString().split(".")[0].length;f<d;f++)e+="&nbsp;&nbsp;";return e+c.toString()};
og.control.EarthCoordinates.prototype.oninit=function(){this._display=document.createElement("div");this._display.className="ogEarthCoordinatesControl";var c=this;this._display.onclick=function(d){c._displayType+=1;c._displayType>=og.control.EarthCoordinates.DisplayTypesConverters.length&&(c._displayType=0);c._converter=og.control.EarthCoordinates.DisplayTypesConverters[c._displayType];c.showPosition()};this.renderer.div.appendChild(this._display);centerDiv=document.createElement("div");centerDiv.className=
"ogCenterIcon";centerDiv.innerHTML='<svg width="12" height="12"><g><path stroke-width="1" stroke-opacity="1" d="M6 0L6 12M0 6L12 6" stroke="#009DFF"></path></g></svg>';this.renderer.div.appendChild(centerDiv);this._center?(this.renderer.events.on("draw",this,this._draw),centerDiv.style.display="block"):(this.renderer.events.on("mousemove",this,this._onMouseMove),centerDiv.style.display="none")};
og.control.EarthCoordinates.prototype.setCenter=function(c){c!=this._center&&((this._center=c)?(this.renderer.events.off("mousemove",this._onMouseMove),this.renderer.events.on("draw",this,this._draw),centerDiv.style.display="block"):(this.renderer.events.off("draw",this._draw),this.renderer.events.on("mousemove",this,this._onMouseMove),centerDiv.style.display="none"))};
og.control.EarthCoordinates.prototype._showPosition=function(){this._display.innerHTML=this.position?"Lat/Lon: "+this._converter(this.position)+" Height(km): "+(0<this.position.height?"~"+(Math.round(this.position.height)/1E3).toFixed(2):"-"):"Lat/Lon: _____________________"};
og.control.EarthCoordinates.prototype._draw=function(){var c=this.renderer,d=c.events.touchState;if(0>=c.controlsBag.scaleRot&&!c.activeCamera._flying||d.moving&&1===d.sys.touches.length)this.position=c.renderNodes.Earth.getLonLatFromPixelTerrain(c.handler.getCenter()),this._showPosition()};
og.control.EarthCoordinates.prototype._onMouseMove=function(){var c=this.renderer,d=c.events.mouseState;!d.leftButtonDown&&!d.rightButtonDown&&0>=c.controlsBag.scaleRot&&!c.activeCamera._flying&&(this.position=c.renderNodes.Earth.getLonLatFromPixelTerrain(d,!0),this._showPosition())};og.layer.CanvasTiles=function(c,d){d=d||{};og.inheritance.base(this,c,d);this.drawTile=null};og.inheritance.extend(og.layer.CanvasTiles,og.layer.Layer);og.layer.CanvasTiles.prototype.loadMaterial=function(c){var d=c.segment;d.tileZoom>=this.minZoom&&d.tileZoom<=this.maxZoom&&(this.drawTile?this.drawTile(c,function(d){c.isReady=!1;c.applyTexture(d)}):c.textureNotExists())};og.proj.EPSG4326=new og.proj.Projection({code:"epsg:4326",units:og.Units.DEGREES});og.utils.GeoImageCreator=function(c,d){this._gridSize=64;this._handler=c;this._indexBuffer=this._texCoordsBuffer=this._framebuffer=null;this.MAX_FRAMES=d||5;this._currentFrame=0;this._queue=[];this._animate=[];this._initialize()};og.utils.GeoImageCreator.prototype._initialize=function(){this._initShaders();this._initBuffers()};
og.utils.GeoImageCreator.prototype.createGridBuffer=function(c,d){for(var e=this._gridSize,f=new og.LonLat((c[3].lon-c[0].lon)/e,(c[3].lat-c[0].lat)/e),g=new og.LonLat((c[2].lon-c[1].lon)/e,(c[2].lat-c[1].lat)/e),h=new og.LonLat((c[1].lon-c[0].lon)/e,(c[1].lat-c[0].lat)/e),k=new og.LonLat((c[2].lon-c[3].lon)/e,(c[2].lat-c[3].lat)/e),m=new Float32Array((e+1)*(e+1)*2),l=0,n=0;n<=e;n++)for(var p=og.lonLat(c[0].lon+n*f.lon,c[0].lat+n*f.lat),q=og.lonLat(c[1].lon+n*g.lon,c[1].lat+n*g.lat),r=0;r<=e;r++){var t=
og.lonLat(c[0].lon+r*h.lon,c[0].lat+r*h.lat),u=og.lonLat(c[3].lon+r*k.lon,c[3].lat+r*k.lat),t=og.utils.getLinesIntersectionLonLat(p,q,t,u);m[l++]=t.lon;m[l++]=t.lat}if(d)for(n=0;n<m.length;n+=2)c=og.lonLat(m[n],m[n+1]).forwardMercator(),m[n]=c.lon,m[n+1]=c.lat;return this._handler.createArrayBuffer(m,2,m.length/2)};og.utils.GeoImageCreator.prototype.frame=function(){for(var c=this.MAX_FRAMES;c--&&this._queue.length;){var d=this._queue.shift();d._isRendering=!1;d.rendering()}for(c=this._animate.length;c--;)this._animate[c].rendering()};
og.utils.GeoImageCreator.prototype.add=function(c){c._isRendering||(c._isRendering=!0,c._animate?this._animate.push(c):this._queue.push(c))};og.utils.GeoImageCreator.prototype.remove=function(c){if(c._isRendering){c._creationProceeding=!1;c._isRendering=!1;var d;d=c._animate?this._animate:this._queue;for(var e=0;e<d.length;e++)if(d[e].isEqual(c)){d.splice(e,1);break}}};
og.utils.GeoImageCreator.prototype._initBuffers=function(){og.PlanetSegmentHelper.initIndexesTables(3);this._framebuffer=new og.webgl.Framebuffer(this._handler,{width:2,height:2,useDepth:!1});this._framebufferMercProj=new og.webgl.Framebuffer(this._handler,{width:2,height:2,useDepth:!1});var c=this._gridSize,d=this._gridSize+1;this._texCoordsBuffer=this._handler.createArrayBuffer(og.PlanetSegmentHelper.textureCoordsTable[c],2,d*d);c=og.PlanetSegmentHelper.createSegmentIndexes(c,[c,c,c,c]);this._indexBuffer=
this._handler.createElementArrayBuffer(c,1,c.length);this._quadTexCoordsBuffer=this._handler.createArrayBuffer(new Float32Array([0,1,1,1,0,0,1,0]),2,4);this._quadVertexBuffer=this._handler.createArrayBuffer(new Float32Array([-1,1,1,1,-1,-1,1,-1]),2,4)};
og.utils.GeoImageCreator.prototype._initShaders=function(){this._handler.addShaderProgram(new og.shaderProgram.ShaderProgram("geoImageTransform",{uniforms:{sourceTexture:{type:og.shaderProgram.types.SAMPLER2D},extentParams:{type:og.shaderProgram.types.VEC4}},attributes:{corners:{type:og.shaderProgram.types.VEC2,enableArray:!0},texCoords:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:"attribute vec2 corners; \r\n                      attribute vec2 texCoords; \r\n                      varying vec2 v_texCoords; \r\n                      uniform vec4 extentParams; \r\n                      void main() { \r\n                          v_texCoords = texCoords; \r\n                          gl_Position = vec4((-1.0 + (corners - extentParams.xy) * extentParams.zw) * vec2(1.0, -1.0), 0.0, 1.0); \r\n                      }",
fragmentShader:"#ifdef GL_ES\n\r\n                        #ifdef GL_FRAGMENT_PRECISION_HIGH\n\r\n                        precision highp float;\n\r\n                        #else\n\r\n                        precision mediump float;\n\r\n                        #endif // GL_FRAGMENT_PRECISION_HIGH\n\r\n                        #endif // GL_ES\n\r\n                        uniform sampler2D sourceTexture; \r\n                        varying vec2 v_texCoords; \r\n                        void main () {  \r\n                            gl_FragColor = texture2D(sourceTexture, v_texCoords); \r\n                        }"}))};og.shaderProgram.drawnode_nl=function(){return new og.shaderProgram.ShaderProgram("drawnode_nl",{uniforms:{projectionViewMatrix:{type:og.shaderProgram.types.MAT4},samplerCount:{type:og.shaderProgram.types.INT},tileOffsetArr:{type:og.shaderProgram.types.VEC4},visibleExtentOffsetArr:{type:og.shaderProgram.types.VEC4},samplerArr:{type:og.shaderProgram.types.SAMPLER2DXX},transparentColorArr:{type:og.shaderProgram.types.VEC4},pickingColorArr:{type:og.shaderProgram.types.VEC3},defaultTexture:{type:og.shaderProgram.types.SAMPLER2D},
height:{type:og.shaderProgram.types.FLOAT},cameraPosition:{type:og.shaderProgram.types.VEC3}},attributes:{aVertexPosition:{type:og.shaderProgram.types.VEC3,enableArray:!0},aTextureCoord:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:"#ifdef GL_ES\n\r\n            #ifdef GL_FRAGMENT_PRECISION_HIGH\n\r\n            precision highp float;\n\r\n            #else\n\r\n            precision mediump float;\n\r\n            #endif // GL_FRAGMENT_PRECISION_HIGH\n\r\n            #endif // GL_ES\n\r\n            attribute vec3 aVertexPosition;\r\n            attribute vec2 aTextureCoord;\r\n            uniform mat4 projectionViewMatrix;\r\n            uniform float height;\r\n            uniform vec3 cameraPosition;\r\n            varying vec2 vTextureCoord;\r\n            varying float range;\r\n            const float C = 0.1;\r\n            const float far = 149.6e+9;\r\n            float logc = 2.0 / log( C * far + 1.0 );\r\n            void main(void) {\r\n                range = distance(cameraPosition, aVertexPosition + normalize(aVertexPosition) * height);\r\n                vTextureCoord = aTextureCoord;\r\n                gl_Position = projectionViewMatrix * vec4(aVertexPosition + normalize(aVertexPosition) * height, 1.0);\r\n                gl_Position.z = ( log( C * gl_Position.w + 1.0 ) * logc - 1.0 ) * gl_Position.w;\r\n            }",
fragmentShader:"#extension GL_EXT_draw_buffers : require\n\r\n            #ifdef GL_ES\n\r\n            #ifdef GL_FRAGMENT_PRECISION_HIGH\n\r\n            precision highp float;\n\r\n            #else\n\r\n            precision mediump float;\n\r\n            #endif // GL_FRAGMENT_PRECISION_HIGH\n\r\n            #endif // GL_ES\n\r\n            uniform vec4 tileOffsetArr[5];\r\n            uniform vec4 visibleExtentOffsetArr[5];\r\n            uniform vec4 transparentColorArr[5];\r\n            uniform vec3 pickingColorArr[5];\r\n            uniform sampler2D defaultTexture;\r\n            uniform sampler2D samplerArr[5];\r\n            uniform int samplerCount;\r\n            varying vec2 vTextureCoord;\r\n            varying float range;\r\n            /* return 1 if v inside the box, return 0 otherwise */\r\n            float insideBox(vec2 v, vec2 bottomLeft, vec2 topRight) {\r\n                vec2 s = step(bottomLeft, v) - step(topRight, v);\r\n                return s.x * s.y;\r\n            }\r\n            vec3 encode32(highp float f) {\r\n                float F = abs(f);\r\n                float s = step(0.0,-f);\r\n                float e = floor(log2(F));\r\n                float m = exp2(- e) * F;\r\n                e = floor(log2(F) + 127.0) + floor(log2(m));\r\n                vec3 rgb;\r\n                rgb[0] = 128.0 * s  + floor(e*exp2(-1.0));\r\n                rgb[1] = 128.0 * mod(e,2.0) + mod(floor(m*128.0),128.0);\r\n                rgb[2] = floor(mod(floor(m*exp2(23.0 -8.0)),exp2(8.0)));\r\n                return rgb / 255.0;\r\n            }\r\n            const vec2 BOTTOMLEFT = vec2(0.0);\r\n            const vec2 TOPRIGHT = vec2(1.0);\r\n            void main(void) {\r\n                gl_FragData[0] = texture2D( defaultTexture, vTextureCoord );\r\n                gl_FragData[1] = vec4(0.0);\r\n                gl_FragData[2] = vec4(encode32(range), gl_FragData[0].a);\r\n                if( samplerCount == 0 ) return;\r\n\r\n                vec4 t = texture2D( samplerArr[0], tileOffsetArr[0].xy + vTextureCoord * tileOffsetArr[0].zw ) * insideBox(visibleExtentOffsetArr[0].xy + vTextureCoord * visibleExtentOffsetArr[0].zw, BOTTOMLEFT, TOPRIGHT);\r\n                float emptiness = t.a * smoothstep(0.35, 0.5, distance( t.rgb, transparentColorArr[0].rgb ));\r\n                gl_FragData[0] = mix( gl_FragData[0], t, transparentColorArr[0].a * emptiness);\r\n                gl_FragData[1] = vec4(pickingColorArr[0], step(1.0, emptiness));\r\n                gl_FragData[2] = mix( gl_FragData[2], vec4(encode32(range), 1.0), step(1.0, emptiness));\r\n                if( samplerCount == 1 ) return;\r\n\r\n                t = texture2D( samplerArr[1], tileOffsetArr[1].xy + vTextureCoord * tileOffsetArr[1].zw ) * insideBox(visibleExtentOffsetArr[1].xy + vTextureCoord * visibleExtentOffsetArr[1].zw, BOTTOMLEFT, TOPRIGHT);\r\n                emptiness = t.a * smoothstep(0.35, 0.5, distance( t.rgb, transparentColorArr[1].rgb ));\r\n                gl_FragData[0] = mix( gl_FragData[0], t, transparentColorArr[1].a * emptiness);\r\n                gl_FragData[1] = mix( gl_FragData[1], vec4(pickingColorArr[1], 1.0), step(1.0, emptiness));\r\n                gl_FragData[2] = mix( gl_FragData[2], vec4(encode32(range), 1.0), step(1.0, emptiness));\r\n                if( samplerCount == 2 ) return;\r\n\r\n                t = texture2D( samplerArr[2], tileOffsetArr[2].xy + vTextureCoord * tileOffsetArr[2].zw ) * insideBox(visibleExtentOffsetArr[2].xy + vTextureCoord * visibleExtentOffsetArr[2].zw, BOTTOMLEFT, TOPRIGHT);\r\n                emptiness = t.a * smoothstep(0.35, 0.5, distance( t.rgb, transparentColorArr[2].rgb ));\r\n                gl_FragData[0] = mix( gl_FragData[0], t, transparentColorArr[2].a * emptiness);\r\n                gl_FragData[1] = mix( gl_FragData[1], vec4(pickingColorArr[2], 1.0), step(1.0, emptiness));\r\n                gl_FragData[2] = mix( gl_FragData[2], vec4(encode32(range), 1.0), step(1.0, emptiness));\r\n                if( samplerCount == 3 ) return;\r\n\r\n                t = texture2D( samplerArr[3], tileOffsetArr[3].xy + vTextureCoord * tileOffsetArr[3].zw ) * insideBox(visibleExtentOffsetArr[3].xy + vTextureCoord * visibleExtentOffsetArr[3].zw, BOTTOMLEFT, TOPRIGHT);\r\n                emptiness = t.a * smoothstep(0.35, 0.5, distance( t.rgb, transparentColorArr[3].rgb ));\r\n                gl_FragData[0] = mix( gl_FragData[0], t, transparentColorArr[3].a * emptiness);\r\n                gl_FragData[1] = mix( gl_FragData[1], vec4(pickingColorArr[3], 1.0), step(1.0, emptiness));\r\n                gl_FragData[2] = mix( gl_FragData[2], vec4(encode32(range), 1.0), step(1.0, emptiness));\r\n                if( samplerCount == 4 ) return;\r\n\r\n                t = texture2D( samplerArr[4], tileOffsetArr[4].xy + vTextureCoord * tileOffsetArr[4].zw ) * insideBox(visibleExtentOffsetArr[4].xy + vTextureCoord * visibleExtentOffsetArr[4].zw, BOTTOMLEFT, TOPRIGHT);\r\n                emptiness = t.a * smoothstep(0.35, 0.5, distance( t.rgb, transparentColorArr[4].rgb ));\r\n                gl_FragData[0] = mix( gl_FragData[0], t, transparentColorArr[4].a * emptiness);\r\n                gl_FragData[1] = mix( gl_FragData[1], vec4(pickingColorArr[4], 1.0), step(1.0, emptiness));\r\n                gl_FragData[2] = mix( gl_FragData[2], vec4(encode32(range), 1.0), step(1.0, emptiness));\r\n            }"})};
og.shaderProgram.drawnode_wl=function(){return new og.shaderProgram.ShaderProgram("drawnode_wl",{uniforms:{projectionMatrix:{type:og.shaderProgram.types.MAT4},viewMatrix:{type:og.shaderProgram.types.MAT4},samplerCount:{type:og.shaderProgram.types.INT},tileOffsetArr:{type:og.shaderProgram.types.VEC4},visibleExtentOffsetArr:{type:og.shaderProgram.types.VEC4},samplerArr:{type:og.shaderProgram.types.SAMPLER2DXX},transparentColorArr:{type:og.shaderProgram.types.VEC4},pickingColorArr:{type:og.shaderProgram.types.VEC3},
defaultTexture:{type:og.shaderProgram.types.SAMPLER2D},height:{type:og.shaderProgram.types.FLOAT},cameraPosition:{type:og.shaderProgram.types.VEC3},uGlobalTextureCoord:{type:og.shaderProgram.types.VEC4},normalMatrix:{type:og.shaderProgram.types.MAT3},uNormalMap:{type:og.shaderProgram.types.SAMPLER2D},uNormalMapBias:{type:og.shaderProgram.types.VEC3},uGlobalTextureCoord:{type:og.shaderProgram.types.VEC4},nightTexture:{type:og.shaderProgram.types.SAMPLER2D},specularTexture:{type:og.shaderProgram.types.SAMPLER2D},
lightsPositions:{type:og.shaderProgram.types.VEC4},diffuseMaterial:{type:og.shaderProgram.types.VEC3},ambientMaterial:{type:og.shaderProgram.types.VEC3},specularMaterial:{type:og.shaderProgram.types.VEC4}},attributes:{aVertexPosition:{type:og.shaderProgram.types.VEC3,enableArray:!0},aTextureCoord:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:"#ifdef GL_ES\n\r\n            #ifdef GL_FRAGMENT_PRECISION_HIGH\n\r\n            precision highp float;\n\r\n            #else\n\r\n            precision mediump float;\n\r\n            #endif // GL_FRAGMENT_PRECISION_HIGH\n\r\n            #endif // GL_ES\n\r\n            attribute vec3 aVertexPosition;\r\n            attribute vec2 aTextureCoord;\r\n            uniform mat4 projectionMatrix;\r\n            uniform mat4 viewMatrix;\r\n            uniform float height;\r\n            uniform vec3 cameraPosition;\r\n            uniform vec4 uGlobalTextureCoord;\r\n            uniform vec3 uNormalMapBias;\r\n            varying vec4 vTextureCoord;\r\n            varying float range;\r\n            varying vec2 vGlobalTextureCoord;\r\n            varying vec4 v_vertex;\r\n            varying float v_height;\r\n            const float C = 0.1;\r\n            const float far = 149.6e+9;\r\n            float logc = 2.0 / log( C * far + 1.0 );\r\n            void main(void) {\r\n                v_height = height;\r\n                vec3 heightVertex = aVertexPosition + normalize(aVertexPosition) * height;\r\n                v_vertex = viewMatrix * vec4(heightVertex, 1.0);\r\n                range = distance(cameraPosition, heightVertex);\r\n                vTextureCoord.xy = aTextureCoord;\r\n                vGlobalTextureCoord = uGlobalTextureCoord.xy + (uGlobalTextureCoord.zw - uGlobalTextureCoord.xy) * aTextureCoord;\r\n                vTextureCoord.zw = uNormalMapBias.z * ( aTextureCoord + uNormalMapBias.xy );\r\n                gl_Position = projectionMatrix * v_vertex;\r\n                gl_Position.z = ( log( C * gl_Position.w + 1.0 ) * logc - 1.0 ) * gl_Position.w;\r\n            }",
fragmentShader:"#extension GL_EXT_draw_buffers : require\n\r\n            #ifdef GL_ES\n\r\n            #ifdef GL_FRAGMENT_PRECISION_HIGH\n\r\n            precision highp float;\n\r\n            #else\n\r\n            precision mediump float;\n\r\n            #endif // GL_FRAGMENT_PRECISION_HIGH\n\r\n            #endif // GL_ES\n\r\n\n\r\n            #define MAX_POINT_LIGHTS 1\n\r\n            #define MAX_OVERLAYS 5\n\r\n            #define MAX_OVERLAYS_PLUS_ONE 6\n\r\n\r\n            uniform vec3 diffuseMaterial[MAX_OVERLAYS_PLUS_ONE];\r\n            uniform vec3 ambientMaterial[MAX_OVERLAYS_PLUS_ONE];\r\n            uniform vec4 specularMaterial[MAX_OVERLAYS_PLUS_ONE];\r\n\r\n            uniform sampler2D uNormalMap;\r\n            uniform vec4 lightsPositions[MAX_POINT_LIGHTS];\r\n            uniform mat3 normalMatrix;\r\n            uniform sampler2D nightTexture;\r\n            uniform sampler2D specularTexture;\r\n\r\n            uniform vec4 tileOffsetArr[MAX_OVERLAYS];\r\n            uniform vec4 visibleExtentOffsetArr[MAX_OVERLAYS];\r\n            uniform vec4 transparentColorArr[MAX_OVERLAYS];\r\n            uniform vec3 pickingColorArr[MAX_OVERLAYS];\r\n\r\n            uniform sampler2D defaultTexture;\r\n            uniform sampler2D samplerArr[MAX_OVERLAYS];\r\n            uniform int samplerCount;\r\n\r\n            varying vec4 vTextureCoord;\r\n            varying float range;\r\n            varying vec2 vGlobalTextureCoord;\r\n            varying vec4 v_vertex;\r\n            varying float v_height;\r\n\r\n            /* return 1 if v inside the box, return 0 otherwise */\r\n            float insideBox(vec2 v, vec2 bottomLeft, vec2 topRight) {\r\n                vec2 s = step(bottomLeft, v) - step(topRight, v);\r\n                return s.x * s.y;\r\n            }\r\n\r\n            vec3 encode24(highp float f) {\r\n                float F = abs(f);\r\n                float s = step( 0.0, -f );\r\n                float e = floor( log2(F) );\r\n                float m = exp2(- e) * F;\r\n                e = floor( log2(F) + 127.0 ) + floor( log2(m) );\r\n                return vec3(\r\n                    ( 128.0 * s + floor( e * exp2(-1.0) ) ) / 255.0,\r\n                    ( 128.0 * mod( e, 2.0 ) + mod( floor( m * 128.0 ), 128.0 ) ) / 255.0,\r\n                    floor( mod( floor( m * exp2( 23.0 - 8.0) ), exp2(8.0) ) ) / 255.0);\r\n            }\r\n\r\n            const vec2 BOTTOMLEFT = vec2(0.0);\r\n            const vec2 TOPRIGHT = vec2(1.0);\r\n            const vec3 nightStep = 10.0 * vec3(0.58, 0.48, 0.25);\r\n\r\n            void main(void) {\r\n\r\n                vec3 range24 = encode24(range);\r\n                float overGround = 1.0 - step(0.1, v_height);\r\n                vec3 normal = normalize(normalMatrix * ((texture2D(uNormalMap, vTextureCoord.zw).rgb - 0.5) * 2.0));\r\n                vec3 lightDirection = normalize(lightsPositions[0].xyz - v_vertex.xyz * lightsPositions[0].w);\r\n                vec3 eyeDirection = normalize(-v_vertex.xyz);\r\n                vec3 reflectionDirection = reflect(-lightDirection, normal);\r\n                vec4 nightImageColor = texture2D( nightTexture, vGlobalTextureCoord.st );\r\n                float shininess = texture2D( specularTexture, vGlobalTextureCoord.st ).r * 255.0 * overGround;\r\n                float reflection = max( dot(reflectionDirection, eyeDirection), 0.0);\r\n                float diffuseLightWeighting = max(dot(normal, lightDirection), 0.0);\r\n                vec3 night = nightStep * (0.3 - diffuseLightWeighting) * nightImageColor.rgb;\r\n                night *= overGround * step(0.0, night);\r\n\r\n\r\n\r\n                vec3 spec = specularMaterial[0].rgb * pow( reflection, specularMaterial[0].w) * shininess;\r\n                vec3 lightWeighting = ambientMaterial[0] + diffuseMaterial[0] * diffuseLightWeighting + spec;\r\n\r\n                vec4 t = texture2D( defaultTexture, vTextureCoord.xy );\r\n                gl_FragData[0] = vec4(t.rgb * lightWeighting + night + spec, t.a);\r\n                gl_FragData[1] = vec4(0.0);\r\n                gl_FragData[2] = vec4(range24, gl_FragData[0].a);\r\n                if( samplerCount == 0 ) return;\r\n\r\n\r\n\r\n                spec = specularMaterial[1].rgb * pow( reflection, specularMaterial[1].w) * (1.0 + shininess);\r\n                lightWeighting = ambientMaterial[1] + diffuseMaterial[1] * diffuseLightWeighting + spec;\r\n\r\n                t = texture2D( samplerArr[0], tileOffsetArr[0].xy + vTextureCoord.xy * tileOffsetArr[0].zw ) * insideBox(visibleExtentOffsetArr[0].xy + vTextureCoord.xy * visibleExtentOffsetArr[0].zw, BOTTOMLEFT, TOPRIGHT);\r\n                float emptiness = t.a * smoothstep(0.35, 0.5, distance( t.rgb, transparentColorArr[0].rgb ));\r\n                gl_FragData[0] = mix( gl_FragData[0], vec4(t.rgb * lightWeighting + night + spec, t.a), transparentColorArr[0].a * emptiness);\r\n                emptiness = step(1.0, emptiness);\r\n                gl_FragData[1] = vec4(pickingColorArr[0], emptiness);\r\n                gl_FragData[2] = mix( gl_FragData[2], vec4(range24, 1.0), emptiness);\r\n                if( samplerCount == 1 ) return;\r\n\r\n\r\n\r\n                spec = specularMaterial[2].rgb * pow( reflection, specularMaterial[2].w);\r\n                lightWeighting = ambientMaterial[2] + diffuseMaterial[2] * diffuseLightWeighting + spec;\r\n\r\n                t = texture2D( samplerArr[1], tileOffsetArr[1].xy + vTextureCoord.xy * tileOffsetArr[1].zw ) * insideBox(visibleExtentOffsetArr[1].xy + vTextureCoord.xy * visibleExtentOffsetArr[1].zw, BOTTOMLEFT, TOPRIGHT);\r\n                emptiness = t.a * smoothstep(0.35, 0.5, distance( t.rgb, transparentColorArr[1].rgb ));\r\n                gl_FragData[0] = mix( gl_FragData[0], vec4(t.rgb * lightWeighting + night + spec, t.a), transparentColorArr[1].a * emptiness);\r\n                emptiness = step(1.0, emptiness);\r\n                gl_FragData[1] = mix( gl_FragData[1], vec4(pickingColorArr[1], 1.0), emptiness);\r\n                gl_FragData[2] = mix( gl_FragData[2], vec4(range24, 1.0), emptiness);\r\n                if( samplerCount == 2 ) return;\r\n\r\n\r\n\r\n                spec = specularMaterial[3].rgb * pow( reflection, specularMaterial[3].w);\r\n                lightWeighting = ambientMaterial[3] + diffuseMaterial[3] * diffuseLightWeighting + spec;\r\n\r\n                t = texture2D( samplerArr[2], tileOffsetArr[2].xy + vTextureCoord.xy * tileOffsetArr[2].zw ) * insideBox(visibleExtentOffsetArr[2].xy + vTextureCoord.xy * visibleExtentOffsetArr[2].zw, BOTTOMLEFT, TOPRIGHT);\r\n                emptiness = t.a * smoothstep(0.35, 0.5, distance( t.rgb, transparentColorArr[2].rgb ));\r\n                gl_FragData[0] = mix( gl_FragData[0], vec4(t.rgb * lightWeighting + night + spec, t.a), transparentColorArr[2].a * emptiness);\r\n                emptiness = step(1.0, emptiness);\r\n                gl_FragData[1] = mix( gl_FragData[1], vec4(pickingColorArr[2], 1.0), emptiness);\r\n                gl_FragData[2] = mix( gl_FragData[2], vec4(range24, 1.0), emptiness);\r\n                if( samplerCount == 3 ) return;\r\n\r\n\r\n\r\n                spec = specularMaterial[4].rgb * pow( reflection, specularMaterial[4].w);\r\n                lightWeighting = ambientMaterial[4] + diffuseMaterial[4] * diffuseLightWeighting + spec;\r\n\r\n                t = texture2D( samplerArr[3], tileOffsetArr[3].xy + vTextureCoord.xy * tileOffsetArr[3].zw ) * insideBox(visibleExtentOffsetArr[3].xy + vTextureCoord.xy * visibleExtentOffsetArr[3].zw, BOTTOMLEFT, TOPRIGHT);\r\n                emptiness = t.a * smoothstep(0.35, 0.5, distance( t.rgb, transparentColorArr[3].rgb ));\r\n                gl_FragData[0] = mix( gl_FragData[0], vec4(t.rgb * lightWeighting + night + spec, t.a), transparentColorArr[3].a * emptiness);\r\n                emptiness = step(1.0, emptiness);\r\n                gl_FragData[1] = mix( gl_FragData[1], vec4(pickingColorArr[3], 1.0), emptiness);\r\n                gl_FragData[2] = mix( gl_FragData[2], vec4(range24, 1.0), emptiness);\r\n                if( samplerCount == 4 ) return;\r\n\r\n\r\n\r\n                spec = specularMaterial[5].rgb * pow( reflection, specularMaterial[5].w);\r\n                lightWeighting = ambientMaterial[5] + diffuseMaterial[5] * diffuseLightWeighting + spec;\r\n\r\n                t = texture2D( samplerArr[4], tileOffsetArr[4].xy + vTextureCoord.xy * tileOffsetArr[4].zw ) * insideBox(visibleExtentOffsetArr[4].xy + vTextureCoord.xy * visibleExtentOffsetArr[4].zw, BOTTOMLEFT, TOPRIGHT);\r\n                emptiness = t.a * smoothstep(0.35, 0.5, distance( t.rgb, transparentColorArr[4].rgb ));\r\n                gl_FragData[0] = mix( gl_FragData[0], vec4(t.rgb * lightWeighting + night + spec, t.a), transparentColorArr[4].a * emptiness);\r\n                emptiness = step(1.0, emptiness);\r\n                gl_FragData[1] = mix( gl_FragData[1], vec4(pickingColorArr[4], 1.0), emptiness);\r\n                gl_FragData[2] = mix( gl_FragData[2], vec4(range24, 1.0), emptiness);\r\n            }"})};og.math.coder={};og.math.coder.encodeFloatToRGBA=function(c){var d=Math.abs(c);c=og.math.step(0,-c);var e=Math.floor(og.math.log2(d)),f=og.math.exp2(-e)*d,e=Math.floor(og.math.log2(d)+127)+Math.floor(og.math.log2(f));return new og.math.Vector4(128*c+Math.floor(.5*e),128*og.math.mod(e,2)+og.math.mod(Math.floor(128*f),128),Math.floor(og.math.mod(Math.floor(32768*f),256)),Math.floor(8388608*og.math.mod(f,3.0517578125E-5)))};
og.math.coder.decodeFloatFromRGBA=function(c){var d=1-2*og.math.step(128,c.x),e=2*og.math.mod(c.x,128)+og.math.step(128,c.y)-127;c=65536*og.math.mod(c.y,128)+256*c.z+c.w+8388608;return d*og.math.exp2(e)*1.1920928955078125E-7*c};og.math.coder.doubleToTwoFloats=function(c){var d;if(0<=c){var e=65536*Math.floor(c/65536);d=Math.fround(e);c=Math.fround(c-e)}else e=65536*Math.floor(-c/65536),d=Math.fround(-e),c=Math.fround(c+e);return[d,c]};og.planetSegment.Material=function(c,d){this.segment=c;this.layer=d;this.isLoading=this.isReady=!1;this.image=this.texture=null;this.textureExists=!1;this.appliedNodeId=0};og.planetSegment.Material.prototype.assignLayer=function(c){this.layer=c};og.planetSegment.Material.prototype.abortLoading=function(){this.layer.abortMaterialLoading(this)};
og.planetSegment.Material.prototype.applyTexture=function(c){!this.isReady&&this.isLoading&&(this.image=c,this.texture=this.segment.handler.createTexture(c),this.appliedNodeId=this.segment.node.nodeId,this.textureExists=this.isReady=!0,this.isLoading=!1)};og.planetSegment.Material.prototype.textureNotExists=function(){this.isLoading=!0;this.textureExists=!1};og.planetSegment.Material.prototype.clear=function(){this.layer.clearMaterial(this)};og.quadTree.QuadNode=function(c,d,e,f,g,h,k){this.planet=d;this.parentNode=f;this.nodes=[];this.partId=e;this.nodeId=e+g;this.state=null;this.appliedTerrainNodeId=-1;this.sideSize=[1,1,1,1];this.hasNeighbor=[!1,!1,!1,!1];this.neighbors=[null,null,null,null];this.SegmentPrototype=c;this.planetSegment=new c(this,d,h,k);this._cameraInside=!1;this.createBounds();this.planet._createdNodesCount++};og.quadTree.QuadNode.VISIBLE_DISTANCE=3570;
og.quadTree.QuadNode._vertOrder=[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}];og.quadTree.QuadNode._neGridSize=Math.sqrt(og.quadTree.QuadNode._vertOrder.length)-1;
og.quadTree.QuadNode.prototype.createChildrenNodes=function(){var c=this.planet,d=this.planetSegment,e=d._extent,f=.5*e.getWidth(),g=.5*e.getHeight(),h=e.northEast,e=e.southWest,d=d.tileZoom+1,k=4*this.nodeId+1,m=new og.LonLat(e.lon+f,e.lat+g),l=this.nodes;l[og.quadTree.NW]=new og.quadTree.QuadNode(this.SegmentPrototype,c,og.quadTree.NW,this,k,d,new og.Extent(new og.LonLat(e.lon,e.lat+g),new og.LonLat(e.lon+f,h.lat)));l[og.quadTree.NE]=new og.quadTree.QuadNode(this.SegmentPrototype,c,og.quadTree.NE,
this,k,d,new og.Extent(m,new og.LonLat(h.lon,h.lat)));l[og.quadTree.SW]=new og.quadTree.QuadNode(this.SegmentPrototype,c,og.quadTree.SW,this,k,d,new og.Extent(new og.LonLat(e.lon,e.lat),m));l[og.quadTree.SE]=new og.quadTree.QuadNode(this.SegmentPrototype,c,og.quadTree.SE,this,k,d,new og.Extent(new og.LonLat(e.lon+f,e.lat),new og.LonLat(h.lon,e.lat+g)))};
og.quadTree.QuadNode.prototype.createBounds=function(){var c=this.planetSegment;if(c.tileZoom)if(c.tileZoom<c.planet.terrainProvider.minZoom)c.createBoundsByExtent();else{for(var d=this;d.parentNode&&!d.planetSegment.terrainReady;)d=d.parentNode;var e=this.planetSegment.tileZoom-d.planetSegment.tileZoom,f=Math.pow(2,e),g=this.planetSegment.tileX-d.planetSegment.tileX*f,f=this.planetSegment.tileY-d.planetSegment.tileY*f;if(d.planetSegment.terrainReady){var h=d.planetSegment.gridSize/Math.pow(2,e);
if(1<=h){var k=d.planetSegment.terrainVertices,e=h*f,m=h*g,f=3*(e*(d.planetSegment.gridSize+1)+m),d=3*((e+h)*(d.planetSegment.gridSize+1)+m+h);c.bsphere.setFromBounds([k[f],k[d],k[f+1],k[d+1],k[f+2],k[d+2]])}else{var k=d.planetSegment,e=Math.floor(h*f),m=Math.floor(h*g),d=1/h,f=f-d*e,g=g-d*m,l=og.quadTree.getMatrixSubArray(k.terrainVertices,k.gridSize,e,m,1),e=new og.math.Vector3(l[0],l[1],l[2]),m=new og.math.Vector3(l[9],l[10],l[11]),h=new og.math.Vector3(l[3]-l[0],l[4]-l[1],l[5]-l[2]),k=new og.math.Vector3(l[6]-
l[0],l[7]-l[1],l[8]-l[2]),n=new og.math.Vector3(l[3]-l[9],l[4]-l[10],l[5]-l[11]),p=new og.math.Vector3(l[6]-l[9],l[7]-l[10],l[8]-l[11]),q=f,r=g,l=q+r<d?og.math.Vector3.add(h.scaleTo(r/d),k.scaleTo(q/d)).addA(e):og.math.Vector3.add(p.scaleTo(1-r/d),n.scaleTo(1-q/d)).addA(m),q=f+1,r=g+1,d=q+r<d?og.math.Vector3.add(h.scaleTo(r/d),k.scaleTo(q/d)).addA(e):og.math.Vector3.add(p.scaleTo(1-r/d),n.scaleTo(1-q/d)).addA(m);c.bsphere.radius=.5*l.distance(d);c.bsphere.center=l.addA(d.subA(l).scale(.5))}}else c.createBoundsByExtent()}else c.bsphere.radius=
c.planet.ellipsoid._a,c.bsphere.center=new og.math.Vector3};og.quadTree.QuadNode.prototype.reloadTerrain=function(){this.planetSegment.ready=!1;this.planetSegment.deleteBuffers();this.planetSegment.deleteElevations();this.getState()===og.quadTree.WALKTHROUGH&&this.planetSegment.loadTerrain();for(var c=0;c<this.nodes.length;c++)this.nodes[c].reloadTerrain()};
og.quadTree.QuadNode.prototype.getState=function(){for(var c=this.parentNode;c;){if(c.state!=og.quadTree.WALKTHROUGH)return og.quadTree.NOTRENDERING;c=c.parentNode}return this.state};og.quadTree.QuadNode.prototype.prepareForRendering=function(c,d){3E6>c?d?this.renderNode():this.state=og.quadTree.NOTRENDERING:this.renderNode()};
og.quadTree.QuadNode.prototype.traverseNodes=function(){this.nodes.length||this.createChildrenNodes();this.nodes[og.quadTree.NW].renderTree();this.nodes[og.quadTree.NE].renderTree();this.nodes[og.quadTree.SW].renderTree();this.nodes[og.quadTree.SE].renderTree()};og.quadTree.QuadNode.prototype.isBrother=function(c){return!(this.parentNode||c.parentNode)||this.parentNode.id===c.parentNode.id};
og.quadTree.QuadNode.prototype.renderTree=function(){this.state=og.quadTree.WALKTHROUGH;var c=this.planet.renderer.activeCamera,d=this.planetSegment,e=this.planet;if(this.parentNode){if(this._cameraInside=!1,this.parentNode._cameraInside){var f;Math.abs(c._lonLat.lat)<=og.mercator.MAX_LAT&&d._projection.id===og.proj.EPSG3857.id?(f=d._extent.isInside(c._lonLatMerc),c._insideSegmentPosition=c._lonLatMerc):d._projection.id===og.proj.EPSG4326.id&&(f=d._extent.isInside(c._lonLat),c._insideSegmentPosition=
c._lonLat);f&&(c._insideSegment=d,this._cameraInside=!0)}}else this._cameraInside=!0;f=0<c.frustum.containsSphere(d.bsphere);var g=c.eye.distance(d.bsphere.center)-d.bsphere.radius<og.quadTree.QuadNode.VISIBLE_DISTANCE*Math.sqrt(c._lonLat.height);f||this._cameraInside?2>d.tileZoom&&d.normalMapReady?this.traverseNodes():d.acceptForRendering(c)?this.prepareForRendering(c._lonLat.height,g):d.tileZoom<e.terrainProvider.gridSizeByZoom.length-1?this.traverseNodes():this.prepareForRendering(c._lonLat.height,
g):this.state=og.quadTree.NOTRENDERING;f&&g&&d._collectRenderNodes()};
og.quadTree.QuadNode.prototype.renderNode=function(){this.state=og.quadTree.RENDERING;var c=this.planetSegment;c.ready||c.createPlainSegment();c.terrainReady||(c.loadTerrain(),this.whileTerrainLoading());!c.planet.lightEnabled||c.normalMapReady||c.parentNormalMapReady||this.whileNormalMapCreating();c.tileZoom>this.planet.maxCurrZoom&&(this.planet.maxCurrZoom=c.tileZoom);c.tileZoom<this.planet.minCurrZoom&&(this.planet.minCurrZoom=c.tileZoom);c._addViewExtent();this.addToRender(this)};
og.quadTree.QuadNode.prototype.addToRender=function(c){for(var d=this.planet._renderedNodes,e=0;e<d.length;e++){var f=d[e],g=c.getCommonSide(f);if(-1!=g){var h=og.quadTree.OPSIDE[g];c.neighbors[g]=f;f.neighbors[h]=c;if(!c.hasNeighbor[g]||!f.hasNeighbor[h]){var k=c.planetSegment,m=f.planetSegment,l=k.gridSize/(m.gridSize*Math.pow(2,m.tileZoom-k.tileZoom));c.hasNeighbor[g]=!0;f.hasNeighbor[h]=!0;1<l?(c.sideSize[g]=Math.ceil(k.gridSize/l),f.sideSize[h]=m.gridSize):1>l?(c.sideSize[g]=k.gridSize,f.sideSize[h]=
Math.ceil(m.gridSize*l)):(c.sideSize[g]=k.gridSize,f.sideSize[h]=m.gridSize)}}}d.push(c)};
og.quadTree.QuadNode.prototype.getCommonSide=function(c){var d=this.planetSegment._extent,e=c.planetSegment._extent,f=d.northEast,d=d.southWest;c=e.northEast;var g=e.southWest,e=f.lon,f=f.lat,h=d.lon,k=d.lat,m=c.lon,l=c.lat,n=g.lon,g=g.lat,p=og.mercator.POLE,q=og.mercator.MAX_LAT;return e===n&&(f<=l&&k>=g||f>=l&&k<=g)?og.quadTree.E:h===m&&(f<=l&&k>=g||f>=l&&k<=g)?og.quadTree.W:f===g&&(h>=n&&e<=m||h<=n&&e>=m)?og.quadTree.N:k===l&&(h>=n&&e<=m||h<=n&&e>=m)?og.quadTree.S:e===p&&n===-p?og.quadTree.E:d.lon===
-p&&c.lon==p?og.quadTree.W:f===p&&g===q?og.quadTree.N:k===-p&&l===-q?og.quadTree.S:-1};
og.quadTree.QuadNode.prototype.whileNormalMapCreating=function(){for(var c=this.planetSegment,d=this;d.parentNode&&!d.planetSegment.normalMapReady;)d=d.parentNode;var e=2<<c.tileZoom-d.planetSegment.tileZoom-1;c.normalMapTexture=d.planetSegment.normalMapTexture;c.normalMapTextureBias[0]=c.tileX-d.planetSegment.tileX*e;c.normalMapTextureBias[1]=c.tileY-d.planetSegment.tileY*e;c.normalMapTextureBias[2]=1/e;e=this.planet.terrainProvider.maxZoom;if(c.tileZoom<=e&&!c.terrainIsLoading&&c.terrainReady&&
!c._inTheQueue)c.planet.normalMapCreator.shift(c);else if(c.tileZoom>e)if(d.planetSegment.tileZoom===e)c.parentNormalMapReady=!0;else{for(d=this;d.parentNode&&d.planetSegment.tileZoom!=e;)d=d.parentNode;c=d.planetSegment;c.ready?c._inTheQueue||c.terrainIsLoading||c.planet.normalMapCreator.shift(c):(c.createPlainSegment(),c.loadTerrain())}};
og.quadTree.QuadNode.prototype.whileTerrainLoading=function(){for(var c=this;c.parentNode&&!c.planetSegment.terrainReady;)c=c.parentNode;if(c.planetSegment.terrainReady){var d=2<<this.planetSegment.tileZoom-c.planetSegment.tileZoom-1,e=this.planetSegment.tileX-c.planetSegment.tileX*d,f=this.planetSegment.tileY-c.planetSegment.tileY*d,g=this.planetSegment,h=c.planetSegment;if(c.planetSegment.terrainExists&&this.appliedTerrainNodeId!=c.nodeId){var d=c.planetSegment.gridSize/d,k=[];g.deleteBuffers();
g.refreshIndexesBuffer=!0;if(1<=d){g.gridSize=d;this.sideSize=[d,d,d,d];var m,l,k=og.quadTree.getMatrixSubArray(h.terrainVertices,h.gridSize,d*f,d*e,d)}else{g.gridSize=og.quadTree.QuadNode._neGridSize;this.sideSize=[g.gridSize,g.gridSize,g.gridSize,g.gridSize];m=Math.floor(d*f);l=Math.floor(d*e);var h=og.quadTree.getMatrixSubArray(h.terrainVertices,h.gridSize,m,l,1),n=1/d,f=f-n*m,e=e-n*l;l=new og.math.Vector3(h[0],h[1],h[2]);m=new og.math.Vector3(h[9],h[10],h[11]);var p=new og.math.Vector3(h[3]-h[0],
h[4]-h[1],h[5]-h[2]),q=new og.math.Vector3(h[6]-h[0],h[7]-h[1],h[8]-h[2]),r=new og.math.Vector3(h[3]-h[9],h[4]-h[10],h[5]-h[11]),t=new og.math.Vector3(h[6]-h[9],h[7]-h[10],h[8]-h[11]),u;new og.math.Vector3;for(var B=og.quadTree.QuadNode._vertOrder,v=0;v<B.length;v++){u=B[v].y+f;var E=B[v].x+e,F=E*d,H=u*d;u=u+E<n?p.scaleTo(F).addA(q.scaleTo(H)).addA(l):t.scaleTo(1-F).addA(r.scaleTo(1-H)).addA(m);E=3*v;k[E]=u.x;k[E+1]=u.y;k[E+2]=u.z}h.length=0}g.createCoordsBuffers(k,g.gridSize);g.tempVertices=k;this.appliedTerrainNodeId=
c.nodeId}d=this.planet.terrainProvider.maxZoom;if(g.tileZoom>d)if(c.planetSegment.tileZoom>=d)g.terrainReady=!0,g.terrainIsLoading=!1,this.appliedTerrainNodeId=this.nodeId,c.planetSegment.terrainExists&&(g.terrainExists=!0,g.terrainVertices=k);else{for(c=this;c.parentNode&&c.planetSegment.tileZoom!=d;)c=c.parentNode;c=c.planetSegment;c.ready||c.createPlainSegment();c.loadTerrain()}}};
og.quadTree.getMatrixSubArray=function(c,d,e,f,g){for(var h=[],k=0,m=e;m<=e+g;m++)for(var l=f;l<=f+g;l++){var n=3*(m*(d+1)+l);h[k++]=c[n];h[k++]=c[n+1];h[k++]=c[n+2]}return h};og.quadTree.QuadNode.prototype.clearTree=function(){var c=this.getState();if(c===og.quadTree.NOTRENDERING)this.destroyBranches(!0);else if(c===og.quadTree.RENDERING)this.destroyBranches(!1);else for(c=0;c<this.nodes.length;c++)this.nodes[c].clearTree()};
og.quadTree.QuadNode.prototype.destroy=function(){this.state=og.quadTree.NOTRENDERING;this.planetSegment.destroySegment();var c=this.neighbors;c[og.quadTree.N]&&c[og.quadTree.N].neighbors&&(c[og.quadTree.N].neighbors[og.quadTree.S]=null);c[og.quadTree.E]&&c[og.quadTree.E].neighbors&&(c[og.quadTree.E].neighbors[og.quadTree.W]=null);c[og.quadTree.S]&&c[og.quadTree.S].neighbors&&(c[og.quadTree.S].neighbors[og.quadTree.N]=null);c[og.quadTree.W]&&c[og.quadTree.W].neighbors&&(c[og.quadTree.W].neighbors[og.quadTree.E]=
null);this.planetSegment=this.sideSize=this.parentNode=this.hasNeighbors=this.neighbors=null};og.quadTree.QuadNode.prototype.destroyBranches=function(c){c&&(this.planetSegment.clearSegment(),this.appliedTerrainNodeId=-1);c=[];for(var d=0;d<this.nodes.length;d++)c[d]=this.nodes[d];this.nodes.length=0;this.nodes=[];for(d=0;d<c.length;d++)c[d].destroyBranches(!1),c[d].destroy(),c[d]=null;c.length=0};og.quadTree.QuadNode.prototype.traverseTree=function(c){c(this);for(var d=0;d<this.nodes.length;d++)this.nodes[d].traverseTree(c)};og.Frustum=function(){this._f=Array(6);for(var c=0;6>c;c++)this._f[c]=Array(4)};og.Frustum.planeNormalize=function(c){var d=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);c[0]/=d;c[1]/=d;c[2]/=d;c[3]/=d};
og.Frustum.prototype.setFrustum=function(c){this._f[0][0]=c[3]-c[0];this._f[0][1]=c[7]-c[4];this._f[0][2]=c[11]-c[8];this._f[0][3]=c[15]-c[12];og.Frustum.planeNormalize(this._f[0]);this._f[1][0]=c[3]+c[0];this._f[1][1]=c[7]+c[4];this._f[1][2]=c[11]+c[8];this._f[1][3]=c[15]+c[12];og.Frustum.planeNormalize(this._f[1]);this._f[2][0]=c[3]+c[1];this._f[2][1]=c[7]+c[5];this._f[2][2]=c[11]+c[9];this._f[2][3]=c[15]+c[13];og.Frustum.planeNormalize(this._f[2]);this._f[3][0]=c[3]-c[1];this._f[3][1]=c[7]-c[5];
this._f[3][2]=c[11]-c[9];this._f[3][3]=c[15]-c[13];og.Frustum.planeNormalize(this._f[3]);this._f[4][0]=c[3]-c[2];this._f[4][1]=c[7]-c[6];this._f[4][2]=c[11]-c[10];this._f[4][3]=c[15]-c[14];og.Frustum.planeNormalize(this._f[4]);this._f[5][0]=c[3]+c[2];this._f[5][1]=c[7]+c[6];this._f[5][2]=c[11]+c[10];this._f[5][3]=c[15]+c[14];og.Frustum.planeNormalize(this._f[5])};og.Frustum.prototype.containsPoint=function(c){for(var d,e=0;6>e;e++)if(d=c.dotArr(this._f[e])+this._f[e][3],0>=d)return!1;return!0};
og.Frustum.prototype.containsSphere=function(c){for(var d,e=0;6>e;e++)if(d=c.center.dotArr(this._f[e])+this._f[e][3],d<=-c.radius)return-1;return d+c.radius};og.Frustum.prototype.containsBox=function(c){for(var d=!0,e,f,g=0;6>g;g++){for(var h=f=e=0;8>h&&(0==f||0==e);h++)0>c.vertices[h].dotArr(this._f[g])+this._f[g][3]?e++:f++;if(0==f)return!1;0<e&&(d=!0)}return d};og.Camera=function(c,d){this.renderer=null;this.events=new og.Events;this.events.registerNames(og.Camera.EVENT_NAMES);this.eye=new og.math.Vector3;this.frustum=new og.Frustum;this._aspect=d.aspect||0;this._viewAngle=this._farDist=this._nearDist=0;this._normalMatrix=new og.math.Matrix3;this._projectionMatrix=new og.math.Matrix4;this._viewMatrix=new og.math.Matrix4;this._projectionViewMatrix=new og.math.Matrix4;this._inverseProjectionViewMatrix=new og.math.Matrix4;this._projectionMatrixPrecise=new og.math.Matrix4;
this._u=new og.math.Vector3(0,1,0);this._v=new og.math.Vector3(1,0,0);this._n=new og.math.Vector3(0,0,1);this._tanViewAngle_hradOneByHeight=this._tanViewAngle_hrad=0;c&&this.initialize(c,d)};og.Camera.EVENT_NAMES=["viewchange"];og.Camera.defaultOptions={viewAngle:35,near:1,far:og.math.MAX,eye:new og.math.Vector3(0,0,0),look:new og.math.Vector3(0,0,0),up:new og.math.Vector3(0,1,0)};
og.Camera.prototype._setViewMatrix=function(){var c=this._u,d=this._v,e=this._n,f=this.eye;this._viewMatrix.set([c.x,d.x,e.x,0,c.y,d.y,e.y,0,c.z,d.z,e.z,0,-f.dot(c),-f.dot(d),-f.dot(e),1])};og.Camera.prototype.initialize=function(c,d){this.renderer=c;var e=og.Camera.defaultOptions;this.setProjectionMatrix(d.viewAngle||e.viewAngle,this._aspect||c.handler.getClientAspect(),d.near||e.near,d.far||e.far);this.set(d.eye||e.eye.clone(),d.look||e.look.clone(),d.up||e.up.clone());this.update()};
og.Camera.prototype.getUp=function(){return this._v};og.Camera.prototype.getDown=function(){return this._v.negateTo()};og.Camera.prototype.getRight=function(){return this._u};og.Camera.prototype.getLeft=function(){return this._u.negateTo()};og.Camera.prototype.getForward=function(){return this._n};og.Camera.prototype.getBackward=function(){return this._n.negateTo()};
og.Camera.prototype.clone=function(){var c=new og.Camera;c.eye.copy(cam.eye);c._u.copy(cam._u);c._v.copy(cam._v);c._n.copy(cam._n);c.renderer=cam.renderer;c._projectionMatrix.copy(cam._projectionMatrix);c._viewMatrix.copy(cam._viewMatrix);c._projectionViewMatrix.copy(cam._projectionViewMatrix);c._inverseProjectionViewMatrix.copy(cam._inverseProjectionViewMatrix);c.frustum.setFrustum(c._projectionViewMatrix);return c};
og.Camera.prototype.update=function(){this._setViewMatrix();this._projectionViewMatrix=this._projectionMatrix.mul(this._viewMatrix);this.frustum.setFrustum(this._projectionViewMatrix._m);this._inverseProjectionViewMatrix=this._projectionViewMatrix.inverseTo();this._normalMatrix=this._viewMatrix.toMatrix3();this.events.dispatch(this.events.viewchange,this)};og.Camera.prototype.refresh=function(){this.setProjectionMatrix(this._viewAngle,this._aspect,this._nearDist,this._farDist);this.update()};
og.Camera.prototype.setAspectRatio=function(c){this._aspect=c;this.refresh()};og.Camera.prototype.getAspectRatio=function(){return this._aspect};og.Camera.prototype.setFar=function(c){this._farDist=c;this.refresh()};og.Camera.prototype.getFar=function(){return this._farDist};og.Camera.prototype.setNear=function(c){this._nearDist=c;this.refresh()};og.Camera.prototype.getNear=function(){return this._nearDist};
og.Camera.prototype.setProjectionMatrix=function(c,d,e,f){this._viewAngle=c;this._tanViewAngle_hrad=Math.tan(c*og.math.RADIANS_HALF);this._tanViewAngle_hradOneByHeight=this._tanViewAngle_hrad*this.renderer.handler._oneByHeight;this._aspect=d;this._nearDist=e;this._farDist=f;this._projectionMatrix.setPerspective(c,d,e,f);this._projectionMatrixPrecise.setPerspective(c,d,.1,10)};og.Camera.prototype.setViewAngle=function(c){this._viewAngle=c;this.refresh()};
og.Camera.prototype.set=function(c,d,e){this.eye.x=c.x;this.eye.y=c.y;this.eye.z=c.z;d=d||this._n;e=e||this._v;this._n.x=c.x-d.x;this._n.y=c.y-d.y;this._n.z=c.z-d.z;this._u.copy(e.cross(this._n));this._n.normalize();this._u.normalize();this._v.copy(this._n.cross(this._u))};og.Camera.prototype.look=function(c,d){this._n.set(this.eye.x-c.x,this.eye.y-c.y,this.eye.z-c.z);this._u.copy((d||this._v).cross(this._n));this._n.normalize();this._u.normalize();this._v.copy(this._n.cross(this._u))};
og.Camera.prototype.slide=function(c,d,e){this.eye.x+=c*this._u.x+d*this._v.x+e*this._n.x;this.eye.y+=c*this._u.y+d*this._v.y+e*this._n.y;this.eye.z+=c*this._u.z+d*this._v.z+e*this._n.z};og.Camera.prototype.roll=function(c){var d=Math.cos(og.math.RADIANS*c);c=Math.sin(og.math.RADIANS*c);var e=this._u.clone();this._u.set(d*e.x-c*this._v.x,d*e.y-c*this._v.y,d*e.z-c*this._v.z);this._v.set(c*e.x+d*this._v.x,c*e.y+d*this._v.y,c*e.z+d*this._v.z)};
og.Camera.prototype.pitch=function(c){var d=Math.cos(og.math.RADIANS*c);c=Math.sin(og.math.RADIANS*c);var e=this._n.clone();this._n.set(d*e.x-c*this._v.x,d*e.y-c*this._v.y,d*e.z-c*this._v.z);this._v.set(c*e.x+d*this._v.x,c*e.y+d*this._v.y,c*e.z+d*this._v.z)};
og.Camera.prototype.yaw=function(c){var d=Math.cos(og.math.RADIANS*c);c=Math.sin(og.math.RADIANS*c);var e=this._u.clone();this._u.set(d*e.x-c*this._n.x,d*e.y-c*this._n.y,d*e.z-c*this._n.z);this._n.set(c*e.x+d*this._n.x,c*e.y+d*this._n.y,c*e.z+d*this._n.z)};
og.Camera.prototype.unproject=function(c,d){var e=this.renderer.handler.gl.canvas,f=.5*e.width,e=.5*e.height,f=(c-f)/f,e=-(d-e)/e,g=this._inverseProjectionViewMatrix.mulVec4(new og.math.Vector4(f,e,-1,1)).affinity();return this._inverseProjectionViewMatrix.mulVec4(new og.math.Vector4(f,e,0,1)).affinity().subA(g).toVector3().normalize()};
og.Camera.prototype.project=function(c){c=this._projectionViewMatrix.mulVec4(c.toVector4());var d=this.renderer.handler.gl.canvas;return new og.math.Vector2((1+c.x/c.w)*d.width*.5,(1-c.y/c.w)*d.height*.5)};
og.Camera.prototype.rotateAround=function(c,d,e,f){e=e||og.math.Vector3.ZERO;f=f||og.math.Vector3.UP;c=(new og.math.Matrix4).rotate(d?this._v:f,c);d=(new og.math.Matrix4).setIdentity().translate(e);e=(new og.math.Matrix4).setIdentity().translate(e.negateTo());this.eye=d.mul(c).mul(e).mulVec3(this.eye);this._v=c.mulVec3(this._v).normalize();this._u=c.mulVec3(this._u).normalize();this._n=c.mulVec3(this._n).normalize()};og.Camera.prototype.rotateHorizontal=function(c,d,e,f){this.rotateAround(c,d,e,f)};
og.Camera.prototype.rotateVertical=function(c,d){this.rotateAround(c,!1,d,this._u)};og.Camera.prototype.projectedSize=function(c){return this.eye.distance(c)*this._tanViewAngle_hrad};og.Camera.prototype.getNormalMatrix=function(){return this._normalMatrix};og.Camera.prototype.getProjectionMatrix=function(){return this._projectionMatrix};og.Camera.prototype.getViewMatrix=function(){return this._viewMatrix};og.Camera.prototype.getProjectionViewMatrix=function(){return this._projectionViewMatrix};
og.Camera.prototype.getInverseProjecttionViewMatrix=function(){return this._inverseProjectionViewMatrix};og.PlanetCamera=function(c,d){this.planet=c;og.inheritance.base(this,c.renderer,d);this.minAltitude=d.minAltitude||50;this._lonLat=this.planet.ellipsoid.cartesianToLonLat(this.eye);this._lonLatMerc=this._lonLat.forwardMercator();this._terrainAltitude=this._lonLat.height;this._terrainPoint=new og.math.Vector3;this._insideSegmentPosition=this._insideSegment=null;this._framesArr=[];this._framesCounter=0;this._numFrames=150;this._completeCallback=null;this._flying=!1};
og.inheritance.extend(og.PlanetCamera,og.Camera);
og.PlanetCamera.prototype.clone=function(){var c=new og.PlanetCamera;c.eye.copy(cam.eye);c._u.copy(cam._u);c._v.copy(cam._v);c._n.copy(cam._n);c.renderer=cam.renderer;c._projectionMatrix.copy(cam._projectionMatrix);c._viewMatrix.copy(cam._viewMatrix);c._projectionViewMatrix.copy(cam._projectionViewMatrix);c._inverseProjectionViewMatrix.copy(cam._inverseProjectionViewMatrix);c.frustum.setFrustum(c._projectionViewMatrix);c.planet=cam.planet;c._lonLat=cam._lonLat.clone();return c};
og.PlanetCamera.prototype.update=function(){this._setViewMatrix();this._projectionViewMatrix=this._projectionMatrix.mul(this._viewMatrix);this.frustum.setFrustum(this._projectionViewMatrix._m);this._inverseProjectionViewMatrix=this._projectionMatrixPrecise.mul(this._viewMatrix).inverseTo();this._normalMatrix=this._viewMatrix.toMatrix3();this.updateGeodeticPosition();this.events.dispatch(this.events.viewchange,this)};
og.PlanetCamera.prototype.updateGeodeticPosition=function(){this._lonLat=this.planet.ellipsoid.cartesianToLonLat(this.eye);Math.abs(this._lonLat.lat)<=og.mercator.MAX_LAT&&(this._lonLatMerc=this._lonLat.forwardMercator())};og.PlanetCamera.prototype.setAltitude=function(c){var d=this.eye.normal(),e=this._terrainPoint;this.eye.x=d.x*c+e.x;this.eye.y=d.y*c+e.y;this.eye.z=d.z*c+e.z;this._terrainAltitude=c;this.update()};og.PlanetCamera.prototype.getAltitude=function(){return this._terrainAltitude};
og.PlanetCamera.prototype.setLonLat=function(c,d){this._lonLat.set(c.lon,c.lat,c.height||this._lonLat.height);var e=this.planet.ellipsoid.lonLatToCartesian(this._lonLat),f=(new og.math.Matrix4).rotateBetweenVectors(e.normal(),this.eye.normal());this.eye=e;this._v=f.mulVec3(this._v);this._u=f.mulVec3(this._u);this._n=f.mulVec3(this._n)};og.PlanetCamera.prototype.getLonLat=function(){return this._lonLat};og.PlanetCamera.prototype.getHeight=function(){return this._lonLat.height};
og.PlanetCamera.prototype.viewLonLat=function(c,d){this._lonLat.set(c.lon,c.lat,c.height||this._lonLat.height);var e=this.planet.ellipsoid,f=e.lonLatToCartesian(this._lonLat),e=e.lonLatToCartesian(new og.LonLat(this._lonLat.lon,this._lonLat.lat,0));this.set(f,e,d||og.math.Vector3.UP)};
og.PlanetCamera.prototype.getExtentPosition=function(c){var d=c.getNorth(),e=c.getSouth(),f=c.getEast(),g=c.getWest();g>f&&(f+=360);var h=this.planet.ellipsoid,k=new og.LonLat(f,d),m=h.lonLatToCartesian(k);k.lat=e;var l=h.lonLatToCartesian(k);k.lon=g;var n=h.lonLatToCartesian(k);k.lat=d;var p=h.lonLatToCartesian(k);c=og.math.Vector3.sub(m,n).scale(.5).addA(n);var q=c.length();1E-6>q&&(k.lon=.5*(f+g),k.lat=.5*(d+e),c=h.lonLatToCartesian(k));p.subA(c);l.subA(c);m.subA(c);n.subA(c);e=c.normal();d=e.cross(og.math.Vector3.UP).normalize();
e=d.cross(e).normalize();e=Math.max(Math.abs(e.dot(p)),Math.abs(e.dot(l)),Math.abs(e.dot(m)),Math.abs(e.dot(n)));m=Math.max(Math.abs(d.dot(p)),Math.abs(d.dot(l)),Math.abs(d.dot(m)),Math.abs(d.dot(n)));l=Math.tan(this._viewAngle*og.math.RADIANS*.5);m=Math.max(m/(this._aspect*l),e/l);c.normalize();c.scale(q+m);return c};og.PlanetCamera.prototype.viewExtent=function(c){this.stopFlying();this.set(this.getExtentPosition(c),og.math.Vector3.ZERO,og.math.Vector3.UP);this.refresh()};
og.PlanetCamera.prototype.flyExtent=function(c,d,e,f){this.flyCartesian(this.getExtentPosition(c),og.math.Vector3.ZERO,d,e,f)};
og.PlanetCamera.prototype.flyCartesian=function(c,d,e,f,g){this.stopFlying();this._completeCallback=f;g&&g.call(this);var h=d||og.math.Vector3.ZERO;d instanceof og.LonLat&&(h=this.planet.ellipsoid.lonLatToCartesian(d));d=this.planet.ellipsoid.lonLatToCartesian(new og.LonLat(this._lonLat.lon,this._lonLat.lat));f=this._v;g=this._n;var k=this.planet.ellipsoid.cartesianToLonLat(c),m=e||og.math.Vector3.UP;e=this.planet.ellipsoid.lonLatToCartesian(new og.LonLat(k.lon,k.lat,0));c=og.math.Vector3.sub(c,h);
h=m.cross(c);c.normalize();h.normalize();var h=c.cross(h),m=d.normal(),l=e.normal(),m=1-m.dot(l),m=og.math.SQRT_HALF*Math.sqrt(0<m?m:0),l=6639613,n=Math.max(this._lonLat.height,k.height);n>l&&(l=n);m=n+2.5*m*(l-n);l=og.math.Vector3.ZERO;for(n=0;n<=this._numFrames;n++){var p=1-n/this._numFrames,p=p*p*(3-2*p),p=p*p,q=d.smerp(e,p).normalize(),r=this.planet.getRayIntersectionEllipsoid(new og.math.Ray(l,q)),t=1-p,q=r.addA(q.scale(this._lonLat.height*p*p*p+3*m*p*p*t+3*m*p*t*t+k.height*t*t*t)),r=f.smerp(h,
p),p=og.math.Vector3.add(q,g.smerp(c,p).negateTo()),p=new og.math.Vector3(q.x-p.x,q.y-p.y,q.z-p.z),r=r.cross(p);p.normalize();r.normalize();t=p.cross(r);this._framesArr[n]={eye:q,n:p,u:r,v:t}}this._framesCounter=this._numFrames;this._flying=!0};og.PlanetCamera.prototype.flyLonLat=function(c,d,e,f,g){c=new og.LonLat(c.lon,c.lat,c.height||this._lonLat.height);this.flyCartesian(this.planet.ellipsoid.lonLatToCartesian(c),d,e,f,g)};
og.PlanetCamera.prototype.stopFlying=function(){this.planet.normalMapCreator.active=!0;this.planet.terrainProvider.active=!0;this.planet.layersActivity=!0;this._flying=!1;this._framesArr.length=0;this._framesArr=[];this._framesCounter=-1};og.PlanetCamera.prototype.isFlying=function(){return this._flying};og.PlanetCamera.prototype.rotateLeft=function(c,d){this.rotateHorizontal(c*og.math.RADIANS,d^1,og.math.Vector3.ZERO);this.update()};
og.PlanetCamera.prototype.rotateRight=function(c,d){this.rotateHorizontal(-c*og.math.RADIANS,d^1,og.math.Vector3.ZERO);this.update()};og.PlanetCamera.prototype.rotateUp=function(c){this.rotateVertical(c*og.math.RADIANS,og.math.Vector3.ZERO);this.update()};og.PlanetCamera.prototype.rotateDown=function(c){this.rotateVertical(-c*og.math.RADIANS,og.math.Vector3.ZERO);this.update()};
og.PlanetCamera.prototype.prepareFrame=function(){if(this._flying){var c=this._numFrames-this._framesCounter;this.planet.normalMapCreator.active=!1;this.planet.layersActivity=c%20?!1:!0;this.eye=this._framesArr[c].eye;this._u=this._framesArr[c].u;this._v=this._framesArr[c].v;this._n=this._framesArr[c].n;this.update();this._framesCounter--;0>this._framesCounter&&(this.stopFlying(),this._completeCallback&&(this._completeCallback(),this._completeCallback=null))}else this._terrainAltitude=this._lonLat.height,
1E6>this._lonLat.height&&(this._terrainAltitude=this._insideSegment.getTerrainPoint(this._terrainPoint,this.eye,this._insideSegmentPosition),this._terrainAltitude<this.minAltitude&&this.setAltitude(this.minAltitude))};og.Ellipsoid=function(c,d){this._a=c;this._b=d;this._flattening=c/d;this._a2=c*c;this._b2=d*d;var e=Math.sqrt(this._a2-this._b2);this._e=e/c;this._e2=this._e*this._e;this._e22=this._e2*this._e2;this._k=e/d;this._k2=this._k*this._k;this._radii=new og.math.Vector3(c,d,c);this._radii2=new og.math.Vector3(this._a2,this._b2,this._a2);this._invRadii=new og.math.Vector3(1/c,1/d,1/c);this._invRadii2=new og.math.Vector3(1/this._a2,1/this._b2,1/this._a2)};og.Ellipsoid.prototype.getEquatorialSize=function(){return this._a};
og.Ellipsoid.prototype.getPolarSize=function(){return this._b};og.Ellipsoid.prototype.lonLatToCartesian=function(c){var d=og.math.RADIANS*c.lat,e=og.math.RADIANS*c.lon,f=Math.sin(d),g=this._a/Math.sqrt(1-this._e2*f*f),d=(g+c.height)*Math.cos(d);return new og.math.Vector3(d*Math.sin(e),(g*(1-this._e2)+c.height)*f,d*Math.cos(e))};
og.Ellipsoid.prototype.cartesianToLonLat=function(c){var d=c.z,e=c.x;c=c.y;var f=this._e2,g=this._e22,h=d*d+e*e,k=Math.sqrt(h),m=c*c,l=54*this._b2*m,n=h+(1-f)*m+f*(this._a2-this._b2),p=n*n,n=g*l*h/(p*n),n=Math.pow(1+n+Math.sqrt(n*(n+2)),.3333333333333333),l=l/(3*Math.pow(1+n+1/n,2)*p),g=Math.sqrt(1+2*g*l),h=k-f*(-(l*f*k)/1+g+Math.sqrt(.5*this._a2*(1+1/g)-l*(1-f)*m/(g*(1+g))-.5*l*h)),h=h*h,f=Math.sqrt(h+(1-f)*m);return new og.LonLat(Math.atan2(e,d)*og.math.DEGREES,Math.atan((c+this._b2*c/(this._a*
f)*this._k2)/k)*og.math.DEGREES,Math.sqrt(h+m)*(1-this._b2/(this._a*f)))};og.Ellipsoid.prototype.getSurfaceNormal3v=function(c){var d=this._invRadii2,e=c.x*d.x,f=c.y*d.y;c=c.z*d.z;d=1/Math.sqrt(e*e+f*f+c*c);return new og.math.Vector3(e*d,f*d,c*d)};og.Ellipsoid.prototype.getSurfaceHeight3v=function(c,d){var e=this._invRadii2,f=c.x*e.x,g=c.y*e.y,e=c.z*e.z,h=1/Math.sqrt(f*f+g*g+e*e);return new og.math.Vector3(c.x+d*f*h,c.y+d*g*h,c.z+d*e*h)};
og.Ellipsoid.prototype.getGreatCircleDistance=function(c,d){var e=(d.lat-c.lat)*og.math.RADIANS,f=(d.lon-c.lon)*og.math.RADIANS,e=Math.sin(e/2)*Math.sin(e/2)+Math.sin(f/2)*Math.sin(f/2)*Math.cos(c.lat*og.math.RADIANS)*Math.cos(d.lat*og.math.RADIANS);return 2*this._a*Math.atan2(Math.sqrt(e),Math.sqrt(1-e))};
og.Ellipsoid.prototype.getMiddlePointOnGreatCircle=function(c,d){var e=c.lat*og.math.RADIANS,f=d.lat*og.math.RADIANS,g=(d.lon-c.lon)*og.math.RADIANS,h=Math.cos(f)*Math.cos(g),g=Math.cos(f)*Math.sin(g);return new og.LonLat(((c.lon*og.math.RADIANS+Math.atan2(g,Math.cos(e)+h))*og.math.DEGREES+540)%360-180,Math.atan2(Math.sin(e)+Math.sin(f),Math.sqrt((Math.cos(e)+h)*(Math.cos(e)+h)+g*g))*og.math.DEGREES)};
og.Ellipsoid.prototype.getIntermediatePointOnGreatCircle=function(c,d,e){var f=c.lat*og.math.RADIANS,g=c.lon*og.math.RADIANS;c=d.lat*og.math.RADIANS;d=d.lon*og.math.RADIANS;var h=Math.cos(f),k=Math.cos(c),m=c-f,l=d-g,m=Math.sin(m/2)*Math.sin(m/2)+Math.cos(f)*Math.cos(c)*Math.sin(l/2)*Math.sin(l/2),l=2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)),m=Math.sin((1-e)*l)/Math.sin(l);e=Math.sin(e*l)/Math.sin(l);l=m*h*Math.cos(g)+e*k*Math.cos(d);g=m*h*Math.sin(g)+e*k*Math.sin(d);return new og.LonLat((Math.atan2(g,
l)*og.math.DEGREES+540)%360-180,Math.atan2(m*Math.sin(f)+e*Math.sin(c),Math.sqrt(l*l+g*g))*og.math.DEGREES)};og.Ellipsoid.prototype.getRhumbBearing=function(c,d){var e=(d.lon-c.lon)*og.math.RADIANS,f=Math.log(Math.tan(d.lat*og.math.RADIANS/2+Math.PI/4)/Math.tan(c.lat*og.math.RADIANS/2+Math.PI/4));Math.abs(e)>Math.PI&&(e=0<e?-1*(2*Math.PI-e):2*Math.PI+e);return(Math.atan2(e,f)*og.math.DEGREES+360)%360};
og.Ellipsoid.prototype.getInitialBearing=function(c,d){var e=c.lat*og.math.RADIANS,f=d.lat*og.math.RADIANS,g=(d.lon-c.lon)*og.math.RADIANS;return(Math.atan2(Math.sin(g)*Math.cos(f),Math.cos(e)*Math.sin(f)-Math.sin(e)*Math.cos(f)*Math.cos(g))*og.math.DEGREES+360)%360};og.Ellipsoid.prototype.getFinalBearing=function(c,d){return(this.getInitialBearing(d,c)+180)%360};
og.Ellipsoid.prototype.intersection=function(c,d,e,f){var g=c.lat*og.math.RADIANS;c=c.lon*og.math.RADIANS;var h=e.lat*og.math.RADIANS;e=e.lon*og.math.RADIANS;d*=og.math.RADIANS;f*=og.math.RADIANS;var k=h-g,m=e-c,k=2*Math.asin(Math.sqrt(Math.sin(k/2)*Math.sin(k/2)+Math.cos(g)*Math.cos(h)*Math.sin(m/2)*Math.sin(m/2)));if(0==k)return null;m=Math.acos((Math.sin(h)-Math.sin(g)*Math.cos(k))/(Math.sin(k)*Math.cos(g)));isNaN(m)&&(m=0);h=Math.acos((Math.sin(g)-Math.sin(h)*Math.cos(k))/(Math.sin(k)*Math.cos(h)));
m=(d-(0<Math.sin(e-c)?m:2*Math.PI-m)+Math.PI)%(2*Math.PI)-Math.PI;e=((0<Math.sin(e-c)?2*Math.PI-h:h)-f+Math.PI)%(2*Math.PI)-Math.PI;if(0==Math.sin(m)&&0==Math.sin(e)||0>Math.sin(m)*Math.sin(e))return null;e=Math.atan2(Math.sin(k)*Math.sin(m)*Math.sin(e),Math.cos(e)+Math.cos(m)*Math.cos(Math.acos(-Math.cos(m)*Math.cos(e)+Math.sin(m)*Math.sin(e)*Math.cos(k))));h=Math.asin(Math.sin(g)*Math.cos(e)+Math.cos(g)*Math.sin(e)*Math.cos(d));return new og.LonLat(((c+Math.atan2(Math.sin(d)*Math.sin(e)*Math.cos(g),
Math.cos(e)-Math.sin(g)*Math.sin(h)))*og.math.DEGREES+540)%360-180,h*og.math.DEGREES)};
og.Ellipsoid.prototype.hitRay=function(c,d){var e=this._invRadii.mul(c),f=this._invRadii.mul(d),g=e.dot(e),e=e.dot(f),h;if(1<g){if(0<=e)return null;var k=e*e,g=g-1,f=f.dot(f);h=f*g;return k<h?null:k>h?(e=-e+Math.sqrt(e*e-h),k=e/f,g/=e,k<g?c.add(d.scaleTo(k)):c.add(d.scaleTo(g))):c.add(d.scaleTo(Math.sqrt(g/f)))}return 1>g?(--g,f=f.dot(f),e=-e+Math.sqrt(e*e-f*g),c.add(d.scaleTo(e/f))):0>e?(f=f.dot(f),c.add(d.scaleTo(-e/f))):null};og.ellipsoid={};og.ellipsoid.wgs84=new og.Ellipsoid(6378137,6356752.3142);og.planetSegment.SegmentWGS84=function(c,d,e,f){this._isNorth=!1;og.inheritance.base(this,c,d,e,f);this._projection=og.proj.EPSG4326;this._extentMerc=new og.Extent(f.southWest.forwardMercatorEPS01(),f.northEast.forwardMercatorEPS01())};og.planetSegment.SegmentWGS84._heightLat=90-og.mercator.MAX_LAT;og.planetSegment.SegmentWGS84._maxPoleZoom=7;og.planetSegment.SegmentWGS84._pieceSize=og.planetSegment.SegmentWGS84._heightLat/Math.pow(2,og.planetSegment.SegmentWGS84._maxPoleZoom);
og.inheritance.extend(og.planetSegment.SegmentWGS84,og.planetSegment.Segment);og.planetSegment.SegmentWGS84.prototype.projectNative=function(c){return c};og.planetSegment.SegmentWGS84.prototype.getTerrainPoint=function(c,d){c.copy(this.planet.ellipsoid.hitRay(d,d.negateTo().normalize()));return d.distance(c)};
og.planetSegment.SegmentWGS84.prototype.acceptForRendering=function(c){var d=this.bsphere,e;e=this._extent.northEast.lat;0<e?(e=Math.floor((90-e)/og.planetSegment.SegmentWGS84._pieceSize),e=Math.floor(e/16)+7):(e=Math.floor((og.mercator.MIN_LAT-e)/og.planetSegment.SegmentWGS84._pieceSize),e=12-Math.floor(e/16));return c.projectedSize(d.center)>this.planet.RATIO_LOD*d.radius||this.tileZoom>e};
og.planetSegment.SegmentWGS84.prototype._assignTileIndexes=function(){var c=this._extent;this.tileX=Math.round(Math.abs(-180-c.southWest.lon)/(c.northEast.lon-c.southWest.lon));var d=c.northEast.lat;0<d?(this._isNorth=!0,this.tileY=Math.round((90-d)/(c.northEast.lat-c.southWest.lat))):this.tileY=Math.round((og.mercator.MIN_LAT-d)/(c.northEast.lat-c.southWest.lat))};
og.planetSegment.SegmentWGS84.prototype._addViewExtent=function(){var c=this._extent;if(this.planet._viewExtentWGS84){var d=this.planet._viewExtentWGS84;c.southWest.lon<d.southWest.lon&&(d.southWest.lon=c.southWest.lon);c.northEast.lon>d.northEast.lon&&(d.northEast.lon=c.northEast.lon);c.southWest.lat<d.southWest.lat&&(d.southWest.lat=c.southWest.lat);c.northEast.lat>d.northEast.lat&&(d.northEast.lat=c.northEast.lat)}else this.planet._viewExtentWGS84=new og.Extent(new og.LonLat(c.southWest.lon,c.southWest.lat),
new og.LonLat(c.northEast.lon,c.northEast.lat))};
og.planetSegment.SegmentWGS84.prototype.createPlainVertices=function(c){for(var d=0,e=this._extent,f=e.getWidth(),g=e.getHeight(),f=f/c,g=g/c,h=e.southWest.lon,k=e.northEast.lat,m=this.planet.ellipsoid._invRadii2,l=this.plainNormals=new Float32Array((c+1)*(c+1)*3),n=this.plainVertices,p=0;p<=c;p++)for(var q=0;q<=c;q++){var r=this.planet.ellipsoid.lonLatToCartesian(new og.LonLat(h+q*f,k-p*g)),t=r.x*m.x,u=r.y*m.y,B=r.z*m.z,v=1/Math.sqrt(t*t+u*u+B*B);n[d]=r.x;l[d++]=t*v;n[d]=r.y;l[d++]=u*v;n[d]=r.z;
l[d++]=B*v}this.normalMapVertices=n;this.normalMapNormals=l;this.normalMapTexture=this.planet.transparentTexture;this.tempVertices=this.terrainVertices=n;this._globalTextureCoordinates[0]=(e.southWest.lon+180)/360;this._globalTextureCoordinates[1]=(90-e.northEast.lat)/180;this._globalTextureCoordinates[2]=(e.northEast.lon+180)/360;this._globalTextureCoordinates[3]=(90-e.southWest.lat)/180};
og.planetSegment.SegmentWGS84.prototype.createBoundsByExtent=function(){for(var c=this.planet.ellipsoid,d=this._extent,e=og.math.MAX,f=og.math.MIN,g=og.math.MAX,h=og.math.MIN,k=og.math.MAX,m=og.math.MIN,d=[new og.LonLat(d.southWest.lon,d.southWest.lat),new og.LonLat(d.southWest.lon,d.northEast.lat),new og.LonLat(d.northEast.lon,d.northEast.lat),new og.LonLat(d.northEast.lon,d.southWest.lat)],l=0;l<d.length;l++){var n=c.lonLatToCartesian(d[l]),p=n.x,q=n.y,n=n.z;p<e&&(e=p);p>f&&(f=p);q<g&&(g=q);q>h&&
(h=q);n<k&&(k=n);n>m&&(m=n)}this.bsphere.setFromBounds([e,f,g,h,k,m])};og.planetSegment.SegmentWGS84.prototype._collectRenderNodes=function(){this._isNorth?this.planet._visibleNodesNorth[this.node.nodeId]=this.node:this.planet._visibleNodesSouth[this.node.nodeId]=this.node};og.planetSegment.SegmentWGS84.prototype.isEntityInside=function(c){return this._extent.isInside(c._lonlat)};
og.planetSegment.SegmentWGS84.prototype._getLayerExtentOffset=function(c){c=c._extent;var d=this._extent,e=c.northEast.lon-c.southWest.lon,f=c.northEast.lat-c.southWest.lat;return[(d.southWest.lon-c.southWest.lon)/e,(c.northEast.lat-d.northEast.lat)/f,(d.northEast.lon-d.southWest.lon)/e,(d.northEast.lat-d.southWest.lat)/f]};og.planetSegment.SegmentWGS84.prototype.layerOverlap=function(c){return this._extent.overlaps(c._extent)};og.planetSegment.SegmentWGS84.prototype._getDefaultTexture=function(){return this.planet.solidTextureTwo};
og.planetSegment.SegmentWGS84.prototype.getExtentMerc=function(){return this._extentMerc};og.utils.NormalMapCreator=function(c,d){this._handler=null;this._verticesBufferArray=[];this._indexBufferArray=[];this._framebuffer=this._positionBuffer=null;this._width=c||128;this._height=d||128;this._init()};
og.utils.NormalMapCreator.prototype._init=function(){var c=new og.shaderProgram.ShaderProgram("normalMapBlur",{attributes:{a_position:{type:og.shaderProgram.types.VEC2,enableArray:!0}},uniforms:{s_texture:{type:og.shaderProgram.types.SAMPLER2D}},vertexShader:"attribute vec2 a_position; \r\n                       attribute vec2 a_texCoord; \r\n                      \r\n                      varying vec2 blurCoordinates[5]; \r\n                      \r\n                      void main() { \r\n                          vec2 vt = a_position * 0.5 + 0.5;vt.y = 1.0 - vt.y; gl_Position = vec4(a_position, 0.0, 1.0); \r\n                          blurCoordinates[0] = vt; \r\n                          blurCoordinates[1] = vt + "+1/
this._width*1.407333+";blurCoordinates[2] = vt - "+1/this._height*1.407333+";blurCoordinates[3] = vt + "+1/this._width*3.294215+";blurCoordinates[4] = vt - "+1/this._height*3.294215+";}",fragmentShader:"#ifdef GL_ES\n\r\n                        #ifdef GL_FRAGMENT_PRECISION_HIGH\n\r\n                        precision highp float;\n\r\n                        #else\n\r\n                        precision mediump float;\n\r\n                        #endif // GL_FRAGMENT_PRECISION_HIGH\n\r\n                        #endif // GL_ES\n\r\n                        uniform sampler2D s_texture; \r\n                        \r\n                        varying vec2 blurCoordinates[5]; \r\n                        \r\n                        void main() { \r\n                            lowp vec4 sum = vec4(0.0); \r\n                            sum += texture2D(s_texture, blurCoordinates[0]) * 0.204164; \r\n                            sum += texture2D(s_texture, blurCoordinates[1]) * 0.304005; \r\n                            sum += texture2D(s_texture, blurCoordinates[2]) * 0.304005; \r\n                            sum += texture2D(s_texture, blurCoordinates[3]) * 0.093913; \r\n                            sum += texture2D(s_texture, blurCoordinates[4]) * 0.093913; \r\n                            gl_FragColor = sum; \r\n                        }"}),
d=new og.shaderProgram.ShaderProgram("normalMap",{attributes:{a_position:{type:og.shaderProgram.types.VEC2,enableArray:!0},a_normal:{type:og.shaderProgram.types.VEC3,enableArray:!0}},vertexShader:"attribute vec2 a_position; \r\n                      attribute vec3 a_normal; \r\n                      \r\n                      varying vec3 v_color; \r\n                      \r\n                      void main() { \r\n                          gl_PointSize = 1.0; \r\n                          gl_Position = vec4(a_position, 0, 1); \r\n                          v_color = normalize(a_normal) * 0.5 + 0.5; \r\n                      }",
fragmentShader:"#ifdef GL_ES\n\r\n                        #ifdef GL_FRAGMENT_PRECISION_HIGH\n\r\n                        precision highp float;\n\r\n                        #else\n\r\n                        precision mediump float;\n\r\n                        #endif // GL_FRAGMENT_PRECISION_HIGH\n\r\n                        #endif // GL_ES\n\r\n                        \r\n                        varying vec3 v_color; \r\n                        \r\n                        void main () { \r\n                            gl_FragColor = vec4(v_color, 1.0); \r\n                        }"});
this._handler=new og.webgl.Handler(null,{width:this._width,height:this._height,context:{alpha:!1,depth:!1}});this._handler.addShaderProgram(c);this._handler.addShaderProgram(d);this._handler.init();this._handler.deactivateFaceCulling();this._handler.deactivateDepthTest();this._framebuffer=new og.webgl.Framebuffer(this._handler,{useDepth:!1});for(c=1;6>=c;c++){for(var d=Math.pow(2,c),e=d/2,f=[],g=0;g<=d;g++)for(var h=0;h<=d;h++)f.push(-1+h/e,-1+g/e);this._verticesBufferArray[d]=this._handler.createArrayBuffer(new Float32Array(f),
2,f.length/2);e=og.PlanetSegmentHelper.createSegmentIndexes(d,[d,d,d,d]);this._indexBufferArray[d]=this._handler.createElementArrayBuffer(e,1,e.length)}c=new Float32Array([-1,-1,1,-1,-1,1,1,1]);this._positionBuffer=this._handler.createArrayBuffer(c,2,c.length/2)};
og.utils.NormalMapCreator.prototype._drawNormalMap=function(c){var d=c.length/3,e=Math.sqrt(d)-1;c=this._handler.createArrayBuffer(c,3,d);var d=this._framebuffer,f=this._handler.shaderPrograms.normalMap,g=this._handler.gl,h=f._program.attributes;f.activate();d.activate();g.bindBuffer(g.ARRAY_BUFFER,this._verticesBufferArray[e]);g.vertexAttribPointer(h.a_position._pName,this._verticesBufferArray[e].itemSize,g.FLOAT,!1,0,0);g.bindBuffer(g.ARRAY_BUFFER,c);g.vertexAttribPointer(h.a_normal._pName,c.itemSize,
g.FLOAT,!1,0,0);g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this._indexBufferArray[e]);g.drawElements(g.TRIANGLE_STRIP,this._indexBufferArray[e].numItems,g.UNSIGNED_SHORT,0);d.deactivate()};
og.utils.NormalMapCreator.prototype._drawBlur=function(){var c=this._handler.gl,d=this._handler.shaderPrograms.normalMapBlur,e=d._program.attributes,f=d._program.uniforms;d.activate();c.bindBuffer(c.ARRAY_BUFFER,this._positionBuffer);c.vertexAttribPointer(e.a_position._pName,this._positionBuffer.itemSize,c.FLOAT,!1,0,0);c.activeTexture(c.TEXTURE0);c.bindTexture(c.TEXTURE_2D,this._framebuffer.texture);c.uniform1i(f.s_texture._pName,0);c.drawArrays(c.TRIANGLE_STRIP,0,this._positionBuffer.numItems)};
og.utils.NormalMapCreator.prototype.draw=function(c){this._drawNormalMap(c);this._drawBlur();return this._handler.canvas};og.planetSegment.NormalMapCreatorQueue=function(c,d){og.inheritance.base(this,c,d);this.active=!0;this._counter=0;this._pendingsQueue=[]};og.inheritance.extend(og.planetSegment.NormalMapCreatorQueue,og.utils.NormalMapCreator);og.planetSegment.NormalMapCreatorQueue.prototype.shift=function(c){if(this.active||0<c.tileZoom)c._inTheQueue=!0,1<=this._counter?this._pendingsQueue.unshift(c):this._exec(c)};
og.planetSegment.NormalMapCreatorQueue.prototype.queue=function(c){if(this.active||0<c.tileZoom)c._inTheQueue=!0,1<=this._counter?this._pendingsQueue.push(c):this._exec(c)};og.planetSegment.NormalMapCreatorQueue.prototype._exec=function(c){this._counter++;var d=this;setTimeout(function(){c.createNormalMapTexture();c._inTheQueue=!1;d._dequeueRequest()},0)};
og.planetSegment.NormalMapCreatorQueue.prototype._dequeueRequest=function(){this._counter--;if(this._pendingsQueue.length&&1>this._counter){var c;(c=this._whilePendings())&&this._exec(c)}};og.planetSegment.NormalMapCreatorQueue.prototype._whilePendings=function(){for(;this._pendingsQueue.length;){var c=this._pendingsQueue.pop();if(c.terrainReady&&c._inTheQueue&&c.node.getState()!==og.quadTree.NOTRENDERING)return c;c._inTheQueue=!1}return null};og.scene.Planet=function(c,d){og.inheritance.base(this,c);this.ellipsoid=d||og.ellipsoid.wgs84;this._planetRadius2=this.ellipsoid.getPolarSize()*this.ellipsoid.getPolarSize();this.layers=[];this.visibleTileLayers=[];this._visibleTileLayerSlices=[];this.visibleVectorLayers=[];this._frustumEntityCollections=[];this.camera=this.terrainProvider=this.baseLayer=null;this.mousePositionOnEarth=new og.math.Vector3;this.normalMapCreator=this.defaultTexture=this.transparentTexture=this.emptyTexture=null;this.minCurrZoom=
og.math.MAX;this.maxCurrZoom=og.math.MIN;this._viewExtentMerc=this._viewExtentWGS84=null;this._createdNodesCount=0;this._renderedNodes=[];this._visibleNodes={};this._visibleNodesNorth={};this._visibleNodesSouth={};this.layersActivity=!0;this._tcolorArr=[];this._heightFactor=1;this._indexesBuffers=[];this._currentDistanceFromPixel=0;this._viewChanged=!0;this._specularTexture=this._nightTexture=this._quadTreeSouth=this._quadTreeNorth=this._quadTree=null;this._useSpecularTexture=this._useNightTexture=
!0;this.SLICE_SIZE=5;this.SLICE_SIZE_4=4*this.SLICE_SIZE;this.SLICE_SIZE_3=3*this.SLICE_SIZE;this.RATIO_LOD=1.12;this._diffuseMaterialArr=new Float32Array(this.SLICE_SIZE_3+3);this._ambientMaterialArr=new Float32Array(this.SLICE_SIZE_3+3);this._specularMaterialArr=new Float32Array(this.SLICE_SIZE_4+4);this._tileOffsetArr=new Float32Array(this.SLICE_SIZE_4);this._visibleExtentOffsetArr=new Float32Array(this.SLICE_SIZE_4);this._transparentColorArr=new Float32Array(this.SLICE_SIZE_4);this._pickingColorArr=
new Float32Array(this.SLICE_SIZE_3);this._samplerArr=Array(this.SLICE_SIZE);this._geoImageCreator=null;this.events.registerNames(og.scene.Planet.EVENT_NAMES)};og.inheritance.extend(og.scene.Planet,og.scene.RenderNode);og.scene.Planet.MAX_NODES=250;og.scene.Planet.EVENT_NAMES=["draw","layeradd","baselayerchange","layerremove","layervisibilitychange"];og.scene.Planet.prototype.getLayerByName=function(c){for(var d=this.layers.length;d--;)if(this.layers[d].name===c)return this.layers[d]};
og.scene.Planet.prototype.addLayer=function(c){c.addTo(this)};og.scene.Planet.prototype._onLayerVisibilityChanged=function(c){this.events.dispatch(this.events.layervisibilitychange,c)};og.scene.Planet.prototype.addLayers=function(c){for(var d=0;d<c.length;d++)this.addLayer(c[d])};og.scene.Planet.prototype.removeLayer=function(c){return c.remove()};
og.scene.Planet.prototype._clearLayerMaterial=function(c){var d=c._id;this._quadTree.traverseTree(function(c){c=c.planetSegment.materials;c[d]&&(c[d].clear(),c[d]=null)})};og.scene.Planet.prototype.getLayers=function(){return this.layers};
og.scene.Planet.prototype.setBaseLayer=function(c){this.baseLayer?this.baseLayer.isEqual(c)||(this.baseLayer.setVisibility(!1),this.baseLayer=c,c.setVisibility(!0),this.events.dispatch(this.events.baselayerchange,c)):(this.baseLayer=c,this.baseLayer.setVisibility(!0),this.events.dispatch(this.events.baselayerchange,c))};og.scene.Planet.prototype.setHeightFactor=function(c){this._heightFactor!==c&&(this._heightFactor=c,this._quadTree.reloadTerrain())};og.scene.Planet.prototype.getHeightFactor=function(){return this._heightFactor};
og.scene.Planet.prototype.setTerrainProvider=function(c){this.terrainProvider=c};og.scene.Planet.prototype._initializeShaders=function(){this.renderer.handler.addShaderProgram(og.shaderProgram.drawnode_nl(),!0);this.renderer.handler.addShaderProgram(og.shaderProgram.drawnode_wl(),!0)};
og.scene.Planet.prototype.initialization=function(){og.PlanetSegmentHelper.initIndexesTables(6);for(var c=0;6>=c;c++){var d=Math.pow(2,c);!this._indexesBuffers[d]&&(this._indexesBuffers[d]=[]);for(var e=0;6>=e;e++){var f=Math.pow(2,e);!this._indexesBuffers[d][f]&&(this._indexesBuffers[d][f]=[]);for(var g=0;6>=g;g++){var h=Math.pow(2,g);!this._indexesBuffers[d][f][h]&&(this._indexesBuffers[d][f][h]=[]);for(var k=0;6>=k;k++){var m=Math.pow(2,k);!this._indexesBuffers[d][f][h][m]&&(this._indexesBuffers[d][f][h][m]=
[]);for(var l=0;6>=l;l++){var n=Math.pow(2,l);!this._indexesBuffers[d][f][h][m][n]&&(this._indexesBuffers[d][f][h][m][n]=[]);var p=og.PlanetSegmentHelper.createSegmentIndexes(d,[f,h,m,n]);this._indexesBuffers[d][f][h][m][n]=this.renderer.handler.createElementArrayBuffer(p,1,p.length)}}}}}var q=this;this.renderer.handler.createDefaultTexture(null,function(c){q.solidTextureOne=c;q.solidTextureTwo=c});this.transparentTexture=this.renderer.handler.transparentTexture;this.camera=this.renderer.activeCamera=
new og.PlanetCamera(this,{eye:new og.math.Vector3(0,0,28E6),look:new og.math.Vector3(0,0,0),up:new og.math.Vector3(0,1,0)});this._quadTree=new og.quadTree.QuadNode(og.planetSegment.Segment,this,og.quadTree.NW,null,0,0,og.Extent.createFromArray([-2.003750834E7,-2.003750834E7,2.003750834E7,2.003750834E7]));this._quadTreeNorth=new og.quadTree.QuadNode(og.planetSegment.SegmentWGS84,this,og.quadTree.NW,null,0,0,og.Extent.createFromArray([-180,og.mercator.MAX_LAT,180,90]));this._quadTreeSouth=new og.quadTree.QuadNode(og.planetSegment.SegmentWGS84,
this,og.quadTree.NW,null,0,0,og.Extent.createFromArray([-180,-90,180,og.mercator.MIN_LAT]));this.drawMode=this.renderer.handler.gl.TRIANGLE_STRIP;this._initializeShaders();this.updateVisibleLayers();this.renderer.activeCamera.events.on("viewchange",this,function(c){this._viewChanged=!0});this.renderer.events.on("mousemove",this,function(c){this._viewChanged=!0});this.renderer.events.on("touchmove",this,function(c){this._viewChanged=!0});this.normalMapCreator=new og.planetSegment.NormalMapCreatorQueue(128,
128);q=this;this.renderer.events.on("charkeypress",this,function(){q.memClear()},og.input.KEY_C);this.renderer.addPickingCallback(this,this._frustumEntityCollectionPickingCallback);this._useNightTexture&&(c=new Image,c.onload=function(){q._nightTexture=q.renderer.handler.createTexture_af(this)},c.src=og.RESOURCES_URL+"night.png");this._useSpecularTexture&&(c=new Image,c.onload=function(){q._specularTexture=q.renderer.handler.createTexture_af(this)},c.src=og.RESOURCES_URL+"spec.png");this._geoImageCreator=
new og.utils.GeoImageCreator(this.renderer.handler);this._preRender()};og.scene.Planet.prototype._preRender=function(){this._quadTree.traverseNodes();this._quadTree.renderNode();this._quadTree.nodes[og.quadTree.NW].renderNode();this._quadTree.nodes[og.quadTree.NE].renderNode();this._quadTree.nodes[og.quadTree.SW].renderNode();this._quadTree.nodes[og.quadTree.SE].renderNode()};
og.scene.Planet.prototype.createDefaultTextures=function(c,d){this.renderer.handler.gl.deleteTexture(this.solidTextureOne);this.renderer.handler.gl.deleteTexture(this.solidTextureTwo);var e=this;this.renderer.handler.createDefaultTexture(c,function(c){e.solidTextureOne=c});this.renderer.handler.createDefaultTexture(d,function(c){e.solidTextureTwo=c})};
og.scene.Planet.prototype.updateAttributionsList=function(){for(var c="",d=0;d<this.layers.length;d++){var e=this.layers[d];e._visibility&&e._attribution.length&&(c+="<li>"+e._attribution+"</li>")}this.renderer&&(c.length?(this.renderer.div.attributions.style.display="block",this.renderer.div.attributions.innerHTML="<ul>"+c+"</ul>"):(this.renderer.div.attributions.style.display="none",this.renderer.div.attributions.innerHTML=""))};
og.scene.Planet.prototype.updateVisibleLayers=function(){this.visibleTileLayers=[];this.visibleTileLayers.length=0;this.visibleVectorLayers=[];this.visibleVectorLayers.length=0;for(var c="",d=0;d<this.layers.length;d++){var e=this.layers[d];e._visibility&&(e._isBaseLayer&&(this.baseLayer=e),e instanceof og.layer.XYZ||e instanceof og.layer.WMS||e instanceof og.layer.CanvasTiles||e instanceof og.layer.BaseGeoImage?this.visibleTileLayers.push(e):e instanceof og.layer.Vector&&this.visibleVectorLayers.push(e),
e._attribution.length&&(c+="<li>"+e._attribution+"</li>"))}this.renderer&&(c.length?(this.renderer.div.attributions.style.display="block",this.renderer.div.attributions.innerHTML="<ul>"+c+"</ul>"):(this.renderer.div.attributions.style.display="none",this.renderer.div.attributions.innerHTML=""));this._sortLayers()};
og.scene.Planet.prototype._sortLayers=function(){this.visibleVectorLayers.sort(function(c,d){return c._zIndex-d._zIndex||c._height-d._height});if(this.visibleTileLayers.length){this.visibleTileLayers.sort(function(c,d){return c._height-d._height||c._zIndex-d._zIndex});this._visibleTileLayerSlices=[];this._visibleTileLayerSlices.length=0;for(var c=-1,d=this.visibleTileLayers[0]._height,e=0;e<this.visibleTileLayers.length;e++){if(0===e%this.SLICE_SIZE||this.visibleTileLayers[e]._height!==d)c++,this._visibleTileLayerSlices[c]=
[],d=this.visibleTileLayers[e]._height;this._visibleTileLayerSlices[c].push(this.visibleTileLayers[e])}}};
og.scene.Planet.prototype._collectRenderNodes=function(){this._renderedNodes.length=0;this._renderedNodes=[];this._viewExtentMerc=this._viewExtentWGS84=null;this._visibleNodes={};this._visibleNodesNorth={};this._visibleNodesSouth={};this._frustumEntityCollections.length=0;this._frustumEntityCollections=[];this.minCurrZoom=og.math.MAX;this.maxCurrZoom=og.math.MIN;this._quadTreeNorth.renderTree();this._quadTreeSouth.renderTree();this._quadTree.renderTree()};
og.scene.Planet.prototype.frame=function(){this.events.dispatch(this.events.draw,this);this._collectRenderNodes();this.renderer.activeCamera.prepareFrame();this.transformLights();this._rendering();this._geoImageCreator.frame();var c=this;this._createdNodesCount>og.scene.Planet.MAX_NODES&&(setTimeout(function(){c.memClear()},0),c._createdNodesCount=0)};og.scene.Planet.prototype._rendering=function(){this._renderNodesPASS();this._renderVectorLayersPASS()};
og.scene.Planet.prototype._renderNodesPASS=function(){var c,d=this.renderer,e=d.handler,f=e.gl;f.blendEquation(f.FUNC_ADD);f.blendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA);f.enable(f.BLEND);this.lightEnabled?(e.shaderPrograms.drawnode_wl.activate(),c=e.shaderPrograms.drawnode_wl._program,shu=c.uniforms,f.uniform4fv(shu.lightsPositions._pName,this._lightsTransformedPositions),f.uniformMatrix3fv(shu.normalMatrix._pName,!1,d.activeCamera._normalMatrix._m),f.uniformMatrix4fv(shu.viewMatrix._pName,!1,d.activeCamera._viewMatrix._m),
f.uniformMatrix4fv(shu.projectionMatrix._pName,!1,d.activeCamera._projectionMatrix._m),f.activeTexture(f.TEXTURE0+this.SLICE_SIZE+3),f.bindTexture(f.TEXTURE_2D,this._nightTexture||this.transparentTexture),f.uniform1i(shu.nightTexture._pName,this.SLICE_SIZE+3),f.activeTexture(f.TEXTURE0+this.SLICE_SIZE+4),f.bindTexture(f.TEXTURE_2D,this._specularTexture||this.transparentTexture),f.uniform1i(shu.specularTexture._pName,this.SLICE_SIZE+4),this._diffuseMaterialArr[0]=this.baseLayer.diffuse.x,this._diffuseMaterialArr[1]=
this.baseLayer.diffuse.y,this._diffuseMaterialArr[2]=this.baseLayer.diffuse.z,this._ambientMaterialArr[0]=this.baseLayer.ambient.x,this._ambientMaterialArr[1]=this.baseLayer.ambient.y,this._ambientMaterialArr[2]=this.baseLayer.ambient.z,this._specularMaterialArr[0]=this.baseLayer.specular.x,this._specularMaterialArr[1]=this.baseLayer.specular.y,this._specularMaterialArr[2]=this.baseLayer.specular.z,this._specularMaterialArr[3]=this.baseLayer.shininess):(e.shaderPrograms.drawnode_nl.activate(),c=e.shaderPrograms.drawnode_nl._program,
f.uniformMatrix4fv(c.uniforms.projectionViewMatrix._pName,!1,d.activeCamera._projectionViewMatrix._m));e.gl.uniform3fv(c.uniforms.cameraPosition._pName,d.activeCamera.eye.toVec());for(var d=this._renderedNodes,e=this._visibleTileLayerSlices,g=d.length;g--;)d[g].planetSegment._renderBase(c,e[0]);f.enable(f.POLYGON_OFFSET_FILL);for(j=1;j<e.length;j++)for(g=d.length,f.polygonOffset(0,-j);g--;)d[g].planetSegment._renderOverlay(c,e[j]);f.disable(f.POLYGON_OFFSET_FILL);f.disable(f.BLEND)};
og.scene.Planet.prototype._renderVectorLayersPASS=function(){for(var c=this.visibleVectorLayers.length;c--;){var d=this.visibleVectorLayers[c];d._collectVisibleCollections(this._frustumEntityCollections);d.events.dispatch(d.events.draw,d)}this.drawEntityCollections(this._frustumEntityCollections)};og.scene.Planet.prototype._frustumEntityCollectionPickingCallback=function(){this.drawPickingEntityCollections(this._frustumEntityCollections)};
og.scene.Planet.prototype.memClear=function(){this._quadTree.clearTree();this._quadTreeNorth.clearTree();this._quadTreeSouth.clearTree()};og.scene.Planet.prototype.getRayIntersectionEllipsoid=function(c){return this.ellipsoid.hitRay(c.origin,c.direction)};og.scene.Planet.prototype.getCartesianFromPixelEllipsoid=function(c){var d=this.renderer.activeCamera;return this.ellipsoid.hitRay(d.eye,d.unproject(c.x,c.y))};
og.scene.Planet.prototype.getLonLatFromPixelEllipsoid=function(c){return(c=this.getCartesianFromPixelEllipsoid(c))?this.ellipsoid.cartesianToLonLat(c):null};og.scene.Planet.prototype.getCartesianFromMouseTerrain=function(c){var d=this.renderer.events.mouseState;return(c=this.getDistanceFromPixel(d,c))?d.direction.scaleTo(c).addA(this.renderer.activeCamera.eye):null};
og.scene.Planet.prototype.getCartesianFromPixelTerrain=function(c,d){var e=this.getDistanceFromPixel(c,d);return e?this.renderer.activeCamera.unproject(c.x,c.y).scaleTo(e).addA(this.renderer.activeCamera.eye):null};og.scene.Planet.prototype.getLonLatFromPixelTerrain=function(c,d){var e=this.getCartesianFromPixelTerrain(c,d);return e?this.ellipsoid.cartesianToLonLat(e):null};og.scene.Planet.prototype.getPixelFromCartesian=function(c){return this.renderer.activeCamera.project(c)};
og.scene.Planet.prototype.getPixelFromLonLat=function(c){return(c=this.ellipsoid.lonLatToCartesian(c))?this.renderer.activeCamera.project(c):null};og.scene.Planet.prototype.getDistanceFromPixelEllipsoid=function(c){return(c=this.getCartesianFromPixelEllipsoid(c))?c.distance(this.renderer.activeCamera.eye):null};
og.scene.Planet.prototype.getDistanceFromPixel=function(c,d){if(this._viewChanged||d){this._viewChanged=!1;var e=this.renderer.handler.canvas,e=og.math.Vector4.fromVec(this.renderer.sceneFrameBuffer.readPixel(c.x/e.width,(e.height-c.y)/e.height,2));if(!(e.x|e.y|e.z|e.w))return this._currentDistanceFromPixel=this.getDistanceFromPixelEllipsoid(c);e.w=0;this._currentDistanceFromPixel=og.math.coder.decodeFloatFromRGBA(e)}return this._currentDistanceFromPixel};og.scene.Planet.prototype.viewExtent=function(c){this.renderer.activeCamera.viewExtent(c)};
og.scene.Planet.prototype.viewExtentArr=function(c){this.renderer.activeCamera.viewExtent(new og.Extent(new og.LonLat(c[0],c[1]),new og.LonLat(c[2],c[3])))};
og.scene.Planet.prototype.getViewExtent=function(){if(this._viewExtentMerc){var c=this._viewExtentMerc.northEast.inverseMercator(),d=this._viewExtentMerc.southWest.inverseMercator();if(this._viewExtentWGS84){var e=this._viewExtentWGS84;e.northEast.lon>c.lon&&(c.lon=e.northEast.lon);e.northEast.lat>c.lat&&(c.lat=e.northEast.lat);e.southWest.lon<d.lon&&(d.lon=e.southWest.lon);e.southWest.lat<d.lat&&(d.lat=e.southWest.lat)}return new og.Extent(d,c)}if(this._viewExtentWGS84)return this._viewExtentWGS84};
og.scene.Planet.prototype.viewLonLat=function(c,d){this.renderer.activeCamera.setLonLat(c,d)};og.scene.Planet.prototype.flyExtent=function(c,d){this.renderer.activeCamera.flyExtent(c,d)};og.scene.Planet.prototype.flyCartesian=function(c,d,e){this.renderer.activeCamera.flyCartesian(c,d,e)};og.scene.Planet.prototype.flyLonLat=function(c,d,e){this.renderer.activeCamera.flyLonLat(c,d,e)};og.scene.Planet.prototype.stopFlying=function(){this.renderer.activeCamera.stopFlying()};
og.scene.Planet.prototype.updateBillboardsTexCoords=function(){for(var c=0;c<this.entityCollections.length;c++)this.entityCollections[c].billboardHandler.refreshTexCoordsArr();for(var d={},c=0;c<this.layers.length;c++){var e=this.layers[c];e instanceof og.layer.Vector&&e.each(function(c){c._entityCollection&&!d[c._entityCollection.id]&&(c._entityCollection.billboardHandler.refreshTexCoordsArr(),d[c._entityCollection.id]=!0)})}};og.control.SimpleNavigation=function(c){og.inheritance.base(this,c);this.camera=null;this.speed=10};og.inheritance.extend(og.control.SimpleNavigation,og.control.BaseControl);
og.control.SimpleNavigation.prototype.oninit=function(){this.camera=this.renderer.activeCamera;this.renderer.events.on("keypress",this,this.onCameraMoveForward,og.input.KEY_W);this.renderer.events.on("keypress",this,this.onCameraMoveBackward,og.input.KEY_S);this.renderer.events.on("keypress",this,this.onCameraStrifeLeft,og.input.KEY_A);this.renderer.events.on("keypress",this,this.onCameraStrifeRight,og.input.KEY_D);this.renderer.events.on("keypress",this,this.onCameraLookUp,og.input.KEY_UP);this.renderer.events.on("keypress",
this,this.onCameraLookDown,og.input.KEY_DOWN);this.renderer.events.on("keypress",this,this.onCameraTurnLeft,og.input.KEY_LEFT);this.renderer.events.on("keypress",this,this.onCameraTurnRight,og.input.KEY_RIGHT);this.renderer.events.on("keypress",this,this.onCameraRollLeft,og.input.KEY_Q);this.renderer.events.on("keypress",this,this.onCameraRollRight,og.input.KEY_E)};og.control.SimpleNavigation.prototype.onCameraMoveForward=function(c){c=this.camera;c.slide(0,0,-this.speed);c.update()};
og.control.SimpleNavigation.prototype.onCameraMoveBackward=function(c){c=this.camera;c.slide(0,0,this.speed);c.update()};og.control.SimpleNavigation.prototype.onCameraStrifeLeft=function(c){c=this.camera;c.slide(-this.speed,0,0);c.update()};og.control.SimpleNavigation.prototype.onCameraStrifeRight=function(c){c=this.camera;c.slide(this.speed,0,0);c.update()};og.control.SimpleNavigation.prototype.onCameraLookUp=function(c){c=this.camera;c.pitch(.5);c.update()};
og.control.SimpleNavigation.prototype.onCameraLookDown=function(c){c=this.camera;c.pitch(-.5);c.update()};og.control.SimpleNavigation.prototype.onCameraTurnLeft=function(c){c=this.camera;c.yaw(.5);c.update()};og.control.SimpleNavigation.prototype.onCameraTurnRight=function(c){c=this.camera;c.yaw(-.5);c.update()};og.control.SimpleNavigation.prototype.onCameraRollLeft=function(c){c=this.camera;c.roll(-.5);c.update()};
og.control.SimpleNavigation.prototype.onCameraRollRight=function(c){c=this.camera;c.roll(.5);c.update()};og.control.ZoomControl=function(c){og.inheritance.base(this,c);this.distDiff=.33;this.stepsCount=5;this.stepsForward=null;this.stepIndex=0;this.planet=null};og.inheritance.extend(og.control.ZoomControl,og.control.BaseControl);og.control.zoomControl=function(c){return new og.control.ZoomControl(c)};
og.control.ZoomControl.prototype.oninit=function(){var c=document.createElement("div"),d=document.createElement("button"),e=document.createElement("button");c.className="ogZoomControl";d.className="ogZoomButton ogZoomIn";e.className="ogZoomButton ogZoomOut";c.appendChild(d);c.appendChild(e);this.renderer.div.appendChild(c);var f=this;d.onclick=function(c){f.zoomIn()};e.onclick=function(c){f.zoomOut()};this.planet=this.renderer.renderNodes.Earth;this.renderer.events.on("draw",this,this._draw)};
og.control.ZoomControl.prototype.zoomIn=function(){this._deactivate=!0;this.planet.normalMapCreator.active=!1;this.planet.terrainProvider.active=!1;this.planet.layersActivity=!1;this.stepIndex=this.stepsCount;this.stepsForward=og.control.MouseNavigation.getMovePointsFromPixelTerrain(this.renderer.activeCamera,this.planet,this.stepsCount,1.7*this.distDiff,this.renderer.getCenter(),!0,this.renderer.activeCamera._n.negateTo())};
og.control.ZoomControl.prototype.zoomOut=function(){this._deactivate=!0;this.planet.normalMapCreator.active=!1;this.planet.terrainProvider.active=!1;this.planet.layersActivity=!1;this.stepIndex=this.stepsCount;this.stepsForward=og.control.MouseNavigation.getMovePointsFromPixelTerrain(this.renderer.activeCamera,this.planet,this.stepsCount,2*this.distDiff,this.renderer.getCenter(),!1,this.renderer.activeCamera._n.negateTo())};
og.control.ZoomControl.prototype._draw=function(c){c=this.renderer.activeCamera;if(this.stepIndex){var d=this.stepsForward[this.stepsCount-this.stepIndex--];c.eye=d.eye;c._v=d.v;c._u=d.u;c._n=d.n;c.update()}else!c._flying&&this._deactivate&&(this.planet.normalMapCreator.active=!0,this.planet.terrainProvider.active=!0,this.planet.layersActivity=!0,this._deactivate=!1)};og.layer.GeoTexture2d=function(c,d){og.inheritance.base(this,c,d);this._sourceTexture=d.texture||null;d.texture&&(this._sourceCreated=this._sourceReady=!0);this._frameWidth=d.frameWidth?og.math.nextHighestPowerOfTwo(d.frameWidth):256;this._frameHeight=d.frameHeight?og.math.nextHighestPowerOfTwo(d.frameHeight):256;this._animate=!0};og.inheritance.extend(og.layer.GeoTexture2d,og.layer.BaseGeoImage);og.layer.GeoTexture2d.prototype.loadMaterial=function(c){this._planet._geoImageCreator.add(this)};
og.layer.GeoTexture2d.prototype.bindTexture=function(c){this._sourceCreated=this._sourceReady=!0;this._sourceTexture=c};og.layer.GeoTexture2d.prototype.setSize=function(c,d){this._frameWidth=c;this._frameHeight=d;this._frameCreated=!1};og.layer.GeoTexture2d.prototype.abortMaterialLoading=function(c){this._creationProceeding=!1;c.isLoading=!1;c.isReady=!1};
og.layer.GeoTexture2d.prototype._renderingProjType1=function(){var c=this._planet,d=c.renderer.handler,e=d.gl,c=c._geoImageCreator;this._refreshFrame&&this._createFrame();var f=c._framebuffer;f.setSize(this._frameWidth,this._frameHeight);f.activate();d.shaderPrograms.geoImageTransform.activate();var d=d.shaderPrograms.geoImageTransform._program,g=d.attributes,h=d.uniforms,k=this.transparentColor[0],m=this.transparentColor[1],l=this.transparentColor[2];e.disable(e.CULL_FACE);f.bindOutputTexture(this._materialTexture);
e.clearColor(k,m,l,0);e.clear(e.COLOR_BUFFER_BIT);e.bindBuffer(e.ARRAY_BUFFER,c._texCoordsBuffer);e.vertexAttribPointer(g.texCoords._pName,c._texCoordsBuffer.itemSize,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,this._gridBuffer);e.vertexAttribPointer(g.corners._pName,this._gridBuffer.itemSize,e.FLOAT,!1,0,0);e.uniform4fv(h.extentParams._pName,this._extentMercParams);e.activeTexture(e.TEXTURE0);e.bindTexture(e.TEXTURE_2D,this._sourceTexture);e.uniform1i(h.sourceTexture._pName,0);d.drawIndexBuffer(e.TRIANGLE_STRIP,
c._indexBuffer);f.deactivate();e.enable(e.CULL_FACE);this._ready=!0;this._creationProceeding=!1};
og.layer.GeoTexture2d.prototype._renderingProjType0=function(){var c=this._planet,d=c.renderer.handler,e=d.gl,c=c._geoImageCreator,f=this._frameWidth,g=this._frameHeight;this._refreshFrame&&this._createFrame();var h=c._framebuffer;h.setSize(f,g);h.activate();d.shaderPrograms.geoImageTransform.activate();var d=d.shaderPrograms.geoImageTransform._program,f=d.attributes,g=d.uniforms,k=this.transparentColor[0],m=this.transparentColor[1],l=this.transparentColor[2];e.disable(e.CULL_FACE);h.bindOutputTexture(this._materialTexture);
e.clearColor(k,m,l,0);e.clear(e.COLOR_BUFFER_BIT);e.bindBuffer(e.ARRAY_BUFFER,c._texCoordsBuffer);e.vertexAttribPointer(f.texCoords._pName,c._texCoordsBuffer.itemSize,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,this._gridBuffer);e.vertexAttribPointer(f.corners._pName,this._gridBuffer.itemSize,e.FLOAT,!1,0,0);e.uniform4fv(g.extentParams._pName,this._extentWgs84Params);e.activeTexture(e.TEXTURE0);e.bindTexture(e.TEXTURE_2D,this._sourceTexture);e.uniform1i(g.sourceTexture._pName,0);d.drawIndexBuffer(e.TRIANGLE_STRIP,
c._indexBuffer);h.deactivate();e.enable(e.CULL_FACE);this._ready=!0;this._creationProceeding=!1};og.PointCloud=function(c){c=c||{};this.id=og.PointCloud.__staticId++;this.visibility=void 0!=c.visibility?c.visibility:!0;this.pointSize=c.pointSize||3;this.pickingDistance=c.pickingDistance||0;this._entity=this._renderNode=null;this._points=[];this._coordinatesData=[];this._colorData=[];this._pickingColorData=[];this._handler=this._pickingColorBuffer=this._colorBuffer=this._coordinatesBuffer=null;this._handlerIndex=-1;this._buffersUpdateCallbacks=[];this._buffersUpdateCallbacks[og.PointCloud.COORDINATES_BUFFER]=
this._createCoordinatesBuffer;this._buffersUpdateCallbacks[og.PointCloud.COLOR_BUFFER]=this._createColorBuffer;this._buffersUpdateCallbacks[og.PointCloud.PICKING_COLOR_BUFFER]=this._createPickingColorBuffer;this._changedBuffers=Array(this._buffersUpdateCallbacks.length);this.setPoints(c.points)};og.PointCloud.COORDINATES_BUFFER=0;og.PointCloud.COLOR_BUFFER=1;og.PointCloud.PICKING_COLOR_BUFFER=2;og.PointCloud.__staticId=0;
og.PointCloud.prototype.clear=function(){this._points.length=0;this._points=[];this._coordinatesData.length=0;this._coordinatesData=[];this._colorData.length=0;this._colorData=[];this._pickingColorData.length=0;this._pickingColorData=[];this._deleteBuffers()};og.PointCloud.prototype.setOpacity=function(c){this.opacity=c};og.PointCloud.prototype.setVisibility=function(c){this.visibility=c};og.PointCloud.prototype.getVisibility=function(){return this.visibility};
og.PointCloud.prototype.setRenderNode=function(c){this._renderNode=c;this._setPickingColors()};og.PointCloud.prototype.remove=function(){this._entity=null;this._handler&&this._handler.remove(this)};
og.PointCloud.prototype.setPoints=function(c){this.clear();for(var d=0;d<c.length;d++){var e=c[d],f=new og.math.Vector3(e[0],e[1],e[2]),g=new og.math.Vector4(e[3],e[4],e[5],void 0==e[6]?255:e[6]);this._coordinatesData.push(f.x,f.y,f.z);this._colorData.push(g.x/255,g.y/255,g.z/255,g.w/255);e={_pickingColor:new og.math.Vector3,_entityCollection:this._entity&&this._entity._entityCollection,index:d,position:f,color:g,pointCloud:this,properties:e[7]||{}};this._points.push(e);this._renderNode&&(this._renderNode.renderer.assignPickingColor(e),
this._pickingColorData.push(e._pickingColor.x/255,e._pickingColor.y/255,e._pickingColor.z/255,1))}this._changedBuffers[og.PointCloud.COORDINATES_BUFFER]=!0;this._changedBuffers[og.PointCloud.COLOR_BUFFER]=!0;this._changedBuffers[og.PointCloud.PICKING_COLOR_BUFFER]=!0};og.PointCloud.prototype.setPointPosition=function(c,d,e,f){this._changedBuffers[og.PointCloud.COORDINATES_BUFFER]=!0};og.PointCloud.prototype.setPointColor=function(c,d,e,f,g){this._changedBuffers[og.PointCloud.COLOR_BUFFER]=!0};
og.PointCloud.prototype.addPoints=function(c){this._changedBuffers[og.PointCloud.COORDINATES_BUFFER]=!0;this._changedBuffers[og.PointCloud.COLOR_BUFFER]=!0;this._changedBuffers[og.PointCloud.PICKING_COLOR_BUFFER]=!0};og.PointCloud.prototype.addPoint=function(c,d){this._changedBuffers[og.PointCloud.COORDINATES_BUFFER]=!0;this._changedBuffers[og.PointCloud.COLOR_BUFFER]=!0;this._changedBuffers[og.PointCloud.PICKING_COLOR_BUFFER]=!0};og.PointCloud.prototype.getPoint=function(c){return this._points[c]};
og.PointCloud.prototype.removePoint=function(c){this._changedBuffers[og.PointCloud.COORDINATES_BUFFER]=!0;this._changedBuffers[og.PointCloud.COLOR_BUFFER]=!0;this._changedBuffers[og.PointCloud.PICKING_COLOR_BUFFER]=!0};og.PointCloud.prototype.insertPoint=function(c,d){this._changedBuffers[og.PointCloud.COORDINATES_BUFFER]=!0;this._changedBuffers[og.PointCloud.COLOR_BUFFER]=!0;this._changedBuffers[og.PointCloud.PICKING_COLOR_BUFFER]=!0};
og.PointCloud.prototype.each=function(c){for(var d=this._points.length;d--;)c&&c(this._points[d])};
og.PointCloud.prototype.draw=function(){if(this.visibility&&this._coordinatesData.length){this._update();var c=this._renderNode.renderer,d=c.handler.shaderPrograms.pointCloud,e=d._program,f=c.handler.gl,g=e.attributes,e=e.uniforms;d.activate();f.uniformMatrix4fv(e.projectionViewMatrix._pName,!1,c.activeCamera._projectionViewMatrix._m);f.uniform1f(e.opacity._pName,this._handler._entityCollection._animatedOpacity);f.uniform1f(e.pointSize._pName,this.pointSize);f.bindBuffer(f.ARRAY_BUFFER,this._coordinatesBuffer);
f.vertexAttribPointer(g.coordinates._pName,this._coordinatesBuffer.itemSize,f.FLOAT,!1,0,0);f.bindBuffer(f.ARRAY_BUFFER,this._colorBuffer);f.vertexAttribPointer(g.colors._pName,this._colorBuffer.itemSize,f.FLOAT,!1,0,0);f.drawArrays(f.POINTS,0,this._coordinatesBuffer.numItems)}};
og.PointCloud.prototype.drawPicking=function(){if(this.visibility&&this._coordinatesData.length){var c=this._renderNode.renderer,d=c.handler.shaderPrograms.pointCloud,e=d._program,f=c.handler.gl,g=e.attributes,e=e.uniforms;d.activate();f.uniformMatrix4fv(e.projectionViewMatrix._pName,!1,c.activeCamera._projectionViewMatrix._m);f.uniform1f(e.opacity._pName,this._handler._entityCollection._animatedOpacity);f.uniform1f(e.pointSize._pName,this.pointSize+this.pickingDistance);f.bindBuffer(f.ARRAY_BUFFER,
this._coordinatesBuffer);f.vertexAttribPointer(g.coordinates._pName,this._coordinatesBuffer.itemSize,f.FLOAT,!1,0,0);f.bindBuffer(f.ARRAY_BUFFER,this._pickingColorBuffer);f.vertexAttribPointer(g.colors._pName,this._pickingColorBuffer.itemSize,f.FLOAT,!1,0,0);f.drawArrays(f.POINTS,0,this._coordinatesBuffer.numItems)}};
og.PointCloud.prototype._update=function(){if(this._renderNode)for(var c=this._changedBuffers.length;c--;)this._changedBuffers[c]&&(this._buffersUpdateCallbacks[c].call(this),this._changedBuffers[c]=!1)};og.PointCloud.prototype._deleteBuffers=function(){if(this._renderNode){var c=this._renderNode.renderer.handler.gl;c.deleteBuffer(this._coordinatesBuffer);c.deleteBuffer(this._colorBuffer);c.deleteBuffer(this._pickingColorBuffer)}this._pickingColorBuffer=this._colorBuffer=this._coordinatesBuffer=null};
og.PointCloud.prototype._createCoordinatesBuffer=function(){var c=this._renderNode.renderer.handler;c.gl.deleteBuffer(this._coordinatesBuffer);this._coordinatesBuffer=c.createArrayBuffer(new Float32Array(this._coordinatesData),3,this._coordinatesData.length/3)};og.PointCloud.prototype._createColorBuffer=function(){var c=this._renderNode.renderer.handler;c.gl.deleteBuffer(this._colorBuffer);this._colorBuffer=c.createArrayBuffer(new Float32Array(this._colorData),4,this._colorData.length/4)};
og.PointCloud.prototype._createPickingColorBuffer=function(){var c=this._renderNode.renderer.handler;c.gl.deleteBuffer(this._pickingColorBuffer);this._pickingColorBuffer=c.createArrayBuffer(new Float32Array(this._pickingColorData),4,this._pickingColorData.length/4)};
og.PointCloud.prototype._setPickingColors=function(){if(this._renderNode){for(var c=0;c<this._points.length;c++){var d=this._points[c];d._entity=this._entity;d._entityCollection=this._entity._entityCollection;this._renderNode.renderer.assignPickingColor(d);this._pickingColorData.push(d._pickingColor.x/255,d._pickingColor.y/255,d._pickingColor.z/255,1)}this._changedBuffers[og.PointCloud.PICKING_COLOR_BUFFER]=!0}};og.terrainProvider={};og.terrainProvider.EmptyTerrainProvider=function(){this.name="empty";this.maxZoom=this.minZoom=50;this.gridSizeByZoom=[32,16,16,8,4,4,4,4,2,2,2,2,2,2,2,2,2,2,2,2,2];this.fileGridSize=2};og.terrainProvider.EmptyTerrainProvider.prototype.handleSegmentTerrain=function(c){c.terrainIsLoading=!1;c.terrainReady=!0;c.terrainExists=!0};og.control.LoadingSpinner=function(c){og.inheritance.base(this,c);this.spinnerElement=null};og.inheritance.extend(og.control.LoadingSpinner,og.control.BaseControl);
og.control.LoadingSpinner.prototype.oninit=function(){this.spinnerElement=document.createElement("div");this.spinnerElement.id="circleG";var c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("div");this.spinnerElement.appendChild(c);this.spinnerElement.appendChild(d);this.spinnerElement.appendChild(e);c.id="circleG_1";c.className="circleG";d.id="circleG_2";d.className="circleG";e.id="circleG_3";e.className="circleG";this.spinnerElement.className="displayBlock";
document.body.appendChild(this.spinnerElement);this.renderer.events.on("draw",this,this.draw)};og.control.LoadingSpinner.prototype.draw=function(){for(var c=!1,d=this.renderer.renderNodes.Earth,e=d.layers,f=0;f<e.length;)if(0!=e[f++].counter){c=!0;break}this.spinnerElement.className=0!=d.terrainProvider.counter||c?"displayBlock":"displayNone"};og.Billboard=function(c){c=c||{};og.inheritance.base(this,c);this._src=c.src||null;this._image=c.image||null;this._width=c.width||(c.size?c.size.x:0);this._height=c.height||(c.size?c.size.y:0)};og.inheritance.extend(og.Billboard,og.BaseBillboard);
og.Billboard.prototype.setSrc=function(c){this._src=c;var d=this._handler;if(d&&c){var e=d._entityCollection.renderNode;if(e){var f=e.billboardsTextureAtlas,g=this;f.loadImage(c,function(c){f.nodes[c.__nodeIndex]?(g._image=c,d.setTexCoordArr(g._handlerIndex,f.nodes[g._image.__nodeIndex].texCoords)):(f.addImage(c),f.createTexture(),g._image=c,e.updateBillboardsTexCoords())})}}};og.Billboard.prototype.setImage=function(c){this.setSrc(c.src)};
og.Billboard.prototype.setSize=function(c,d){this._width=c;this._height=d;this._handler&&this._handler.setSizeArr(this._handlerIndex,c*this._scale,d*this._scale)};og.Billboard.prototype.getSize=function(){return{width:this._width,height:this._height}};og.Billboard.prototype.setWidth=function(c){this.setSize(c,this._height)};og.Billboard.prototype.getWidth=function(){return this._width};og.Billboard.prototype.setHeight=function(c){this.setSize(this._width,c)};og.Billboard.prototype.getHeight=function(){return this._height};og.LineString=function(c){c=c||{};this.id=og.LineString.__staticId++;this.thickness=c.thickness||1.5;this.color=og.utils.createColorRGBA(c.color,new og.math.Vector4(1,1,1,1));this.visibility=void 0!=c.visibility?c.visibility:!0;this._path=[];this._pathLonLat=[];this._pathLonLatMerc=[];this._indexBuffer=this._orderBuffer=this._mainBuffer=this._indexData=this._orderData=this._mainData=null;this._pickingColor=[0,0,0];this._handler=this._entity=this._renderNode=null;this._handlerIndex=-1;this._buffersUpdateCallbacks=
[];this._buffersUpdateCallbacks[og.LineString.MAIN_BUFFER]=this._createMainBuffer;this._buffersUpdateCallbacks[og.LineString.INDEX_BUFFER]=this._createIndexBuffer;this._changedBuffers=Array(this._buffersUpdateCallbacks.length);c.pathLonLat?this.setPathLonLat(c.pathLonLat):c.path&&this.setPath(c.path)};og.LineString.MAIN_BUFFER=0;og.LineString.INDEX_BUFFER=1;og.LineString.__staticId=0;
og.LineString.prototype.clear=function(){this._path.length=0;this._path=[];this._pathLonLat.length=0;this._pathLonLat=[];this._pathLonLatMerc.length=0;this._pathLonLatMerc=[];this._mainData.length=0;this._orderData.length=0;this._indexData.length=0;this._indexData=this._orderData=this._mainData=null;this._deleteBuffers()};og.LineString.prototype.setColor=function(c,d,e,f){this.color.x=c;this.color.y=d;this.color.z=e;f&&(this.color.w=f)};
og.LineString.prototype.setColor3v=function(c){this.color.x=c.x;this.color.y=c.y;this.color.z=c.z};og.LineString.prototype.setColor4v=function(c){this.color.x=c.x;this.color.y=c.y;this.color.z=c.z;this.color.w=c.w};og.LineString.prototype.setOpacity=function(c){this.color.w=c};og.LineString.prototype.setThickness=function(c){this.thickness=c};og.LineString.prototype.getThickness=function(){return this.thickness};og.LineString.prototype.setVisibility=function(c){this.visibility=c};
og.LineString.prototype.getVisibility=function(){return this.visibility};og.LineString.prototype.setRenderNode=function(c){this._renderNode=c;this._createData3v()};og.LineString.prototype.remove=function(){this._entity=null;this._handler&&this._handler.remove(this)};og.LineString.prototype.setPickingColor3v=function(c){this._pickingColor[0]=c.x/255;this._pickingColor[1]=c.y/255;this._pickingColor[2]=c.z/255};og.LineString.prototype.getPath=function(){return this._path};
og.LineString.prototype.setPath=function(c){if(this._renderNode){var d=this._path;if(c.length===d.length){for(var e=c[0],f=c[1],g=e[0]+e[0]-f[0],h=e[1]+e[1]-f[1],k=e[2]+e[2]-f[2],m=c.length-1,l=this._mainData,n=0,p=0;n<m;n++,p+=36){e=c[n];f=c[n+1];l[p]=e[0];l[p+1]=e[1];l[p+2]=e[2];l[p+3]=g;l[p+4]=h;l[p+5]=k;l[p+6]=f[0];l[p+7]=f[1];l[p+8]=f[2];l[p+9]=e[0];l[p+10]=e[1];l[p+11]=e[2];l[p+12]=g;l[p+13]=h;l[p+14]=k;l[p+15]=f[0];l[p+16]=f[1];l[p+17]=f[2];g=e[0];h=e[1];k=e[2];d[n].set(g,h,k);var q=c[n+2],
r,t;q?(r=q[0],t=q[1],q=q[2]):(r=f[0]+f[0]-e[0],t=f[1]+f[1]-e[1],q=f[2]+f[2]-e[2]);l[p+18]=f[0];l[p+19]=f[1];l[p+20]=f[2];l[p+21]=e[0];l[p+22]=e[1];l[p+23]=e[2];l[p+24]=r;l[p+25]=t;l[p+26]=q;l[p+27]=f[0];l[p+28]=f[1];l[p+29]=f[2];l[p+30]=e[0];l[p+31]=e[1];l[p+32]=e[2];l[p+33]=r;l[p+34]=t;l[p+35]=q}this._path[m].set(c[m][0],c[m][1],c[m][2]);this._changedBuffers[og.LineString.MAIN_BUFFER]=!0}else this._createDataArr(c)}else for(n=0;n<c.length;n++)d=c[n],this._path[n]=new og.math.Vector3(d[0],d[1],d[2])};
og.LineString.prototype.setPoint3v=function(c,d){var e=this._path.length;if(0<=c&&c<e&&this._renderNode){var f,g,h,k,m=d.x,l=d.y,n=d.z,p=this._mainData,q=this._path[c];q.x=m;q.y=l;q.z=n;if(g=this._renderNode.ellipsoid)q=g.cartesianToLonLat(q),this._pathLonLat[f]=q,Math.abs(q.lat)<og.mercator.MAX_LAT&&(this._pathLonLatMerc[f]=q.forwardMercator());q=36*c;if(0===c||1===c)f=this._path[0],g=this._path[1],h=f.x+f.x-g.x,k=f.y+f.y-g.y,f=f.z+f.z-g.z,p[3]=h,p[4]=k,p[5]=f,p[12]=h,p[13]=k,p[14]=f;c==e-2?(f=this._path[e-
2],g=this._path[e-1],e=g.x+g.x-f.x,h=g.y+g.y-f.y,f=g.z+g.z-f.z,p[q+24]=e,p[q+25]=h,p[q+26]=f,p[q+33]=e,p[q+34]=h,p[q+35]=f):c===e-1&&(f=this._path[e-2],g=this._path[e-1],e=g.x+g.x-f.x,h=g.y+g.y-f.y,f=g.z+g.z-f.z,p[q-12]=e,p[q-11]=h,p[q-10]=f,p[q-3]=e,p[q-2]=h,p[q-1]=f);g=[0,21,39];for(f=0;3>f;f++)if(e=q+g[f],e<p.length)p[e]=m,p[e+1]=l,p[e+2]=n,p[e+9]=m,p[e+10]=l,p[e+11]=n;else break;g=[-18,-30,-48];for(f=0;3>f;f++)if(e=q+g[f],0<=e)p[e]=m,p[e+1]=l,p[e+2]=n,p[e+9]=m,p[e+10]=l,p[e+11]=n;else break;this._changedBuffers[og.LineString.MAIN_BUFFER]=
!0}};og.LineString.prototype.getPoint=function(c){return this._path[c]};og.LineString.prototype.removePoint=function(c){};og.LineString.prototype.insertPoint=function(c,d){};
og.LineString.prototype._createDataArr=function(c){var d=this._renderNode.ellipsoid,e=c.length-1;this._path=[];this._mainData=[];this._orderData=[];this._indexData=[];for(var f=c[0],g=c[1],h=f[0]+f[0]-g[0],k=f[1]+f[1]-g[1],m=f[2]+f[2]-g[2],l=0,n=0;l<e;l++){f=c[l];g=c[l+1];this._mainData.push(f[0],f[1],f[2],h,k,m,g[0],g[1],g[2]);this._mainData.push(f[0],f[1],f[2],h,k,m,g[0],g[1],g[2]);h=f[0];k=f[1];m=f[2];this._path[l]=new og.math.Vector3(h,k,m);if(d){var p=d.cartesianToLonLat(this._path[l]);this._pathLonLat[l]=
p;Math.abs(p.lat)<og.mercator.MAX_LAT&&(this._pathLonLatMerc[l]=p.forwardMercator())}var q=c[l+2],r;q?(p=q[0],r=q[1],q=q[2],this._indexData.push(n,++n,++n,++n,n,n,++n)):(p=g[0]+g[0]-f[0],r=g[1]+g[1]-f[1],q=g[2]+g[2]-f[2],this._indexData.push(n,++n,++n,++n));this._mainData.push(g[0],g[1],g[2],f[0],f[1],f[2],p,r,q);this._mainData.push(g[0],g[1],g[2],f[0],f[1],f[2],p,r,q);this._orderData.push(-1,1,-1,-1,1,-1,1,1)}this._path[e]=og.math.Vector3.fromVec(c[e]);this._changedBuffers[og.LineString.MAIN_BUFFER]=
!0;this._changedBuffers[og.LineString.INDEX_BUFFER]=!0};
og.LineString.prototype._createData3v=function(){var c=this._path,d=this._renderNode.ellipsoid,e=c.length-1;this._mainData=[];this._orderData=[];this._indexData=[];for(var f=c[0],g=c[1],h=f.x+f.x-g.x,k=f.y+f.y-g.y,m=f.z+f.z-g.z,l=0,n=0;l<e;l++){f=c[l];g=c[l+1];this._mainData.push(f.x,f.y,f.z,h,k,m,g.x,g.y,g.z);this._mainData.push(f.x,f.y,f.z,h,k,m,g.x,g.y,g.z);h=f.x;k=f.y;m=f.z;if(d){var p=d.cartesianToLonLat(this._path[l]);this._pathLonLat[l]=p;Math.abs(p.lat)<og.mercator.MAX_LAT&&(this._pathLonLatMerc[l]=
p.forwardMercator())}var q=c[l+2],r;q?(p=q.x,r=q.y,q=q.z,this._indexData.push(n,++n,++n,++n,n,n,++n)):(p=g.x+g.x-f.x,r=g.y+g.y-f.y,q=g.z+g.z-f.z,this._indexData.push(n,++n,++n,++n));this._mainData.push(g.x,g.y,g.z,f.x,f.y,f.z,p,r,q);this._mainData.push(g.x,g.y,g.z,f.x,f.y,f.z,p,r,q);this._orderData.push(-1,1,-1,-1,1,-1,1,1)}this._changedBuffers[og.LineString.MAIN_BUFFER]=!0;this._changedBuffers[og.LineString.INDEX_BUFFER]=!0};
og.LineString.prototype.draw=function(){if(this.visibility&&this._path.length){this._update();var c=this._renderNode,d=c.renderer,e=d.handler.shaderPrograms.lineString,f=e._program,g=d.handler.gl,h=f.attributes,f=f.uniforms;e.activate();g.uniformMatrix4fv(f.proj._pName,!1,d.activeCamera._projectionMatrix._m);g.uniformMatrix4fv(f.view._pName,!1,d.activeCamera._viewMatrix._m);g.uniform2fv(f.viewport._pName,[d.handler.canvas.width,d.handler.canvas.height]);g.uniform1f(f.thickness._pName,.5*this.thickness);
g.uniform4fv(f.color._pName,[this.color.x,this.color.y,this.color.z,this.color.w]);g.uniform2fv(f.uFloatParams._pName,[c._planetRadius2||0,d.activeCamera._tanViewAngle_hradOneByHeight]);g.uniform3fv(f.uCamPos._pName,d.activeCamera.eye.toVec());g.uniform3fv(f.pickingColor._pName,this._pickingColor);c=this._mainBuffer;g.bindBuffer(g.ARRAY_BUFFER,c);g.vertexAttribPointer(h.current._pName,c.itemSize,g.FLOAT,!1,36,0);g.vertexAttribPointer(h.prev._pName,c.itemSize,g.FLOAT,!1,36,12);g.vertexAttribPointer(h.next._pName,
c.itemSize,g.FLOAT,!1,36,24);g.bindBuffer(g.ARRAY_BUFFER,this._orderBuffer);g.vertexAttribPointer(h.order._pName,this._orderBuffer.itemSize,g.FLOAT,!1,0,0);g.disable(g.CULL_FACE);g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this._indexBuffer);g.drawElements(d.handler.gl.TRIANGLE_STRIP,this._indexBuffer.numItems,g.UNSIGNED_SHORT,0);g.enable(g.CULL_FACE)}};
og.LineString.prototype._update=function(){if(this._renderNode)for(var c=this._changedBuffers.length;c--;)this._changedBuffers[c]&&(this._buffersUpdateCallbacks[c].call(this),this._changedBuffers[c]=!1)};og.LineString.prototype._deleteBuffers=function(){var c=this._renderNode.renderer.handler.gl;c.deleteBuffer(this._mainBuffer);c.deleteBuffer(this._orderBuffer);c.deleteBuffer(this._indexBuffer);this._indexBuffer=this._orderBuffer=this._mainBuffer=null};
og.LineString.prototype._createMainBuffer=function(){var c=this._renderNode.renderer.handler;c.gl.deleteBuffer(this._mainBuffer);this._mainBuffer=c.createArrayBuffer(new Float32Array(this._mainData),3,this._mainData.length/9)};
og.LineString.prototype._createIndexBuffer=function(){var c=this._renderNode.renderer.handler;c.gl.deleteBuffer(this._orderBuffer);c.gl.deleteBuffer(this._indexBuffer);this._orderBuffer=c.createArrayBuffer(new Float32Array(this._orderData),2,this._orderData.length/2);this._indexBuffer=c.createElementArrayBuffer(new Uint16Array(this._indexData),1,this._indexData.length)};og.Entity=function(c,d){c=c||{};this.id=og.Entity.__staticCounter++;this.properties=d||{};this.properties.name=this.properties.name||"noname";this.childrenNodes=[];this.parent=null;this._cartesian=og.utils.createVector3(c.cartesian);this._lonlat=og.utils.createLonLat(c.lonlat);this._lonlatMerc=null;this._altitude=c.altitude||0;this._visibility=void 0!=c.visibility?c.visibility:!0;this._entityCollection=null;this._entityCollectionIndex=-1;this._vectorLayer=null;this._vectorLayerIndex=-1;this._pickingColor=
new og.math.Vector3(0,0,0);this._featureConstructorArray={billboard:[og.Billboard,this.setBillboard],label:[og.Label,this.setLabel],sphere:[og.shape.Sphere,this.setShape],box:[og.shape.Box,this.setShape],lineString:[og.LineString,this.setLineString],pointCloud:[og.PointCloud,this.setPointCloud]};this.billboard=this._createOptionFeature("billboard",c.billboard);this.label=this._createOptionFeature("label",c.label);this.shape=this._createOptionFeature("sphere",c.sphere||c.box);this.lineString=this._createOptionFeature("lineString",
c.lineString);this.pointCloud=this._createOptionFeature("pointCloud",c.pointCloud)};og.entity=function(c,d){return new og.Entity(c,d)};og.Entity.__staticCounter=0;og.Entity.prototype._createOptionFeature=function(c,d){if(d){var e=this._featureConstructorArray[c];return e[1].call(this,new e[0](d))}return null};og.Entity.prototype.addTo=function(c){c.add(this);return this};og.Entity.prototype.remove=function(){this._vectorLayer&&this._vectorLayer.removeEntity(this);this._entityCollection&&this._entityCollection.removeEntity(this)};
og.Entity.prototype.setVisibility=function(c){this._visibility=c;this.billboard&&this.billboard.setVisibility(c);this.label&&this.label.setVisibility(c);this.shape&&this.shape.setVisibility(c);this.lineString&&this.lineString.setVisibility(c);for(var d=0;d<this.childrenNodes.length;d++)this.childrenNodes[d].setVisibility(c)};og.Entity.prototype.getVisibility=function(){return this._visibility};og.Entity.prototype.setCartesian3v=function(c){this.setCartesian(c.x,c.y,c.z)};
og.Entity.prototype.setCartesian=function(c,d,e){var f=this._cartesian;f.x=c;f.y=d;f.z=e;this.billboard&&this.billboard.setPosition3v(f);this.label&&this.label.setPosition3v(f);this.shape&&this.shape.setPosition3v(f);for(f=0;f<this.childrenNodes.length;f++)this.childrenNodes[f].setCartesian(c,d,e);(c=this._entityCollection)&&c.events.dispatch(c.events.entitymove,this)};
og.Entity.prototype._setCartesian3vSilent=function(c){var d=this._cartesian;d.x=c.x;d.y=c.y;d.z=c.z;this.billboard&&this.billboard.setPosition3v(d);this.label&&this.label.setPosition3v(d);this.shape&&this.shape.setPosition3v(d);for(c=0;c<this.childrenNodes.length;c++)this.childrenNodes[c].setCartesian(x,y,z)};og.Entity.prototype.getLonLat=function(){var c=this._entityCollectio;if(c&&c.renderNode&&c.renderNode.ellipsoid)return this._lonlat=c.renderNode.ellipsoid.cartesianToLonLat(lonlat)};
og.Entity.prototype.setLonLat=function(c){var d=this._lonlat;d.lon=c.lon;d.lat=c.lat;d.height=c.height;(d=this._entityCollection)&&d.renderNode&&d.renderNode.ellipsoid&&(this._lonlatMerc=Math.abs(c.lat)<og.mercator.MAX_LAT?c.forwardMercator():null,this._cartesian=d.renderNode.ellipsoid.lonLatToCartesian(c),this.setCartesian3v(this._cartesian))};og.Entity.prototype.setAltitude=function(c){this._altitude=c};og.Entity.prototype.getCartesian=function(){return this._cartesian};
og.Entity.prototype.setBillboard=function(c){this.billboard&&this.billboard.remove();this.billboard=c;this.billboard._entity=this;this.billboard.setPosition3v(this._cartesian);this.billboard.setVisibility(this._visibility);this._entityCollection&&this._entityCollection._billboardHandler.add(c);return c};
og.Entity.prototype.setLabel=function(c){this.label&&this.label.remove();this.label=c;this.label._entity=this;this.label.setPosition3v(this._cartesian);this.label.setVisibility(this._visibility);this._entityCollection&&this._entityCollection._labelHandler.add(c);return c};
og.Entity.prototype.setShape=function(c){this.shape&&this.shape.remove();this.shape=c;this.shape._entity=this;this.shape.setPosition3v(this._cartesian);this.shape.setVisibility(this._visibility);this._entityCollection&&this._entityCollection._shapeHandler.add(c);return c};
og.Entity.prototype.setLineString=function(c){this.lineString&&this.lineString.remove();this.lineString=c;this.lineString._entity=this;this.lineString.setVisibility(this._visibility);this._entityCollection&&this._entityCollection._lineStringHandler.add(c);return c};
og.Entity.prototype.setPointCloud=function(c){this.pointCloud&&this.pointCloud.remove();this.pointCloud=c;this.pointCloud._entity=this;this.pointCloud.setVisibility(this._visibility);this._entityCollection&&this._entityCollection._pointCloudHandler.add(c);return c};og.Entity.prototype.appendChild=function(c){c._entityCollection=this._entityCollection;c._pickingColor=this._pickingColor;c.parent=this;this.childrenNodes.push(c);this._entityCollection&&this._entityCollection._addRecursively(c)};
og.Entity.prototype.setPickingColor=function(){var c=this._pickingColor;this.billboard&&this.billboard.setPickingColor3v(c);this.label&&this.label.setPickingColor3v(c);this.shape&&this.shape.setPickingColor3v(c);this.lineString&&this.lineString.setPickingColor3v(c);for(c=0;c<this.childrenNodes.length;c++)this.childrenNodes[c].setPickingColor()};var EntityCollectionQuadNodeWGS84={};og.quadTree.EntityCollectionQuadNode=function(c,d,e,f,g,h,k){this.layer=c;this.parentNode=e;this.childrenNodes=[];this.partId=d;this.nodeId=d+f;this.state=null;this.extent=g;this.count=0;this.deferredEntities=[];this.entityCollection=null;this.zoom=k;this._inTheQueue=!1;this.bsphere=new og.bv.Sphere;h&&this._setExtentBounds()};
og.quadTree.EntityCollectionQuadNode.prototype.insertEntity=function(c,d,e){var f=this._setLonLat(c);if(d||f&&this.extent.isInside(f))this.count++,this.count>this.layer._maxCountPerCollection?(d=this.childrenNodes,d.length?d[og.quadTree.NW].extent.isInside(f)?d[og.quadTree.NW].insertEntity(c,!0,e):d[og.quadTree.NE].extent.isInside(f)?d[og.quadTree.NE].insertEntity(c,!0,e):d[og.quadTree.SW].extent.isInside(f)?d[og.quadTree.SW].insertEntity(c,!0,e):d[og.quadTree.SE].extent.isInside(f)&&d[og.quadTree.SE].insertEntity(c,
!0,e):(f=this.entityCollection.getEntities(),f.push(c),this.entityCollection.events.clear(),this.entityCollection.clear(),this.entityCollection=null,this.buildTree(f,e))):this._addEntitiesToCollection([c],e)};
og.quadTree.EntityCollectionQuadNode.prototype._addEntitiesToCollection=function(c,d){if(c.length){var e=this.layer,f=e._planet,g=this.entityCollection;g||(g=new og.EntityCollection,g._layer=this.layer,g.addTo(f,!0),g._quadNode=this,e._bindEventsDefault(g),this.entityCollection=g);d?this.entityCollection.addEntities(c):this.deferredEntities.push.apply(this.deferredEntities,c)}};
og.quadTree.EntityCollectionQuadNode.prototype._setExtentBounds=function(){this.nodeId?this.bsphere.setFromExtent(this.layer._planet.ellipsoid,this.extent.inverseMercator()):(this.bsphere.radius=this.layer._planet.ellipsoid._a,this.bsphere.center=new og.math.Vector3)};
og.quadTree.EntityCollectionQuadNode.prototype._setLonLat=function(c){c._lonlat||(c._lonlat=this.layer._planet.ellipsoid.cartesianToLonLat(c._cartesian));c._lonlatMerc=Math.abs(c._lonlat.lat)<og.mercator.MAX_LAT?c._lonlat.forwardMercator():null;return c._lonlatMerc};
og.quadTree.EntityCollectionQuadNode.prototype.buildTree=function(c,d){this.count=c.length;if(c.length>this.layer._maxCountPerCollection||this.zoom<this.layer.minZoom||this.zoom<this.layer._minTreeZoom){var e=this.childrenNodes;e.length||this.createChildrenNodes();for(var f=[],g=[],h=[],k=[],m=c.length;m--;){var l=c[m],n=this._setLonLat(l);n&&(e[og.quadTree.NW].extent.isInside(n)?(l._nodePtr=e[og.quadTree.NW],f.push(l)):e[og.quadTree.NE].extent.isInside(n)?(l._nodePtr=e[og.quadTree.NE],g.push(l)):
e[og.quadTree.SW].extent.isInside(n)?(l._nodePtr=e[og.quadTree.SW],h.push(l)):e[og.quadTree.SE].extent.isInside(n)&&(l._nodePtr=e[og.quadTree.SE],k.push(l)))}f.length&&e[og.quadTree.NW].buildTree(f,d);g.length&&e[og.quadTree.NE].buildTree(g,d);h.length&&e[og.quadTree.SW].buildTree(h,d);k.length&&e[og.quadTree.SE].buildTree(k,d)}else this._addEntitiesToCollection(c,d)};
og.quadTree.EntityCollectionQuadNode.prototype.createChildrenNodes=function(){var c=this.layer,d=this.extent,e=.5*d.getWidth(),f=.5*d.getHeight(),g=d.northEast,d=d.southWest,h=4*this.nodeId+1,k=new og.LonLat(d.lon+e,d.lat+f),m=this.childrenNodes,l=this.layer._planet,n=this.zoom+1;m[og.quadTree.NW]=new og.quadTree.EntityCollectionQuadNode(c,og.quadTree.NW,this,h,new og.Extent(new og.LonLat(d.lon,d.lat+f),new og.LonLat(d.lon+e,g.lat)),l,n);m[og.quadTree.NE]=new og.quadTree.EntityCollectionQuadNode(c,
og.quadTree.NE,this,h,new og.Extent(k,new og.LonLat(g.lon,g.lat)),l,n);m[og.quadTree.SW]=new og.quadTree.EntityCollectionQuadNode(c,og.quadTree.SW,this,h,new og.Extent(new og.LonLat(d.lon,d.lat),k),l,n);m[og.quadTree.SE]=new og.quadTree.EntityCollectionQuadNode(c,og.quadTree.SE,this,h,new og.Extent(new og.LonLat(d.lon+e,d.lat),new og.LonLat(g.lon,d.lat+f)),l,n)};
og.quadTree.EntityCollectionQuadNode.prototype.collectRenderCollections=function(c,d){var e=c[this.nodeId];if(e){var f=this.childrenNodes;this.entityCollection?this.renderCollection(d,c):f.length&&(e.state===og.quadTree.RENDERING?this.layer._secondPASS.push(this):(f[og.quadTree.NW].collectRenderCollections(c,d),f[og.quadTree.NE].collectRenderCollections(c,d),f[og.quadTree.SW].collectRenderCollections(c,d),f[og.quadTree.SE].collectRenderCollections(c,d)))}};
og.quadTree.EntityCollectionQuadNode.prototype.collectRenderCollectionsPASS2=function(c,d,e){var f=this.layer._planet,g=f.renderer.activeCamera;0<this.count&&g.eye.distance(this.bsphere.center)-this.bsphere.radius<og.quadTree.QuadNode.VISIBLE_DISTANCE*Math.sqrt(g._lonLat.height)&&0<f.renderer.activeCamera.frustum.containsSphere(this.bsphere)&&(f=this.childrenNodes,this.entityCollection?this.renderCollection(d,c,e):f.length&&(f[og.quadTree.NW].collectRenderCollectionsPASS2(c,d,e),f[og.quadTree.NE].collectRenderCollectionsPASS2(c,
d,e),f[og.quadTree.SW].collectRenderCollectionsPASS2(c,d,e),f[og.quadTree.SE].collectRenderCollectionsPASS2(c,d,e)))};og.quadTree.EntityCollectionQuadNode.prototype.applyCollection=function(){this.entityCollection.addEntities(this.deferredEntities);this.deferredEntities.length=0;this.deferredEntities=[];this._inTheQueue=!1};
og.quadTree.EntityCollectionQuadNode.prototype.traverseTree=function(c){var d=this.childrenNodes;this.entityCollection?c(this):d.length&&(d[og.quadTree.NW].traverseTree(c),d[og.quadTree.NE].traverseTree(c),d[og.quadTree.SW].traverseTree(c),d[og.quadTree.SE].traverseTree(c))};
og.quadTree.EntityCollectionQuadNode.prototype.renderCollection=function(c,d,e){this.layer._renderingNodes[this.nodeId]=!0;this.deferredEntities.length&&!this._inTheQueue&&(this.layer.async?this.layer._queueDeferredNode(this):this.applyCollection());var f=this.entityCollection;f._animatedOpacity=this.layer.opacity;f.scaleByDistance=this.layer.scaleByDistance;c.push(this.entityCollection);if(this.layer.groundAlign)if(c=f._entities,f=c.length,d[this.nodeId]&&d[this.nodeId].state===og.quadTree.RENDERING)for(;f--;){var g=
c[f];g._lonlat.height||this.alignEntityToTheGround(g,d[this.nodeId].planetSegment)}else if(e)for(;f--;)g=c[f],g._lonlat.height||this.alignEntityToTheGround(g,d[e].planetSegment);else for(d=this.layer._planet._renderedNodes;f--;)if(g=c[f],!g._lonlat.height)for(e=d.length;e--;)if(d[e].planetSegment.isEntityInside(g)){this.alignEntityToTheGround(g,d[e].planetSegment);break}};
og.quadTree.EntityCollectionQuadNode.prototype.alignEntityToTheGround=function(c,d){d.getEntityTerrainPoint(c,c._cartesian);c._setCartesian3vSilent(c._cartesian.addA(c._cartesian.normal().scale(c._altitude||.1)))};og.quadTree.EntityCollectionQuadNode.prototype.isVisible=function(){return this.layer._renderingNodes[this.nodeId]?!0:!1};og.quadTree.EntityCollectionQuadNodeWGS84=function(c,d,e,f,g,h,k){og.inheritance.base(this,c,d,e,f,g,h,k);this.isNorth=!1};
og.inheritance.extend(og.quadTree.EntityCollectionQuadNodeWGS84,og.quadTree.EntityCollectionQuadNode);og.quadTree.EntityCollectionQuadNodeWGS84.prototype._setExtentBounds=function(){0<this.extent.northEast.lat&&(this.isNorth=!0);this.bsphere.setFromExtent(this.layer._planet.ellipsoid,this.extent)};og.quadTree.EntityCollectionQuadNodeWGS84.prototype._setLonLat=function(c){c._lonlat||(c._lonlat=this.layer._planet.ellipsoid.cartesianToLonLat(c._cartesian));return c._lonlat};
og.quadTree.EntityCollectionQuadNodeWGS84.prototype.isVisible=function(){return this.isNorth&&this.layer._renderingNodesNorth[this.nodeId]||this.layer._renderingNodesSouth[this.nodeId]?!0:!1};
og.quadTree.EntityCollectionQuadNodeWGS84.prototype.renderCollection=function(c,d,e){this.isNorth?this.layer._renderingNodesNorth[this.nodeId]=!0:this.layer._renderingNodesSouth[this.nodeId]=!0;this.deferredEntities.length&&!this._inTheQueue&&(this.layer.async?this.layer._queueDeferredNode(this):this.applyCollection());this.entityCollection._animatedOpacity=this.layer.opacity;this.entityCollection.scaleByDistance=this.layer.scaleByDistance;c.push(this.entityCollection)};og.layer.Vector=function(c,d){d=d||{};og.inheritance.base(this,c,d);this.events.registerNames(og.layer.Vector.EVENT_NAMES);this.scaleByDistance=d.scaleByDistance||[og.math.MAX32,og.math.MAX32,og.math.MAX32];this.async=void 0!=d.async?d.async:!0;this.groundAlign=d.groundAlign||!1;this._maxCountPerCollection=d.maxCountNode||30;this._minTreeZoom=5;this._entities=d.entities?[].concat(d.entities):[];this._entityCollectionAlways=new og.EntityCollection;this._bindEventsDefault(this._entityCollectionAlways);
this._entityCollectionsTreeSouth=this._entityCollectionsTreeNorth=this._entityCollectionsTree=null;this._renderingNodes={};this._renderingNodesNorth={};this._renderingNodesSouth={};this._counter=0;this._deferredEntitiesPendingQueue=new og.QueueArray;this._buildEntityCollectionsTree()};og.inheritance.extend(og.layer.Vector,og.layer.Layer);og.layer.Vector.EVENT_NAMES=["entitymove","draw","entityadd","entityremove"];
og.layer.Vector.prototype.addTo=function(c){this._assignPlanet(c);this._entityCollectionAlways.addTo(c,!0);this._buildEntityCollectionsTree()};og.layer.Vector.prototype.getEntities=function(){return[].concat(this._entities)};
og.layer.Vector.prototype.add=function(c,d){c._vectorLayer||c._entityCollection||(c._vectorLayer=this,c._vectorLayerIndex=this._entities.length,this._entities.push(c),c.lineString?this._entityCollectionAlways.add(c):this._planet&&(c._lonlat||(c._lonlat=this.layer._planet.ellipsoid.cartesianToLonLat(c._cartesian)),c._lonlat.lat>og.mercator.MAX_LAT?this._entityCollectionsTreeNorth.insertEntity(c,d):c._lonlat.lat<og.mercator.MIN_LAT?this._entityCollectionsTreeSouth.insertEntity(c,d):this._entityCollectionsTree.insertEntity(c,
d)),this.events.dispatch(this.events.entityadd,c));return this};og.layer.Vector.prototype.addEntities=function(c,d){for(var e=c.length;e--;)this.add(c[e],d);return this};
og.layer.Vector.prototype.removeEntity=function(c){if(c._vectorLayer&&this.isEqual(c._vectorLayer)){this._entities.splice(c._vectorLayerIndex,1);this._reindexEntitiesArray(c._vectorLayerIndex);c._vectorLayer=null;c._vectorLayerIndex=-1;if(c._entityCollection){c._entityCollection._removeEntitySilent(c);for(var d=c._nodePtr;d;)d.count--,d=d.parentNode;c._nodePtr&&0===c._nodePtr.count&&0===c._nodePtr.deferredEntities.length&&(c._nodePtr.entityCollection=null)}else if(c._nodePtr&&c._nodePtr.deferredEntities.length)for(var d=
c._nodePtr.deferredEntities,e=d.length;e--;)if(d[e].id===c.id){d.splice(e,1);for(d=c._nodePtr;d;)d.count--,d=d.parentNode;break}c._nodePtr&&(c._nodePtr=null);this.events.dispatch(this.events.entityremove,c)}return this};og.layer.Vector.prototype.setPickingEnabled=function(c){this._entityCollectionAlways.setPickingEnabled(c);this._entityCollectionsTree.traverseTree(function(d){d.setPickingEnabled(c)});this._entityCollectionsTreeNorth.traverseTree(function(d){d.setPickingEnabled(c)});this._entityCollectionsTreeSouth.traverseTree(function(d){d.setPickingEnabled(c)})};
og.layer.Vector.prototype._reindexEntitiesArray=function(c){for(var d=this._entities;c<d.length;c++)d[c]._vectorLayerIndex=c};og.layer.Vector.prototype.removeEntities=function(c){for(var d=c.length;d--;)this.removeEntity(c[d]);return this};og.layer.Vector.prototype.setEntities=function(c){this.clear();this._entities=[].concat(c);for(var d=c.length;d--;){var e=c[d];e._vectorLayer||(e._vectorLayer=this,e._vectorLayerIndex=d)}this._buildEntityCollectionsTree()};
og.layer.Vector.prototype.setScaleByDistance=function(c,d,e){this.scaleByDistance[0]=c;this.scaleByDistance[1]=d;this.scaleByDistance[2]=e||og.math.MAX32};og.layer.Vector.prototype.clear=function(){};og.layer.Vector.prototype.each=function(c){for(var d=this._entities,e=d.length;e--;)c(d[e])};
og.layer.Vector.prototype._buildEntityCollectionsTree=function(){if(this._planet){this._entityCollectionsTree=new og.quadTree.EntityCollectionQuadNode(this,og.quadTree.NW,null,0,og.Extent.createFromArray([-2.003750834E7,-2.003750834E7,2.003750834E7,2.003750834E7]),this._planet,0);this._entityCollectionsTreeNorth=new og.quadTree.EntityCollectionQuadNodeWGS84(this,og.quadTree.NW,null,0,og.Extent.createFromArray([-180,og.mercator.MAX_LAT,180,90]),this._planet,0);this._entityCollectionsTreeSouth=new og.quadTree.EntityCollectionQuadNodeWGS84(this,
og.quadTree.NW,null,0,og.Extent.createFromArray([-180,-90,180,og.mercator.MIN_LAT]),this._planet,0);for(var c=[],d=0;d<this._entities.length;d++){var e=this._entities[d];e.lineString?this._entityCollectionAlways.add(e):c.push(e)}this._entityCollectionsTree.buildTree(c);this._entityCollectionsTreeNorth.buildTree(c);this._entityCollectionsTreeSouth.buildTree(c)}};
og.layer.Vector.prototype._bindEventsDefault=function(c){var d=this.events;c.events.on("entitymove",null,function(c){d.dispatch(d.entitymove,c)});c.events.on("mousemove",null,function(c){d.dispatch(d.mousemove,c)});c.events.on("mouseenter",null,function(c){d.dispatch(d.mouseenter,c)});c.events.on("mouseleave",null,function(c){d.dispatch(d.mouseleave,c)});c.events.on("mouselbuttonclick",null,function(c){d.dispatch(d.mouselbuttonclick,c)});c.events.on("mouserbuttonclick",null,function(c){d.dispatch(d.mouserbuttonclick,
c)});c.events.on("mousembuttonclick",null,function(c){d.dispatch(d.mousembuttonclick,c)});c.events.on("mouselbuttondoubleclick",null,function(c){d.dispatch(d.mouselbuttondoubleclick,c)});c.events.on("mouserbuttondoubleclick",null,function(c){d.dispatch(d.mouserbuttondoubleclick,c)});c.events.on("mousembuttondoubleclick",null,function(c){d.dispatch(d.mousembuttondoubleclick,c)});c.events.on("mouselbuttonup",null,function(c){d.dispatch(d.mouselbuttonup,c)});c.events.on("mouserbuttonup",null,function(c){d.dispatch(d.mouserbuttonup,
c)});c.events.on("mousembuttonup",null,function(c){d.dispatch(d.mousembuttonup,c)});c.events.on("mouselbuttondown",null,function(c){d.dispatch(d.mouselbuttondown,c)});c.events.on("mouserbuttondown",null,function(c){d.dispatch(d.mouserbuttondown,c)});c.events.on("mousembuttondown",null,function(c){d.dispatch(d.mousembuttondown,c)});c.events.on("mouselbuttonhold",null,function(c){d.dispatch(d.mouselbuttonhold,c)});c.events.on("mouserbuttonhold",null,function(c){d.dispatch(d.mouserbuttonhold,c)});c.events.on("mousembuttonhold",
null,function(c){d.dispatch(d.mousembuttonhold,c)});c.events.on("mousewheel",null,function(c){d.dispatch(d.mousewheel,c)});c.events.on("touchmove",null,function(c){d.dispatch(d.touchmove,c)});c.events.on("touchstart",null,function(c){d.dispatch(d.touchstart,c)});c.events.on("touchend",null,function(c){d.dispatch(d.touchend,c)});c.events.on("doubletouch",null,function(c){d.dispatch(d.doubletouch,c)});c.events.on("touchleave",null,function(c){d.dispatch(d.touchleave,c)});c.events.on("touchenter",null,
function(c){d.dispatch(d.touchenter,c)})};
og.layer.Vector.prototype._collectVisibleCollections=function(c){if(this.minZoom<=this._planet.maxCurrZoom&&this.maxZoom>=this._planet.maxCurrZoom){this._renderingNodes={};this._renderingNodesNorth={};this._renderingNodesSouth={};c.push(this._entityCollectionAlways);this._secondPASS=[];this._entityCollectionsTree.collectRenderCollections(this._planet._visibleNodes,c);for(var d=this._secondPASS.length;d--;)this._secondPASS[d].collectRenderCollectionsPASS2(this._planet._visibleNodes,c,this._secondPASS[d].nodeId);
this._secondPASS=[];this._entityCollectionsTreeNorth.collectRenderCollections(this._planet._visibleNodesNorth,c);for(d=this._secondPASS.length;d--;)this._secondPASS[d].collectRenderCollectionsPASS2(this._planet._visibleNodesNorth,c,this._secondPASS[d].nodeId);this._secondPASS=[];this._entityCollectionsTreeSouth.collectRenderCollections(this._planet._visibleNodesSouth,c);for(d=this._secondPASS.length;d--;)this._secondPASS[d].collectRenderCollectionsPASS2(this._planet._visibleNodesSouth,c,this._secondPASS[d].nodeId)}};
og.layer.Vector.prototype._queueDeferredNode=function(c){this._visibility&&(c._inTheQueue=!0,1<=this._counter?this._deferredEntitiesPendingQueue.push(c):this._execDeferredNode(c))};og.layer.Vector.prototype._execDeferredNode=function(c){this._counter++;var d=this;setTimeout(function(){c.applyCollection();d._dequeueRequest()},0)};og.layer.Vector.prototype._dequeueRequest=function(){this._counter--;if(this._deferredEntitiesPendingQueue.length&&1>this._counter){var c;(c=this._whilePendings())&&this._execDeferredNode(c)}};
og.layer.Vector.prototype._whilePendings=function(){for(;this._deferredEntitiesPendingQueue.length;){var c=this._deferredEntitiesPendingQueue.pop();c._inTheQueue=!1;if(c.isVisible())return c}return null};og.input.MouseHandler=function(c){this._htmlObject=c};
og.input.MouseHandler.prototype.setEvent=function(c,d,e){switch(c){case "mousewheel":c=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";this._htmlObject.attachEvent?this._htmlObject.attachEvent("on"+c,function(c){e.call(d,c)}):this._htmlObject.addEventListener&&this._htmlObject.addEventListener(c,function(c){c.wheelDelta=-120*c.detail;e.call(d,c)},!1);break;case "mousedown":this._htmlObject.onmousedown=function(c){e.call(d,c)};this._htmlObject.oncontextmenu=function(c){return!1};
break;case "mouseup":this._htmlObject.onmouseup=function(c){e.call(d,c)};break;case "mousemove":this._htmlObject.onmousemove=function(c){var g=this.getBoundingClientRect();e.call(d,{clientX:c.clientX-g.left,clientY:c.clientY-g.top})}}};og.input.KeyboardHandler=function(){var c={},d={},e={},f=this,g=null,h=null;if(og.input.KeyboardHandler.prototype._instance)return og.input.KeyboardHandler.prototype._instance;og.input.KeyboardHandler.prototype._instance=this;document.onkeydown=function(c){h=c;f.handleKeyDown.call(f)};document.onkeyup=function(c){h=c;f.handleKeyUp.call(f)};var k=function(c,d){return c.priority<d.priority};this.addEvent=function(c,h,n,p,q){void 0===q&&(q=1600);switch(c){case "keypress":null==p?g={callback:n,sender:h||
f}:(d[p]||(d[p]=[]),d[p].push({callback:n,sender:h,priority:q}),d[p].sort(k));break;case "charkeypress":e[p]||(e[p]=[]),e[p].push({callback:n,sender:h,priority:q}),e[p].sort(k)}};this.isKeyPressed=function(d){return c[d]};this.handleKeyDown=function(){g&&g.callback.call(g.sender,h);c[h.keyCode]=!0;for(var d in e)if(String.fromCharCode(h.keyCode)==String.fromCharCode(d))for(var f=e[d],k=0;k<f.length;k++)f[k].callback.call(f[k].sender,h)};this.handleKeyUp=function(){c[h.keyCode]=!1};this.handleEvents=
function(){for(var e in d)if(c[e])for(var f=d[e],g=0;g<f.length;g++)f[g].callback.call(f[g].sender,h)}};og.input.TouchHandler=function(c){this._htmlObject=c};
og.input.TouchHandler.prototype.setEvent=function(c,d,e){switch(c){case "touchcancel":this._htmlObject.ontouchcancel=function(c){c.preventDefault();var g=this.getBoundingClientRect();c.offsetLeft=g.left;c.offsetTop=g.top;e.call(d,c)};break;case "touchstart":this._htmlObject.ontouchstart=function(c){c.preventDefault();var g=this.getBoundingClientRect();c.offsetLeft=g.left;c.offsetTop=g.top;e.call(d,c)};break;case "touchend":this._htmlObject.ontouchend=function(c){c.preventDefault();var g=this.getBoundingClientRect();
c.offsetLeft=g.left;c.offsetTop=g.top;e.call(d,c)};break;case "touchmove":this._htmlObject.ontouchmove=function(c){c.preventDefault();var g=this.getBoundingClientRect();c.offsetLeft=g.left;c.offsetTop=g.top;e.call(d,c)}}};og.RendererEvents=function(c){og.inheritance.base(this);this.renderer=c;this._touchHandler=new og.input.TouchHandler(c.handler.gl.canvas);this._mouseHandler=new og.input.MouseHandler(c.handler.gl.canvas);this._keyboardHandler=new og.input.KeyboardHandler;this.mouseState={x:0,y:0,nx:0,ny:0,prev_x:0,prev_y:0,direction:new og.math.Vector3,leftButtonUp:!1,rightButtonUp:!1,middleButtonUp:!1,leftButtonDown:!1,rightButtonDown:!1,middleButtonDown:!1,leftButtonHold:!1,rightButtonHold:!1,middleButtonHold:!1,
leftButtonDoubleClick:!1,rightButtonDoubleClick:!1,middleButtonDoubleClick:!1,leftButtonClick:!1,rightButtonClick:!1,middleButtonClick:!1,moving:!1,justStopped:!1,doubleClickDelay:300,wheelDelta:0,sys:null,pickingObject:null};this.touchState={moving:!1,touchEnd:!1,touchStart:!1,touchCancel:!1,doubleTouch:!1,doubleTouchDelay:550,doubleTouchRadius:10,x:0,y:0,nx:0,ny:0,prev_x:0,prev_y:0,sys:null,pickingObject:null};this._dblTchCoords=new og.math.Pixel;this._oneTouchStart=!1;this._dblTchBegins=0;this._mousestopThread=
null;this._mclickY=this._mclickX=this._rclickY=this._rclickX=this._lclickY=this._lclickX=this._mdblClkBegins=this._rdblClkBegins=this._ldblClkBegins=0};og.inheritance.extend(og.RendererEvents,og.Events);og.RendererEvents.EVENT_NAMES="draw resize mousemove mousestop mouselbuttonclick mouserbuttonclick mousembuttonclick mouselbuttondoubleclick mouserbuttondoubleclick mousembuttondoubleclick mouselbuttonup mouserbuttonup mousembuttonup mouselbuttondown mouserbuttondown mousembuttondown mouselbuttonhold mouserbuttonhold mousembuttonhold mousewheel touchstart touchend touchcancel touchmove doubletouch touchleave touchenter".split(" ");
og.RendererEvents.prototype.handleEvents=function(){this.mouseState.direction=this.renderer.activeCamera.unproject(this.mouseState.x,this.mouseState.y);this.entityPickingEvents();this._keyboardHandler.handleEvents();this.handleMouseEvents();this.handleTouchEvents()};og.RendererEvents.prototype.on=function(c,d,e,f,g){this[c]?this.constructor.superclass.on.call(this,c,d,e):this._keyboardHandler.addEvent(c,d,e,f,g)};og.RendererEvents.prototype.isKeyPressed=function(c){return this._keyboardHandler.isKeyPressed(c)};
og.RendererEvents.prototype.initialize=function(){this.registerNames(og.RendererEvents.EVENT_NAMES);this._mouseHandler.setEvent("mouseup",this,this.onMouseUp);this._mouseHandler.setEvent("mousemove",this,this.onMouseMove);this._mouseHandler.setEvent("mousedown",this,this.onMouseDown);this._mouseHandler.setEvent("mousewheel",this,this.onMouseWheel);this._touchHandler.setEvent("touchstart",this,this.onTouchStart);this._touchHandler.setEvent("touchend",this,this.onTouchEnd);this._touchHandler.setEvent("touchcancel",
this,this.onTouchCancel);this._touchHandler.setEvent("touchmove",this,this.onTouchMove)};og.RendererEvents.prototype.onMouseWheel=function(c){this.mouseState.wheelDelta=c.wheelDelta};
og.RendererEvents.prototype.onMouseMove=function(c){var d=this.mouseState;d.sys=c;if(d.x!==c.clientX||d.y!==c.clientY)this._mdblClkBegins=this._rdblClkBegins=this._ldblClkBegins=0,d.x=c.clientX,d.y=c.clientY,c=this.renderer.handler.canvas,d.nx=d.x/c.width,d.ny=d.y/c.height,d.moving=!0,clearTimeout(this._mousestopThread),this._mousestopThread=setTimeout(function(){d.justStopped=!0},100)};
og.RendererEvents.prototype.onMouseDown=function(c){c.button===og.input.MB_LEFT?(this._lclickX=c.clientX,this._lclickY=c.clientY,this.mouseState.sys=c,this.mouseState.leftButtonDown=!0):c.button===og.input.MB_RIGHT?(this._rclickX=c.clientX,this._rclickY=c.clientY,this.mouseState.sys=c,this.mouseState.rightButtonDown=!0):c.button===og.input.MB_MIDDLE&&(this._mclickX=c.clientX,this._mclickY=c.clientY,this.mouseState.sys=c,this.mouseState.middleButtonDown=!0)};
og.RendererEvents.prototype.onMouseUp=function(c){var d=this.mouseState;d.sys=c;c.button===og.input.MB_LEFT?(d.leftButtonDown=!1,d.leftButtonUp=!0,this._lclickX===c.clientX&&this._lclickY===c.clientY&&(this._ldblClkBegins?(c=(new Date).getTime()-this._ldblClkBegins,c<=d.doubleClickDelay&&(d.leftButtonDoubleClick=!0),this._ldblClkBegins=0):this._ldblClkBegins=(new Date).getTime(),d.leftButtonClick=!0)):c.button===og.input.MB_RIGHT?(d.rightButtonDown=!1,d.rightButtonUp=!0,this._rclickX===c.clientX&&
this._rclickY===c.clientY&&(this._rdblClkBegins?(c=(new Date).getTime()-this._rdblClkBegins,c<=d.doubleClickDelay&&(d.rightButtonDoubleClick=!0),this._rdblClkBegins=0):this._rdblClkBegins=(new Date).getTime(),d.rightButtonClick=!0)):c.button===og.input.MB_MIDDLE&&(d.middleButtonDown=!1,d.middleButtonUp=!0,this._mclickX===c.clientX&&this._mclickY===c.clientY&&(this._mdblClkBegins?(c=(new Date).getTime()-this._mdblClkBegins,c<=d.doubleClickDelay&&(d.middleButtonDoubleClick=!0),this._mdblClkBegins=0):
this._mdblClkBegins=(new Date).getTime(),d.middleButtonClick=!0))};og.RendererEvents.prototype.onTouchStart=function(c){var d=this.touchState;d.sys=c;d.x=c.touches.item(0).pageX-c.offsetLeft;d.y=c.touches.item(0).pageY-c.offsetTop;var e=this.renderer.handler.canvas;d.nx=d.x/e.width;d.ny=d.y/e.height;d.prev_x=d.x;d.prev_y=d.y;d.touchStart=!0;1===c.touches.length?(this._dblTchCoords.x=d.x,this._dblTchCoords.y=d.y,this._oneTouchStart=!0):this._oneTouchStart=!1};
og.RendererEvents.prototype.onTouchEnd=function(c){var d=this.touchState;d.sys=c;d.touchEnd=!0;0===c.touches.length&&(d.prev_x=d.x,d.prev_y=d.y,this._oneTouchStart&&(this._dblTchBegins&&((new Date).getTime()-this._dblTchBegins<=d.doubleTouchDelay&&(d.doubleTouch=!0),this._dblTchBegins=0),this._dblTchBegins=(new Date).getTime(),this._oneTouchStart=!1))};og.RendererEvents.prototype.onTouchCancel=function(c){var d=this.touchState;d.sys=c;d.touchCancel=!0};
og.RendererEvents.prototype.onTouchMove=function(c){var d=this.touchState;d.x=c.touches.item(0).pageX-c.offsetLeft;d.y=c.touches.item(0).pageY-c.offsetTop;var e=this.renderer.handler.canvas;d.nx=d.x/e.width;d.ny=d.y/e.height;d.sys=c;d.moving=!0;this._dblTchBegins=0;this._oneTouchStart=!1};
og.RendererEvents.prototype.entityPickingEvents=function(){var c=this.touchState,d=this.mouseState;if(!(d.leftButtonHold||d.rightButtonHold||d.middleButtonHold)){var e=this.renderer,f=e.colorObjects,g=e._currPickingColor,h=e._prevPickingColor;d.pickingObject=null;c.pickingObject=null;if(e=f[g[0]+"_"+g[1]+"_"+g[2]])if(d.pickingObject=e,c.pickingObject=e,g[0]!=h[0]||g[1]!=h[1]||g[2]!=h[2])if(g[0]||g[1]||g[2]){if(h[0]||h[1]||h[2])f=f[h[0]+"_"+h[1]+"_"+h[2]],g=f.events||f._entityCollection.events,d.pickingObject=
f,g.dispatch(g.mouseleave,d),c.pickingObject=f,g.dispatch(g.touchleave,c);f=e.events||e._entityCollection.events;d.pickingObject=e;f.dispatch(f.mouseenter,d);c.pickingObject=e;f.dispatch(f.touchenter,c)}else if(f=f[h[0]+"_"+h[1]+"_"+h[2]])g=f.events||f._entityCollection.events,d.pickingObject=f,g.dispatch(g.mouseleave,d),c.pickingObject=f,g.dispatch(g.touchleave,c)}};
og.RendererEvents.prototype.handleMouseEvents=function(){var c=this.mouseState,d=this.dispatch,e=c.pickingObject,f;c.leftButtonClick&&(e&&(f=e.events||e._entityCollection.events,f.dispatch(f.mouselbuttonclick,c)),d(this.mouselbuttonclick,c),c.leftButtonClick=!1);c.rightButtonClick&&(e&&(f=e.events||e._entityCollection.events,f.dispatch(f.mouserbuttonclick,c)),d(this.mouserbuttonclick,c),c.rightButtonClick=!1);c.middleButtonClick&&(e&&(f=e.events||e._entityCollection.events,f.dispatch(f.mousembuttonclick,
c)),d(this.mousembuttonclick,c),c.middleButtonClick=!1);c.leftButtonDown&&(c.leftButtonHold?(e&&(f=e.events||e._entityCollection.events,f.dispatch(f.mouselbuttonhold,c)),d(this.mouselbuttonhold,c)):(c.leftButtonHold=!0,e&&(f=e.events||e._entityCollection.events,f.dispatch(f.mouselbuttondown,c)),d(this.mouselbuttondown,c)));c.rightButtonDown&&(c.rightButtonHold?(e&&(f=e.events||e._entityCollection.events,f.dispatch(f.mouserbuttonhold,c)),d(this.mouserbuttonhold,c)):(c.rightButtonHold=!0,e&&(f=e.events||
e._entityCollection.events,f.dispatch(f.mouserbuttondown,c)),d(this.mouserbuttondown,c)));c.middleButtonDown&&(c.middleButtonHold?(e&&(f=e.events||e._entityCollection.events,f.dispatch(f.mousembuttonhold,c)),d(this.mousembuttonhold,c)):(c.middleButtonHold=!0,e&&(f=e.events||e._entityCollection.events,f.dispatch(f.mousembuttondown,c)),d(this.mousembuttondown,c)));c.leftButtonUp&&(e&&(f=e.events||e._entityCollection.events,f.dispatch(f.mouselbuttonup,c)),d(this.mouselbuttonup,c),c.leftButtonUp=!1,c.leftButtonHold=
!1);c.rightButtonUp&&(e&&(f=e.events||e._entityCollection.events,f.dispatch(f.mouserbuttonup,c)),d(this.mouserbuttonup,c),c.rightButtonUp=!1,c.rightButtonHold=!1);c.middleButtonUp&&(e&&(f=e.events||e._entityCollection.events,f.dispatch(f.mousembuttonup,c)),d(this.mousembuttonup,c),c.middleButtonUp=!1,c.middleButtonHold=!1);c.leftButtonDoubleClick&&(e&&(f=e.events||e._entityCollection.events,f.dispatch(f.mouselbuttondoubleclick,c)),d(this.mouselbuttondoubleclick,c),c.leftButtonDoubleClick=!1);c.rightButtonDoubleClick&&
(e&&(f=e.events||e._entityCollection.events,f.dispatch(f.mouserbuttondoubleclick,c)),d(this.mouserbuttondoubleclick,c),c.rightButtonDoubleClick=!1);c.middleButtonDoubleClick&&(e&&(f=e.events||e._entityCollection.events,f.dispatch(f.mousembuttondoubleclick,c)),d(this.mousembuttondoubleclick,c),c.middleButtonDoubleClick=!1);c.wheelDelta&&(e&&(f=e.events||e._entityCollection.events,f.dispatch(f.mousewheel,c)),d(this.mousewheel,c),c.wheelDelta=0);c.moving&&(e&&(f=e.events||e._entityCollection.events,
f.dispatch(f.mousemove,c)),d(this.mousemove,c),c.prev_x=c.x,c.prev_y=c.y);c.justStopped&&(d(this.mousestop,c),c.justStopped=!1)};
og.RendererEvents.prototype.handleTouchEvents=function(){var c=this.touchState,d=this.dispatch,e=c.pickingObject,f;c.touchCancel&&(d(this.touchcancel,c),c.touchCancel=!1);if(c.touchStart){e=this.renderer;e._currPickingColor=e._pickingFramebuffer.readPixel(c.nx,1-c.ny);f=e._currPickingColor;if(e=c.pickingObject=e.colorObjects[f[0]+"_"+f[1]+"_"+f[2]])f=e.events||e._entityCollection.events,f.dispatch(f.touchstart,c);d(this.touchstart,c);c.touchStart=!1}c.doubleTouch&&(e&&(f=e.events||e._entityCollection.events,
f.dispatch(f.doubletouch,c)),d(this.doubletouch,c),c.doubleTouch=!1);c.touchEnd&&(e&&(f=e.events||e._entityCollection.events,f.dispatch(f.touchend,c)),d(this.touchend,c),c.x=0,c.y=0,c.touchEnd=!1);c.moving&&(e&&(f=e.events||e._entityCollection.events,f.dispatch(f.touchmove,c)),d(this.touchmove,c),c.prev_x=c.x,c.prev_y=c.y)};og.webgl.MultiFramebuffer=function(c,d){d=d||{};this.handler=c;this._fbo=null;this._pFbo=[];this._rbo=null;this._size=d.size||1;this._width=d.width||256;this._height=d.height||256;this.textures=[];this._initialize()};
og.webgl.MultiFramebuffer.prototype.destroy=function(){var c=this.handler.gl;c.deleteFramebuffer(this._fbo);this._fbo=null;c.deleteRenderbuffer(this._rbo);this._rbo=null;for(var d=0;d<this._size;d++)c.deleteTexture(this.textures[d]),c.deleteFramebuffer(this._pFbo[d]);this.textures.length=0;this.textures=[];this._pFbo.length=0;this._pFbo=[]};
og.webgl.MultiFramebuffer.prototype._initialize=function(){var c=this.handler.gl,d=this.handler.extensions.WEBGL_draw_buffers;this._fbo=c.createFramebuffer();c.bindFramebuffer(c.FRAMEBUFFER,this._fbo);for(var e=[],f=0;f<this._size;f++)e[f]=d.COLOR_ATTACHMENT0_WEBGL+f;d.drawBuffersWEBGL(e);for(f=0;f<this._size;f++)this.textures[f]=this.handler.createEmptyTexture_l(this._width,this._height),c.bindTexture(c.TEXTURE_2D,this.textures[f]),c.framebufferTexture2D(c.FRAMEBUFFER,d.COLOR_ATTACHMENT0_WEBGL+f,
c.TEXTURE_2D,this.textures[f],0),c.bindTexture(c.TEXTURE_2D,null),e[f]=d.COLOR_ATTACHMENT0_WEBGL+f;this._rbo=c.createRenderbuffer();c.bindRenderbuffer(c.RENDERBUFFER,this._rbo);c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,this._width,this._height);c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,this._rbo);c.bindRenderbuffer(c.RENDERBUFFER,null);c.bindFramebuffer(c.FRAMEBUFFER,null);for(f=0;f<this._size;f++)this._pFbo[f]=c.createFramebuffer(),c.bindFramebuffer(c.FRAMEBUFFER,
this._pFbo[f]),c.bindTexture(c.TEXTURE_2D,this.textures[f]),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,this.textures[f],0),c.bindTexture(c.TEXTURE_2D,null);c.bindFramebuffer(c.FRAMEBUFFER,null)};og.webgl.MultiFramebuffer.prototype.setSize=function(c,d){this._width=c;this._height=d;this.destroy();this._initialize()};
og.webgl.MultiFramebuffer.prototype.readAllPixels=function(c){var d=this.handler.gl;d.bindFramebuffer(d.FRAMEBUFFER,this._pFbo[c||0]);c=new Uint8Array(4*this._width*this._height);d.readPixels(0,0,this._width,this._height,d.RGBA,d.UNSIGNED_BYTE,c);d.bindFramebuffer(d.FRAMEBUFFER,null);return c};
og.webgl.MultiFramebuffer.prototype.readPixel=function(c,d,e){var f=this.handler.gl;f.bindFramebuffer(f.FRAMEBUFFER,this._pFbo[e||0]);e=new Uint8Array(4);f.readPixels(c*this._width,d*this._height,1,1,f.RGBA,f.UNSIGNED_BYTE,e);f.bindFramebuffer(f.FRAMEBUFFER,null);return e};
og.webgl.MultiFramebuffer.prototype.isComplete=function(){var c=this.handler.gl;c.bindFramebuffer(c.FRAMEBUFFER,this._fbo);if(c.checkFramebufferStatus(c.FRAMEBUFFER)==c.FRAMEBUFFER_COMPLETE)return c.bindFramebuffer(c.FRAMEBUFFER,null),!0;c.bindFramebuffer(c.FRAMEBUFFER,null);return!1};og.webgl.MultiFramebuffer.prototype.activate=function(){var c=this.handler,d=c.gl;d.bindFramebuffer(d.FRAMEBUFFER,null);d.bindFramebuffer(d.FRAMEBUFFER,this._fbo);d.viewport(0,0,this._width,this._height);c.framebufferStack.push(this)};
og.webgl.MultiFramebuffer.prototype.deactivate=function(){var c=this.handler,d=c.gl;d.bindFramebuffer(d.FRAMEBUFFER,null);d.viewport(0,0,c.canvas.width,c.canvas.height);var e=c.framebufferStack.popPrev();e?(d.bindFramebuffer(d.FRAMEBUFFER,e._fbo),d.viewport(0,0,e._width,e._height)):d.viewport(0,0,c.canvas.width,c.canvas.height)};og.webgl.MultiFramebuffer.prototype.getImage=function(c){c=this.readAllPixels(c);var d=new og.ImageCanvas(this._width,this._height);d.setData(c);return d.getImage()};
og.webgl.MultiFramebuffer.prototype.openImage=function(c){var d=this.getImage(c);c="<!DOCTYPE html><html><head><title>Print</title></head><body>"+('<img src="'+d.src+'">')+"</body>";c+="</html>";d=window.open("","","width="+d.width+"px ,height="+d.height+"px");d.document.open();d.document.write(c);d.document.close();d.focus()};og.Renderer=function(c){this.div=null;this.handler=c;this._renderNodesArr=[];this.renderNodes={};this.cameras=[];this.activeCamera=null;this.events=new og.RendererEvents(this);this.controls=[];this.controlsBag={};this.colorObjects={};this._pickingCallbacks=[];this._pickingFramebuffer=null;this._currPickingColor=[0,0,0];this._prevPickingColor=[0,0,0]};og.Renderer.prototype.addPickingCallback=function(c,d){this._pickingCallbacks.push({callback:d,sender:c})};
og.Renderer.prototype.assignPickingColor=function(c){for(var d=0,e=0,f=0,g="0_0_0";!(d||e||f)||this.colorObjects[g];)d=og.math.randomi(1,255),e=og.math.randomi(1,255),f=og.math.randomi(1,255),g=d+"_"+e+"_"+f;c._pickingColor?c._pickingColor.set(d,e,f):c._pickingColor=new og.math.Vector3(d,e,f);this.colorObjects[g]=c};
og.Renderer.prototype.clearPickingColor=function(c){c=c._pickingColor;c.isZero()||(this.colorObjects[c.x+"_"+c.y+"_"+c.z]=null,delete this.colorObjects[c.x+"_"+c.y+"_"+c.z],c.x=c.y=c.z=0)};og.Renderer.prototype.getWidth=function(){return this.handler.gl.canvas.width};og.Renderer.prototype.getHeight=function(){return this.handler.gl.canvas.height};og.Renderer.prototype.getCenter=function(){var c=this.handler.gl.canvas;return new og.math.Pixel(Math.round(.5*c.width),Math.round(.5*c.height))};
og.Renderer.prototype.addControl=function(c){c.addTo(this)};og.Renderer.prototype.addControls=function(c){for(var d=0;d<c.length;d++)c[d].addTo(this)};og.Renderer.prototype.removeControl=function(c){for(var d=0;d<this.controls.length;d++)if(this.controls[d]==c)return this.controls.splice(d,1),c.remove(),c};
og.Renderer.prototype.init=function(){var c=this;this.handler.setFrameCallback(function(){c.draw()});this.activeCamera=new og.Camera(this,{eye:new og.math.Vector3(0,0,0),look:new og.math.Vector3(0,0,-1),up:new og.math.Vector3(0,1,0)});this.events.initialize();this.handler.onCanvasResize=function(d){c.sceneFrameBuffer.setSize(d.clientWidth,d.clientHeight);c.activeCamera.setAspectRatio(d.clientWidth/d.clientHeight);c._pickingFramebuffer.setSize(d.clientWidth,d.clientHeight);c.events.dispatch(c.events.resize,
d)};this._pickingFramebuffer=new og.webgl.Framebuffer(this.handler);this.handler.addShaderProgram(new og.shaderProgram.ShaderProgram("screenFrame",{uniforms:{texture:{type:og.shaderProgram.types.SAMPLER2D}},attributes:{corners:{type:og.shaderProgram.types.VEC3,enableArray:!0}},vertexShader:"attribute vec2 corners;\r\n            \r\n            varying vec2 tc;\r\n            void main(void) {\r\n                gl_Position = vec4(corners, 0.0, 1.0);\r\n                tc = corners * 0.5 + 0.5;\r\n            }",
fragmentShader:"precision lowp float;\r\n            uniform sampler2D texture;\r\n            \r\n            varying vec2 tc;\r\n            \r\n            void main(void) {\r\n                gl_FragColor = texture2D( texture, tc );\r\n            }"}));this.sceneFrameBuffer=new og.webgl.MultiFramebuffer(this.handler,{size:3});this._screenFrameCornersBuffer=this.handler.createArrayBuffer(new Float32Array([1,1,-1,1,1,-1,-1,-1]),2,4)};
og.Renderer.prototype.addRenderNode=function(c){this.renderNodes[c.name]?og.console.logWrn("og.Renderer 259 - node name: "+c.name+" allready exists."):(c.assignRenderer(this),this._renderNodesArr.unshift(c),this.renderNodes[c.name]=c)};og.Renderer.prototype.addRenderNodes=function(c){for(var d=0;d<c;d++)this.addRenderNode(c[d])};
og.Renderer.prototype.draw=function(){var c=this.events;c.handleEvents();c.dispatch(c.draw,this);var d=this.sceneFrameBuffer;d.activate();var e=this.handler;e.clearFrame();e.gl.activeTexture(e.gl.TEXTURE0);e.gl.bindTexture(e.gl.TEXTURE_2D,e.transparentTexture);for(var f=this._renderNodesArr,g=f.length;g--;)f[g].drawNode();d.deactivate();this._drawPickingBuffer();f=this.events.mouseState;g=this.events.touchState;if(!(f.leftButtonHold||f.rightButtonHold||f.middleButtonHold)){this._prevPickingColor[0]=
this._currPickingColor[0];this._prevPickingColor[1]=this._currPickingColor[1];this._prevPickingColor[2]=this._currPickingColor[2];var h;g.x||g.y?(h=this._pickingFramebuffer.readPixel(g.nx,1-g.ny),h[0]||h[1]||h[2]||(h=this.sceneFrameBuffer.readPixel(g.nx,1-g.ny,1))):(h=this._pickingFramebuffer.readPixel(f.nx,1-f.ny),h[0]||h[1]||h[2]||(h=this.sceneFrameBuffer.readPixel(f.nx,1-f.ny,1)));this._currPickingColor=h}f=e.shaderPrograms.screenFrame;g=f._program;e=e.gl;e.disable(e.DEPTH_TEST);f.activate();e.activeTexture(e.TEXTURE0);
e.bindTexture(e.TEXTURE_2D,d.textures[0]);e.uniform1i(g.uniforms.texture._pName,0);e.bindBuffer(e.ARRAY_BUFFER,this._screenFrameCornersBuffer);e.vertexAttribPointer(g.attributes.corners._pName,2,e.FLOAT,!1,0,0);e.drawArrays(e.TRIANGLE_STRIP,0,4);e.enable(e.DEPTH_TEST);c.mouseState.moving=!1;c.touchState.moving=!1};
og.Renderer.prototype.getPickingObject=function(c,d){var e=this.renderer.handler.canvas,e=this.sceneFrameBuffer.readPixel(c/e.width,(e.height-d)/e.height,1);return this.colorObjects[e[0]+"_"+e[1]+"_"+e[2]]};og.Renderer.prototype._drawPickingBuffer=function(){this._pickingFramebuffer.activate();var c=this.handler,d=c.gl;d.clearColor(0,0,0,1);d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT);d.disable(c.gl.BLEND);c=this._pickingCallbacks;for(d=c.length;d--;)c[d].callback.call(c[d].sender);this._pickingFramebuffer.deactivate()};
og.Renderer.prototype.start=function(){this.handler.start()};og.shaderProgram.atmosphereSpace=function(){return new og.shaderProgram.ShaderProgram("atmosphereSpace",{uniforms:{projectionMatrix:{type:og.shaderProgram.types.MAT4},viewMatrix:{type:og.shaderProgram.types.MAT4},cameraPosition:{type:og.shaderProgram.types.VEC3},v3LightPosition:{type:og.shaderProgram.types.VEC3},v3InvWavelength:{type:og.shaderProgram.types.VEC3},v3LightPos:{type:og.shaderProgram.types.VEC3},g:{type:og.shaderProgram.types.FLOAT},g2:{type:og.shaderProgram.types.FLOAT},fCameraHeight2:{type:og.shaderProgram.types.FLOAT},
fOuterRadius:{type:og.shaderProgram.types.FLOAT},fOuterRadius2:{type:og.shaderProgram.types.FLOAT},fInnerRadius:{type:og.shaderProgram.types.FLOAT},fKrESun:{type:og.shaderProgram.types.FLOAT},fKmESun:{type:og.shaderProgram.types.FLOAT},fKr4PI:{type:og.shaderProgram.types.FLOAT},fKm4PI:{type:og.shaderProgram.types.FLOAT},fScale:{type:og.shaderProgram.types.FLOAT},fScaleDepth:{type:og.shaderProgram.types.FLOAT},fScaleOverScaleDepth:{type:og.shaderProgram.types.FLOAT}},attributes:{position:{type:og.shaderProgram.types.VEC3,
enableArray:!0}},vertexShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"atmosphereSpace_vs.txt"),fragmentShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"atmosphereSpace_fs.txt")})};og.shape.Icosphere=function(c){og.shape.BaseShape.call(this,c);this._size=c.size||1;this._level=c.level||0;this._index=0;this._middlePointIndexCache={};this._createData()};goog.inherits(og.shape.Icosphere,og.shape.BaseShape);og.shape.Icosphere.prototype._addVertex=function(c){var d=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);this._positionData.push(this._size*c[0]/d,this._size*c[1]/d,this._size*c[2]/d);return this._index++};
og.shape.Icosphere.prototype._getMiddlePoint=function(c,d){var e=c<d,e=(e?c:d)+"_"+(e?d:c),f=this._middlePointIndexCache[e];if(f)return f;var f=[this._positionData[3*c],this._positionData[3*c+1],this._positionData[3*c+2]],g=[this._positionData[3*d],this._positionData[3*d+1],this._positionData[3*d+2]],f=this._addVertex([(f[0]+g[0])/2,(f[1]+g[1])/2,(f[2]+g[2])/2]);return this._middlePointIndexCache[e]=f};
og.shape.Icosphere.prototype._createData=function(){this._positionData=[];this._indexData=[];this._index=0;this._middlePointIndexCache={};var c=(1+Math.sqrt(5))/2;this._addVertex([-1,c,0]);this._addVertex([1,c,0]);this._addVertex([-1,-c,0]);this._addVertex([1,-c,0]);this._addVertex([0,-1,c]);this._addVertex([0,1,c]);this._addVertex([0,-1,-c]);this._addVertex([0,1,-c]);this._addVertex([c,0,-1]);this._addVertex([c,0,1]);this._addVertex([-c,0,-1]);this._addVertex([-c,0,1]);c=[];c.push([0,11,5]);c.push([0,
5,1]);c.push([0,1,7]);c.push([0,7,10]);c.push([0,10,11]);c.push([1,5,9]);c.push([5,11,4]);c.push([11,10,2]);c.push([10,7,6]);c.push([7,1,8]);c.push([3,9,4]);c.push([3,4,2]);c.push([3,2,6]);c.push([3,6,8]);c.push([3,8,9]);c.push([4,9,5]);c.push([2,4,11]);c.push([6,2,10]);c.push([8,6,7]);c.push([9,8,1]);for(var d=0;d<this._level;d++){for(var e=[],f=0;f<c.length;f++){var g=c[f],h=this._getMiddlePoint(g[0],g[1]),k=this._getMiddlePoint(g[1],g[2]),m=this._getMiddlePoint(g[2],g[0]);e.push([g[0],h,m]);e.push([g[1],
k,h]);e.push([g[2],m,k]);e.push([h,k,m])}c=e}for(d=0;d<c.length;d++)g=c[d],this._indexData.push(g[0]),this._indexData.push(g[1]),this._indexData.push(g[2])};og.scene.PlanetAtmosphere=function(c,d){og.inheritance.base(this,c,d);this.atmosphereSpaceParams={Kr:.0025,Km:2.5E-4,ESun:4,g:-.75,innerRadius:this.ellipsoid._a-3E4,outerRadius:this.ellipsoid._a+118E3,wavelength:[.65,.57,.475],scaleDepth:.29,v3InvWavelength:0,g2:0,fOuterRadius2:0,fKrESun:0,fKmESun:0,fKr4PI:0,fKm4PI:0,fScale:0,fScaleDepth:0,fScaleOverScaleDepth:0};this.atmosphereGroundParams={Kr:.0025,Km:2.5E-4,ESun:17,g:-.75,innerRadius:this.ellipsoid._a,outerRadius:this.ellipsoid._a+118E3,wavelength:[.65,
.57,.475],scaleDepth:.29,v3InvWavelength:0,g2:0,fOuterRadius2:0,fKrESun:0,fKmESun:0,fKr4PI:0,fKm4PI:0,fScale:0,fScaleDepth:0,fScaleOverScaleDepth:0};var e=this;this.updateAtmosphereParams=function(){var c=e.atmosphereSpaceParams;c.v3InvWavelength=[1/Math.pow(c.wavelength[0],4),1/Math.pow(c.wavelength[1],4),1/Math.pow(c.wavelength[2],4)];c.fOuterRadius2=c.outerRadius*c.outerRadius;c.fKrESun=c.Kr*c.ESun;c.fKmESun=c.Km*c.ESun;c.fKr4PI=4*c.Kr*Math.PI;c.fKm4PI=4*c.Km*Math.PI;c.fScale=1/(c.outerRadius-
c.innerRadius);c.fScaleDepth=c.scaleDepth;c.fScaleOverScaleDepth=1/(c.outerRadius-c.innerRadius)/c.scaleDepth;c.g2=c.g*c.g;c=e.atmosphereGroundParams;c.v3InvWavelength=[1/Math.pow(c.wavelength[0],4),1/Math.pow(c.wavelength[1],4),1/Math.pow(c.wavelength[2],4)];c.fOuterRadius2=c.outerRadius*c.outerRadius;c.fKrESun=c.Kr*c.ESun;c.fKmESun=c.Km*c.ESun;c.fKr4PI=4*c.Kr*Math.PI;c.fKm4PI=4*c.Km*Math.PI;c.fScale=1/(c.outerRadius-c.innerRadius);c.fScaleDepth=c.scaleDepth;c.fScaleOverScaleDepth=1/(c.outerRadius-
c.innerRadius)/c.scaleDepth;c.g2=c.g*c.g};this.updateAtmosphereParams();this._atmosphereIndexBuffer=this._atmospherePositionBuffer=null};og.inheritance.extend(og.scene.PlanetAtmosphere,og.scene.Planet);
og.scene.PlanetAtmosphere.prototype._initializeShaders=function(){this.renderer.handler.addShaderProgram(og.shaderProgram.single_nl(),!0);this.renderer.handler.addShaderProgram(og.shaderProgram.singleAtmosphere_wl(),!0);this.renderer.handler.addShaderProgram(og.shaderProgram.overlays_nl(),!0);this.renderer.handler.addShaderProgram(og.shaderProgram.heightPicking(),!0);this.renderer.handler.addShaderProgram(og.shaderProgram.atmosphereSpace(),!0)};
og.scene.PlanetAtmosphere.prototype.initialization=function(){this.constructor.superclass.initialization.call(this);var c=new og.shape.Icosphere({level:5,size:this.atmosphereSpaceParams.outerRadius});this._atmospherePositionBuffer=this.renderer.handler.createArrayBuffer(new Float32Array(c._positionData),3,c._positionData.length/3);this._atmosphereIndexBuffer=this.renderer.handler.createElementArrayBuffer(new Uint16Array(c._indexData),1,c._indexData.length)};
og.scene.PlanetAtmosphere.prototype._rendering=function(){this._renderNodesPASS();this._renderHeightBackbufferPASS();this._renderVectorLayersPASS();this._renderAtmosphere()};
og.scene.PlanetAtmosphere.prototype._drawOverlays=function(){var c,d=this.renderer;c=d.handler;var e=c.gl,f=this.visibleTileLayers;e.blendEquation(e.FUNC_ADD);e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);e.enable(e.BLEND);if(this.lightEnabled){c.shaderPrograms.overlaysAtmosphere_wl.activate();c=c.shaderPrograms.overlaysAtmosphere_wl._program;shu=c.uniforms;e.uniform4fv(shu.lightsPositions._pName,this._lightsTransformedPositions);e.uniform3fv(shu.lightsParamsv._pName,this._lightsParamsv);e.uniform1fv(shu.lightsParamsf._pName,
this._lightsParamsf);e.uniformMatrix3fv(shu.normalMatrix._pName,!1,d.activeCamera._normalMatrix._m);e.uniformMatrix4fv(shu.viewMatrix._pName,!1,d.activeCamera._viewMatrix._m);e.uniformMatrix4fv(shu.projectionMatrix._pName,!1,d.activeCamera._projectionMatrix._m);var g=this.atmosphereGroundParams,d=d.activeCamera.eye;e.uniform3fv(shu.cameraPosition._pName,[d.x,d.y,d.z]);e.uniform1f(shu.fCameraHeight2._pName,d.length2());e.uniform3fv(shu.v3LightPosition._pName,this._sunControl.sunlight._position.normal().toVec());
e.uniform3fv(shu.v3InvWavelength._pName,g.v3InvWavelength);e.uniform1f(shu.fInnerRadius._pName,g.innerRadius);e.uniform1f(shu.fOuterRadius._pName,g.outerRadius);e.uniform1f(shu.fOuterRadius2._pName,g.fOuterRadius2);e.uniform1f(shu.fKrESun._pName,g.fKrESun);e.uniform1f(shu.fKmESun._pName,g.fKmESun);e.uniform1f(shu.fKr4PI._pName,g.fKr4PI);e.uniform1f(shu.fKm4PI._pName,g.fKm4PI);e.uniform1f(shu.fScale._pName,g.fScale);e.uniform1f(shu.fScaleDepth._pName,g.fScaleDepth);e.uniform1f(shu.fScaleOverScaleDepth._pName,
g.fScaleOverScaleDepth);e.activeTexture(e.TEXTURE0+f.length+2);e.bindTexture(e.TEXTURE_2D,this._nightTexture||this.transparentTexture);e.uniform1i(shu.uNightImage._pName,f.length+2);e.activeTexture(e.TEXTURE0+f.length+3);e.bindTexture(e.TEXTURE_2D,this._specularTexture||this.transparentTexture);e.uniform1i(shu.uSpecularImage._pName,f.length+3)}else c.shaderPrograms.overlays_nl.activate(),c=c.shaderPrograms.overlays_nl._program,e.uniformMatrix4fv(c.uniforms.projectionViewMatrix._pName,!1,d.activeCamera._projectionViewMatrix._m);
for(d=f.length;d--;){var g=f[d],h=4*d;this._tcolorArr[h]=g.transparentColor[0];this._tcolorArr[h+1]=g.transparentColor[1];this._tcolorArr[h+2]=g.transparentColor[2];this._tcolorArr[h+3]=g.opacity}e.uniform1i(c.uniforms.numTex._pName,f.length);e.uniform4fv(c.uniforms.tcolorArr._pName,this._tcolorArr);for(d=this._renderedNodes.length;d--;)og.planetSegment.drawOverlays(c,this._renderedNodes[d].planetSegment);e.disable(e.BLEND)};
og.scene.PlanetAtmosphere.prototype._drawSingle=function(){var c,d=this.renderer;c=d.handler;var e=c.gl;e.blendEquation(e.FUNC_ADD);e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);e.enable(e.BLEND);if(this.lightEnabled){c.shaderPrograms.singleAtmosphere_wl.activate();c=c.shaderPrograms.singleAtmosphere_wl._program;shu=c.uniforms;e.uniform4fv(shu.lightsPositions._pName,this._lightsTransformedPositions);e.uniform3fv(shu.lightsParamsv._pName,this._lightsParamsv);e.uniform1fv(shu.lightsParamsf._pName,
this._lightsParamsf);e.uniformMatrix3fv(shu.normalMatrix._pName,!1,d.activeCamera._normalMatrix._m);e.uniformMatrix4fv(shu.viewMatrix._pName,!1,d.activeCamera._viewMatrix._m);e.uniformMatrix4fv(shu.projectionMatrix._pName,!1,d.activeCamera._projectionMatrix._m);var f=this.atmosphereGroundParams,d=d.activeCamera.eye;e.uniform3fv(shu.cameraPosition._pName,[d.x,d.y,d.z]);e.uniform1f(shu.fCameraHeight2._pName,d.length2());e.uniform3fv(shu.v3LightPosition._pName,this._sunControl.sunlight._position.normal().toVec());
e.uniform3fv(shu.v3InvWavelength._pName,f.v3InvWavelength);e.uniform1f(shu.fInnerRadius._pName,f.innerRadius);e.uniform1f(shu.fOuterRadius._pName,f.outerRadius);e.uniform1f(shu.fOuterRadius2._pName,f.fOuterRadius2);e.uniform1f(shu.fKrESun._pName,f.fKrESun);e.uniform1f(shu.fKmESun._pName,f.fKmESun);e.uniform1f(shu.fKr4PI._pName,f.fKr4PI);e.uniform1f(shu.fKm4PI._pName,f.fKm4PI);e.uniform1f(shu.fScale._pName,f.fScale);e.uniform1f(shu.fScaleDepth._pName,f.fScaleDepth);e.uniform1f(shu.fScaleOverScaleDepth._pName,
f.fScaleOverScaleDepth);e.activeTexture(e.TEXTURE3);e.bindTexture(e.TEXTURE_2D,this._nightTexture||this.transparentTexture);e.uniform1i(shu.uNightImage._pName,3);e.activeTexture(e.TEXTURE4);e.bindTexture(e.TEXTURE_2D,this._specularTexture||this.transparentTexture);e.uniform1i(shu.uSpecularImage._pName,4)}else c.shaderPrograms.single_nl.activate(),c=c.shaderPrograms.single_nl._program,e.uniformMatrix4fv(c.uniforms.projectionViewMatrix._pName,!1,d.activeCamera._projectionViewMatrix._m);for(d=this._renderedNodes.length;d--;)og.planetSegment.drawSingle(c,
this._renderedNodes[d].planetSegment);e.disable(e.BLEND)};
og.scene.PlanetAtmosphere.prototype._renderAtmosphere=function(){var c=this.renderer,d,e,f=c.handler.gl;d=c.handler.shaderPrograms.atmosphereSpace;e=d._program;sha=e.attributes;shu=e.uniforms;d.activate();f.cullFace(f.FRONT);f.enable(f.BLEND);f.blendEquation(f.FUNC_ADD);f.blendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA);f.uniformMatrix4fv(shu.projectionMatrix._pName,!1,c.activeCamera._projectionMatrix._m);f.uniformMatrix4fv(shu.viewMatrix._pName,!1,c.activeCamera._viewMatrix._m);d=c.activeCamera.eye;
e=this.atmosphereSpaceParams;var g=this._sunControl.sunlight._position.normal().toVec();f.uniform3fv(shu.cameraPosition._pName,[d.x,d.y,d.z]);f.uniform1f(shu.fCameraHeight2._pName,d.length2());f.uniform3fv(shu.v3LightPosition._pName,g);f.uniform3fv(shu.v3LightPos._pName,g);f.uniform3fv(shu.v3InvWavelength._pName,e.v3InvWavelength);f.uniform1f(shu.g._pName,e.g);f.uniform1f(shu.g2._pName,e.g2);f.uniform1f(shu.fInnerRadius._pName,e.innerRadius);f.uniform1f(shu.fOuterRadius._pName,e.outerRadius);f.uniform1f(shu.fOuterRadius2._pName,
e.fOuterRadius2);f.uniform1f(shu.fKrESun._pName,e.fKrESun);f.uniform1f(shu.fKmESun._pName,e.fKmESun);f.uniform1f(shu.fKr4PI._pName,e.fKr4PI);f.uniform1f(shu.fKm4PI._pName,e.fKm4PI);f.uniform1f(shu.fScale._pName,e.fScale);f.uniform1f(shu.fScaleDepth._pName,e.scaleDepth);f.uniform1f(shu.fScaleOverScaleDepth._pName,e.fScaleOverScaleDepth);f.bindBuffer(f.ARRAY_BUFFER,this._atmospherePositionBuffer);f.vertexAttribPointer(sha.position._pName,this._atmospherePositionBuffer.itemSize,f.FLOAT,!1,0,0);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,
this._atmosphereIndexBuffer);f.drawElements(c.handler.gl.TRIANGLES,this._atmosphereIndexBuffer.numItems,f.UNSIGNED_SHORT,0);f.cullFace(f.BACK);f.disable(f.BLEND)};og.Globus=function(c){function d(){return!1}function e(){return!0}var f=og.Globus.CANVAS_ID_PREFIX+og.Globus.__id,g=document.createElement("canvas");g.id=f;g.style.width="100%";g.style.height="100%";g.style.display="block";g.style.opacity="1.0";this.div=document.getElementById(c.target);this.div.appendChild(g);this.div.classList.add("ogViewport");this.div.onmouseenter=function(){document.onmousewheel=d};this.div.onmouseleave=function(){document.onmousewheel=e};f=new og.webgl.Handler(f,{alpha:!1,antialias:!1});
f.init();this.renderer=new og.Renderer(f);this.renderer.init();this.renderer.div=this.div;this.renderer.div.attributions=document.createElement("div");this.renderer.div.attributions.classList.add("ogAttribution");this.div.appendChild(this.renderer.div.attributions);c.skybox&&this.renderer.addRenderNode(c.skybox);this._planetName=c.name?c.name:og.Globus.PLANET_NAME_PREFIX+og.Globus.__id;this.planet=c.atmosphere?new og.scene.PlanetAtmosphere(this._planetName,c.ellipsoid?c.ellipsoid:og.ellipsoid.wgs84):
new og.scene.Planet(this._planetName,c.ellipsoid?c.ellipsoid:og.ellipsoid.wgs84);c.terrain?this.planet.setTerrainProvider(c.terrain):this.planet.setTerrainProvider(new og.terrainProvider.EmptyTerrainProvider);this.renderer.addRenderNode(this.planet);c.controls&&this.renderer.addControls(c.controls);c.layers&&this.planet.addLayers(c.layers);og.Globus.__id++;c.viewExtent&&this.planet.viewToExtent(c.viewExtent);var h=0,k=null;this.fadeIn=function(c){clearInterval(null);clearInterval(k);h=g.style.opacity=
0;var d=1/(c/10);k=setInterval(function(){h+=d;1<=h&&(h=1,clearInterval(k));g.style.opacity=h},10)};this.fadeOut=function(c){clearInterval(null);clearInterval(k);h=g.style.opacity=1;var d=1/(c/10);k=setInterval(function(){h-=d;0>=h&&(h=0,clearInterval(k));g.style.opacity=h},10)};if(isUndefined(c.autoActivate)||c.autoActivate)this.fadeIn(500),this.renderer.start()};og.Globus.__id=1;og.Globus.CANVAS_ID_PREFIX="globus_viewport_";og.Globus.PLANET_NAME_PREFIX="globus_planet_";
function isUndefined(c){return void 0===c};og.layer.GeoVideo=function(c,d){og.inheritance.base(this,c,d);this._animate=!0;this._video=d.videoElement||null;this._src=d.src||null};og.inheritance.extend(og.layer.GeoVideo,og.layer.BaseGeoImage);og.layer.GeoVideo.prototype.setSrc=function(c){this._planet&&this._planet._geoImageCreator.remove(this);this._src=c;this._sourceReady=!1};og.layer.GeoVideo.prototype.setVideoElement=function(c){this._planet&&this._planet._geoImageCreator.remove(this);this._video=c;this._src=c.src;this._sourceReady=!1};
og.layer.GeoVideo.prototype.setVisibility=function(c){c!=this._visibility&&(this._visibility=c,this._isBaseLayer&&c&&this._planet.setBaseLayer(this),this._planet.updateVisibleLayers(),this.events.dispatch(this.events.visibilitychange,this),c?(this._sourceReady&&this._planet._geoImageCreator.add(this),this._video&&this._video.play()):(this._sourceReady&&this._planet._geoImageCreator.remove(this),this._video&&this._video.pause()))};
og.layer.GeoVideo.prototype._createSourceTexture=function(){if(this._sourceCreated){var c=this._planet.renderer.handler.gl;c.bindTexture(c.TEXTURE_2D,this._sourceTexture);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,this._video)}else this._sourceTexture=this._planet.renderer.handler.createTexture_n(this._video),this._sourceCreated=!0};
og.layer.GeoVideo.prototype._onCanPlay=function(c){this._frameWidth=c.videoWidth;this._frameHeight=c.videoHeight;c.width=c.videoWidth;c.height=c.videoHeight;c.play();this._sourceReady=!0;this._planet._geoImageCreator.add(this)};
og.layer.GeoVideo.prototype._onError=function(c){var d="unknown error";switch(c.error.code){case 1:d="video loading aborted";break;case 2:d="network loading error";break;case 3:d="video decoding failed / corrupted data or unsupported codec";break;case 4:d="video not supported"}console.log("Error: "+d+" (errorcode="+c.error.code+")")};
og.layer.GeoVideo.prototype.loadMaterial=function(c){this._creationProceeding=c.isLoading=!0;if(!this._sourceReady&&this._src){if(this._video)if(this._video.readyState===this._video.HAVE_ENOUGH_DATA)this._onCanPlay(this._video);else{if(this._video.src){var d=this;this._video.addEventListener("canplay",function(c){d._onCanPlay(this)})}}else this._video=document.createElement("video"),d=this,this._video.addEventListener("canplay",function(){d._onCanPlay(this)}),this._video.addEventListener("error",
function(){d._onError(this)});this._video.autoplay=!0;this._video.loop=!0;this._video.src=this._src;this._video.setAttribute("playsinline","");this._video.setAttribute("webkit-playsinline","")}else this._planet._geoImageCreator.add(this)};og.layer.GeoVideo.prototype.abortMaterialLoading=function(c){this._video&&(this._video.src="");this._creationProceeding=!1;c.isLoading=!1;c.isReady=!1};
og.layer.GeoVideo.prototype._renderingProjType1=function(){var c=this._planet,d=c.renderer.handler,e=d.gl,c=c._geoImageCreator;this._refreshFrame&&this._createFrame();this._sourceCreated?(e=this._planet.renderer.handler.gl,e.bindTexture(e.TEXTURE_2D,this._sourceTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this._video)):(this._sourceTexture=this._planet.renderer.handler.createTexture_n(this._video),this._sourceCreated=!0);var f=c._framebuffer;f.setSize(this._frameWidth,this._frameHeight);
f.activate();d.shaderPrograms.geoImageTransform.activate();var d=d.shaderPrograms.geoImageTransform._program,g=d.attributes,h=d.uniforms,k=this.transparentColor[0],m=this.transparentColor[1],l=this.transparentColor[2];e.disable(e.CULL_FACE);f.bindOutputTexture(this._materialTexture);e.clearColor(k,m,l,0);e.clear(e.COLOR_BUFFER_BIT);e.bindBuffer(e.ARRAY_BUFFER,c._texCoordsBuffer);e.vertexAttribPointer(g.texCoords._pName,c._texCoordsBuffer.itemSize,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,this._gridBuffer);
e.vertexAttribPointer(g.corners._pName,this._gridBuffer.itemSize,e.FLOAT,!1,0,0);e.uniform4fv(h.extentParams._pName,this._extentMercParams);e.activeTexture(e.TEXTURE0);e.bindTexture(e.TEXTURE_2D,this._sourceTexture);e.uniform1i(h.sourceTexture._pName,0);d.drawIndexBuffer(e.TRIANGLE_STRIP,c._indexBuffer);f.deactivate();e.enable(e.CULL_FACE);this._ready=!0;this._creationProceeding=!1};
og.layer.GeoVideo.prototype._renderingProjType0=function(){var c=this._planet,d=c.renderer.handler,e=d.gl,c=c._geoImageCreator;this._refreshFrame&&this._createFrame();this._sourceCreated?(e=this._planet.renderer.handler.gl,e.bindTexture(e.TEXTURE_2D,this._sourceTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this._video)):(this._sourceTexture=this._planet.renderer.handler.createTexture_n(this._video),this._sourceCreated=!0);var f=c._framebuffer;f.setSize(this._frameWidth,this._frameHeight);
f.activate();d.shaderPrograms.geoImageTransform.activate();var d=d.shaderPrograms.geoImageTransform._program,g=d.attributes,h=d.uniforms,k=this.transparentColor[0],m=this.transparentColor[1],l=this.transparentColor[2];e.disable(e.CULL_FACE);f.bindOutputTexture(this._materialTexture);e.clearColor(k,m,l,0);e.clear(e.COLOR_BUFFER_BIT);e.bindBuffer(e.ARRAY_BUFFER,c._texCoordsBuffer);e.vertexAttribPointer(g.texCoords._pName,c._texCoordsBuffer.itemSize,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,this._gridBuffer);
e.vertexAttribPointer(g.corners._pName,this._gridBuffer.itemSize,e.FLOAT,!1,0,0);e.uniform4fv(h.extentParams._pName,this._extentWgs84Params);e.activeTexture(e.TEXTURE0);e.bindTexture(e.TEXTURE_2D,this._sourceTexture);e.uniform1i(h.sourceTexture._pName,0);d.drawIndexBuffer(e.TRIANGLE_STRIP,c._indexBuffer);f.deactivate();e.enable(e.CULL_FACE);this._ready=!0;this._creationProceeding=!1};og.control.ShowFps=function(c){og.inheritance.base(this,c)};og.inheritance.extend(og.control.ShowFps,og.control.BaseControl);og.control.showFps=function(c){return new og.control.ShowFps(c)};og.control.ShowFps.prototype.oninit=function(){var c=document.createElement("div");c.className="defaultText ";c.id="ogShowFpsControl";document.body.appendChild(c);this.renderer.events.on("draw",this,this._draw)};
og.control.ShowFps.prototype._draw=function(){print2d("ogShowFpsControl",(1E3/this.renderer.handler.deltaTime).toFixed(1),this.renderer.handler.gl.canvas.clientWidth-60,0)};og.shaderProgram.simple=function(){return new og.shaderProgram.ShaderProgram("simple",{uniforms:{projectionViewMatrix:{type:og.shaderProgram.types.MAT4}},attributes:{aVertexPosition:{type:og.shaderProgram.types.VEC3,enableArray:!0},aVertexColor:{type:og.shaderProgram.types.VEC4,enableArray:!0}},vertexShader:"attribute vec3 aVertexPosition;\r\n            attribute vec4 aVertexColor;\r\n            uniform mat4 projectionViewMatrix;\r\n            varying vec4 vColor;\r\n            void main(void) {\r\n                gl_Position = projectionViewMatrix * vec4(aVertexPosition, 1.0);\r\n                vColor = aVertexColor;\r\n            }",
fragmentShader:"precision mediump float;\r\n            varying vec4 vColor;\r\n            void main(void) {\r\n                gl_FragColor = vColor;\r\n            }"})};og.scene.Axes=function(c){og.inheritance.base(this,"Axes");this.size=c;this.axesColorBuffer=this.axesBuffer=null};og.inheritance.extend(og.scene.Axes,og.scene.RenderNode);og.scene.Axes.prototype.initialization=function(){this.createAxisBuffer(this.size);this.drawMode=this.renderer.handler.gl.LINES;this.renderer.handler.addShaderProgram(og.shaderProgram.simple())};
og.scene.Axes.prototype.frame=function(){this.renderer.handler.shaderPrograms.simple.activate();this.renderer.handler.shaderPrograms.simple.set({projectionViewMatrix:this.renderer.activeCamera._projectionViewMatrix._m,aVertexPosition:this.axisBuffer,aVertexColor:this.axisColorBuffer});this.renderer.handler.shaderPrograms.simple.drawArray(this.drawMode,this.axisBuffer.numItems)};
og.scene.Axes.prototype.createAxisBuffer=function(c){this.axisBuffer=this.renderer.handler.createArrayBuffer(new Float32Array([0,0,0,c-1,0,0,0,0,0,0,c-1,0,0,0,0,0,0,c-1]),3,6);this.axisColorBuffer=this.renderer.handler.createArrayBuffer(new Float32Array([1,0,0,1,1,0,0,1,0,0,1,1,0,0,1,1,0,1,0,1,0,1,0,1]),4,6)};og.control.LayerSwitcher=function(c){og.inheritance.base(this,c);this.overlaysDiv=this.baseLayersDiv=this.dialog=null;this._id=og.control.LayerSwitcher.numSwitches++};og.control.LayerSwitcher.numSwitches=0;og.inheritance.extend(og.control.LayerSwitcher,og.control.BaseControl);og.control.layerSwitcher=function(c){return new og.control.LayerSwitcher(c)};
og.control.LayerSwitcher.prototype.oninit=function(){this.renderer.renderNodes.Earth.events.on("layeradd",this,this.onLayerAdded);this.renderer.renderNodes.Earth.events.on("layerremove",this,this.onLayerRemoved);this.createSwitcher();this.createDialog()};og.control.LayerSwitcher.prototype.onLayerAdded=function(c){c.displayInLayerSwitcher&&(c.isBaseLayer()?this.addSwitcher("radio",c,this.baseLayersDiv):this.addSwitcher("checkbox",c,this.overlaysDiv,this._id))};
og.control.LayerSwitcher.prototype.onLayerRemoved=function(c){c._removeCallback();c._removeCallback=null};
og.control.LayerSwitcher.prototype.addSwitcher=function(c,d,e,f){var g=document.createElement("div"),h=this,k=document.createElement("div");k.classList.add("ogViewExtentBtn");k.onclick=function(){h.renderer.renderNodes.Earth.flyExtent(d.getExtent())};var m=document.createElement("input");m.type=c;m.name="ogBaseLayerRadiosId"+(f||"");m.checked=d.getVisibility();m.className="ogLayerSwitcherInput";m.onclick=function(){d.setVisibility(this.checked)};d.events&&d.events.on("visibilitychange",null,function(c){m.checked=
c.getVisibility()});var l=document.createElement("label");l.className="ogLayerSwitcherLabel";l.innerHTML=(d.name||d.src||"noname")+"</br>";d._removeCallback=function(){e.removeChild(m);e.removeChild(l)};g.appendChild(k);g.appendChild(m);g.appendChild(l);e.appendChild(g)};
og.control.LayerSwitcher.prototype.createBaseLayersContainer=function(){var c=document.createElement("div");c.className="layersDiv";this.dialog.appendChild(c);var d=document.createElement("div");d.className="layersDiv";d.innerHTML="Base Layer";c.appendChild(d);this.baseLayersDiv=document.createElement("div");c.appendChild(this.baseLayersDiv)};
og.control.LayerSwitcher.prototype.createOverlaysContainer=function(){var c=document.createElement("div");c.className="layersDiv";this.dialog.appendChild(c);var d=document.createElement("div");d.className="layersDiv";d.innerHTML="Overlays";c.appendChild(d);this.overlaysDiv=document.createElement("div");c.appendChild(this.overlaysDiv)};
og.control.LayerSwitcher.prototype.createDialog=function(){this.dialog=document.createElement("div");this.dialog.id="ogLayerSwitcherDialog";this.dialog.className="displayNone";this.renderer.div.appendChild(this.dialog);this.createBaseLayersContainer();this.createOverlaysContainer()};
og.control.LayerSwitcher.prototype.createSwitcher=function(){var c=document.createElement("div");c.className="ogLayerSwitcherButton";c.id="ogLayerSwitcherButtonMaximize";var d=this;c.onclick=function(c){"ogLayerSwitcherButtonMaximize"===this.id?(this.id="ogLayerSwitcherButtonMinimize",d.dialog.className="displayBlock"):(this.id="ogLayerSwitcherButtonMaximize",d.dialog.className="displayNone")};this.renderer.div.appendChild(c)};og.terrainProvider.TerrainProvider=function(c,d){og.inheritance.base(this);d=d||{};this.name=c||"";this.minZoom=d.minZoom||3;this.maxZoom=d.maxZoom||14;this.url=d.url||"http://earth3.openglobus.org/{z}/{y}/{x}.ddm";this.gridSizeByZoom=d.gridSizeByZoom||[64,32,32,16,16,8,8,8,8,16,16,16,16,32,32,32,32,32,32,32,32];this.fileGridSize=d.fileGridSize||32;this.responseType=d.responseType||"arraybuffer";this.MAX_LOADING_TILES=d.MAX_LOADING_TILES||4;this.active=!0;this.events=new og.Events;this.events.registerNames(og.terrainProvider.TerrainProvider.EVENT_NAMES);
this._counter=0;this._pendingsQueue=[];this._urlRewriteCallback=null};og.inheritance.extend(og.terrainProvider.TerrainProvider,og.terrainProvider.EmptyTerrainProvider);og.terrainProvider.TerrainProvider.EVENT_NAMES=["load","loadend"];og.terrainProvider.TerrainProvider.prototype.abort=function(){this._pendingsQueue.length=0};og.terrainProvider.TerrainProvider.prototype.setUrl=function(c){this.url=c};og.terrainProvider.TerrainProvider.prototype.setName=function(c){this.name=c};
og.terrainProvider.TerrainProvider.prototype.handleSegmentTerrain=function(c){this.active?(c.terrainReady=!1,c.terrainIsLoading=!0,c._projection.id==og.proj.EPSG3857.id&&(this._counter>=this.MAX_LOADING_TILES?this._pendingsQueue.push(c):this._exec(c))):c.terrainIsLoading=!1};og.terrainProvider.TerrainProvider.prototype._createUrl=function(c){return og.utils.stringTemplate(this.url,{x:c.tileX.toString(),y:c.tileY.toString(),z:c.tileZoom.toString()})};
og.terrainProvider.TerrainProvider.prototype._getHTTPRequestString=function(c){var d=this._createUrl(c);return this._urlRewriteCallback?this._urlRewriteCallback(c,d):d};og.terrainProvider.TerrainProvider.prototype.setUrlRewriteCallback=function(c){this._urlRewriteCallback=c};og.terrainProvider.TerrainProvider.prototype.getElevations=function(c){return new Float32Array(c)};
og.terrainProvider.TerrainProvider.prototype._exec=function(c){this._counter++;og.ajax.request(this._getHTTPRequestString(c),{responseType:this.responseType,sender:this,success:function(d){this._applyElevationsData(c,d)},error:function(){this._applyElevationsData(c,[])},abort:function(){c.terrainIsLoading=!1}})};
og.terrainProvider.TerrainProvider.prototype._applyElevationsData=function(c,d){if(c){var e=this.getElevations(d),f=this.events.load;f.length&&this.events.dispatch(f,{elevations:e,segment:c});c.applyTerrain(e)}this._dequeueRequest()};og.terrainProvider.TerrainProvider.prototype._dequeueRequest=function(){this._counter--;if(this._pendingsQueue.length){if(this._counter<this.MAX_LOADING_TILES){var c;(c=this._whilePendings())&&this._exec.call(this,c)}}else 0===this._counter&&this.events.dispatch(this.events.loadend)};
og.terrainProvider.TerrainProvider.prototype._whilePendings=function(){for(;this._pendingsQueue.length;){var c=this._pendingsQueue.pop();if(c.node){if(c.ready&&c.node.getState()!==og.quadTree.NOTRENDERING)return c;c.terrainIsLoading=!1}}return null};og.all=function(){};
