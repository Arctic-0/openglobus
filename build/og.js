var COMPILED=!0,goog=goog||{};goog.global=this;goog.exportPath_=function(c,d,e){c=c.split(".");e=e||goog.global;c[0]in e||!e.execScript||e.execScript("var "+c[0]);for(var f;c.length&&(f=c.shift());)c.length||void 0===d?e=e[f]?e[f]:e[f]={}:e[f]=d};goog.define=function(c,d){var e=d;COMPILED||goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,c)&&(e=goog.global.CLOSURE_DEFINES[c]);goog.exportPath_(c,e)};goog.DEBUG=!0;goog.LOCALE="en";goog.TRUSTED_SITE=!0;
goog.provide=function(c){if(!COMPILED){if(goog.isProvided_(c))throw Error('Namespace "'+c+'" already declared.');delete goog.implicitNamespaces_[c];for(var d=c;(d=d.substring(0,d.lastIndexOf(".")))&&!goog.getObjectByName(d);)goog.implicitNamespaces_[d]=!0}goog.exportPath_(c)};goog.setTestOnly=function(c){if(COMPILED&&!goog.DEBUG)throw c=c||"",Error("Importing test-only code into non-debug environment"+c?": "+c:".");};
COMPILED||(goog.isProvided_=function(c){return!goog.implicitNamespaces_[c]&&!!goog.getObjectByName(c)},goog.implicitNamespaces_={});goog.getObjectByName=function(c,d){for(var e=c.split("."),f=d||goog.global,g;g=e.shift();)if(goog.isDefAndNotNull(f[g]))f=f[g];else return null;return f};goog.globalize=function(c,d){var e=d||goog.global,f;for(f in c)e[f]=c[f]};
goog.addDependency=function(c,d,e){if(goog.DEPENDENCIES_ENABLED){var f;c=c.replace(/\\/g,"/");for(var g=goog.dependencies_,h=0;f=d[h];h++)g.nameToPath[f]=c,c in g.pathToNames||(g.pathToNames[c]={}),g.pathToNames[c][f]=!0;for(f=0;d=e[f];f++)c in g.requires||(g.requires[c]={}),g.requires[c][d]=!0}};goog.ENABLE_DEBUG_LOADER=!0;
goog.require=function(c){if(!COMPILED&&!goog.isProvided_(c)){if(goog.ENABLE_DEBUG_LOADER){var d=goog.getPathFromDeps_(c);if(d){goog.included_[d]=!0;goog.writeScripts_();return}}c="goog.require could not find: "+c;goog.global.console&&goog.global.console.error(c);throw Error(c);}};goog.basePath="";goog.nullFunction=function(){};goog.identityFunction=function(c,d){return c};goog.abstractMethod=function(){throw Error("unimplemented abstract method");};
goog.addSingletonGetter=function(c){c.getInstance=function(){if(c.instance_)return c.instance_;goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=c);return c.instance_=new c}};goog.instantiatedSingletons_=[];goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;
goog.DEPENDENCIES_ENABLED&&(goog.included_={},goog.dependencies_={pathToNames:{},nameToPath:{},requires:{},visited:{},written:{}},goog.inHtmlDocument_=function(){var c=goog.global.document;return"undefined"!=typeof c&&"write"in c},goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH)goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_())for(var c=goog.global.document.getElementsByTagName("script"),d=c.length-1;0<=d;--d){var e=c[d].src,f=e.lastIndexOf("?"),f=-1==f?e.length:
f;if("base.js"==e.substr(f-7,7)){goog.basePath=e.substr(0,f-7);break}}},goog.importScript_=function(c){var d=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;!goog.dependencies_.written[c]&&d(c)&&(goog.dependencies_.written[c]=!0)},goog.writeScriptTag_=function(c){if(goog.inHtmlDocument_()){var d=goog.global.document;if("complete"==d.readyState){if(/\bdeps.js$/.test(c))return!1;throw Error('Cannot write "'+c+'" after document load');}d.write('<script type="text/javascript" src="'+c+'">\x3c/script>');
return!0}return!1},goog.writeScripts_=function(){function c(g){if(!(g in f.written)){if(!(g in f.visited)&&(f.visited[g]=!0,g in f.requires))for(var k in f.requires[g])if(!goog.isProvided_(k))if(k in f.nameToPath)c(f.nameToPath[k]);else throw Error("Undefined nameToPath for "+k);g in e||(e[g]=!0,d.push(g))}}var d=[],e={},f=goog.dependencies_,g;for(g in goog.included_)f.written[g]||c(g);for(g=0;g<d.length;g++)if(d[g])goog.importScript_(goog.basePath+d[g]);else throw Error("Undefined script input");
},goog.getPathFromDeps_=function(c){return c in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[c]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js"));
goog.typeOf=function(c){var d=typeof c;if("object"==d)if(c){if(c instanceof Array)return"array";if(c instanceof Object)return d;var e=Object.prototype.toString.call(c);if("[object Window]"==e)return"object";if("[object Array]"==e||"number"==typeof c.length&&"undefined"!=typeof c.splice&&"undefined"!=typeof c.propertyIsEnumerable&&!c.propertyIsEnumerable("splice"))return"array";if("[object Function]"==e||"undefined"!=typeof c.call&&"undefined"!=typeof c.propertyIsEnumerable&&!c.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==d&&"undefined"==typeof c.call)return"object";return d};goog.isDef=function(c){return void 0!==c};goog.isNull=function(c){return null===c};goog.isDefAndNotNull=function(c){return null!=c};goog.isArray=function(c){return"array"==goog.typeOf(c)};goog.isArrayLike=function(c){var d=goog.typeOf(c);return"array"==d||"object"==d&&"number"==typeof c.length};goog.isDateLike=function(c){return goog.isObject(c)&&"function"==typeof c.getFullYear};goog.isString=function(c){return"string"==typeof c};
goog.isBoolean=function(c){return"boolean"==typeof c};goog.isNumber=function(c){return"number"==typeof c};goog.isFunction=function(c){return"function"==goog.typeOf(c)};goog.isObject=function(c){var d=typeof c;return"object"==d&&null!=c||"function"==d};goog.getUid=function(c){return c[goog.UID_PROPERTY_]||(c[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(c){return!!c[goog.UID_PROPERTY_]};goog.removeUid=function(c){"removeAttribute"in c&&c.removeAttribute(goog.UID_PROPERTY_);try{delete c[goog.UID_PROPERTY_]}catch(d){}};
goog.UID_PROPERTY_="closure_uid_"+(1E9*Math.random()>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(c){var d=goog.typeOf(c);if("object"==d||"array"==d){if(c.clone)return c.clone();var d="array"==d?[]:{},e;for(e in c)d[e]=goog.cloneObject(c[e]);return d}return c};goog.bindNative_=function(c,d,e){return c.call.apply(c.bind,arguments)};
goog.bindJs_=function(c,d,e){if(!c)throw Error();if(2<arguments.length){var f=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(e,f);return c.apply(d,e)}}return function(){return c.apply(d,arguments)}};goog.bind=function(c,d,e){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_;return goog.bind.apply(null,arguments)};
goog.partial=function(c,d){var e=Array.prototype.slice.call(arguments,1);return function(){var d=e.slice();d.push.apply(d,arguments);return c.apply(this,d)}};goog.mixin=function(c,d){for(var e in d)c[e]=d[e]};goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date};
goog.globalEval=function(c){if(goog.global.execScript)goog.global.execScript(c,"JavaScript");else if(goog.global.eval)if(null==goog.evalWorksForGlobals_&&(goog.global.eval("var _et_ = 1;"),"undefined"!=typeof goog.global._et_?(delete goog.global._et_,goog.evalWorksForGlobals_=!0):goog.evalWorksForGlobals_=!1),goog.evalWorksForGlobals_)goog.global.eval(c);else{var d=goog.global.document,e=d.createElement("script");e.type="text/javascript";e.defer=!1;e.appendChild(d.createTextNode(c));d.body.appendChild(e);
d.body.removeChild(e)}else throw Error("goog.globalEval not available");};goog.evalWorksForGlobals_=null;goog.getCssName=function(c,d){var e=function(c){return goog.cssNameMapping_[c]||c},f=function(c){c=c.split("-");for(var d=[],f=0;f<c.length;f++)d.push(e(c[f]));return d.join("-")},f=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?e:f:function(c){return c};return d?c+"-"+f(d):f(c)};goog.setCssNameMapping=function(c,d){goog.cssNameMapping_=c;goog.cssNameMappingStyle_=d};
!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING);goog.getMsg=function(c,d){var e=d||{},f;for(f in e){var g=(""+e[f]).replace(/\$/g,"$$$$");c=c.replace(RegExp("\\{\\$"+f+"\\}","gi"),g)}return c};goog.getMsgWithFallback=function(c,d){return c};goog.exportSymbol=function(c,d,e){goog.exportPath_(c,d,e)};goog.exportProperty=function(c,d,e){c[d]=e};
goog.inherits=function(c,d){function e(){}e.prototype=d.prototype;c.superClass_=d.prototype;c.prototype=new e;c.prototype.constructor=c;c.base=function(c,e,h){var k=Array.prototype.slice.call(arguments,2);return d.prototype[e].apply(c,k)}};
goog.base=function(c,d,e){var f=arguments.callee.caller;if(goog.DEBUG&&!f)throw Error("arguments.caller not defined.  goog.base() expects not to be running in strict mode. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(f.superClass_)return f.superClass_.constructor.apply(c,Array.prototype.slice.call(arguments,1));for(var g=Array.prototype.slice.call(arguments,2),h=!1,k=c.constructor;k;k=k.superClass_&&k.superClass_.constructor)if(k.prototype[d]===f)h=!0;else if(h)return k.prototype[d].apply(c,
g);if(c[d]===f)return c.constructor.prototype[d].apply(c,g);throw Error("goog.base called from a method of one name to a method of a different name");};goog.scope=function(c){c.call(goog.global)};var og={Events:function(){}};og.Events.prototype.registerNames=function(c){for(var d=0;d<c.length;d++)this[c[d]]={active:!0,handlers:[]}};og.Events.prototype.on=function(c,d,e){this[c].handlers.push({sender:d,callback:e})};og.Events.prototype.dispatch=function(c,d){if(c&&c.active)for(var e=c.handlers,f=e.length;f--;){var g=e[f];g.callback.call(g.sender,d)}};og.layer={};og.layer.MAX_OVERLAYS=8;og.layer.MAX_REQUESTS=10;og.layer.layersCounter=0;og.layer.requestsCounter=0;og.layer.DEFAILT_Z_INDEX=0;og.layer.DEFAILT_OPACITY=1;
og.layer.Layer=function(c,d){this.name=c?c:"noname";this.planet=null;this.events=new og.Events;this.events.registerNames(["onload","onloadend","onvisibilitychanged"]);d&&(this.isBaseLayer=d.isBaseLayer?d.isBaseLayer:!1,this.numZoomLevels=d.numZoomLevels?d.numZoomLevels:-1,this.url=d.url?d.url:"",this.visibility=d.visibility?d.visibility:!1,this.opacity=d.opacity?d.opacity:og.layer.DEFAILT_OPACITY,this.transparentColor=d.transparentColor?d.transparentColor:[1,1,1],this.zIndex=d.zIndex?d.zIndex:og.layer.DEFAILT_Z_INDEX);
this.id=og.layer.layersCounter++;this.counter=0;this.pendingsQueue=[]};og.layer.Layer.prototype.clone=function(){};og.layer.Layer.prototype.setZIndex=function(c){this.zIndex=c;this.planet.updateVisibleLayers()};og.layer.Layer.prototype.abortLoading=function(){this.pendingsQueue.length=0};
og.layer.Layer.prototype.setVisibility=function(c){this.isBaseLayer&&c?this.planet.setBaseLayer(this):c||this.abortLoading();c!=this.visibility&&(this.events.dispatch(this.events.onvisibilitychanged,this),this.visibility=c,this.planet.updateVisibleLayers())};og.layer.Layer.prototype.getVisibility=function(){return this.visibility};og.layer.replaceTemplate=function(c,d){return c.replace(/{[^{}]+}/g,function(c){return d[c.replace(/[{}]+/g,"")]||""})};
og.layer.Layer.prototype.setUrl=function(c){this.url=c};og.layer.Layer.prototype.setName=function(c){this.name=c};og.inheritance={};og.inheritance.extend=function(c,d){var e=function(){};e.prototype=d.prototype;c.prototype=new e;c.prototype.constructor=c;c.superclass=d.prototype;c.superclass.constructor=d};og.inheritance.base=function(c){arguments.callee.caller.superclass.constructor.apply(c,Array.prototype.slice.call(arguments,1))};og.quadTree={};og.quadTree.NW=0;og.quadTree.NE=1;og.quadTree.SW=2;og.quadTree.SE=3;og.quadTree.N=0;og.quadTree.E=1;og.quadTree.S=2;og.quadTree.W=3;og.quadTree.WALKTHROUGH=0;og.quadTree.RENDERING=1;og.quadTree.NOTRENDERING=2;og.quadTree.RATIO_LOD=1.12;og.quadTree.OPSIDE=[og.quadTree.S,og.quadTree.W,og.quadTree.N,og.quadTree.E];og.quadTree.acceptableForRender=function(c,d){return c.projectedSize(d.center)>og.quadTree.RATIO_LOD*d.radius};og.layer.XYZ=function(c,d){og.inheritance.base(this,c,d)};og.inheritance.extend(og.layer.XYZ,og.layer.Layer);og.layer.XYZ.prototype.handleSegmentTile=function(c){og.layer.requestsCounter>=og.layer.MAX_REQUESTS&&this.counter?this.pendingsQueue.push(c):this.loadSegmentTileImage(c)};og.layer.XYZ.prototype.GetHTTPRequestString=function(c){return og.layer.replaceTemplate(this.url,{tilex:c.tileX.toString(),tiley:c.tileY.toString(),zoom:c.zoomIndex.toString()})};
og.layer.XYZ.prototype.loadSegmentTileImage=function(c){var d=this;this.counter++;og.layer.requestsCounter++;var e=new Image;e.crossOrigin="";e.onload=function(){var e=d.events.onload;e.length&&d.events.dispatch(e,{image:this,segment:c.segment});c.applyTexture.call(c,this);d.dequeueRequest()};e.onerror=function(){c&&c.textureNotExists.call(c);d.dequeueRequest()};c.segment.materials.length?e.src=this.GetHTTPRequestString(c.segment):this.dequeueRequest()};
og.layer.XYZ.prototype.dequeueRequest=function(){this.counter--;og.layer.requestsCounter--;if(this.pendingsQueue.length){if(og.layer.requestsCounter<og.layer.MAX_REQUESTS){var c;(c=this.whilePendings())&&this.loadSegmentTileImage.call(this,c)}}else this.events.dispatch(this.events.onloadend)};og.layer.XYZ.prototype.whilePendings=function(){for(;this.pendingsQueue.length;){var c=this.pendingsQueue.pop();if(c){if(c.segment.node.getState()!=og.quadTree.NOTRENDERING)return c;c.imageIsLoading=!1}}return null};og.input={};og.input.KEY_SPACE=32;og.input.KEY_H=72;og.input.KEY_C=67;og.input.KEY_X=88;og.input.KEY_E=69;og.input.KEY_Q=81;og.input.KEY_W=87;og.input.KEY_S=83;og.input.KEY_A=65;og.input.KEY_D=68;og.input.KEY_SHIFT=16;og.input.KEY_LEFT=37;og.input.KEY_RIGHT=39;og.input.KEY_UP=38;og.input.KEY_DOWN=40;og.input.KEY_F1=112;og.input.MB_LEFT=0;og.input.MB_RIGHT=2;og.input.MB_MIDDLE=1;og.control={};og.control.Control=function(c){this.renderer=null;this.activated=!1;c&&(this.autoActivate=c.autoActivate?c.autoActivate:!1,this.active=c.active?c.active:!1)};og.control.Control.prototype.setRenderer=function(c){this.renderer=c;this.autoActivate&&(this.initialize(),this.active=!0)};og.control.Control.prototype.initialize=function(){this.init&&this.init();this.activated=!0};og.control.Control.prototype.activate=function(){this.active=!0};
og.control.Control.prototype.deactivate=function(){this.active=!1};og.control.KeyboardNavigation=function(c){og.inheritance.base(this,c)};og.inheritance.extend(og.control.KeyboardNavigation,og.control.Control);
og.control.KeyboardNavigation.prototype.init=function(){this.renderer.events.on("onkeypressed",this,this.onCameraMoveForward,og.input.KEY_W);this.renderer.events.on("onkeypressed",this,this.onCameraMoveBackward,og.input.KEY_S);this.renderer.events.on("onkeypressed",this,this.onCameraStrifeLeft,og.input.KEY_A);this.renderer.events.on("onkeypressed",this,this.onCameraStrifeRight,og.input.KEY_D);this.renderer.events.on("onkeypressed",this,this.onCameraLookUp,og.input.KEY_UP);this.renderer.events.on("onkeypressed",
this,this.onCameraLookDown,og.input.KEY_DOWN);this.renderer.events.on("onkeypressed",this,this.onCameraTurnLeft,og.input.KEY_LEFT);this.renderer.events.on("onkeypressed",this,this.onCameraTurnRight,og.input.KEY_RIGHT);this.renderer.events.on("onkeypressed",this,this.onCameraRollLeft,og.input.KEY_Q);this.renderer.events.on("onkeypressed",this,this.onCameraRollRight,og.input.KEY_E);this.renderer.events.on("onkeypressed",this,this.onCameraGrowAlt,og.input.KEY_SPACE)};
og.control.KeyboardNavigation.prototype.onCameraGrowAlt=function(c){};og.control.KeyboardNavigation.prototype.onCameraMoveForward=function(c){c=this.renderer.activeCamera;c.slide(0,0,-c.lonLat.height/30)};og.control.KeyboardNavigation.prototype.onCameraMoveBackward=function(c){c=this.renderer.activeCamera;c.slide(0,0,c.lonLat.height/30)};og.control.KeyboardNavigation.prototype.onCameraStrifeLeft=function(c){c=this.renderer.activeCamera;c.slide(-c.lonLat.height/30,0,0)};
og.control.KeyboardNavigation.prototype.onCameraStrifeRight=function(c){c=this.renderer.activeCamera;c.slide(c.lonLat.height/30,0,0)};og.control.KeyboardNavigation.prototype.onCameraLookUp=function(c){c=this.renderer.activeCamera;this.renderer.events.isKeyPressed(og.input.KEY_SHIFT)?c.pitch(1):c.rotateVertical(c.lonLat.height/3E6*og.math.RADIANS,og.math.Vector3.ZERO)};
og.control.KeyboardNavigation.prototype.onCameraLookDown=function(c){c=this.renderer.activeCamera;this.renderer.events.isKeyPressed(og.input.KEY_SHIFT)?c.pitch(-1):c.rotateVertical(-c.lonLat.height/3E6*og.math.RADIANS,og.math.Vector3.ZERO)};og.control.KeyboardNavigation.prototype.onCameraTurnLeft=function(c){c=this.renderer.activeCamera;this.renderer.events.isKeyPressed(og.input.KEY_SHIFT)?c.yaw(1):c.rotateHorizontal(c.lonLat.height/3E6*og.math.RADIANS,!1,og.math.Vector3.ZERO)};
og.control.KeyboardNavigation.prototype.onCameraTurnRight=function(c){c=this.renderer.activeCamera;this.renderer.events.isKeyPressed(og.input.KEY_SHIFT)?c.yaw(-1):c.rotateHorizontal(-c.lonLat.height/3E6*og.math.RADIANS,!1,og.math.Vector3.ZERO)};og.control.KeyboardNavigation.prototype.onCameraRollLeft=function(c){this.renderer.activeCamera.roll(-1)};og.control.KeyboardNavigation.prototype.onCameraRollRight=function(c){this.renderer.activeCamera.roll(1)};og.math={};og.math.Vector3=function(c,d,e){this.x=c||0;this.y=d||0;this.z=e||0};og.math.Vector3.prototype.toVector4=function(){return new og.math.Vector4(this.x,this.y,this.z,1)};og.math.Vector3.UP=new og.math.Vector3(0,1,0);og.math.Vector3.DOWN=new og.math.Vector3(0,-1,0);og.math.Vector3.RIGHT=new og.math.Vector3(1,0,0);og.math.Vector3.LEFT=new og.math.Vector3(-1,0,0);og.math.Vector3.FORWARD=new og.math.Vector3(0,0,-1);og.math.Vector3.BACKWARD=new og.math.Vector3(0,0,1);og.math.Vector3.ZERO=new og.math.Vector3;
og.math.Vector3.prototype.clone=function(){return new og.math.Vector3(this.x,this.y,this.z)};og.math.Vector3.add=function(c,d){var e=new og.math.Vector3(c.x,c.y,c.z);e.add(d);return e};og.math.Vector3.sub=function(c,d){var e=new og.math.Vector3(c.x,c.y,c.z);e.sub(d);return e};og.math.Vector3.scale=function(c,d){var e=new og.math.Vector3(c.x,c.y,c.z);e.scale(d);return e};og.math.Vector3.mull=function(c,d){var e=new og.math.Vector3(c.x,c.y,c.z);e.mull(d);return e};
og.math.Vector3.div=function(c,d){var e=new og.math.Vector3(c.x,c.y,c.z);e.div(d);return e};og.math.Vector3.prototype.equal=function(c){return this.x===c.x&&this.y===c.y&&this.z===c.z};og.math.Vector3.prototype.copy=function(c){this.x=c.x;this.y=c.y;this.z=c.z;return this};og.math.Vector3.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};og.math.Vector3.prototype.getQuaternion=function(){return new og.math.Quaternion(this.x,this.y,this.z)};
og.math.Vector3.prototype.length2=function(){return this.x*this.x+this.y*this.y+this.z*this.z};og.math.Vector3.prototype.add=function(c){this.x+=c.x;this.y+=c.y;this.z+=c.z;return this};og.math.Vector3.prototype.sub=function(c){this.x-=c.x;this.y-=c.y;this.z-=c.z;return this};og.math.Vector3.prototype.scale=function(c){this.x*=c;this.y*=c;this.z*=c;return this};og.math.Vector3.prototype.scaleTo=function(c){return new og.math.Vector3(this.x*c,this.y*c,this.z*c)};
og.math.Vector3.prototype.mull=function(c){this.x*=c.x;this.y*=c.y;this.z*=c.z;return this};og.math.Vector3.prototype.div=function(c){this.x/=c.x;this.y/=c.y;this.z/=c.z;return this};og.math.Vector3.prototype.dot=function(c){return c.x*this.x+c.y*this.y+c.z*this.z};og.math.Vector3.prototype.dotArr=function(c){return c[0]*this.x+c[1]*this.y+c[2]*this.z};og.math.Vector3.prototype.cross=function(c){var d=new og.math.Vector3;d.set(this.y*c.z-this.z*c.y,this.z*c.x-this.x*c.z,this.x*c.y-this.y*c.x);return d};
og.math.Vector3.noncollinear=function(c,d){return c.y*d.z-c.z*d.y||c.z*d.x-c.x*d.z||c.x*d.y-c.y*d.z};og.math.Vector3.prototype.clear=function(){this.x=this.y=this.z=0;return this};og.math.Vector3.prototype.normal=function(){var c=new og.math.Vector3;c.copy(this);var d=1/c.length();c.x*=d;c.y*=d;c.z*=d;return c};og.math.Vector3.prototype.normalize=function(){var c=1/this.length();this.x*=c;this.y*=c;this.z*=c;return this};
og.math.Vector3.prototype.toVec=function(){var c=new og.math.GLArray(3);c[0]=this.x;c[1]=this.y;c[2]=this.z;return c};og.math.Vector3.prototype.distance=function(c){return og.math.Vector3.sub(this,c).length()};og.math.Vector3.prototype.set=function(c,d,e){this.x=c;this.y=d;this.z=e;return this};og.math.Vector3.prototype.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};og.math.Vector3.prototype.getNegate=function(){return new og.math.Vector3(-this.x,-this.y,-this.z)};
og.math.Vector3.proj_b_to_a=function(c,d){return d.scaleTo(d.dot(c)/d.dot(d))};og.math.Vector3.prototype.projToRay=function(c,d){var e=og.math.Vector3.proj_b_to_a(og.math.Vector3.sub(this,c),d);e.add(c);return e};og.math.Vector3.prototype.angle=function(c){return og.math.Vector3.angle(this,c)};og.math.Vector3.angle=function(c,d){return Math.acos(c.dot(d)/Math.sqrt(c.length2()*d.length2()))};
og.math.Vector3.prototype.lerp=function(c,d,e){var f=og.math.Vector3.clone(this);0>=e?f.copy(c):1<=e?f.copy(d):f=og.math.Vector3.add(c,og.math.Vector3.sub(d,c).scale(e));return f};og.math.Vector3.LERP_DELTA=1E-6;og.math.Vector3.prototype.slerp=function(c,d,e){var f=new og.math.Vector3;if(0>=e)f.copy(c);else if(1<=e)f.copy(d);else{var g,h,f=c.dot(d);1-f>Vector3.LERP_DELTA?(g=Math.acos(f),h=Math.sin(g),f=Math.sin((1-e)*g)/h,e=Math.sin(e*g)/h):f=1-e;return og.math.Vector3.add(c.scale(f),d.scale(e))}};
og.math.Vector3.orthoNormalize=function(c,d){c=c.normal();c.scale(d.dot(c));return d.sub(c).normalize()};og.math.GLArray="undefined"!=typeof Float32Array?Float32Array:"undefined"!=typeof WebGLFloatArray?WebGLFloatArray:Array;og.math.X=0;og.math.Y=1;og.math.Z=2;og.math.W=3;og.math.LOG2=Math.log(2);og.math.MAX=549755748352;og.math.MIN=-og.math.MAX;og.math.RADIANS=Math.PI/180;og.math.DEGREES=180/Math.PI;Math.PI=3.1415927410125732;og.math.EPSILON1=0.1;og.math.EPSILON2=0.01;og.math.EPSILON3=0.001;og.math.EPSILON4=1E-4;og.math.EPSILON5=1E-5;og.math.EPSILON6=1E-6;og.math.EPSILON7=1E-7;og.math.EPSILON8=1E-8;
og.math.EPSILON9=1E-9;og.math.EPSILON10=1E-10;og.math.EPSILON11=1E-11;og.math.EPSILON12=1E-12;og.math.EPSILON13=1E-13;og.math.EPSILON14=1E-14;og.math.EPSILON15=1E-15;og.math.EPSILON16=1E-16;og.math.EPSILON17=1E-17;og.math.EPSILON18=1E-18;og.math.EPSILON19=1E-19;og.math.EPSILON20=1E-20;og.math.log=function(c,d){return Math.log(c)/Math.log(d)};og.math.clamp=function(c,d,e){return Math.max(d,Math.min(c,e))};og.math.DEG2RAD=function(c){return c*og.math.RADIANS};og.math.RAD2DEG=function(c){return c*og.math.DEGREES};
og.math.isPowerOfTwo=function(c){return 0==(c&c-1)};og.math.nextHighestPowerOfTwo=function(c){--c;for(var d=1;32>d;d<<=1)c|=c>>d;return c+1};og.math.mod=function(c,d){return c-d*Math.floor(c/d)};og.math.step=function(c,d){return d<c?0:1};og.math.frac=function(c){return c-floor(c)};og.math.log2=function(c){return Math.log(c)/og.math.LOG2};og.math.exp2=function(c){return Math.pow(2,c)};og.math.slice=function(c,d,e){return c*(d-e)};og.math.lerp=function(c,d,e){return e+c*(d-e)};og.math.Vector4=function(c,d,e,f){this.x=c||0;this.y=d||0;this.z=e||0;this.w=f||0};og.math.Vector4.identity=new og.math.Vector4(0,0,0,1);og.math.Vector4.prototype.toVector3=function(){return new og.math.Vector3(this.x,this.y,this.z)};og.math.Vector4.prototype.clone=function(c){return new og.math.Vector4(this.x,this.y,this.z,this.w)};og.math.Vector4.prototype.equal=function(c){return this.x===c.x&&this.y===c.y&&this.z===c.z&&this.w===c.w};
og.math.Vector4.prototype.copy=function(c){this.x=c.x;this.y=c.y;this.z=c.z;this.w=c.w;return this};og.math.Vector4.prototype.toVec=function(){var c=new og.math.GLArray(4);c[0]=this.x;c[1]=this.y;c[2]=this.z;c[3]=this.w;return c};og.math.Vector4.fromVec=function(c){return new og.math.Vector4(c[0],c[1],c[2],c[3])};og.math.Vector4.prototype.set=function(c,d,e,f){this.x=c;this.y=d;this.z=e;this.w=f;return this};
og.math.Vector4.prototype.add=function(c){this.x+=c.x;this.y+=c.y;this.z+=c.z;this.w+=c.w;return this};og.math.Vector4.prototype.sub=function(c){this.x-=c.x;this.y-=c.y;this.z-=c.z;this.w-=c.w;return this};og.math.Vector4.prototype.scale=function(c){this.x*=c;this.y*=c;this.z*=c;this.w*=c;return this};og.math.Vector4.prototype.affinity=function(){var c=1/this.w;this.x*=c;this.y*=c;this.z*=c;this.w=1;return this};
og.math.Vector4.prototype.scaleTo=function(c){return new og.math.Vector4(this.x*c,this.y*c,this.z*c,this.w*c)};og.math.Vector4.prototype.getStep=function(c){return new og.math.Vector4(this.x<c?0:1,this.y<c?0:1,this.z<c?0:1,this.w<c?0:1)};og.math.Vector4.prototype.getFrac=function(c){return new og.math.Vector4(og.math.frac(c.x),og.math.frac(c.y),og.math.frac(c.z),og.math.frac(c.w))};og.math.Matrix4=function(){this._m=Array(16)};og.math.Matrix4.prototype.set=function(c){this._m[0]=c[0];this._m[1]=c[1];this._m[2]=c[2];this._m[3]=c[3];this._m[4]=c[4];this._m[5]=c[5];this._m[6]=c[6];this._m[7]=c[7];this._m[8]=c[8];this._m[9]=c[9];this._m[10]=c[10];this._m[11]=c[11];this._m[12]=c[12];this._m[13]=c[13];this._m[14]=c[14];this._m[15]=c[15];return this};og.math.Matrix4.prototype.clone=function(){var c=new og.math.Matrix4;c.set(this);return c};og.math.Matrix4.prototype.copy=function(c){this.set(c._m)};
og.math.Matrix4.prototype.mulVec3=function(c){return new og.math.Vector3(this._m[0]*c.x+this._m[4]*c.y+this._m[8]*c.z+this._m[12],this._m[1]*c.x+this._m[5]*c.y+this._m[9]*c.z+this._m[13],this._m[2]*c.x+this._m[6]*c.y+this._m[10]*c.z+this._m[14])};
og.math.Matrix4.prototype.mulVec4=function(c){var d=c.x,e=c.y,f=c.z;c=c.w;return new og.math.Vector4(this._m[0]*d+this._m[4]*e+this._m[8]*f+this._m[12]*c,this._m[1]*d+this._m[5]*e+this._m[9]*f+this._m[13]*c,this._m[2]*d+this._m[6]*e+this._m[10]*f+this._m[14]*c,this._m[3]*d+this._m[7]*e+this._m[11]*f+this._m[15]*c)};
og.math.Matrix4.prototype.inverse=function(){var c=this._m[0],d=this._m[1],e=this._m[2],f=this._m[3],g=this._m[4],h=this._m[5],k=this._m[6],m=this._m[7],l=this._m[8],n=this._m[9],q=this._m[10],r=this._m[11],s=this._m[12],t=this._m[13],p=this._m[14],A=this._m[15],u=c*h-d*g,B=c*k-e*g,v=c*m-f*g,G=d*k-e*h,H=d*m-f*h,F=e*m-f*k,D=l*t-n*s,I=l*p-q*s,J=l*A-r*s,K=n*p-q*t,L=n*A-r*t,M=q*A-r*p,E=1/(u*M-B*L+v*K+G*J-H*I+F*D),C=new og.math.Matrix4;C._m[0]=(h*M-k*L+m*K)*E;C._m[1]=(-d*M+e*L-f*K)*E;C._m[2]=(t*F-p*H+
A*G)*E;C._m[3]=(-n*F+q*H-r*G)*E;C._m[4]=(-g*M+k*J-m*I)*E;C._m[5]=(c*M-e*J+f*I)*E;C._m[6]=(-s*F+p*v-A*B)*E;C._m[7]=(l*F-q*v+r*B)*E;C._m[8]=(g*L-h*J+m*D)*E;C._m[9]=(-c*L+d*J-f*D)*E;C._m[10]=(s*H-t*v+A*u)*E;C._m[11]=(-l*H+n*v-r*u)*E;C._m[12]=(-g*K+h*I-k*D)*E;C._m[13]=(c*K-d*I+e*D)*E;C._m[14]=(-s*G+t*B-p*u)*E;C._m[15]=(l*G-n*B+q*u)*E;return C};
og.math.Matrix4.prototype.transpose=function(){var c=new og.math.Matrix4;c._m[0]=this._m[0];c._m[1]=this._m[4];c._m[2]=this._m[8];c._m[3]=this._m[12];c._m[4]=this._m[1];c._m[5]=this._m[5];c._m[6]=this._m[9];c._m[7]=this._m[13];c._m[8]=this._m[2];c._m[9]=this._m[6];c._m[10]=this._m[10];c._m[11]=this._m[14];c._m[12]=this._m[3];c._m[13]=this._m[7];c._m[14]=this._m[11];c._m[15]=this._m[15];return c};
og.math.Matrix4.prototype.setIdentity=function(){this._m[0]=1;this._m[1]=0;this._m[2]=0;this._m[3]=0;this._m[4]=0;this._m[5]=1;this._m[6]=0;this._m[7]=0;this._m[8]=0;this._m[9]=0;this._m[10]=1;this._m[11]=0;this._m[12]=0;this._m[13]=0;this._m[14]=0;this._m[15]=1;return this};
og.math.Matrix4.identity=function(){var c=new og.math.Matrix4;c._m[0]=1;c._m[1]=0;c._m[2]=0;c._m[3]=0;c._m[4]=0;c._m[5]=1;c._m[6]=0;c._m[7]=0;c._m[8]=0;c._m[9]=0;c._m[10]=1;c._m[11]=0;c._m[12]=0;c._m[13]=0;c._m[14]=0;c._m[15]=1;return c};
og.math.Matrix4.prototype.mul=function(c){var d=this._m[0],e=this._m[1],f=this._m[2],g=this._m[3],h=this._m[4],k=this._m[5],m=this._m[6],l=this._m[7],n=this._m[8],q=this._m[9],r=this._m[10],s=this._m[11],t=this._m[12],p=this._m[13],A=this._m[14];a=this._m[15];var u=c._m[0],B=c._m[1],v=c._m[2],G=c._m[3],H=c._m[4],F=c._m[5],D=c._m[6],I=c._m[7],J=c._m[8],K=c._m[9],L=c._m[10],M=c._m[11],E=c._m[12],C=c._m[13],N=c._m[14];b=c._m[15];c=new og.math.Matrix4;c._m[0]=u*d+B*h+v*n+G*t;c._m[1]=u*e+B*k+v*q+G*p;c._m[2]=
u*f+B*m+v*r+G*A;c._m[3]=u*g+B*l+v*s+G*a;c._m[4]=H*d+F*h+D*n+I*t;c._m[5]=H*e+F*k+D*q+I*p;c._m[6]=H*f+F*m+D*r+I*A;c._m[7]=H*g+F*l+D*s+I*a;c._m[8]=J*d+K*h+L*n+M*t;c._m[9]=J*e+K*k+L*q+M*p;c._m[10]=J*f+K*m+L*r+M*A;c._m[11]=J*g+K*l+L*s+M*a;c._m[12]=E*d+C*h+N*n+b*t;c._m[13]=E*e+C*k+N*q+b*p;c._m[14]=E*f+C*m+N*r+b*A;c._m[15]=E*g+C*l+N*s+b*a;return c};
og.math.Matrix4.prototype.translate=function(c){var d=c.x,e=c.y;c=c.z;var f=this._m;f[12]=f[0]*d+f[4]*e+f[8]*c+f[12];f[13]=f[1]*d+f[5]*e+f[9]*c+f[13];f[14]=f[2]*d+f[6]*e+f[10]*c+f[14];f[15]=f[3]*d+f[7]*e+f[11]*c+f[15];return this};og.math.Matrix4.prototype.translateToPosition=function(c){var d=this._m;d[12]=c.x;d[13]=c.y;d[14]=c.z;return this};
og.math.Matrix4.prototype.rotate=function(c,d){var e=Math.cos(d),f=Math.sin(d),g=this._m;g[0]=e+(1-e)*c.x*c.x;g[1]=(1-e)*c.y*c.x-f*c.z;g[2]=(1-e)*c.z*c.x+f*c.y;g[3]=0;g[4]=(1-e)*c.x*c.y+f*c.z;g[5]=e+(1-e)*c.y*c.y;g[6]=(1-e)*c.z*c.y-f*c.x;g[7]=0;g[8]=(1-e)*c.x*c.z-f*c.y;g[9]=(1-e)*c.y*c.z+f*c.x;g[10]=e+(1-e)*c.z*c.z;g[11]=0;g[12]=0;g[13]=0;g[14]=0;g[15]=1;return this};og.math.Matrix4.prototype.rotateBetweenVectors=function(c,d){return og.math.Quaternion.getRotationBetweenVectors(c,d).getMatrix4()};
og.math.Matrix4.prototype.scale=function(c){var d=this._m;d[0]*=c.x;d[1]*=c.x;d[2]*=c.x;d[3]*=c.x;d[4]*=c.y;d[5]*=c.y;d[6]*=c.y;d[7]*=c.y;d[8]*=c.z;d[9]*=c.z;d[10]*=c.z;d[11]*=c.z;d[12]=d[12];d[13]=d[13];d[14]=d[14];d[15]=d[15];return this};
og.math.Matrix4.prototype.setFrustum=function(c,d,e,f,g,h){this.right=d;this.left=c;this.top=f;this.bottom=e;this.far=h;this.near=g;var k=d-c,m=f-e,l=h-g;this._m[0]=2*g/k;this._m[1]=0;this._m[2]=0;this._m[3]=0;this._m[4]=0;this._m[5]=2*g/m;this._m[6]=0;this._m[7]=0;this._m[8]=(d+c)/k;this._m[9]=(f+e)/m;this._m[10]=-(h+g)/l;this._m[11]=-1;this._m[12]=0;this._m[13]=0;this._m[14]=-(2*h*g)/l;this._m[15]=0;return this};
og.math.Matrix4.prototype.setPerspective=function(c,d,e,f){c=e*Math.tan(c*Math.PI/360);d*=c;return this.setFrustum(-d,d,-c,c,e,f)};og.math.Matrix4.prototype.eulerToMatrix=function(c,d,e){var f=Math.cos(c);c=Math.sin(c);var g=Math.cos(d);d=Math.sin(d);var h=Math.cos(e);e=Math.sin(e);var k=f*d,m=c*d,l=this._m;l[0]=g*h;l[1]=-g*e;l[2]=-d;l[4]=-m*h+f*e;l[5]=m*e+f*h;l[6]=-c*g;l[8]=k*h+c*e;l[9]=-k*e+c*h;l[10]=f*g;l[3]=l[7]=l[11]=l[12]=l[13]=l[14]=0;l[15]=1};og.math.Matrix4.prototype.getEulerAngles=function(){};og.math.Pixel=function(c,d){this.x=c||0;this.y=d||0};og.Frustum=function(){this._f=Array(6);for(var c=0;6>c;c++)this._f[c]=Array(4)};
og.Frustum.prototype.setFrustum=function(c){this._f[0][0]=c[3]-c[0];this._f[0][1]=c[7]-c[4];this._f[0][2]=c[11]-c[8];this._f[0][3]=c[15]-c[12];this.planeNormalize(this._f[0]);this._f[1][0]=c[3]+c[0];this._f[1][1]=c[7]+c[4];this._f[1][2]=c[11]+c[8];this._f[1][3]=c[15]+c[12];this.planeNormalize(this._f[1]);this._f[2][0]=c[3]+c[1];this._f[2][1]=c[7]+c[5];this._f[2][2]=c[11]+c[9];this._f[2][3]=c[15]+c[13];this.planeNormalize(this._f[2]);this._f[3][0]=c[3]-c[1];this._f[3][1]=c[7]-c[5];this._f[3][2]=c[11]-
c[9];this._f[3][3]=c[15]-c[13];this.planeNormalize(this._f[3]);this._f[4][0]=c[3]-c[2];this._f[4][1]=c[7]-c[6];this._f[4][2]=c[11]-c[10];this._f[4][3]=c[15]-c[14];this.planeNormalize(this._f[4]);this._f[5][0]=c[3]+c[2];this._f[5][1]=c[7]+c[6];this._f[5][2]=c[11]+c[10];this._f[5][3]=c[15]+c[14];this.planeNormalize(this._f[5])};og.Frustum.prototype.planeNormalize=function(c){var d=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);c[0]/=d;c[1]/=d;c[2]/=d;c[3]/=d};
og.Frustum.prototype.containsPoint=function(c){for(var d,e=0;6>e;e++)if(d=c.dotArr(this._f[e])+this._f[e][3],0>=d)return!1;return!0};og.Frustum.prototype.containsSphere=function(c){for(var d,e=0;6>e;e++)if(d=c.center.dotArr(this._f[e])+this._f[e][3],d<=-c.radius)return-1;return d+c.radius};og.Frustum.prototype.containsBox=function(c){for(var d=!0,e,f,g=0;6>g;g++){for(var h=f=e=0;8>h&&(0==f||0==e);h++)0>c.vertices[h].dotArr(this._f[g])+this._f[g][3]?e++:f++;if(0==f)return!1;0<e&&(d=!0)}return d};og.Camera=function(c,d){this.events=new og.Events;this.renderer=null;this.events.registerNames(["onviewchanged"]);this.eye=new og.math.Vector3;this.u=new og.math.Vector3(0,1,0);this.v=new og.math.Vector3(1,0,0);this.n=new og.math.Vector3(0,0,1);this.viewAngle=this.farDist=this.nearDist=this.aspect=0;this.pMatrix=new og.math.Matrix4;this.mvMatrix=new og.math.Matrix4;this.pmvMatrix=new og.math.Matrix4;this.ipmvMatrix=new og.math.Matrix4;this.frustum=new og.Frustum;this.pMatrixPrecise=new og.math.Matrix4;
c&&this.init(c,d)};og.Camera.clone=function(c){var d=new og.Camera;d.eye.copy(c.eye);d.u.copy(c.u);d.v.copy(c.v);d.n.copy(c.n);d.renderer=c.renderer;d.pMatrix.copy(c.pMatrix);d.mvMatrix.copy(c.mvMatrix);d.pmvMatrix.copy(c.pmvMatrix);d.ipmvMatrix.copy(c.ipmvMatrix);d.frustum.setFrustum(d.pmvMatrix);d.ellipsoid=c.ellipsoid;d.lonLat=c.lonLat.clone();return d};
og.Camera.defaultOptions={viewAngle:35,nearDist:1,farDist:og.math.MAX,eye:new og.math.Vector3(0,0,0),look:new og.math.Vector3(0,0,0),up:new og.math.Vector3(0,1,0)};
og.Camera.prototype.init=function(c,d){this.renderer=c;d?(this.setProjectionMatrix(d.viewAngle?d.viewAngle:og.Camera.defaultOptions.viewAngle,this.renderer.handler.gl.canvas.aspect,d.nearDist?d.nearDist:og.Camera.defaultOptions.nearDist,d.farDist?d.farDist:og.Camera.defaultOptions.farDist),this.set(d.eye?d.eye:og.Camera.defaultOptions.eye.clone(),d.look?d.look:og.Camera.defaultOptions.look.clone(),d.up?d.up:og.Camera.defaultOptions.up.clone())):this.initDefaults();this.update()};
og.Camera.prototype.initDefaults=function(){this.setProjectionMatrix(og.Camera.defaultOptions.viewAngle,this.renderer.handler.gl.canvas.aspect,og.Camera.defaultOptions.nearDist,og.Camera.defaultOptions.farDist);this.set(Camera.defaultOptions.eye.clone(),Camera.defaultOptions.look.clone(),Camera.defaultOptions.up.clone())};
og.Camera.prototype.update=function(){this.setModelViewMatrix();this.pmvMatrix=this.pMatrix.mul(this.mvMatrix);this.frustum.setFrustum(this.pmvMatrix._m);this.events.dispatch(this.events.onviewchanged,this)};og.Camera.prototype.setModelViewMatrix=function(){this.mvMatrix.set([this.u.x,this.v.x,this.n.x,0,this.u.y,this.v.y,this.n.y,0,this.u.z,this.v.z,this.n.z,0,-this.eye.dot(this.u),-this.eye.dot(this.v),-this.eye.dot(this.n),1])};
og.Camera.prototype.refresh=function(){this.setProjectionMatrix(this.viewAngle,this.renderer.handler.gl.canvas.aspect,this.nearDist,this.farDist);this.update()};og.Camera.prototype.setFarVisibilityDistance=function(c){this.farDist=c;this.refresh()};og.Camera.prototype.setNearVisibilityDistance=function(c){this.nearDist=c;this.refresh()};og.Camera.prototype.setDistanceVisibility=function(c,d){this.nearDist=d||this.nearDist;this.farDist=c?d+c:d+this.farDist-this.nearDist;this.refresh()};
og.Camera.prototype.setProjectionMatrix=function(c,d,e,f){this.viewAngle=c;this.aspect=d;this.nearDist=e;this.farDist=f;this.pMatrix.setPerspective(c,d,e,f);this.pMatrixPrecise.setPerspective(c,d,0.1,10)};og.Camera.prototype.setViewAngle=function(c){this.viewAngle=c;this.refresh()};og.Camera.prototype.set=function(c,d,e){this.eye.copy(c);this.n.set(c.x-d.x,c.y-d.y,c.z-d.z);this.u.copy(e.cross(this.n));this.n.normalize();this.u.normalize();this.v.copy(this.n.cross(this.u));this.update()};
og.Camera.prototype.look=function(c,d){this.n.set(this.eye.x-c.x,this.eye.y-c.y,this.eye.z-c.z);this.u.copy((d?d:this.v).cross(this.n));this.n.normalize();this.u.normalize();this.v.copy(this.n.cross(this.u));this.update()};og.Camera.prototype.slide=function(c,d,e){this.eye.x+=c*this.u.x+d*this.v.x+e*this.n.x;this.eye.y+=c*this.u.y+d*this.v.y+e*this.n.y;this.eye.z+=c*this.u.z+d*this.v.z+e*this.n.z;this.update()};
og.Camera.prototype.roll=function(c){var d=Math.cos(og.math.RADIANS*c);c=Math.sin(og.math.RADIANS*c);var e=this.u.clone();this.u.set(d*e.x-c*this.v.x,d*e.y-c*this.v.y,d*e.z-c*this.v.z);this.v.set(c*e.x+d*this.v.x,c*e.y+d*this.v.y,c*e.z+d*this.v.z);this.update()};
og.Camera.prototype.pitch=function(c){var d=Math.cos(og.math.RADIANS*c);c=Math.sin(og.math.RADIANS*c);var e=this.n.clone();this.n.set(d*e.x-c*this.v.x,d*e.y-c*this.v.y,d*e.z-c*this.v.z);this.v.set(c*e.x+d*this.v.x,c*e.y+d*this.v.y,c*e.z+d*this.v.z);this.update()};
og.Camera.prototype.yaw=function(c){var d=Math.cos(og.math.RADIANS*c);c=Math.sin(og.math.RADIANS*c);var e=this.u.clone();this.u.set(d*e.x-c*this.n.x,d*e.y-c*this.n.y,d*e.z-c*this.n.z);this.n.set(c*e.x+d*this.n.x,c*e.y+d*this.n.y,c*e.z+d*this.n.z);this.update()};
og.Camera.prototype.unproject=function(c,d){var e=(c-this.renderer.handler.gl.canvas.width/2)/(this.renderer.handler.gl.canvas.width/2),f=-(d-this.renderer.handler.gl.canvas.height/2)/(this.renderer.handler.gl.canvas.height/2);this.ipmvMatrix=this.pMatrixPrecise.mul(this.mvMatrix).inverse();var g=this.ipmvMatrix.mulVec4(new og.math.Vector4(e,f,-1,1)).affinity();return this.ipmvMatrix.mulVec4(new og.math.Vector4(e,f,0,1)).affinity().sub(g).toVector3().normalize()};
og.Camera.prototype.project=function(c){c=this.pmvMatrix.mulVec4(c.toVector4());return new og.math.Pixel((1+c.x/c.w)*this.gl.canvas.width/2,(1-c.y/c.w)*this.gl.canvas.height/2)};og.Camera.prototype.setEye=function(c){this.eye.copy(c);this.update()};og.Camera.prototype.setAltitude=function(c){var d=this.eye.normal();this.eye=this.earthPoint.earth.add(d.scale(c));this.altitude=c;this.update()};
og.Camera.prototype.rotateAround=function(c,d,e,f){e=e||og.math.Vector3.ZERO;f=f||og.math.Vector3.UP;c=(new og.math.Matrix4).rotate(d?this.v:f,c);d=(new og.math.Matrix4).setIdentity().translate(e);e=(new og.math.Matrix4).setIdentity().translate(e.getNegate());this.eye=d.mul(c).mul(e).mulVec3(this.eye);this.v=c.mulVec3(this.v);this.u=c.mulVec3(this.u);this.n=c.mulVec3(this.n);this.update()};og.Camera.prototype.rotateHorizontal=function(c,d,e,f){this.rotateAround(c,d,e,f)};
og.Camera.prototype.rotateVertical=function(c,d,e){this.rotateAround(c,!1,d,this.u)};og.Camera.prototype.projectedSize=function(c){return this.eye.distance(c)*Math.tan(0.5*this.viewAngle*og.math.RADIANS)};og.input.MouseHandler=function(c){this._htmlObject=c};
og.input.MouseHandler.prototype.setEvent=function(c,d,e,f){switch(c){case "onmousewheel":c=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";this._htmlObject.attachEvent?this._htmlObject.attachEvent("on"+c,function(c){e.call(d,c)}):this._htmlObject.addEventListener&&this._htmlObject.addEventListener(c,function(c){c.wheelDelta=-120*c.detail;e.call(d,c)},!1);break;case "onmousedown":this._htmlObject.onmousedown=function(c){e.call(d,c)};this._htmlObject.oncontextmenu=function(c){return!1};
break;case "onmouseup":this._htmlObject.onmouseup=function(c){e.call(d,c)};break;case "onmousemove":this._htmlObject.onmousemove=function(c){var f=this.getBoundingClientRect();e.call(d,{clientX:c.clientX-f.left,clientY:c.clientY-f.top})}}};og.input.KeyboardHandler=function(){var c={},d={},e={},f=this;if(og.input.KeyboardHandler.prototype._instance)return og.input.KeyboardHandler.prototype._instance;og.input.KeyboardHandler.prototype._instance=this;document.onkeydown=function(c){f.handleKeyDown.call(f,c)};document.onkeyup=function(c){f.handleKeyUp.call(f,c)};var g=function(c,d){return c.priority<d.priority};this.addEvent=function(c,f,m,l,n){void 0===n&&(n=1600);switch(c){case "onkeypressed":d[l]||(d[l]=[]);d[l].push({callback:m,sender:f,
priority:n});d[l].sort(g);break;case "oncharkeypressed":e[l]||(e[l]=[]),e[l].push({callback:m,sender:f,priority:n}),e[l].sort(g)}};this.isKeyPressed=function(d){return c[d]};this.handleKeyDown=function(d){c[d.keyCode]=!0;for(var f in e)if(String.fromCharCode(d.keyCode)==String.fromCharCode(f))for(var g=e[f],l=0;l<g.length;l++)g[l].callback.call(g[l].sender)};this.handleKeyUp=function(d){c[d.keyCode]=!1};this.handleEvents=function(){for(var e in d)if(c[e])for(var f=d[e],g=0;g<f.length;g++)f[g].callback.call(f[g].sender)}};og.RendererEvents=function(c){og.inheritance.base(this);this.mouseHandler=new og.input.MouseHandler(c);this.keyboardHandler=new og.input.KeyboardHandler;this.mouseState={x:0,y:0,prev_x:0,prev_y:0,direction:new og.math.Vector3,leftButtonUp:!1,rightButtonUp:!1,leftButtonDown:!1,rightButtonDown:!1,leftButtonHold:!1,rightButtonHold:!1,leftButtonDoubleClick:!1,click:!1,moving:!1,justStopped:!1,doubleClickDelay:300,wheelDelta:0};this._mousestopThread=null;this._clickY=this._clickX=this._dblClkBegins=0};
og.inheritance.extend(og.RendererEvents,og.Events);og.RendererEvents.prototype.handleEvents=function(){this.keyboardHandler.handleEvents();this.handleMouseEvents()};og.RendererEvents.prototype.on=function(c,d,e,f,g){this[c]?this.constructor.superclass.on.call(this,c,d,e):this.keyboardHandler.addEvent(c,d,e,f,g)};og.RendererEvents.prototype.isKeyPressed=function(c){return this.keyboardHandler.isKeyPressed(c)};
og.RendererEvents.prototype.initialize=function(){this.registerNames("ondraw onmousemove onmousestop onmouselbuttondoubleclick onmouseclick onmouselbuttondown onmouselbuttonhold onmouserbuttondown onmouserbuttonhold onmouselbuttonup onmouserbuttonup onresize onmousewheel".split(" "));this.mouseHandler.setEvent("onmouseup",this,this.onMouseUp);this.mouseHandler.setEvent("onmousemove",this,this.onMouseMove);this.mouseHandler.setEvent("onmousedown",this,this.onMouseDown);this.mouseHandler.setEvent("onmousewheel",
this,this.onMouseWheel)};og.RendererEvents.prototype.onMouseWheel=function(c){this.mouseState.wheelDelta=c.wheelDelta};og.RendererEvents.prototype.onMouseMove=function(c){var d=this.mouseState;if(d.x!=c.clientX||d.y!=c.clientY)d.x=c.clientX,d.y=c.clientY,d.moving=!0,clearTimeout(this._mousestopThread),this._mousestopThread=setTimeout(function(){d.justStopped=!0},100)};
og.RendererEvents.prototype.onMouseDown=function(c){c.button===og.input.MB_LEFT?(this._clickX=c.clientX,this._clickY=c.clientY,this.mouseState.leftButtonDown=!0):this.mouseState.rightButtonDown=!0};
og.RendererEvents.prototype.onMouseUp=function(c){var d=this.mouseState;c.button===og.input.MB_LEFT?(d.leftButtonDown=!1,d.leftButtonHold=!1,d.leftButtonUp=!0,this._dblClkBegins?((new Date).getTime()-this._dblClkBegins<=d.doubleClickDelay&&(d.leftButtonDoubleClick=!0),this._dblClkBegins=0):this._dblClkBegins=(new Date).getTime(),this._clickX==c.clientX&&this._clickY==c.clientY&&(d.click=!0)):(d.rightButtonDown=!1,d.rightButtonHold=!1,d.rightButtonUp=!0)};
og.RendererEvents.prototype.handleMouseEvents=function(){var c=this.mouseState,d=this.dispatch;c.click&&(d(this.onmouseclick,c),c.click=!1);c.leftButtonDown&&(c.leftButtonHold?d(this.onmouselbuttonhold,c):(c.leftButtonHold=!0,d(this.onmouselbuttondown,c)));c.rightButtonDown&&(c.rightButtonHold?d(this.onmouserbuttonhold,c):(c.rightButtonHold=!0,d(this.onmouserbuttondown,c)));c.leftButtonUp&&(c.leftButtonUp=!1,d(this.onmouselbuttonup,c));c.rightButtonUp&&(c.rightButtonUp=!1,d(this.onmouserbuttonup,
c));c.leftButtonDoubleClick&&(d(this.onmouselbuttondoubleclick,c),c.leftButtonDoubleClick=!1);c.wheelDelta&&(d(this.onmousewheel,c),c.wheelDelta=0);c.moving&&(d(this.onmousemove,c),c.prev_x=c.x,c.prev_y=c.y,this._dblClkBegins=0);c.justStopped&&(d(this.onmousestop,c),c.justStopped=!1)};og.Renderer=function(c){this.div=null;this.handler=c;this._renderNodesArr=[];this.renderNodes={};this.cameras=[];this.activeCamera;this.events=new og.RendererEvents(c.gl.canvas);this.controls=[];this.controlsBag={}};og.Renderer.prototype.getWidth=function(){return this.handler.gl.canvas.width};og.Renderer.prototype.getHeight=function(){return this.handler.gl.canvas.height};og.Renderer.prototype.addControl=function(c){c.setRenderer(this);this.controls.push(c)};
og.Renderer.prototype.addControls=function(c){for(var d=0;d<c.length;d++)c[d].setRenderer(this),this.controls.push(c[d])};og.Renderer.prototype.removeControl=function(c){for(var d=0;d<this.controls.length;d++)if(this.controls[d]==c)return this.controls.splice(d,1),c.deactivate(),c};
og.Renderer.prototype.init=function(){var c=this;this.handler.drawback=function(){c.draw()};this.activeCamera=new og.Camera(this,{eye:new og.math.Vector3(0,0,12E6),look:new og.math.Vector3(0,0,0),up:new og.math.Vector3(0,1,0)});this.events.initialize();this.handler.onCanvasResize=function(d){c.activeCamera.refresh();c.events.dispatch(c.events.onresize,d)}};
og.Renderer.prototype.addRenderNode=function(c){this.renderNodes[c.name]?alert("Node name: "+c.name+" allready exists."):(c.assignRenderer(this),c.initialization(),this._renderNodesArr.push(c),this.renderNodes[c.name]=c)};og.Renderer.prototype.addRenderNodes=function(c){for(var d=0;d<c;d++)this.addRenderNode(c[d])};
og.Renderer.prototype.draw=function(){this.events.mouseState.direction=this.activeCamera.unproject(this.events.mouseState.x,this.events.mouseState.y);this.events.handleEvents();for(var c=0;c<this._renderNodesArr.length;c++)this._renderNodesArr[c].drawNode();this.events.dispatch(this.events.ondraw,this);this.events.mouseState.moving=!1};og.Renderer.prototype.start=function(){this.handler.start()};og.LonLat=function(c,d,e){this.lon=c||0;this.lat=d||0;this.height=e||0};og.LonLat.prototype.set=function(c,d,e){this.lon=c;this.lat=d;this.height=e};og.LonLat.createFromArray=function(c){return new og.LonLat(c[0],c[1],c[2])};og.LonLat.prototype.clone=function(){return new og.LonLat(this.lon,this.lat,this.height)};
og.LonLat.prototype.toTile=function(c){return{x:Math.floor((this.lon+180)/360*Math.pow(2,c)),y:Math.floor((1-Math.log(Math.tan(this.lat*Math.PI/180)+1/Math.cos(this.lat*Math.PI/180))/Math.PI)/2*Math.pow(2,c))}};og.Extent=function(c,d){this.southWest=c||new og.LonLat;this.northEast=d||new og.LonLat};og.Extent.createFromArray=function(c){return new og.Extent(new og.LonLat(c[0],c[1]),new og.LonLat(c[2],c[3]))};og.Extent.prototype.isInside=function(c){var d=this.southWest,e=this.northEast;return c.lon>=d.lon&&c.lon<=e.lon&&c.lat>=d.lat&&c.lat<=e.lat};og.Extent.prototype.getWidth=function(){return this.northEast.lon-this.southWest.lon};og.Extent.prototype.getHeight=function(){return this.northEast.lat-this.southWest.lat};
og.Extent.prototype.clone=function(){return new og.Extent(this.sw,this.ne)};og.Extent.prototype.getCenter=function(){var c=this.southWest,d=this.northEast;return new og.LonLat(c.lon+0.5*(d.lon-c.lon),c.lat+0.5*(d.lat-c.lat))};og.Extent.prototype.getNorthWest=function(){return new og.LonLat(this.northEast.lon,this.southWest.lat)};og.Extent.prototype.getNorthEast=function(){return new og.LonLat(this.northEast.lon,this.northEast.lat)};
og.Extent.prototype.getSouthWest=function(){return new og.LonLat(this.southWest.lon,this.southWest.lat)};og.Extent.prototype.getSouthEast=function(){return new og.LonLat(this.southWest.lon,this.northEast.lat)};og.Extent.prototype.getNorth=function(){return this.northEast.lat};og.Extent.prototype.getEast=function(){return this.northEast.lon};og.Extent.prototype.getWest=function(){return this.southWest.lon};og.Extent.prototype.getSouth=function(){return this.southWest.lat};
og.Extent.fromTile=function(c,d,e){var f=Math.pow(2,zoom);e=360/Math.pow(2,zoom);f=180/f;c=-180+c*e;d=90-d*f;e=c+e;return new og.Extent(new og.LonLat(c,d-f),new og.LonLat(e,d))};og.mercator={};og.mercator.POLE=2.003750834E7;og.mercator.inverseMercator=function(c,d){var e=180*c/og.mercator.POLE,f=180/Math.PI*(2*Math.atan(Math.exp(d/og.mercator.POLE*Math.PI))-Math.PI/2);return new og.LonLat(e,f)};og.mercator.forwardMercator=function(c,d){var e=c*og.mercator.POLE/180,f=Math.log(Math.tan((90+d)*Math.PI/360))/Math.PI*og.mercator.POLE;return new og.LonLat(e,f)};og.bv={};
og.bv.getBoundsFromExtent=function(c,d){var e=og.math.MAX,f=og.math.MIN,g=og.math.MAX,h=og.math.MIN,k=og.math.MAX,m=og.math.MIN,l=[];l.push(og.mercator.inverseMercator(d.southWest.lon,d.southWest.lat),og.mercator.inverseMercator(d.southWest.lon,d.northEast.lat),og.mercator.inverseMercator(d.northEast.lon,d.northEast.lat),og.mercator.inverseMercator(d.northEast.lon,d.southWest.lat));for(var n=0;n<l.length;n++){var q=c.LonLat2ECEF(l[n]),r=q.x,s=q.y,q=q.z;r<e&&(e=r);r>f&&(f=r);s<g&&(g=s);s>h&&(h=s);
q<k&&(k=q);q>m&&(m=q)}return[e,f,g,h,k,m]};og.bv.Sphere=function(c,d){this.radius=c||0;this.center=d?d.clone():new og.math.Vector3};og.bv.Sphere.prototype.setFromBounds=function(c){this.center.set(c[0]+(c[1]-c[0])/2,c[2]+(c[3]-c[2])/2,c[4]+(c[5]-c[4])/2);this.radius=this.center.distance(new og.math.Vector3(c[0],c[2],c[4]))};og.bv.Sphere.prototype.setFromExtent=function(c,d){this.setFromBounds(og.bv.getBoundsFromExtent(c,d))};og.planetSegment={};og.planetSegment.PlanetSegmentHelper={};
og.planetSegment.PlanetSegmentHelper.initIndexesTables=function(c){c!=og.planetSegment.PlanetSegmentHelper.powerOfTwo&&(og.planetSegment.PlanetSegmentHelper.powerOfTwo=c,og.planetSegment.PlanetSegmentHelper.centerIndexesTable=og.planetSegment.PlanetSegmentHelper.initIndexBodiesTable(c),og.planetSegment.PlanetSegmentHelper.textureCoordsTable=og.planetSegment.PlanetSegmentHelper.initTextureCoordsTable(c),og.planetSegment.PlanetSegmentHelper.skirtsIndexesTable=og.planetSegment.PlanetSegmentHelper.initIndexesBodySkirts(c));
og.planetSegment.PlanetSegmentHelper.centerIndexesTable[0]=[];og.planetSegment.PlanetSegmentHelper.textureCoordsTable[0]=[]};
og.planetSegment.PlanetSegmentHelper.createSegmentIndexes=function(c,d){if(1!=c){for(var e=og.planetSegment.PlanetSegmentHelper.centerIndexesTable[c],f=og.planetSegment.PlanetSegmentHelper.skirtsIndexesTable[og.quadTree.W][c][d[og.quadTree.W]],g=og.planetSegment.PlanetSegmentHelper.skirtsIndexesTable[og.quadTree.N][c][d[og.quadTree.N]],h=og.planetSegment.PlanetSegmentHelper.skirtsIndexesTable[og.quadTree.E][c][d[og.quadTree.E]],k=og.planetSegment.PlanetSegmentHelper.skirtsIndexesTable[og.quadTree.S][c][d[og.quadTree.S]],
m=new Uint16Array(e.length+f.length+g.length+h.length+k.length),l=0,n=0,l=0;l<e.length;l++)m[n++]=e[l];for(l=0;l<f.length;l++)m[n++]=f[l];for(l=0;l<g.length;l++)m[n++]=g[l];for(l=0;l<h.length;l++)m[n++]=h[l];for(l=0;l<k.length;l++)m[n++]=k[l];return m}return new Uint16Array([0,2,1,3])};og.planetSegment.PlanetSegmentHelper.createCenterBodyIndexes=function(c,d){for(var e,f,g,h=1;h<c-1-1;h++){for(var k=1;k<c-1;k++)e=h*c+k,g=(h+1)*c,f=g+k,d.push(e,f);d.push(f,g+1)}d.push(d[d.length-1],c*c-c)};
og.planetSegment.PlanetSegmentHelper.createWestNeighborSkirt=function(c,d,e){for(var f=(c-1)/d,g=c*c-c,h=0,k=0;k<c-2;k++)0===k%f&&(h=k),e.push(g-c*h,g-c*k-c+1);d===c-1&&(e.push(c),e.push(0))};og.planetSegment.PlanetSegmentHelper.createNorthNeighborSkirt=function(c,d,e){for(var f=(c-1)/d,g=0,h=0;h<c-2;h++)0===h%f&&(g=h),e.push(g,c+h+1);d===c-1&&(e.push(c-2),e.push(c-1))};
og.planetSegment.PlanetSegmentHelper.createEastNeighborSkirt=function(c,d,e){for(var f=(c-1)/d,g=0,h=0;h<c-2;h++)0===h%f&&(g=h),e.push(c+c*g-1,c*(h+1)+c-2);d===c-1&&(e.push(c*(c-1)-1),e.push(c*c-1))};og.planetSegment.PlanetSegmentHelper.createSouthNeighborSkirt=function(c,d,e){for(var f=(c-1)/d,g=0,h=c*(c-1)-2,k=c*c-1,m=0;m<c-2;m++)0===m%f&&(g=m),e.push(k-g,h-m);d===c-1&&e.push(c*c-c+1);e.push(c*c-c)};
og.planetSegment.PlanetSegmentHelper.initIndexesBodySkirts=function(c){var d=[];d[og.quadTree.N]=[];d[og.quadTree.W]=[];d[og.quadTree.S]=[];d[og.quadTree.E]=[];d[og.quadTree.N][0]=[];d[og.quadTree.W][0]=[];d[og.quadTree.S][0]=[];d[og.quadTree.E][0]=[];for(var e=0;e<=c;e++){var f=Math.pow(2,e);d[og.quadTree.N][f]=[];d[og.quadTree.W][f]=[];d[og.quadTree.S][f]=[];d[og.quadTree.E][f]=[];d[og.quadTree.N][f][0]=[];d[og.quadTree.W][f][0]=[];d[og.quadTree.S][f][0]=[];d[og.quadTree.E][f][0]=[];for(var g=0;g<=
c;g++){var h=Math.pow(2,g),k=d[og.quadTree.N][f][h]=[],m=d[og.quadTree.W][f][h]=[],l=d[og.quadTree.S][f][h]=[],n=d[og.quadTree.E][f][h]=[];og.planetSegment.PlanetSegmentHelper.createWestNeighborSkirt(f+1,h,m);og.planetSegment.PlanetSegmentHelper.createNorthNeighborSkirt(f+1,h,k);og.planetSegment.PlanetSegmentHelper.createEastNeighborSkirt(f+1,h,n);og.planetSegment.PlanetSegmentHelper.createSouthNeighborSkirt(f+1,h,l)}}return d};
og.planetSegment.PlanetSegmentHelper.initTextureCoordsTable=function(c){for(var d=[],e=0;e<=c;e++){var f=Math.pow(2,e);d[f]=og.planetSegment.PlanetSegmentHelper.createTextureCoords(f)}return d};og.planetSegment.PlanetSegmentHelper.initIndexBodiesTable=function(c){for(var d=[],e=0;e<=c;e++){var f=Math.pow(2,e),g=d[f]=[];og.planetSegment.PlanetSegmentHelper.createCenterBodyIndexes(f+1,g)}return d};
og.planetSegment.PlanetSegmentHelper.createTextureCoords=function(c){for(var d=[],e=0;e<=c;e++)for(var f=0;f<=c;f++)d.push(f/c,e/c);return d};og.bv.Box=function(){this.vertices=[new og.math.Vector3,new og.math.Vector3,new og.math.Vector3,new og.math.Vector3,new og.math.Vector3,new og.math.Vector3,new og.math.Vector3,new og.math.Vector3]};
og.bv.Box.prototype.setFromBounds=function(c){var d=c[0],e=c[1],f=c[2],g=c[3],h=c[4];c=c[5];this.vertices[0].set(d,f,h);this.vertices[1].set(e,f,h);this.vertices[2].set(e,f,c);this.vertices[3].set(d,f,c);this.vertices[4].set(d,g,h);this.vertices[5].set(e,g,h);this.vertices[6].set(e,g,c);this.vertices[7].set(d,g,c)};og.bv.Box.prototype.setFromExtent=function(c,d){this.setFromBounds(og.bv.getBoundsFromExtent(c,d))};og.planetSegment.PlanetSegment=function(){this.plainVertices=[];this.terrainVertices=[];this.tempVertices=[];this.bbox=new og.bv.Box;this.bsphere=new og.bv.Sphere;this.vertexPositionBuffer;this.vertexIndexBuffer;this.vertexTextureCoordBuffer;this.extent;this.gridSize;this.zoomIndex;this.tileX;this.tileY;this.planet;this.handler=null;this.ready=!1;this.materials=[];this.terrainExists=this.terrainIsLoading=this.terrainReady=!1;this.texBiasArr=new Float32Array(3*og.layer.MAX_OVERLAYS);this.samplerArr=
new Int32Array(og.layer.MAX_OVERLAYS);this.alfaArr=new Float32Array(og.layer.MAX_OVERLAYS);this.node};
og.planetSegment.PlanetSegment.prototype.getEarthPoint=function(c,d){var e=this.extent.northEast,f=this.extent.southWest,g=this.gridSize,h=f.lon,k=f.lat,f=Math.floor((c.lon-h)/((e.lon-h)/g)),m=Math.floor(g-(c.lat-k)/((e.lat-k)/g)),h=this.terrainReady?this.terrainVertices:this.tempVertices,e=new og.math.Ray(d,d.getNegate()),k=3*((g+1)*m+f),m=3*((g+1)*(m+1)+f),g=new og.math.Vector3(h[k],h[k+1],h[k+2]),f=new og.math.Vector3(h[k+3],h[k+4],h[k+5]),k=new og.math.Vector3(h[m],h[m+1],h[m+2]),h=new og.math.Vector3(h[m+
3],h[m+4],h[m+5]),m=new og.math.Vector3,g=e.hitTriangle(g,f,k,m);if(g==og.math.Ray.INSIDE)return{distance:d.distance(m),earth:m};g=e.hitTriangle(f,h,k,m);return g==og.math.Ray.INSIDE?{distance:d.distance(m),earth:m}:g==og.math.Ray.AWAY?{distance:-d.distance(m),earth:m}:{distance:d.distance(m),earth:m}};
og.planetSegment.PlanetSegment.getCornersVertices=function(c,d){var e=3*d,f=0.5*e,g=e*(d+1),h=f*(d+1);return[c[0],c[1],c[2],c[f],c[f+1],c[f+2],c[e],c[e+1],c[e+2],c[h],c[h+1],c[h+2],c[h+f],c[h+f+1],c[h+f+2],c[h+e],c[h+e+1],c[h+e+2],c[g],c[g+1],c[g+2],c[g+f],c[g+f+1],c[g+f+2],c[g+e],c[g+e+1],c[g+e+2]]};
og.planetSegment.PlanetSegment.prototype.loadTerrain=function(){this.zoomIndex>=this.planet.terrainProvider.minZoom?this.terrainIsLoading||this.terrainReady||(this.terrainReady=!1,this.terrainIsLoading=!0,this.planet.terrainProvider.handleSegmentTerrain(this)):this.terrainReady=!0};
og.planetSegment.PlanetSegment.prototype.applyTerrain=function(c){if(c.length&&this.ready&&this.terrainIsLoading){this.terrainExists=!0;var d=og.math.MAX,e=og.math.MIN,f=og.math.MAX,g=og.math.MIN,h=og.math.MAX,k=og.math.MIN,m=this.planet.terrainProvider.gridSizeByZoom[this.zoomIndex],l=this.planet.terrainProvider.fileGridSize||Math.sqrt(c.length)-1,n=m+1,q=this.planet.heightFactor,r=this.plainVertices,s=[],t=l/m,p=new og.math.Vector3,A;if(l>=m)for(var u=0;u<n;u++)for(var B=0;B<n;B++){var v=3*(u*n+
B);p.set(r[v],r[v+1],r[v+2]);A=p.length();p.scale((A+q*c[u*t*(l+1)+B*t])/A);s[v]=p.x;s[v+1]=p.y;s[v+2]=p.z;p.x<d&&(d=p.x);p.x>e&&(e=p.x);p.y<f&&(f=p.y);p.y>g&&(g=p.y);p.z<h&&(h=p.z);p.z>k&&(k=p.z)}else for(var t=m/l,G,H,F,D,u=0;u<n;u++)for(u==n-1?(H=t,F=Math.floor(u/t)-1):(H=u%t,F=Math.floor(u/t)),B=0;B<n;B++){B==n-1?(A=t,D=Math.floor(B/t)-1):(A=B%t,D=Math.floor(B/t));v=c[F*(l+1)+D];G=c[F*(l+1)+D+1];var I=c[(F+1)*(l+1)+D];D=c[(F+1)*(l+1)+D+1];G=H+A<t?v+og.math.slice(A/t,G,v)+og.math.slice(H/t,I,v):
D+og.math.slice((t-A)/t,I,D)+og.math.slice((t-H)/t,G,D);v=3*(u*n+B);p.set(r[v],r[v+1],r[v+2]);A=p.length();p.scale((A+q*G)/A);s[v]=p.x;s[v+1]=p.y;s[v+2]=p.z;p.x<d&&(d=p.x);p.x>e&&(e=p.x);p.y<f&&(f=p.y);p.y>g&&(g=p.y);p.z<h&&(h=p.z);p.z>k&&(k=p.z)}this.deleteBuffers();this.createCoordsBuffers(s,m);this.bsphere.setFromBounds([d,e,f,g,h,k]);this.terrainVertices.length=0;this.terrainVertices=s;this.gridSize=m;this.terrainReady=!0;this.terrainIsLoading=!1;this.node.appliedTerrainNodeId=this.node.nodeId;
c.length=0}};og.planetSegment.PlanetSegment.prototype.deleteBuffers=function(){this.handler.gl.deleteBuffer(this.vertexPositionBuffer);this.handler.gl.deleteBuffer(this.vertexIndexBuffer);this.handler.gl.deleteBuffer(this.vertexTextureCoordBuffer)};og.planetSegment.PlanetSegment.prototype.clearBuffers=function(){this.ready=!1;this.deleteBuffers()};
og.planetSegment.PlanetSegment.prototype.deleteElevations=function(){this.terrainIsLoading=this.terrainReady=!1;this.tempVertices.length=0;this.terrainVertices.length=0;this.plainVertices.length=0};og.planetSegment.PlanetSegment.prototype.clearSegment=function(){this.clearBuffers();this.deleteMaterials();this.deleteElevations()};og.planetSegment.PlanetSegment.prototype.deleteMaterials=function(){for(var c=this.materials,d=0;d<c.length;d++){var e=c[d];e&&e.clear()}c.length=0};
og.planetSegment.PlanetSegment.prototype.destroySegment=function(){this.clearSegment();this.extent=null};og.planetSegment.PlanetSegment.prototype.createCoordsBuffers=function(c,d){var e=(d+1)*(d+1);this.vertexTextureCoordBuffer=this.handler.createArrayBuffer(new Float32Array(og.planetSegment.PlanetSegmentHelper.textureCoordsTable[d]),2,e);this.vertexPositionBuffer=this.handler.createArrayBuffer(new Float32Array(c),3,e)};
og.planetSegment.PlanetSegment.prototype.createIndexesBuffer=function(c,d){var e=og.planetSegment.PlanetSegmentHelper.createSegmentIndexes(d,c);this.vertexIndexBuffer=this.handler.createElementArrayBuffer(e,1,e.length)};og.planetSegment.PlanetSegment.prototype.assignTileIndexes=function(c,d){this.zoomIndex=c;this.extent=d;var e=d.getCenter(),e=og.mercator.inverseMercator(e.lon,e.lat).toTile(c);this.tileX=e.x;this.tileY=e.y};
og.planetSegment.PlanetSegment.prototype.createPlainVertices=function(c){for(var d=[],e=0,f=this.extent,g=f.getWidth()/c,h=0;h<=c;h++)for(var k=0;k<=c;k++){var m=og.mercator.inverseMercator(f.southWest.lon+k*g,f.northEast.lat-h*g),m=this.planet.ellipsoid.LonLat2ECEF(m);d[e++]=m.x;d[e++]=m.y;d[e++]=m.z}this.plainVertices=d};
og.planetSegment.drawSingle=function(c,d){if(d.ready){var e=d.handler.gl,f=c.uniforms,g=d.planet.visibleLayers;g.length&&(g=d.materials[g[0].id],e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,g.texture),e.uniform3fv(f.texBias._pName,g.texBias),e.uniform1i(f.uSampler._pName,0));d.draw(c)}};
og.planetSegment.drawOverlays=function(c,d){if(d.ready){for(var e=d.handler.gl,f=c.uniforms,g=d.planet.visibleLayers,h=0;h<g.length;h++){var k=d.materials[g[h].id],m=3*h;d.texBiasArr[m]=k.texBias[0];d.texBiasArr[m+1]=k.texBias[1];d.texBiasArr[m+2]=k.texBias[2];d.samplerArr[h]=h;e.activeTexture(e.TEXTURE0+c._textureID+h);e.bindTexture(e.TEXTURE_2D,k.texture)}e.uniform3fv(f.texBiasArr._pName,d.texBiasArr);e.uniform1iv(f.uSamplerArr._pName,d.samplerArr);d.draw(c)}};
og.planetSegment.PlanetSegment.prototype.draw=function(c){var d=this.handler.gl,e=c.attributes;d.bindBuffer(d.ARRAY_BUFFER,this.vertexPositionBuffer);d.vertexAttribPointer(e.aVertexPosition._pName,this.vertexPositionBuffer.itemSize,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,this.vertexTextureCoordBuffer);d.vertexAttribPointer(e.aTextureCoord._pName,this.vertexTextureCoordBuffer.itemSize,d.FLOAT,!1,0,0);this._setVIb();c.drawIndexBuffer(this.planet.drawMode,this._vib);this.node.sideSize=[this.gridSize,
this.gridSize,this.gridSize,this.gridSize];this.node.hasNeighbor.length=0};og.planetSegment.PlanetSegment.prototype._setVIb=function(){this.node.sideSize[og.quadTree.N]&this.node.sideSize[og.quadTree.W]&this.node.sideSize[og.quadTree.S]&this.node.sideSize[og.quadTree.E]?this._vib=this.planet.indexesBuffers[this.gridSize]:(this.createIndexesBuffer(this.node.sideSize,this.gridSize),this._vib=this.vertexIndexBuffer)};
og.planetSegment.PlanetSegment.prototype.drawPicking=function(){if(this.ready){var c=this.handler.gl,d=this.handler.shaderPrograms.picking._program,e=d.attributes;c.uniformMatrix4fv(d.uniforms.uPMVMatrix._pName,!1,this.node.planet.renderer.activeCamera.pmvMatrix._m);c.bindBuffer(c.ARRAY_BUFFER,this.vertexPositionBuffer);c.vertexAttribPointer(e.aVertexPosition._pName,this.vertexPositionBuffer.itemSize,c.FLOAT,!1,0,0);this._setVIb();d.drawIndexBuffer(this.planet.drawMode,this._vib);this.node.sideSize=
[this.gridSize,this.gridSize,this.gridSize,this.gridSize];this.node.hasNeighbor.length=0}};og.control.MousePosition=function(c){og.inheritance.base(this,c);this.displayType=0;this.converter=og.control.MousePosition.DisplayTypesConverters[0];this.position=this.display=null};og.inheritance.extend(og.control.MousePosition,og.control.Control);og.control.MousePosition.toDecimal=function(c){return c.lat.toFixed(5)+", "+c.lon.toFixed(5)};og.control.MousePosition.toDegrees=function(c){return og.control.MousePosition.dec2deg(c.lat)+", "+og.control.MousePosition.dec2deg(c.lon)};
og.control.MousePosition.toMercator=function(c){c=og.mercator.forwardMercator(c.lon,c.lat);return c.lat.toFixed(5)+", "+c.lon.toFixed(5)};og.control.MousePosition.DisplayTypesConverters=[og.control.MousePosition.toDecimal,og.control.MousePosition.toDegrees,og.control.MousePosition.toMercator];
og.control.MousePosition.dec2deg=function(c){var d,e=0>c?Math.ceil(c):Math.floor(c);c=Math.floor(d=60*Math.abs(c-e));d=Math.floor(6E3*(d-c));d/=100;return og.control.MousePosition.numToFixedString(e,3)+"\u00b0"+og.control.MousePosition.numToFixedString(c,2)+"'"+og.control.MousePosition.numToFixedString(d.toFixed(2),2)+'"'};og.control.MousePosition.numToFixedString=function(c,d){for(var e="&nbsp;",f=c.toString().split(".")[0].length;f<d;f++)e+="&nbsp;&nbsp;";return e+c.toString()};
og.control.MousePosition.prototype.init=function(){this.display=document.createElement("div");this.display.className="ogMousePositionControl";var c=this;this.display.onclick=function(d){c.displayType+=1;c.displayType>=og.control.MousePosition.DisplayTypesConverters.length&&(c.displayType=0);c.converter=og.control.MousePosition.DisplayTypesConverters[c.displayType];c.showPosition()};this.renderer.div.appendChild(this.display);this.renderer.events.on("onmousemove",this,this.onMouseMove)};
og.control.MousePosition.prototype.showPosition=function(){this.display.innerHTML=this.position?"Lat/Lon: "+this.converter(this.position)+" Height(km): "+(0<this.position.height?"~"+(Math.round(this.position.height)/1E3).toFixed(2):"-"):"Lat/Lon: _____________________"};
og.control.MousePosition.prototype.onMouseMove=function(){var c=this.renderer.events.mouseState;!c.leftButtonDown&&!c.rightButtonDown&&0>=this.renderer.controlsBag.scaleRot&&(this.position=this.renderer.renderNodes.Earth.getLonLatFromPixelTerrain(c),this.showPosition())};og.control.LoadingSpinner=function(c){og.inheritance.base(this,c);this.spinnerElement=null};og.inheritance.extend(og.control.LoadingSpinner,og.control.Control);
og.control.LoadingSpinner.prototype.init=function(){this.spinnerElement=document.createElement("div");this.spinnerElement.id="circleG";var c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("div");this.spinnerElement.appendChild(c);this.spinnerElement.appendChild(d);this.spinnerElement.appendChild(e);c.id="circleG_1";c.className="circleG";d.id="circleG_2";d.className="circleG";e.id="circleG_3";e.className="circleG";this.spinnerElement.className="displayBlock";
document.body.appendChild(this.spinnerElement);this.renderer.events.on("ondraw",this,this.draw)};og.control.LoadingSpinner.prototype.draw=function(){for(var c=!1,d=this.renderer.renderNodes.Earth,e=d.layers,f=0;f<e.length;)if(0!=e[f++].counter){c=!0;break}this.spinnerElement.className=0!=d.terrainProvider.counter||c?"displayBlock":"displayNone"};og.Ellipsoid=function(c,d){var e=this._a=c,f=this._b=d;this.flattening=e/f;this.a2=e*e;this.b2=f*f;this._e=Math.sqrt(this.a2-this.b2)/e;this._e2=Math.pow(this._e,2);this._k=Math.sqrt(this.a2-this.b2)/f;this._k2=Math.pow(this._k,2);this._radii=new og.math.Vector3(c,d,c);this._radii2=new og.math.Vector3(c*c,d*d,c*c);this._invRadii=new og.math.Vector3(1/c,1/d,1/c);this._invRadii2=new og.math.Vector3(1/(c*c),1/(d*d),1/(c*c))};
og.Ellipsoid.prototype.N=function(c){c=Math.pow(Math.sin(c),2);c=Math.sqrt(1-this._e2*c);return this._a/c};og.Ellipsoid.prototype.LonLat2ECEF=function(c){var d=og.math.DEG2RAD(c.lat),e=og.math.DEG2RAD(c.lon),f=(this.N(d)+c.height)*Math.cos(d)*Math.cos(e),e=(this.N(d)+c.height)*Math.cos(d)*Math.sin(e);c=(this.N(d)*(1-this._e2)+c.height)*Math.sin(d);return new og.math.Vector3(e,c,f)};
og.Ellipsoid.prototype.ECEF2LonLat=function(c){var d=c.z,e=c.x;c=c.y;var f=this._e2,g=this._k2,h=d*d+e*e,k=Math.sqrt(h),m=c*c,l=54*this.b2*m,n=h+(1-f)*m+f*(this.a2-this.b2),q=n*n,n=f*f*l*h/(q*n),n=Math.pow(1+n+Math.sqrt(n*(n+2)),1/3),l=l/(3*Math.pow(n+1/n+1,2)*q),q=Math.sqrt(1+2*f*f*l),l=-(l*f*k)/1+q+Math.sqrt(0.5*this.a2*(1+1/q)-l*(1-f)*m/(q*(1+q))-0.5*l*h),h=Math.sqrt(Math.pow(k-f*l,2)+m),m=Math.sqrt(Math.pow(k-f*l,2)+(1-f)*m),f=h*(1-this.b2/(this._a*m));c=Math.atan((c+g*(this.b2*c/(this._a*m)))/
k);d=Math.atan2(e,d);return new og.LonLat(180*(d/Math.PI),180*(c/Math.PI),f)};og.Ellipsoid.prototype.getSurfaceNormal=function(c){return og.math.Vector3.mull(c,this._invRadii2).normalize()};og.ellipsoid={};og.ellipsoid.wgs84=new og.Ellipsoid(6378137,6356752.3142);og.layer.WMS=function(c,d){og.inheritance.base(this,c,d);this.layers=d.layers};og.inheritance.extend(og.layer.WMS,og.layer.XYZ);og.layer.WMS.prototype.GetHTTPRequestString=function(c){return this.url+"wms?LAYERS="+this.layers+"&FORMAT=image/jpeg&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&SRS=EPSG:900913&BBOX="+c.extent.getWest()+","+c.extent.getSouth()+","+c.extent.getEast()+","+c.extent.getNorth()+"&WIDTH="+(this.width?this.width:256)+"&HEIGHT="+(this.height?this.height:256)};og.control.LayerSwitcher=function(c){og.inheritance.base(this,c);this.overlaysDiv=this.baseLayersDiv=this.dialog=null;this._id=og.control.LayerSwitcher.numSwitches++};og.control.LayerSwitcher.numSwitches=0;og.inheritance.extend(og.control.LayerSwitcher,og.control.Control);
og.control.LayerSwitcher.prototype.init=function(){this.renderer.renderNodes.Earth.events.on("onlayeradded",this,this.onLayerAdded);this.renderer.renderNodes.Earth.events.on("onlayerremoved",this,this.onLayerRemoved);this.renderer.renderNodes.Earth.events.on("onbaselayerchanged",this,this.onBaseLayerChanged);this.renderer.renderNodes.Earth.events.on("onlayervisibilitychanged",this,this.onLayerVisibilityChanged);this.createSwitcher();this.createDialog()};
og.control.LayerSwitcher.prototype.onLayerAdded=function(c){console.log("added")};og.control.LayerSwitcher.prototype.onLayerRemoved=function(c){console.log("removed")};og.control.LayerSwitcher.prototype.onBaseLayerChanged=function(c){console.log("basechanged")};og.control.LayerSwitcher.prototype.onLayerVisibilityChanged=function(c){console.log("changed "+c.id)};
og.control.LayerSwitcher.prototype.createBaseLayersDiv=function(){var c=document.createElement("div");c.className="layersDiv";this.dialog.appendChild(c);var d=document.createElement("div");d.className="layersDiv";d.innerHTML="Base Layer";c.appendChild(d);this.baseLayersDiv=document.createElement("div");c.appendChild(this.baseLayersDiv);this.createBaseLayersList(this.baseLayersDiv)};
og.control.LayerSwitcher.prototype.createOverlaysDiv=function(){var c=document.createElement("div");c.className="layersDiv";this.dialog.appendChild(c);var d=document.createElement("div");d.className="layersDiv";d.innerHTML="Overlays";c.appendChild(d);this.overlaysDiv=document.createElement("div");c.appendChild(this.overlaysDiv);this.createOverlaysList(this.overlaysDiv)};
og.control.LayerSwitcher.prototype.createDialog=function(){this.dialog=document.createElement("div");this.dialog.id="ogLayerSwitcherDialog";this.dialog.className="displayNone";this.renderer.div.appendChild(this.dialog);this.createBaseLayersDiv();this.createOverlaysDiv()};
og.control.LayerSwitcher.prototype.createOverlaysList=function(c){var d,e,f=this,g=this.renderer.renderNodes.Earth.layers;for(d=0;d<g.length;d++)g[d].isBaseLayer||(e=document.createElement("input"),e.type="checkbox",e.value=d,e.checked=g[d].visibility,e.name="ogBaseLayerCheckbox",e.className="ogLayerSwitcherInput",e.onclick=function(){f.switchLayerVisibility.call(f,this)},c.appendChild(e),e=document.createElement("label"),e.className="ogLayerSwitcherLabel",e.innerHTML=g[d].name+"</br>",c.appendChild(e))};
og.control.LayerSwitcher.prototype.createBaseLayersList=function(c){var d,e,f=this,g=this.renderer.renderNodes.Earth.layers;for(d=0;d<g.length;d++)g[d].isBaseLayer&&(e=document.createElement("input"),e.type="radio",e.value=d,e.checked=g[d].visibility,e.name="ogBaseLayerRadiosId"+this._id,e.className="ogLayerSwitcherInput",e.onclick=function(){f.switchLayer.call(f,this)},c.appendChild(e),e=document.createElement("label"),e.className="ogLayerSwitcherLabel",e.innerHTML=g[d].name+"</br>",c.appendChild(e))};
og.control.LayerSwitcher.prototype.switchLayer=function(c){var d=this.renderer.renderNodes.Earth;d.setBaseLayer(d.layers[c.value])};og.control.LayerSwitcher.prototype.switchLayerVisibility=function(c){c=this.renderer.renderNodes.Earth.layers[c.value];c.setVisibility(c.getVisibility()?!1:!0)};
og.control.LayerSwitcher.prototype.createSwitcher=function(){var c=document.createElement("div");c.className="ogLayerSwitcherButton";c.id="ogLayerSwitcherButtonMaximize";var d=this;c.onclick=function(c){"ogLayerSwitcherButtonMaximize"===this.id?(this.id="ogLayerSwitcherButtonMinimize",d.dialog.className="displayBlock"):(this.id="ogLayerSwitcherButtonMaximize",d.dialog.className="displayNone")};this.renderer.div.appendChild(c)};og.Ajax={ReadyState:{Uninitialized:0,Loading:1,Loaded:2,Interactive:3,Complete:4},Status:{OK:200,Created:201,Accepted:202,NoContent:204,BadRequest:400,Forbidden:403,NotFound:404,Gone:410,ServerError:500},Method:{Get:"GET",Post:"POST"},Asynchronous:!0,Synchronous:!1};og.Ajax.defaultParams={type:og.Ajax.Method.Get,async:og.Ajax.Asynchronous,data:null,sender:null,responseType:"text"};
og.Ajax.createXMLHttp=function(){var c=null;if(void 0!=typeof XMLHttpRequest)return c=new XMLHttpRequest;if(window.ActiveXObject)for(var d=["MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"],e=0;e<d.length;e++)try{return c=new ActiveXObject(d[e])}catch(f){}};
og.Ajax.request=function(c,d){var e={},f;for(f in og.Ajax.defaultParams)e[f]=og.Ajax.defaultParams[f];for(f in d)e[f]=d[f];var g=og.Ajax.createXMLHttp();g.open(e.type,c,e.async);e.type===og.Ajax.Method.Post&&g.setRequestHeader("Content-Type","application/x-www-form-urlencoded");e.async&&(g.responseType=e.responseType);g.overrideMimeType("text/plain");g.onreadystatechange=function(){g.readyState===og.Ajax.ReadyState.Complete&&(g.status===og.Ajax.Status.OK?d.success&&d.success.call(d.sender?d.sender:
this,g.response):d.error&&d.error.call(d.sender?d.sender:this,g.response,g.status))};g.send(d.data?d.data:og.Ajax.defaultParams.data)};og.utils={};og.utils.readTextFile=function(c){var d="";og.Ajax.request(c,{async:!1,success:function(c){d=c}});return d};og.webgl={};og.webgl.vendorPrefixes=["","WEBKIT_","MOZ_"];og.webgl.MAX_FRAME_DELAY=24;og.webgl.RESOURCES_URL="../../resources/";og.webgl.getExtension=function(c,d){var e,f;for(e in og.webgl.vendorPrefixes)if(f=c.getExtension(og.webgl.vendorPrefixes[e]+d))return f;return null};
og.webgl.initCanvas=function(c){c=document.getElementById(c);var d;try{d=c.getContext("experimental-webgl"),d.canvas=c,c.width=c.scrollWidth,c.height=c.scrollHeight,c.aspect=c.width/c.height}catch(e){alert("Exception during the GL context initialization")}d||alert("Could not initialise WebGL, sorry :-(");return d};
(function(){var c=0;og.webgl.requestAnimationFrame=function(d,e){var f=(new Date).getTime(),g=Math.max(og.webgl.MAX_FRAME_DELAY,16-(f-c)),h=window.setTimeout(function(){d(f+g,e)},g);c=f+g;return h};og.webgl.cancelAnimationFrame=function(c){clearTimeout(c)}})();og.control.ToggleWireframe=function(c){og.inheritance.base(this,c)};og.inheritance.extend(og.control.ToggleWireframe,og.control.Control);og.control.ToggleWireframe.prototype.init=function(){this.renderer.events.on("oncharkeypressed",this,this.toogleWireframe,og.input.KEY_X)};
og.control.ToggleWireframe.prototype.toogleWireframe=function(c){this.renderer.renderNodes.Earth.drawMode===this.renderer.handler.gl.LINE_STRIP?this.renderer.renderNodes.Earth.setDrawMode(this.renderer.handler.gl.TRIANGLE_STRIP):this.renderer.renderNodes.Earth.setDrawMode(this.renderer.handler.gl.LINE_STRIP)};og.planetSegment.PlanetSegmentMaterial=function(c,d){this.segment=c;this.layer=d;this.imageIsLoading=this.imageReady=!1;this.texBias=[0,0,1];this.texture=null};og.planetSegment.PlanetSegmentMaterial.prototype.assignLayer=function(c){this.layer=c};og.planetSegment.PlanetSegmentMaterial.prototype.loadTileImage=function(){this.imageIsLoading||(this.imageReady=!1,this.imageIsLoading=!0,this.layer.handleSegmentTile(this))};
og.planetSegment.PlanetSegmentMaterial.prototype.applyTexture=function(c){this.segment.ready&&this.imageIsLoading?(this.texture=this.segment.handler.createTextureFromImage(c),this.texBias=[0,0,1],this.segment.node.appliedTextureNodeId=this.segment.node.nodeId,this.imageReady=!0):(this.imageReady=!1,this.texture=null,this.texBias=[0,0,1]);this.imageIsLoading=!1};og.planetSegment.PlanetSegmentMaterial.prototype.textureNotExists=function(){this.imageIsLoading=!0};
og.planetSegment.PlanetSegmentMaterial.prototype.clear=function(){this.imageIsLoading=!1;this.imageReady&&(this.imageReady=!1,this.segment.handler.gl.deleteTexture(this.texture),this.texture=null,this.texBias=[0,0,1])};og.quadTree.QuadNode=function(){this.parentNode;this.nodes=[];this.planetSegment;this.partId;this.nodeId;this.planet;this.state;this.appliedTerrainNodeId=-1;this.sideSize=[0,0,0,0];this.hasNeighbor=[];this.neighbors=[];this.cameraInside=!1};og.quadTree.QuadNode._vertOrder=[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}];og.quadTree.QuadNode._neGridSize=Math.sqrt(og.quadTree.QuadNode._vertOrder.length)-1;
og.quadTree.QuadNode.createNode=function(c,d,e,f,g,h){var k=new og.quadTree.QuadNode;k.partId=d;k.parentNode=e;k.nodeId=d+f;k.planet=c;k.planetSegment=new og.planetSegment.PlanetSegment;k.planetSegment.node=k;k.planetSegment.planet=c;k.planetSegment.handler=c.renderer.handler;k.planetSegment.assignTileIndexes(g,h);k.planetSegment.gridSize=c.terrainProvider.gridSizeByZoom[g];k.createBounds();k.planet.createdNodesCount++;return k};
og.quadTree.QuadNode.prototype.getCommonSide=function(c){var d=this.planetSegment.extent,e=c.planetSegment.extent,f=d.northEast,d=d.southWest;c=e.northEast;var g=e.southWest,e=f.lon,f=f.lat,h=d.lon,k=d.lat,m=c.lon,l=c.lat,n=g.lon,g=g.lat;return e==n&&(f<=l&&k>=g||f>=l&&k<=g)?og.quadTree.E:h==m&&(f<=l&&k>=g||f>=l&&k<=g)?og.quadTree.W:f==g&&(h>=n&&e<=m||h<=n&&e>=m)?og.quadTree.N:k==l&&(h>=n&&e<=m||h<=n&&e>=m)?og.quadTree.S:2.003750834E7==e&&-2.003750834E7==n?og.quadTree.E:-2.003750834E7==d.lon&&2.003750834E7==
c.lon?og.quadTree.W:-1};
og.quadTree.QuadNode.prototype.createBounds=function(){var c=this.planetSegment;if(c.zoomIndex)if(c.zoomIndex<c.planet.terrainProvider.minZoom)c.bsphere.setFromExtent(c.planet.ellipsoid,c.extent);else{for(var d=this,e=0,f=0,g=0;d.parentNode&&!d.planetSegment.terrainReady;)d.partId!==og.quadTree.NW&&(d.partId===og.quadTree.NE?f+=Math.pow(2,e):d.partId===og.quadTree.SW?g+=Math.pow(2,e):d.partId===og.quadTree.SE&&(f+=Math.pow(2,e),g+=Math.pow(2,e))),e++,d=d.parentNode;if(d.planetSegment.terrainReady){var h=d.planetSegment.gridSize/
Math.pow(2,e);if(1<=h){var k=d.planetSegment.terrainVertices,e=h*g,m=h*f,g=3*(e*(d.planetSegment.gridSize+1)+m),d=3*((e+h)*(d.planetSegment.gridSize+1)+m+h);c.bsphere.setFromBounds([k[g],k[d],k[g+1],k[d+1],k[g+2],k[d+2]])}else{var k=d.planetSegment,e=Math.floor(h*g),m=Math.floor(h*f),d=1/h,g=g-d*e,f=f-d*m,l=og.quadTree.getVerticesArray(k.terrainVertices,k.gridSize,e,m,1),e=new og.math.Vector3(l[0],l[1],l[2]),m=new og.math.Vector3(l[9],l[10],l[11]),h=new og.math.Vector3(l[3]-l[0],l[4]-l[1],l[5]-l[2]),
k=new og.math.Vector3(l[6]-l[0],l[7]-l[1],l[8]-l[2]),n=new og.math.Vector3(l[3]-l[9],l[4]-l[10],l[5]-l[11]),q=new og.math.Vector3(l[6]-l[9],l[7]-l[10],l[8]-l[11]),r=g,s=f,l=r+s<d?og.math.Vector3.add(h.scaleTo(s/d),k.scaleTo(r/d)).add(e):og.math.Vector3.add(q.scaleTo(1-s/d),n.scaleTo(1-r/d)).add(m),r=g+1,s=f+1,d=r+s<d?og.math.Vector3.add(h.scaleTo(s/d),k.scaleTo(r/d)).add(e):og.math.Vector3.add(q.scaleTo(1-s/d),n.scaleTo(1-r/d)).add(m);c.bsphere.radius=0.5*l.distance(d);c.bsphere.center=l.add(d.sub(l).scale(0.5))}}else c.bsphere.setFromExtent(c.planet.ellipsoid,
c.extent)}else c.bsphere.radius=c.planet.ellipsoid._a,c.bsphere.center=new og.math.Vector3};
og.quadTree.QuadNode.prototype.createChildrenNodes=function(){var c=this.planet,d=this.planetSegment,e=d.extent,f=0.5*e.getWidth(),g=e.northEast,e=e.southWest,d=d.zoomIndex+1,h=4*this.nodeId+1,k=new og.LonLat(e.lon+f,e.lat+f),m=this.nodes;m[og.quadTree.NW]=og.quadTree.QuadNode.createNode(c,og.quadTree.NW,this,h,d,new og.Extent(new og.LonLat(e.lon,e.lat+f),new og.LonLat(e.lon+f,g.lat)));m[og.quadTree.NE]=og.quadTree.QuadNode.createNode(c,og.quadTree.NE,this,h,d,new og.Extent(k,new og.LonLat(g.lon,
g.lat)));m[og.quadTree.SW]=og.quadTree.QuadNode.createNode(c,og.quadTree.SW,this,h,d,new og.Extent(new og.LonLat(e.lon,e.lat),k));m[og.quadTree.SE]=og.quadTree.QuadNode.createNode(c,og.quadTree.SE,this,h,d,new og.Extent(new og.LonLat(e.lon+f,e.lat),new og.LonLat(g.lon,e.lat+f)))};og.quadTree.QuadNode.prototype.reloadTerrain=function(){this.planetSegment.clearBuffers();this.planetSegment.deleteElevations();this.getState()===og.quadTree.WALKTHROUGH&&this.planetSegment.loadTerrain();for(var c=0;c<this.nodes.length;c++)this.nodes[c].reloadTerrain()};
og.quadTree.QuadNode.prototype.getState=function(){for(var c=this.parentNode;c;){if(c.state!=og.quadTree.WALKTHROUGH)return og.quadTree.NOTRENDERING;c=c.parentNode}return this.state};og.quadTree.QuadNode.prototype.prepareForRendering=function(c){if(3E6>c.lonLat.height){var d=c.eye.distance(this.planetSegment.bsphere.center)-this.planetSegment.bsphere.radius;c=3570*Math.sqrt(c.lonLat.height);d<c?this.renderNode():this.state=og.quadTree.NOTRENDERING}else this.renderNode()};
og.quadTree.QuadNode.prototype.traverseNodes=function(){this.nodes.length||this.createChildrenNodes();this.nodes[og.quadTree.NW].renderTree();this.nodes[og.quadTree.NE].renderTree();this.nodes[og.quadTree.SW].renderTree();this.nodes[og.quadTree.SE].renderTree()};
og.quadTree.QuadNode.prototype.renderTree=function(){this.state=og.quadTree.WALKTHROUGH;var c=this.planet.renderer.activeCamera;this.cameraInside=!1;this.parentNode?(this.planet.cameraPositionM=og.mercator.forwardMercator(c.lonLat.lon,c.lonLat.lat),this.parentNode.cameraInside&&this.planetSegment.extent.isInside(this.planet.cameraPositionM)&&(this.cameraInside=!0,this.planet.cameraInsideNode=this)):this.cameraInside=!0;0<c.frustum.containsSphere(this.planetSegment.bsphere)||this.cameraInside?og.quadTree.acceptableForRender(c,
this.planetSegment.bsphere)?this.prepareForRendering(c):this.planetSegment.zoomIndex<this.planet.terrainProvider.gridSizeByZoom.length-1?this.traverseNodes():this.prepareForRendering(c):this.state=og.quadTree.NOTRENDERING};og.quadTree.QuadNode.prototype.createPlainSegment=function(c){var d=this.planet.terrainProvider.gridSizeByZoom[c.zoomIndex];c.gridSize=d;this.sideSize=[d,d,d,d];c.createPlainVertices(d);c.terrainVertices=c.plainVertices;c.createCoordsBuffers(c.plainVertices,d);c.ready=!0};
og.quadTree.QuadNode.prototype.renderNode=function(){this.state=og.quadTree.RENDERING;var c=this.planetSegment;c.ready||this.createPlainSegment(c);c.terrainReady||(c.loadTerrain(),this.whileTerrainLoading());for(var d=this.planet.visibleLayers,e=c.materials,f=0;f<d.length;f++){var g=d[f],h=e[g.id];h||(h=c.materials[g.id]=new og.planetSegment.PlanetSegmentMaterial(c,g));h.imageReady||(h.loadTileImage(),this.whileTextureLoading(g.id))}this.addToRender(this)};
og.quadTree.QuadNode.prototype.addToRender=function(c){for(var d=this.planet.renderedNodes,e=0;e<d.length;e++){var f=d[e],g=c.getCommonSide(f);if(-1!=g){var h=og.quadTree.OPSIDE[g];if(!c.hasNeighbor[g]||!f.hasNeighbor[h]){var k=c.planetSegment,m=f.planetSegment,l=k.gridSize/(m.gridSize*Math.pow(2,m.zoomIndex-k.zoomIndex));c.hasNeighbor[g]=!0;f.hasNeighbor[h]=!0;c.neighbors[g]=f;f.neighbors[h]=c;1<l?(c.sideSize[g]=Math.ceil(k.gridSize/l),f.sideSize[h]=m.gridSize):1>l?(c.sideSize[g]=k.gridSize,f.sideSize[h]=
Math.ceil(m.gridSize*l)):(c.sideSize[g]=k.gridSize,f.sideSize[h]=m.gridSize)}}}d.push(c)};
og.quadTree.QuadNode.prototype.whileTerrainLoading=function(){for(var c=this,d=0,e=0,f=0;c.parentNode&&!c.planetSegment.terrainReady;)c.partId==og.quadTree.NE?e+=Math.pow(2,d):c.partId==og.quadTree.SW?f+=Math.pow(2,d):c.partId==og.quadTree.SE&&(e+=Math.pow(2,d),f+=Math.pow(2,d)),d++,c=c.parentNode;var g=this.planet.terrainProvider.maxZoom;if(c.planetSegment.terrainReady){var h=this.planetSegment,k=c.planetSegment;if(c.planetSegment.terrainExists&&this.appliedTerrainNodeId!=c.nodeId){var d=c.planetSegment.gridSize/
Math.pow(2,d),m=[];h.deleteBuffers();h.refreshIndexesBuffer=!0;if(1<=d){h.gridSize=d;this.sideSize=[d,d,d,d];var l,n,m=og.quadTree.getVerticesArray(k.terrainVertices,k.gridSize,d*f,d*e,d)}else{h.gridSize=og.quadTree.QuadNode._neGridSize;this.sideSize=[h.gridSize,h.gridSize,h.gridSize,h.gridSize];l=Math.floor(d*f);n=Math.floor(d*e);k=og.quadTree.getVerticesArray(k.terrainVertices,k.gridSize,l,n,1);d=1/d;f-=d*l;e-=d*n;n=new og.math.Vector3(k[0],k[1],k[2]);l=new og.math.Vector3(k[9],k[10],k[11]);for(var q=
new og.math.Vector3(k[3]-k[0],k[4]-k[1],k[5]-k[2]),r=new og.math.Vector3(k[6]-k[0],k[7]-k[1],k[8]-k[2]),s=new og.math.Vector3(k[3]-k[9],k[4]-k[10],k[5]-k[11]),t=new og.math.Vector3(k[6]-k[9],k[7]-k[10],k[8]-k[11]),p=new og.math.Vector3,A=og.quadTree.QuadNode._vertOrder,u=0;u<A.length;u++){var p=A[u].y+f,B=A[u].x+e,p=p+B<d?og.math.Vector3.add(q.scaleTo(B/d),r.scaleTo(p/d)).add(n):og.math.Vector3.add(t.scaleTo(1-B/d),s.scaleTo(1-p/d)).add(l);m[3*u]=p.x;m[3*u+1]=p.y;m[3*u+2]=p.z}k.length=0}h.createCoordsBuffers(m,
h.gridSize);h.tempVertices=m;this.appliedTerrainNodeId=c.nodeId}if(h.zoomIndex>g)if(c.planetSegment.zoomIndex>=g)h.terrainReady=!0,this.appliedTerrainNodeId=this.nodeId,c.planetSegment.terrainExists?(h.terrainExists=!0,h.terrainVertices=m):(h.terrainExists=!1,h.deleteBuffers(),h.terrainVertices=og.planetSegment.PlanetSegment.getCornersVertices(h.terrainVertices,h.gridSize),h.createCoordsBuffers(h.terrainVertices,2),h.gridSize=2);else{for(c=this;c.parentNode&&c.planetSegment.zoomIndex!=g;)c=c.parentNode;
c=c.planetSegment;c.ready||this.createPlainSegment(c);c.loadTerrain()}}};og.quadTree.getVerticesArray=function(c,d,e,f,g){for(var h=[],k=0,m=e;m<=e+g;m++)for(var l=f;l<=f+g;l++){var n=3*(m*(d+1)+l);h[k++]=c[n];h[k++]=c[n+1];h[k++]=c[n+2]}return h};
og.quadTree.QuadNode.prototype.whileTextureLoading=function(c){for(var d=this,e=0,f=0,g=0,h=!1,k=d.planetSegment.materials[c];d.parentNode;){if(k&&k.imageReady){h=!0;break}d.partId==og.quadTree.NE?f+=Math.pow(2,e):d.partId==og.quadTree.SW?g+=Math.pow(2,e):d.partId==og.quadTree.SE&&(f+=Math.pow(2,e),g+=Math.pow(2,e));e++;d=d.parentNode;k=d.planetSegment.materials[c]}c=this.planetSegment.materials[c];c.imageIsLoading&&h&&(c.texture=k.texture,c.texBias[0]=f,c.texBias[1]=g,c.texBias[2]=1/Math.pow(2,e))};
og.quadTree.QuadNode.prototype.clearTree=function(){var c=this.getState();if(c===og.quadTree.NOTRENDERING)this.destroyBranches(!0);else if(c===og.quadTree.RENDERING)this.destroyBranches(!1);else for(c=0;c<this.nodes.length;c++)this.nodes[c].clearTree()};
og.quadTree.QuadNode.prototype.destroyBranches=function(c){c&&(this.planetSegment.clearSegment(),this.appliedTerrainNodeId=-1);for(c=0;c<this.nodes.length;c++)this.nodes[c].planetSegment.destroySegment(),this.appliedTerrainNodeId=-1,this.nodes[c].destroyBranches(!1);this.nodes.length=0};og.quadTree.QuadNode.prototype.traverseTree=function(c){c(this);for(var d=0;d<this.nodes.length;d++)this.nodes[d].traverseTree(c)};og.shaderProgram={};og.shaderProgram.types={};og.shaderProgram.types._declarations="FLOAT DOUBLE BOOL INT UINT VEC2 VEC3 VEC4 DVEC2 DVEC3 DVEC4 BVEC2 BVEC3 BVEC4 IVEC2 IVEC3 IVEC4 UVEC2 UVEC3 UVEC4 MAT2 DMAT2 MAT3 DMAT3 MAT4 DMAT4 MAT2X3 MAT2X4 MAT3X2 MAT3X4 MAT4X2 MAT4X3 DMAT2X3 DMAT2X4 DMAT3X2 DMAT3X4 DMAT4X2 DMAT4X3 SAMPLER1D SAMPLER2D SAMPLER3D SAMPLERCUBE SAMPLER2DSHADOW SAMPLER2DXX INTXX FLOATXX".split(" ");
(function(){for(var c=0;c<og.shaderProgram.types._declarations.length;c++)og.shaderProgram.types[og.shaderProgram.types._declarations[c]]=c})();og.shaderProgram.callbacks={};og.shaderProgram.bindBuffer=function(c,d){var e=c.gl;e.bindBuffer(e.ARRAY_BUFFER,d.value);e.vertexAttribPointer(d._pName,d.value.itemSize,e.FLOAT,!1,0,0)};og.shaderProgram.callbacks.u=[];og.shaderProgram.callbacks.a=[];og.shaderProgram.callbacks.u[og.shaderProgram.types.MAT4]=function(c,d){c.gl.uniformMatrix4fv(d._pName,!1,d.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.FLOAT]=function(c,d){c.gl.uniform1f(d._pName,d.value)};
og.shaderProgram.callbacks.u[og.shaderProgram.types.INT]=function(c,d){c.gl.uniform1i(d._pName,d.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.VEC2]=function(c,d){c.gl.uniform2fv(d._pName,d.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.VEC3]=function(c,d){c.gl.uniform3fv(d._pName,d.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.VEC4]=function(c,d){c.gl.uniform4fv(d._pName,d.value)};
og.shaderProgram.callbacks.u[og.shaderProgram.types.SAMPLER2D]=function(c,d){var e=c.gl;e.activeTexture(e.TEXTURE0+c._textureID);e.bindTexture(e.TEXTURE_2D,d.value);e.uniform1i(d._pName,c._textureID);c._textureID++};og.shaderProgram.callbacks.u[og.shaderProgram.types.SAMPLERCUBE]=function(c,d){var e=c.gl;e.activeTexture(e.TEXTURE0+c._textureID);e.bindTexture(e.TEXTURE_CUBE_MAP,d.value);e.uniform1i(d._pName,c._textureID);c._textureID++};
og.shaderProgram.callbacks.u[og.shaderProgram.types.SAMPLER2DXX]=function(c,d){for(var e=c.gl,f=d.value.length,g=new Int32Array(f),h=0;h<f;h++)e.activeTexture(e.TEXTURE0+c._textureID+h),e.bindTexture(e.TEXTURE_2D,d.value[h]),g[h]=h;e.uniform1iv(d._pName,g)};og.shaderProgram.callbacks.u[og.shaderProgram.types.INTXX]=function(c,d){pgl.uniform1iv(d._pName,d.value)};og.shaderProgram.callbacks.u[og.shaderProgram.types.FLOATXX]=function(c,d){c.gl.uniform1fv(d._pName,d.value)};
og.shaderProgram.callbacks.a[og.shaderProgram.types.FLOAT]=function(c,d){c.gl.vertexAttrib1f(d._pName,d.value)};og.shaderProgram.callbacks.a[og.shaderProgram.types.VEC2]=function(c,d){c.gl.vertexAttrib2fv(d._pName,d.value)};og.shaderProgram.callbacks.a[og.shaderProgram.types.VEC3]=function(c,d){c.gl.vertexAttrib3fv(d._pName,d.value)};og.shaderProgram.callbacks.a[og.shaderProgram.types.VEC4]=function(c,d){c.gl.vertexAttrib4fv(d._pName,d.value)};og.shaderProgram.SHADERS_URL="../../src/og/shaders/";og.shaderProgram.ShaderProgram=function(c,d){this.name=c;this.attributes=d.attributes;this.uniforms=d.uniforms;this._variables={};this.vertexShader=d.vertexShader;this.fragmentShader=d.fragmentShader;this._p=this.gl=null;this._textureID=0;this._attribArrays=[]};og.shaderProgram.ShaderProgram.prototype.use=function(){this.gl.useProgram(this._p)};
og.shaderProgram.ShaderProgram.prototype.set=function(c){this._textureID=0;for(var d in c)this._variables[d].value=c[d],this._variables[d]._callback(this,this._variables[d])};og.shaderProgram.ShaderProgram.prototype.apply=function(){this._textureID=0;var c=this._variables,d;for(d in c)c[d]._callback(this,c[d])};og.shaderProgram.ShaderProgram.prototype.drawIndexBuffer=function(c,d){this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,d);this.gl.drawElements(c,d.numItems,this.gl.UNSIGNED_SHORT,0)};
og.shaderProgram.ShaderProgram.prototype.drawArray=function(c,d){this.gl.drawArrays(c,0,d)};og.shaderProgram.ShaderProgram.prototype.getShaderCompileStatus=function(c,d){this.gl.shaderSource(c,d);this.gl.compileShader(c);return this.gl.getShaderParameter(c,this.gl.COMPILE_STATUS)?!0:(alert(this.gl.getShaderInfoLog(c)),!1)};og.shaderProgram.ShaderProgram.prototype.createVertexShader=function(c){var d=this.gl.createShader(this.gl.VERTEX_SHADER);return this.getShaderCompileStatus(d,c)?d:null};
og.shaderProgram.ShaderProgram.prototype.createFragmentShader=function(c){var d=this.gl.createShader(this.gl.FRAGMENT_SHADER);return this.getShaderCompileStatus(d,c)?d:null};og.shaderProgram.ShaderProgram.prototype.disableAttribArrays=function(){for(var c=this.gl,d=this._attribArrays,e=d.length;e--;)c.disableVertexAttribArray(d[e])};og.shaderProgram.ShaderProgram.prototype.enableAttribArrays=function(){for(var c=this.gl,d=this._attribArrays,e=d.length;e--;)c.enableVertexAttribArray(d[e])};
og.shaderProgram.ShaderProgram.prototype.createProgram=function(c){this.gl=c;this._p=this.gl.createProgram();c.attachShader(this._p,this.createFragmentShader(this.fragmentShader));c.attachShader(this._p,this.createVertexShader(this.vertexShader));c.linkProgram(this._p);c.getProgramParameter(this._p,c.LINK_STATUS)||alert("Could not initialise shaders.");this.use();for(var d in this.attributes)this.attributes[d]._name=d,this._variables[d]=this.attributes[d],this.attributes[d]._callback=this.attributes[d].enableArray?
og.shaderProgram.bindBuffer:og.shaderProgram.callbacks.a[this.attributes[d].type],this._p[d]=c.getAttribLocation(this._p,d),this.attributes[d].enableArray&&(this._attribArrays.push(this._p[d]),c.enableVertexAttribArray(this._p[d])),this.attributes[d]._pName=this._p[d];for(var e in this.uniforms)this.uniforms[e]._name=e,this.uniforms[e]._callback=og.shaderProgram.callbacks.u[this.uniforms[e].type],this._variables[e]=this.uniforms[e],this._p[e]=c.getUniformLocation(this._p,e),this.uniforms[e]._pName=
this._p[e]};og.shaderProgram.overlays=function(){return new og.shaderProgram.ShaderProgram("overlays",{uniforms:{uPMVMatrix:{type:og.shaderProgram.types.MAT4},uSamplerArr:{type:og.shaderProgram.types.SAMPLER2DXX},texBiasArr:{type:og.shaderProgram.types.VEC3},tcolorArr:{type:og.shaderProgram.types.VEC4},numTex:{type:og.shaderProgram.types.INT}},attributes:{aVertexPosition:{type:og.shaderProgram.types.VEC3,enableArray:!0},aTextureCoord:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+
"overlays_vs.txt"),fragmentShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"overlays_fs.txt")})};og.PlanetCamera=function(c,d,e){this._ellipsoid=d;og.inheritance.base(this,c,e);this.lonLat=new og.LonLat;this.altitude;this.minAlt=e.minAltitude||50;this.earthPoint;this.bindEllipsoid(this._ellipsoid)};og.inheritance.extend(og.PlanetCamera,og.Camera);og.PlanetCamera.prototype.bindEllipsoid=function(c){this._ellipsoid=c;this.lonLat=c.ECEF2LonLat(this.eye)};
og.PlanetCamera.prototype.update=function(){this.setModelViewMatrix();this.pmvMatrix=this.pMatrix.mul(this.mvMatrix);this.frustum.setFrustum(this.pmvMatrix._m);this.lonLat=this._ellipsoid.ECEF2LonLat(this.eye);this.events.dispatch(this.events.onviewchanged,this)};
og.PlanetCamera.prototype.setLonLat=function(c){this.lonLat.set(c.lon,c.lat,c.height?c.height:this.lonLat.height);c=this._ellipsoid.LonLat2ECEF(this.lonLat);var d=(new og.math.Matrix4).rotateBetweenVectors(c.normal(),this.eye.normal());this.eye=c;this.v=d.mulVec3(this.v);this.u=d.mulVec3(this.u);this.n=d.mulVec3(this.n);this.update()};
og.PlanetCamera.prototype.getExtentPosition=function(c){var d=c.getNorth(),e=c.getSouth(),f=c.getEast(),g=c.getWest();g>f&&(f+=360);var h=new og.LonLat(f,d),k=this._ellipsoid.LonLat2ECEF(h);h.lat=e;var m=this._ellipsoid.LonLat2ECEF(h);h.lon=g;var l=this._ellipsoid.LonLat2ECEF(h);h.lat=d;var n=this._ellipsoid.LonLat2ECEF(h);c=og.math.Vector3.sub(k,l).scale(0.5).add(l);var q=c.length();1E-6>q&&(h.lon=0.5*(f+g),h.lat=0.5*(d+e),c=this._ellipsoid.LonLat2ECEF(h));n.sub(c);m.sub(c);k.sub(c);l.sub(c);e=c.normal();
d=e.cross(og.math.Vector3.UP).normalize();e=d.cross(e).normalize();e=Math.max(Math.abs(e.dot(n)),Math.abs(e.dot(m)),Math.abs(e.dot(k)),Math.abs(e.dot(l)));k=Math.max(Math.abs(d.dot(n)),Math.abs(d.dot(m)),Math.abs(d.dot(k)),Math.abs(d.dot(l)));m=Math.tan(0.5*this.viewAngle*og.math.RADIANS);k=Math.max(k/(this.aspect*m),e/m);c.normalize();c.scale(q+k);return c};og.shaderProgram.single=function(){return new og.shaderProgram.ShaderProgram("single",{uniforms:{uPMVMatrix:{type:og.shaderProgram.types.MAT4},texBias:{type:og.shaderProgram.types.VEC3},uSampler:{type:og.shaderProgram.types.SAMPLER2D}},attributes:{aVertexPosition:{type:og.shaderProgram.types.VEC3,enableArray:!0},aTextureCoord:{type:og.shaderProgram.types.VEC2,enableArray:!0}},vertexShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"single_vs.txt"),fragmentShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+
"single_fs.txt")})};og.ImageCanvas=function(c,d){this._canvas=document.createElement("canvas");this._canvas.width=c||256;this._canvas.height=d||256;this.context=this._canvas.getContext("2d")};og.ImageCanvas.prototype.fillEmpty=function(){for(var c=this.context.getImageData(0,0,this._canvas.width,this._canvas.height),d=c.data,e=0,f=d.length;e<f;e+=4)d[e]=d[e+1]=d[e+2]=d[e+3]=0;this.context.putImageData(c,0,0)};
og.ImageCanvas.prototype.fillColor=function(c,d,e,f){for(var g=this.context.getImageData(0,0,this._canvas.width,this._canvas.height),h=g.data,k=0,m=h.length;k<m;k+=4)h[k]=c,h[k+1]=d,h[k+2]=e,h[k+3]=f;this.context.putImageData(g,0,0)};og.ImageCanvas.prototype.setData=function(c){var d=this.context.createImageData(this._canvas.width,this._canvas.height);d.data.set(c);this.context.putImageData(d,0,0)};
og.ImageCanvas.prototype.resize=function(c,d){this._canvas.width=c;this._canvas.height=d;this.context=this._canvas.getContext("2d")};og.ImageCanvas.prototype.getImage=function(){var c=new Image;c.src=this._canvas.toDataURL();return c};og.ImageCanvas.prototype.getWidth=function(){return this._canvas.width};og.ImageCanvas.prototype.getHeight=function(){return this._canvas.height};
og.ImageCanvas.prototype.loadImage=function(c,d){var e=new Image,f=this;e.onload=function(){f.resize(e.width,e.height);f.context.drawImage(e,0,0,e.width,e.height);d&&d(e)};e.src=c};og.webgl.Framebuffer=function(c){this.gl=c;this.fbo;this.width;this.height;this._imageCanvas=this.texture=null};og.webgl.Framebuffer.prototype.initialize=function(){var c=this.gl;this.fbo=c.createFramebuffer();this.width=c.canvas.width;this.height=c.canvas.height;this._imageCanvas=new og.ImageCanvas(this.width,this.height);this._createTexture()};
og.webgl.Framebuffer.prototype._createTexture=function(){var c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,this.fbo);this.texture=c.createTexture();c.bindTexture(c.TEXTURE_2D,this.texture);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,this.width,this.height,0,c.RGBA,c.UNSIGNED_BYTE,null);var d=c.createRenderbuffer();c.bindRenderbuffer(c.RENDERBUFFER,d);c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,this.width,this.height);c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,this.texture,
0);c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,d);c.bindTexture(c.TEXTURE_2D,null);c.bindRenderbuffer(c.RENDERBUFFER,null);c.bindFramebuffer(c.FRAMEBUFFER,null)};og.webgl.Framebuffer.prototype.setSize=function(c,d){this.width=c;this.height=d;this._createTexture();this._imageCanvas.resize(c,d)};og.webgl.Framebuffer.prototype.isComplete=function(){var c=this.gl;return c.checkFramebufferStatus(c.FRAMEBUFFER)==c.FRAMEBUFFER_COMPLETE?!0:!1};
og.webgl.Framebuffer.prototype.readPixels=function(c,d,e,f){var g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,this.fbo);var h=new Uint8Array(4);g.readPixels(c,d,e||1,f||1,g.RGBA,g.UNSIGNED_BYTE,h);g.bindFramebuffer(g.FRAMEBUFFER,null);return h};og.webgl.Framebuffer.prototype.activate=function(){var c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,this.fbo)};og.webgl.Framebuffer.prototype.clear=function(){var c=this.gl;c.clearColor(0,0,0,0);c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT)};
og.webgl.Framebuffer.prototype.deactivate=function(){var c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,null)};og.webgl.Framebuffer.prototype.getImage=function(){var c=this.readPixels(0,0,this.width,this.height);this._imageCanvas.setData(c);return this._imageCanvas.getImage()};og.math.Ray=function(c,d){this.origin=c.clone();this.direction=d.clone().normalize()};og.math.Ray.prototype.set=function(c,d){this.origin=c.clone();this.direction=d.clone()};og.math.Ray.prototype.getPoint=function(c){return og.Vector3.add(this.origin,this.direction.scaleTo(c))};og.math.Ray.OUTSIDE=0;og.math.Ray.INSIDE=1;og.math.Ray.INPLANE=2;og.math.Ray.AWAY=3;
og.math.Ray.prototype.hitTriangle=function(c,d,e,f){d=og.math.Vector3.sub(d,c);e=og.math.Vector3.sub(e,c);var g=d.cross(e),h=og.math.Vector3.sub(this.origin,c),h=-g.dot(h),g=g.dot(this.direction);if(Math.abs(g)<og.math.EPSILON10)return 0==h?(f.copy(this.origin),og.math.Ray.INPLANE):og.math.Ray.OUTSIDE;g=h/g;f.copy(og.math.Vector3.add(this.origin,this.direction.scaleTo(g)));if(0>g)return og.math.Ray.AWAY;var g=d.dot(d),h=d.dot(e),k=e.dot(e);f=og.math.Vector3.sub(f,c);c=f.dot(d);f=f.dot(e);d=h*h-g*
k;e=(h*f-k*c)/d;if(0>e||1<e)return og.math.Ray.OUTSIDE;c=(h*c-g*f)/d;return 0>c||1<e+c?og.math.Ray.OUTSIDE:og.math.Ray.INSIDE};og.math.Ray.prototype.hitPlane=function(c,d){};
og.math.Ray.prototype.hitSphere=function(c){var d=c.radius,e=c.center,f=this.origin,g=this.direction,h=og.math.Vector3.sub(e,f);if(0>h.dot(g)){var k=h.length();if(k>d)return null;if(k===d)return f.clone();k=e.projToRay(f,h);h=og.math.Vector3.sub(k,e).length();c=Math.sqrt(d*d-h*h);d=c-og.math.Vector3.sub(k,f).length();return f=og.math.Vector3.add(f,g.scaleTo(d))}k=e.projToRay(f,g);e=og.math.Vector3.sub(e,k).length();if(e>c.radius)return null;c=Math.sqrt(d*d-e*e);k.sub(f);d=h.length()>d?k.length()-
c:k.length()+c;return f=og.math.Vector3.add(f,g.scaleTo(d))};og.math.Ray.prototype.hitBox=function(c){};og.shaderProgram.picking=function(){return new og.shaderProgram.ShaderProgram("picking",{uniforms:{uPMVMatrix:{type:og.shaderProgram.types.MAT4},camPos:{type:og.shaderProgram.types.VEC3}},attributes:{aVertexPosition:{type:og.shaderProgram.types.VEC3,enableArray:!0}},vertexShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"picking_vs.txt"),fragmentShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"picking_fs.txt")})};og.node={};og.node.Node=function(c){this.name=c;this.topNode=this;this.dictionary=[];this.dictionary[c]=this;this.childNodes=[];this.parentNode=null};og.node.Node.prototype={name:"",childNodes:[],parentNode:null,topNode:null,dictionary:[]};og.node.Node.prototype.addNode=function(c){c.topNode=null==this.parentNode?this:this.topNode;c.parentNode=this;c.dictionary=this.topNode.dictionary;this.childNodes.push(c);this.topNode.dictionary[c.name]=c};
og.node.Node.prototype.destroy=function(){for(var c=0;c<this.childNodes.length;c++)this.childNodes[c].destroy();this._clear()};og.node.Node.prototype._clear=function(){this.name="";this.topNode=this.parentNode=null;this.childNodes.length=0};og.node.Node.prototype.getNodeByName=function(c){return this.dictionary[c]};og.node.RenderNode=function(c){og.inheritance.base(this,c);this.renderer=null;this.drawMode;this._isActive=this.show=!0;this._zIndex=1E3;this.scaleMatrix=(new og.math.Matrix4).setIdentity();this.rotationMatrix=(new og.math.Matrix4).setIdentity();this.translationMatrix=(new og.math.Matrix4).setIdentity();this.transformationMatrix=(new og.math.Matrix4).setIdentity();this.itransformationMatrix=(new og.math.Matrix4).setIdentity()};og.inheritance.extend(og.node.RenderNode,og.node.Node);
og.node.RenderNode.prototype.setScale=function(c){this.scaleMatrix.scale(c)};og.node.RenderNode.prototype.setOrigin=function(c){this.translationMatrix.translate(c)};og.node.RenderNode.prototype.setAngles=function(c,d,e){this.rotationMatrix.eulerToMatrix(c,d,e)};og.node.RenderNode.prototype.updateMatrices=function(){this.transformationMatrix=this.translationMatrix.mul(this.rotationMatrix).mul(this.scaleMatrix);this.itransformationMatrix=this.transformationMatrix.inverse()};
og.node.RenderNode.prototype.drawNode=function(){this._isActive&&this.drawNodes()};og.node.RenderNode.prototype.setZIndex=function(c){this._zIndex=c};og.node.RenderNode.prototype.getZIndex=function(){return this._zIndex};og.node.RenderNode.prototype.isActive=function(){return this._isActive};og.node.RenderNode.prototype.setActive=function(c){this._isActive=c;for(var d=0;d<this.childNodes.length;d++)this.childNodes[d].setActive(c)};
og.node.RenderNode.prototype.setDrawMode=function(c){this.drawMode=c;for(var d=0;d<this.childNodes.length;d++)this.childNodes[d].setDrawMode(c)};og.node.RenderNode.prototype.drawNodes=function(){for(var c=0;c<this.childNodes.length;c++)this.childNodes[c]._isActive&&this.childNodes[c].drawNodes();this.show&&this.frame&&this.frame()};og.node.RenderNode.prototype.assignRenderer=function(c){this.renderer=c};og.math.coder={};og.math.coder.encodeFloatToRGBA=function(c){var d=Math.abs(c);c=og.math.step(0,-c);var e=Math.floor(og.math.log2(d)),f=og.math.exp2(-e)*d,e=Math.floor(og.math.log2(d)+127)+Math.floor(og.math.log2(f));return new og.math.Vector4(128*c+Math.floor(e*og.math.exp2(-1)),128*og.math.mod(e,2)+og.math.mod(Math.floor(128*f),128),Math.floor(og.math.mod(Math.floor(f*og.math.exp2(15)),og.math.exp2(8))),Math.floor(og.math.exp2(23)*og.math.mod(f,og.math.exp2(-15))))};
og.math.coder.decodeFloatFromRGBA=function(c){var d=1-2*og.math.step(128,c.x),e=2*og.math.mod(c.x,128)+og.math.step(128,c.y)-127;c=65536*og.math.mod(c.y,128)+256*c.z+c.w+8388608;return d*og.math.exp2(e)*c*og.math.exp2(-23)};og.math.coder.doubleToTwoFloats=function(c){var d;if(0<=c){var e=65536*Math.floor(c/65536);d=Math.fround(e);c=Math.fround(c-e)}else e=65536*Math.floor(-c/65536),d=Math.fround(-e),c=Math.fround(c+e);return[d,c]};og.node.Planet=function(c,d){og.inheritance.base(this,c);this.ellipsoid=d;this.quadTree;this.events=new og.Events;this.layers=[];this.visibleLayers=[];this.tcolorArr=[];this.baseLayer;this.terrainProvider;this.createdNodesCount=0;this.renderedNodes=[];this.heightFactor=1;this.mousePositionOnEarth=new og.math.Vector3;this.indexesBuffers=[];this.backbuffer;this._currentDistanceFromPixel=0;this._viewChanged=!0;this.cameraInsideNode=null;this.cameraPositionM};og.inheritance.extend(og.node.Planet,og.node.RenderNode);
og.node.Planet.prototype.getLayerByName=function(c){for(var d=this.layers.length;d--;)if(this.layers[d].name===c)return this.layers[d]};og.node.Planet.prototype.addLayer=function(c){c.planet=this;c.events.on("onvisibilitychanged",this,this._onLayerVisibilityChanged);c.isBaseLayer&&c.visibility&&this.setBaseLayer(c);this.layers.push(c);this.events.dispatch(this.events.onlayeradded,c);this.updateVisibleLayers()};
og.node.Planet.prototype._onLayerVisibilityChanged=function(c){this.events.dispatch(this.events.onlayervisibilitychanged,c)};og.node.Planet.prototype.addLayers=function(c){for(var d=0;d<c.length;d++)this.addLayer(c[d])};
og.node.Planet.prototype.removeLayer=function(c){for(var d=c.id,e=0;e<this.layers.length;e++)if(this.layers[e].id==d)return this.layers.splice(e,1),c.setVisibility(!1),c.abortLoading(),this.quadTree.traverseTree(function(c){c=c.planetSegment.materials;c[d]&&(c[d].clear(),c[d]=null)}),this.events.dispatch(this.events.onlayerremoved,c),c};og.node.Planet.prototype.getLayers=function(){return this.layers};
og.node.Planet.prototype.setBaseLayer=function(c){if(this.baseLayer){if(c.id!=this.baseLayer.id){for(var d=0;d<this.layers.length;d++){var e=this.layers[d];e.isBaseLayer&&(e.visibility=!1,e.id!=c.id&&e.events.dispatch(e.events.onvisibilitychanged,e))}c.visibility=!0;c.events.dispatch(c.events.onvisibilitychanged,c);this.baseLayer.abortLoading();this.baseLayer=c}}else this.baseLayer=c,this.baseLayer.setVisibility(!0);this.events.dispatch(this.events.onbaselayerchanged,c);this.updateVisibleLayers()};
og.node.Planet.prototype.setHeightFactor=function(c){this.heightFactor!==c&&(this.heightFactor=c,this.quadTree.reloadTerrain())};og.node.Planet.prototype.setTerrainProvider=function(c){this.terrainProvider=c};
og.node.Planet.prototype.initialization=function(){og.planetSegment.PlanetSegmentHelper.initIndexesTables(6);for(var c=0;6>=c;c++){var d=Math.pow(2,c),e=og.planetSegment.PlanetSegmentHelper.createSegmentIndexes(d,[d,d,d,d]);this.indexesBuffers[d]=this.renderer.handler.createElementArrayBuffer(e,1,e.length)}this.renderer.activeCamera=new og.PlanetCamera(this.renderer,this.ellipsoid,{eye:new og.math.Vector3(0,0,12E6),look:new og.math.Vector3(0,0,0),up:new og.math.Vector3(0,1,0)});this.cameraInsideNode=
this.quadTree=og.quadTree.QuadNode.createNode(this,og.quadTree.NW,null,0,0,og.Extent.createFromArray([-2.003750834E7,-2.003750834E7,2.003750834E7,2.003750834E7]));c=this.renderer.activeCamera;this.cameraPositionM=og.mercator.forwardMercator(c.lonLat.lon,c.lonLat.lat);this.drawMode=this.renderer.handler.gl.TRIANGLE_STRIP;this.setScale(new og.math.Vector3(1,this.ellipsoid._a/this.ellipsoid._b,1));this.updateMatrices();this.renderer.handler.addShaderProgram(og.shaderProgram.overlays(),!0);this.renderer.handler.addShaderProgram(og.shaderProgram.single(),
!0);this.renderer.handler.addShaderProgram(og.shaderProgram.picking(),!0);this.backbuffer=new og.webgl.Framebuffer(this.renderer.handler.gl);this.backbuffer.initialize();this.updateVisibleLayers();this.events.registerNames(["ondraw","onlayeradded","onbaselayerchanged","onlayerremoved","onlayervisibilitychanged"]);this.renderer.events.on("onresize",this.backbuffer,function(c){this.setSize(c.width,c.height)});this.renderer.activeCamera.events.on("onviewchanged",this,function(c){this._viewChanged=!0});
this.renderer.events.on("onmousemove",this,function(c){this._viewChanged=!0})};og.node.Planet.prototype.updateVisibleLayers=function(){for(var c=this.visibleLayers.length=0;c<this.layers.length;c++)this.layers[c].visibility&&(this.layers[c].isBaseLayer&&(this.baseLayer=this.layers[c]),this.visibleLayers.push(this.layers[c]));this.sortVisibleLayersByZIndex()};og.node.Planet.prototype.sortVisibleLayersByZIndex=function(){this.visibleLayers.sort(function(c,d){return c.isBaseLayer?-1:c.zIndex-d.zIndex})};
og.node.Planet.prototype.checkCameraCollision=function(){var c=this.renderer.activeCamera;c.earthPoint=this.cameraInsideNode.planetSegment.getEarthPoint(this.cameraPositionM,c.eye);c.altitude=c.earthPoint.distance;c.altitude<c.minAlt&&c.setAltitude(c.minAlt)};
og.node.Planet.prototype.frame=function(){this.checkCameraCollision();this.quadTree.renderTree();this.renderNodesPASS();this.renderDistanceBackbufferPASS();this.events.dispatch(this.events.ondraw,this);140<this.createdNodesCount&&(this.quadTree.clearTree(),this.createdNodesCount=0);this.renderedNodes.length=0};
og.node.Planet.prototype.renderNodesPASS=function(){var c,d,e=this.renderer,f=e.handler;if(1<this.visibleLayers.length){f.shaderPrograms.overlays.activate();c=f.shaderPrograms.overlays._program;d=og.planetSegment.drawOverlays;for(var g=this.visibleLayers,h=g.length;h--;){var k=g[h],m=4*h;this.tcolorArr[m]=k.transparentColor[0];this.tcolorArr[m+1]=k.transparentColor[1];this.tcolorArr[m+2]=k.transparentColor[2];this.tcolorArr[m+3]=k.opacity}f.gl.uniform1i(c.uniforms.numTex._pName,g.length);f.gl.uniform4fv(c.uniforms.tcolorArr._pName,
this.tcolorArr)}else f.shaderPrograms.single.activate(),c=f.shaderPrograms.single._program,d=og.planetSegment.drawSingle;f.gl.uniformMatrix4fv(c.uniforms.uPMVMatrix._pName,!1,e.activeCamera.pmvMatrix._m);for(h=this.renderedNodes.length;h--;)d(c,this.renderedNodes[h].planetSegment)};
og.node.Planet.prototype.getCartesianFromPixelEllipsoid=function(c){c=this.renderer.activeCamera.unproject(c.x,c.y);var d=this.transformationMatrix.transpose();return(c=(new og.math.Ray(d.mulVec3(this.renderer.activeCamera.eye),d.mulVec3(c))).hitSphere(new og.bv.Sphere(this.ellipsoid._a)))?this.itransformationMatrix.mulVec3(c):null};og.node.Planet.prototype.getLonLatFromPixelEllipsoid=function(c){return(c=this.getCartesianFromPixelEllipsoid(c))?this.ellipsoid.ECEF2LonLat(c):null};
og.node.Planet.prototype.getRayIntersectionEllipsoid=function(c){var d=this.transformationMatrix.transpose();return(c=(new og.math.Ray(d.mulVec3(c.origin),d.mulVec3(c.direction))).hitSphere(new og.bv.Sphere(this.ellipsoid._a)))?this.itransformationMatrix.mulVec3(c):null};og.node.Planet.prototype.getCartesianFromMouseTerrain=function(){var c=this.renderer.events.mouseState,d=this.getDistanceFromPixel(c);return d?c.direction.scaleTo(d).add(this.renderer.activeCamera.eye):null};
og.node.Planet.prototype.getCartesianFromPixelTerrain=function(c){var d=this.getDistanceFromPixel(c);return d?this.renderer.activeCamera.unproject(c.x,c.y).scaleTo(d).add(this.renderer.activeCamera.eye):null};og.node.Planet.prototype.getLonLatFromPixelTerrain=function(c){return(c=this.getCartesianFromPixelTerrain(c))?this.ellipsoid.ECEF2LonLat(c):null};og.node.Planet.prototype.getPixelFromCartesian=function(c){return this.renderer.activeCamera.project(c)};
og.node.Planet.prototype.getPixelFromLonLat=function(c){return(c=this.ellipsoid.LonLat2ECEF(c))?this.renderer.activeCamera.project(c):null};og.node.Planet.prototype.getDistanceFromPixelEllipsoid=function(c){return(c=this.getCartesianFromPixelEllipsoid(c))?c.distance(this.renderer.activeCamera.eye):null};
og.node.Planet.prototype.getDistanceFromPixel=function(c){if(this._viewChanged){this._viewChanged=!1;var d=og.math.Vector4.fromVec(this.backbuffer.readPixels(c.x,this.backbuffer.height-c.y));return d.x|d.y|d.z|d.w?this._currentDistanceFromPixel=og.math.coder.decodeFloatFromRGBA(d):this.getDistanceFromPixelEllipsoid(c)}return this._currentDistanceFromPixel};
og.node.Planet.prototype.renderDistanceBackbufferPASS=function(){var c=this.backbuffer,d=this.renderer,e=d.handler,f=e.shaderPrograms.picking;c.activate();c.clear();f.activate();e.gl.uniform3fv(f._program.uniforms.camPos._pName,d.activeCamera.eye.toVec());for(d=this.renderedNodes.length;d--;)this.renderedNodes[d].planetSegment.drawPicking();c.deactivate();this.renderedNodes.length=0};
og.node.Planet.prototype.viewToExtent=function(c){var d=this.renderer.activeCamera;d.set(d.getExtentPosition(c,this.ellipsoid),og.math.Vector3.ZERO,og.math.Vector3.UP)};og.terrainProvider={};og.terrainProvider.defaultOptions={url:"http://earth3.openglobus.org/{zoom}/{tiley}/{tilex}.ddm",responseType:"arraybuffer",minZoom:3,maxZoom:14,gridSizeByZoom:[32,32,32,32,8,8,8,8,16,16,16,32,32,32,32,32,32,32,32,32,32],fileGridSize:32,MAX_LOADING_TILES:10};
og.terrainProvider.TerrainProvider=function(c,d){this.name=c||"";d=d||{};this.minZoom=d.minZoom||og.terrainProvider.defaultOptions.minZoom;this.maxZoom=d.maxZoom||og.terrainProvider.defaultOptions.maxZoom;this.url=d.url||og.terrainProvider.defaultOptions.url;this.gridSizeByZoom=d.gridSizeByZoom||og.terrainProvider.defaultOptions.gridSizeByZoom;this.fileGridSize=d.fileGridSize||og.terrainProvider.defaultOptions.fileGridSize;this.responseType=d.responseType||og.terrainProvider.defaultOptions.responseType;
this.MAX_LOADING_TILES=d.MAX_LOADING_TILES||og.terrainProvider.defaultOptions.MAX_LOADING_TILES;this.events=new og.Events;this.events.registerNames(["onload","onloadend"]);this._counter=0;this._pendingsQueue=[]};og.terrainProvider.TerrainProvider.prototype.abort=function(){this._pendingsQueue.length=0};og.terrainProvider.TerrainProvider.prototype.setUrl=function(c){this.url=c};og.terrainProvider.TerrainProvider.prototype.setName=function(c){this.name=c};
og.terrainProvider.TerrainProvider.prototype.handleSegmentTerrain=function(c){this._counter>=this.MAX_LOADING_TILES?this._pendingsQueue.push(c):this.loadSegmentTerrainData(c)};og.terrainProvider.TerrainProvider.prototype.getServerUrl=function(c){return og.layer.replaceTemplate(this.url,{tilex:c.tileX.toString(),tiley:c.tileY.toString(),zoom:c.zoomIndex.toString()})};og.terrainProvider.TerrainProvider.prototype.getElevations=function(c){return new Float32Array(c)};
og.terrainProvider.TerrainProvider.prototype.loadSegmentTerrainData=function(c){this._counter++;og.Ajax.request(this.getServerUrl(c),{responseType:this.responseType,sender:this,success:function(d){this._applyElevationsData(c,d)},error:function(){this._applyElevationsData(c,[])}})};og.terrainProvider.TerrainProvider.prototype._applyElevationsData=function(c,d){if(c){var e=this.getElevations(d),f=this.events.onload;f.length&&this.events.dispatch(f,{elevations:[],segment:c});c.applyTerrain.call(c,e)}this.dequeueRequest()};
og.terrainProvider.TerrainProvider.prototype.dequeueRequest=function(){this._counter--;if(this._pendingsQueue.length){if(this._counter<this.MAX_LOADING_TILES){var c;(c=this.whilePendings())&&this.loadSegmentTerrainData.call(this,c)}}else this.events.dispatch(this.events.onloadend)};og.terrainProvider.TerrainProvider.prototype.whilePendings=function(){for(;this._pendingsQueue.length;){var c=this._pendingsQueue.pop();if(c){if(c.node.getState()!=og.quadTree.NOTRENDERING)return c;c.terrainIsLoading=!1}}return null};og.webgl.ShaderController=function(c,d){this._program=d;this._handler=c;this._activated=!1};og.webgl.ShaderController.prototype.getProgram=function(){return this._program};og.webgl.ShaderController.prototype.activate=function(){if(!this._activated){this._handler.activeShaderProgram.deactivate();this._handler.activeShaderProgram=this;var c=this._program;this._activated=!0;c.enableAttribArrays();c.use()}};
og.webgl.ShaderController.prototype.deactivate=function(){this._program.disableAttribArrays();this._activated=!1};og.webgl.ShaderController.prototype.isActive=function(){return this._activated};og.webgl.ShaderController.prototype.set=function(c){this._program.set(c)};og.webgl.ShaderController.prototype.drawIndexBuffer=function(c,d){this._program.drawIndexBuffer(c,d)};og.webgl.ShaderController.prototype.drawArray=function(c,d){this._program.drawArray(c,d)};
og.webgl.ShaderController.prototype.initialize=function(){this._program.createProgram(this._handler.gl)};og.webgl.Handler=function(c){this.lastAnimationFrameTime=0;this.fps;this.delta;this.animSpeed=1;this.backgroundColor={r:0.48,g:0.48,b:0.48,a:1};this.htmlCanvasId=c;this.gl;this._initialized=!1;this.emptyTexture=null;this.drawback=function(c){};this.shaderPrograms={};this.activeShaderProgram=null;this.anisotropicFilteringEnabled=!1};
og.webgl.Handler.prototype.createTextureFromImage=function(c){var d=this.gl,e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,c);d.generateMipmap(d.TEXTURE_2D);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_LINEAR);this.anisotropicFilteringEnabled&&d.texParameterf(d.TEXTURE_2D,d.ext.TEXTURE_MAX_ANISOTROPY_EXT,4);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,
d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.bindTexture(d.TEXTURE_2D,null);return e};
og.webgl.Handler.prototype.loadCubeMapTexture=function(c){var d=this.gl,e=d.createTexture();d.bindTexture(d.TEXTURE_CUBE_MAP,e);d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MIN_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MAG_FILTER,d.LINEAR);c=[[c.positiveX,d.TEXTURE_CUBE_MAP_POSITIVE_X],[c.negativeX,d.TEXTURE_CUBE_MAP_NEGATIVE_X],[c.positiveY,
d.TEXTURE_CUBE_MAP_POSITIVE_Y],[c.negativeY,d.TEXTURE_CUBE_MAP_NEGATIVE_Y],[c.positiveZ,d.TEXTURE_CUBE_MAP_POSITIVE_Z],[c.negativeZ,d.TEXTURE_CUBE_MAP_NEGATIVE_Z]];var f=new og.ImageCanvas;f.fillEmpty();for(var g=f.getImage(),f=0;f<c.length;f++){var h=c[f][1];d.bindTexture(d.TEXTURE_CUBE_MAP,e);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1);d.texImage2D(h,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,g)}for(f=0;f<c.length;f++)h=c[f][1],g=new Image,g.crossOrigin="",g.onload=function(c,e,f){return function(){d.bindTexture(d.TEXTURE_CUBE_MAP,
c);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1);d.texImage2D(e,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,f)}}(e,h,g),g.src=c[f][0];return e};og.webgl.Handler.prototype.createEmptyTexture=function(c){c=new og.ImageCanvas;c.fillEmpty();this.emptyTexture=this.createTextureFromImage(c.getImage())};
og.webgl.Handler.prototype.addShaderProgram=function(c,d){if(this.shaderPrograms[c.name])alert(c.name+" is allready exists.");else{var e=new og.webgl.ShaderController(this,c);this.shaderPrograms[c.name]=e;this._initShaderController(e);d&&(e._activated=!1)}};og.webgl.Handler.prototype._initShaderController=function(c){this._initialized&&(c.initialize(),this.activeShaderProgram?this.activeShaderProgram._program.use():(this.activeShaderProgram=c,c.activate()))};
og.webgl.Handler.prototype.addShaderPrograms=function(c){for(var d=0;d<c.length;d++)this.addShaderProgram(c[d])};og.webgl.Handler.prototype.initAnysotropicFiltering=function(){var c=og.webgl.getExtension(this.gl,"EXT_texture_filter_anisotropic");if(!c)return null;this.anisotropicFilteringEnabled=!0;return c};og.webgl.Handler.prototype.initShaderPrograms=function(){for(var c in this.shaderPrograms)this._initShaderController(this.shaderPrograms[c])};
og.webgl.Handler.prototype.init=function(){this.gl=og.webgl.initCanvas(this.htmlCanvasId);this._initialized=!0;this.createEmptyTexture();this.initShaderPrograms();this.setDefaults()};og.webgl.Handler.prototype.setDefaults=function(){this.activateDepthTest();this.applyViewport(this.gl.canvas.width,this.gl.canvas.height);this.gl.frontFace(this.gl.CCW);this.gl.cullFace(this.gl.BACK);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE);this.activateFaceCulling();this.deactivateBlending();this.gl.ext=this.initAnysotropicFiltering()};
og.webgl.Handler.prototype.activateDepthTest=function(){this.gl.enable(this.gl.DEPTH_TEST)};og.webgl.Handler.prototype.deactivateDepthTest=function(){this.gl.disable(this.gl.DEPTH_TEST)};og.webgl.Handler.prototype.activateFaceCulling=function(){this.gl.enable(this.gl.CULL_FACE)};og.webgl.Handler.prototype.deactivateFaceCulling=function(){this.gl.disable(this.gl.CULL_FACE)};og.webgl.Handler.prototype.activateBlending=function(){this.gl.enable(this.gl.BLEND)};
og.webgl.Handler.prototype.deactivateBlending=function(){this.gl.disable(this.gl.BLEND)};og.webgl.Handler.prototype.createArrayBuffer=function(c,d,e){var f=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,f);this.gl.bufferData(this.gl.ARRAY_BUFFER,c,this.gl.STATIC_DRAW);f.itemSize=d;f.numItems=e;return f};
og.webgl.Handler.prototype.createElementArrayBuffer=function(c,d,e){var f=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,f);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,c,this.gl.STATIC_DRAW);f.itemSize=d;f.numItems=e;return f};og.webgl.Handler.prototype.fillBackGroundColor=function(c){this.gl.clearColor(c.r,c.g,c.b,c.a)};function print2d(c,d,e,f){c=document.getElementById(c);c.innerHTML=d;c.style.left=e;c.style.top=f}
og.webgl.Handler.prototype.calculateFPS=function(c){this.fps=1E3/(c-this.lastAnimationFrameTime);this.lastAnimationFrameTime=c;this.delta=this.animSpeed/this.fps};og.webgl.Handler.prototype.setBackgroundColor=function(c){this.backgroundColor.r=c.r;this.backgroundColor.g=c.g;this.backgroundColor.b=c.b;this.backgroundColor.a=c.a};
og.webgl.Handler.prototype.applyViewport=function(c,d){var e=Math.max(1,d);this.gl.viewport(0,0,c,e);this.gl.canvas.width=c;this.gl.canvas.height=e;this.gl.canvas.aspect=c/e};og.webgl.Handler.prototype.viewportResized=function(){return this.gl.canvas.clientWidth!=this.gl.canvas.width||this.gl.canvas.clientHeight!=this.gl.canvas.height};
og.webgl.Handler.prototype.drawFrame=function(c,d){d.viewportResized()&&(d.applyViewport(d.gl.canvas.clientWidth,d.gl.canvas.clientHeight),d.onCanvasResize(d.gl.canvas));d.calculateFPS(c);d.clearFrame();d.drawback();og.webgl.requestAnimationFrame(d.drawFrame,d)};og.webgl.Handler.prototype.clearFrame=function(){var c=this.gl;this.fillBackGroundColor(this.backgroundColor);c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT)};
og.webgl.Handler.prototype.start=function(){og.webgl.requestAnimationFrame(this.drawFrame,this)};og.Globus=function(c){function d(){return!1}function e(){return!0}var f=og.Globus.CANVAS_ID_PREFIX+og.Globus.__id,g=document.createElement("canvas");g.id=f;g.style.width="100%";g.style.height="100%";g.style.display="block";this.div=document.getElementById(c.target);this.div.appendChild(g);this.div.classList.add("ogViewport");this.div.onmouseenter=function(){document.onmousewheel=d};this.div.onmouseleave=function(){document.onmousewheel=e};f=new og.webgl.Handler(f);f.init();this.renderer=new og.Renderer(f);
this.renderer.init();this.renderer.div=this.div;c.skybox&&this.renderer.addRenderNode(c.skybox);this._planetName=c.name?c.name:og.Globus.PLANET_NAME_PREFIX+og.Globus.__id;this.planet=new og.node.Planet(this._planetName,c.ellipsoid?c.ellipsoid:og.ellipsoid.wgs84);c.layers&&this.planet.addLayers(c.layers);c.terrain&&this.planet.setTerrainProvider(c.terrain);this.renderer.addRenderNode(this.planet);c.controls&&this.renderer.addControls(c.controls);og.Globus.__id++;c.viewExtent&&this.planet.viewToExtent(c.viewExtent);
(isUndefined(c.autoActivate)||c.autoActivate)&&this.renderer.start()};og.Globus.__id=1;og.Globus.CANVAS_ID_PREFIX="globus_viewport_";og.Globus.PLANET_NAME_PREFIX="globus_planet_";function isUndefined(c){return void 0===c};og.math.Quaternion=function(c,d,e,f){this.x=c||0;this.y=d||0;this.z=e||0;this.w=f||0};og.math.Quaternion.IDENTITY=new og.math.Quaternion(0,0,0,1);og.math.Quaternion.prototype.clear=function(){this.x=this.y=this.z=this.w=0;return this};og.math.Quaternion.prototype.set=function(c,d,e,f){this.x=c;this.y=d;this.z=e;this.w=f;return this};og.math.Quaternion.prototype.copy=function(c){this.x=c.x;this.y=c.y;this.z=c.z;this.w=c.w;return this};
og.math.Quaternion.prototype.clone=function(){return new og.math.Quaternion(this.x,this.y,this.z,this.w)};og.math.Quaternion.prototype.add=function(c){return new og.math.Quaternion(this.x+c.x,this.y+c.y,this.z+c.z,this.w+c.w)};og.math.Quaternion.prototype.sub=function(c){return new og.math.Quaternion(this.x-c.x,this.y-c.y,this.z-c.z,this.w-c.w)};og.math.Quaternion.prototype.mulScal=function(c){return new og.math.Quaternion(this.x*c,this.y*c,this.z*c,this.w*c)};
og.math.Quaternion.prototype.toVec=function(){var c=new og.math.GLArray(4);c[0]=this.x;c[1]=this.y;c[2]=this.z;c[3]=this.w;return c};og.math.Quaternion.prototype.setFromSphericalCoords=function(c,d,e){var f=Math.sin(e/2);e=Math.cos(e/2);var g=Math.sin(c);c=Math.cos(c);var h=Math.sin(d);d=Math.cos(d);this.x=f*c*h;this.y=f*g;this.z=f*g*d;this.w=e;return this};
og.math.Quaternion.prototype.toSphericalCoords=function(){var c=this.w,d=Math.sqrt(1-c*c);Math.acos(c);5E-4>Math.abs(d)&&(d=1);var c=this.x/d,e=this.z/d,d=-Math.asin(this.y/d),c=5E-4>c*c+e*e?0:Math.atan2(c,e);0>c&&(c+=360);return{lat:d,lon:c}};og.math.Quaternion.axisAngleToQuat=function(c,d){var e=new og.math.Quaternion,f=c.normal(),g=0.5*d,h=Math.sin(g);e.set(f.x*h,f.y*h,f.z*h,Math.cos(g));return e};
og.math.Quaternion.prototype.setFromAxisAngle=function(c,d){var e=c.normal(),f=0.5*d,g=Math.sin(f);this.set(e.x*g,e.y*g,e.z*g,Math.cos(f));return this};og.math.Quaternion.prototype.getAxisAngle=function(){var c=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z),d;1E-7<c?(d=1/c,d=new og.math.Vector3(x*d,y*d,z*d),c=0>this.w?2*Math.atan2(-c,-w):2*Math.atan2(c,w)):(d=new og.math.Vector3(0,0,0),c=0);return{axis:d,angle:c}};
og.math.Quaternion.prototype.setFromEulerAngles=function(c,d,e){var f,g,h,k,m;f=x*og.Math.RADIANS/2;g=y*og.Math.RADIANS/2;h=z*og.Math.RADIANS/2;c=Math.cos(f);d=Math.cos(g);e=Math.cos(h);f=Math.sin(f);g=Math.sin(g);h=Math.sin(h);k=d*e;m=g*h;this.w=c*k+f*m;this.x=f*k-c*m;this.y=c*g*e+f*d*h;this.z=c*d*h-f*g*e;return this.normalize()};og.math.Quaternion.prototype.getEulerAngles=function(){return this.getMatrix4().getEulerAngles()};
og.math.Quaternion.prototype.setFromMatrix4=function(c){var d,e,f=[],g,h;c=c._m;e=[1,2,0];d=c[0]+c[5]+c[10];0<d?(e=Math.sqrt(d+1),this.w=e/2,e=0.5/e,this.x=(c[6]-c[9])*e,this.y=(c[8]-c[2])*e,this.z=(c[1]-c[4])*e):(d=0,c[5]>c[0]&&(d=1),c[10]>c[5*d]&&(d=2),g=e[d],h=e[g],e=Math.sqrt(c[5*d]-(c[5*g]+c[5*h])+1),f[d]=0.5*e,0!=e&&(e=0.5/e),f[3]=(c[4*g+h]-c[4*h+g])*e,f[g]=(c[4*d+g]+c[4*g+d])*e,f[h]=(c[4*d+h]+c[4*h+d])*e,this.x=f[0],this.y=f[1],this.z=f[2],this.w=f[3]);return this};
og.math.Quaternion.prototype.getMatrix4=function(){var c=new og.math.Matrix4,d=c._m,e=this.x,f=this.y,g=this.z,h=this.w,k=e+e,m=f+f,l=g+g,n=e*k,q=e*m,e=e*l,r=f*m,f=f*l,g=g*l,k=h*k,m=h*m,h=h*l;d[0]=1-(r+g);d[1]=q-h;d[2]=e+m;d[3]=0;d[4]=q+h;d[5]=1-(n+g);d[6]=f-k;d[7]=0;d[8]=e-m;d[9]=f+k;d[10]=1-(n+r);d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return c};
og.math.Quaternion.prototype.mulVec3=function(c){var d=c.x,e=c.y;c=c.z;var f=this.x,g=this.y,h=this.z,k=this.w,m=k*d+g*c-h*e,l=k*e+h*d-f*c,n=k*c+f*e-g*d,d=-f*d-g*e-h*c;return new og.math.Vector3(m*k+d*-f+l*-h-n*-g,l*k+d*-g+n*-f-m*-h,n*k+d*-h+m*-g-l*-f)};og.math.Quaternion.prototype.mul=function(c){var d=this.x,e=this.y,f=this.z,g=this.w,h=c.x,k=c.y,m=c.z;c=c.w;return new og.math.Quaternion(d*c+g*h+e*m-f*k,e*c+g*k+f*h-d*m,f*c+g*m+d*k-e*h,g*c-d*h-e*k-f*m)};
og.math.Quaternion.prototype.conjugate=function(){return new og.math.Quaternion(-this.x,-this.y,-this.z,this.w)};og.math.Quaternion.prototype.inverse=function(){var c=1/this.norm2();return new og.math.Quaternion(-this.x*c,-this.y*c,-this.z*c,this.w*c)};og.math.Quaternion.prototype.norm=function(){var c=this.x,d=this.y,e=this.z,f=this.w;return Math.sqrt(c*c+d*d+e*e+f*f)};og.math.Quaternion.prototype.norm2=function(){var c=this.x,d=this.y,e=this.z,f=this.w;return c*c+d*d+e*e+f*f};
og.math.Quaternion.prototype.dot=function(c){return this.x*c.x+this.y*c.y+this.z*c.z};og.math.Quaternion.prototype.normalize=function(){var c=this.x,d=this.y,e=this.z,f=this.w,g=Math.sqrt(c*c+d*d+e*e+f*f);if(0==g)return this.w=this.z=this.y=this.x=0,this;g=1/g;this.x=c*g;this.y=d*g;this.z=e*g;this.w=f*g;return this};og.math.Quaternion.prototype.isEqual=function(c){c=this.dot(c);return 0.001>Math.abs(c-1)?!0:!1};
og.math.Quaternion.prototype.slerp=function(c,d){var e=this.x,f=this.y,g=this.z,h=this.w,k=c.x,m=c.y,l=c.z,n=c.w,q,r,s;r=e*k+f*m+g*l+h*n;0>r&&(r=-r,k=-k,m=-m,l=-l,n=-n);1E-6<1-r?(q=Math.acos(r),s=Math.sin(q),r=Math.sin((1-d)*q)/s,q=Math.sin(d*q)/s):(r=1-d,q=d);return new og.math.Quaternion(r*e+q*k,r*f+q*m,r*g+q*l,r*h+q*n)};
og.math.Quaternion.getLookAtTargetUp=function(c,d){var e=c.normal(),e=og.math.Vector3.OrthoNormalize(d,e),f=d.cross(e),g=new og.math.Quaternion;g.w=0.5*Math.sqrt(1+f.x+d.y+e.z);var h=1/(4*g.w);g.x=(e.y-d.z)*h;g.y=(f.z-e.x)*h;g.z=(d.x-f.y)*h;return g};
og.math.Quaternion.getLookAtSourceDest=function(c,d){var e=d.sub(c).normalize(),f=og.math.Vector3.FORWARD.dot(e);if(1E-6>Math.abs(f- -1))return og.math.Quaternion.axisAngleToQuat(og.math.Vector3.UP,Math.PI);if(1E-6>Math.abs(f-1))return new og.math.Quaternion(0,0,0,1);f=Math.acos(f);e=og.math.Vector3.FORWARD.cross(e).normalize();return og.math.Quaternion.axisAngleToQuat(e,f)};og.math.Quaternion.getRotationBetweenVectors=function(c,d){var e=c.cross(d);return(new og.math.Quaternion(e.x,e.y,e.z,1+c.dot(d))).normalize()};
og.math.Quaternion.prototype.getRoll=function(c){var d=this.x,e=this.y,f=this.z,g=this.w;if(c){c=2*e;var h=2*f;return Math.atan2(c*d+h*g,1-(c*e+h*f))}return Math.atan2(2*(d*e+g*f),g*g+d*d-e*e-f*f)};og.math.Quaternion.prototype.getPitch=function(c){var d=this.x,e=this.y,f=this.z,g=this.w;if(c){c=2*d;var h=2*f;return Math.atan2(h*e+c*g,1-(c*d+h*f))}return Math.atan2(2*(e*f+g*d),g*g-d*d-e*e+f*f)};
og.math.Quaternion.prototype.getYaw=function(c){var d=this.x,e=this.y,f=this.z,g=this.w;return c?(c=2*e,Math.atan2(2*f*d+c*g,1-(2*d*d+c*e))):Math.asin(-2*(d*f-g*e))};og.control.MouseNavigation=function(c){og.inheritance.base(this,c);this.grabbedPoint=new og.math.Vector3;this.pointOnEarth=new og.math.Vector3;this.earthUp=new og.math.Vector3;this.distDiff=0.2;this.inertia=0.007;this.grabbedSpheroid=new og.bv.Sphere;this.planet;this.qRot=new og.math.Quaternion;this.scaleRot=0};og.inheritance.extend(og.control.MouseNavigation,og.control.Control);
og.control.MouseNavigation.prototype.onMouseWheel=function(c){this.stopRotation();var d=this.planet.getCartesianFromPixelTerrain(this.renderer.events.mouseState);if(d){var e=this.renderer.activeCamera,f=this.renderer.events.mouseState.direction,g=this.distDiff*e.eye.distance(d);0<c.wheelDelta&&(g=-g);9E3<e.lonLat.height?(this.grabbedSpheroid.radius=d.length(),e.eye.add(e.n.scaleTo(g)),(c=(new og.math.Ray(e.eye,f)).hitSphere(this.grabbedSpheroid))?(d=(new og.math.Matrix4).rotateBetweenVectors(d.normal(),
c.normal()),e.eye=d.mulVec3(e.eye),e.v=d.mulVec3(e.v),e.u=d.mulVec3(e.u),e.n=d.mulVec3(e.n)):e.eye.add(e.n.scaleTo(g))):e.eye.add(f.scaleTo(-g));e.update()}};
og.control.MouseNavigation.prototype.init=function(){this.renderer.events.on("onmousewheel",this,this.onMouseWheel);this.renderer.events.on("onmouselbuttonhold",this,this.onMouseLeftButtonDown);this.renderer.events.on("onmouserbuttonhold",this,this.onMouseRightButtonDown);this.renderer.events.on("onmouselbuttondown",this,this.onMouseLeftButtonClick);this.renderer.events.on("onmouserbuttondown",this,this.onMouseRightButtonClick);this.renderer.events.on("onmouselbuttondoubleclick",this,this.onMouseLeftButtonDoubleClick);
this.renderer.events.on("onmouseclick",this,this.onMouseClick);this.renderer.events.on("ondraw",this,this.onDraw);this.planet=this.renderer.renderNodes.Earth};og.control.MouseNavigation.prototype.onMouseClick=function(){};og.control.MouseNavigation.prototype.onMouseLeftButtonDoubleClick=function(){};og.control.MouseNavigation.prototype.onMouseLeftButtonClick=function(){if(this.grabbedPoint=this.planet.getCartesianFromMouseTerrain())this.grabbedSpheroid.radius=this.grabbedPoint.length(),this.stopRotation()};
og.control.MouseNavigation.prototype.stopRotation=function(){this.qRot.clear()};
og.control.MouseNavigation.prototype.onMouseLeftButtonDown=function(c){if(this.grabbedPoint)if(this.renderer.events.mouseState.moving){var d=this.renderer.activeCamera;if(c=(new og.math.Ray(d.eye,c.direction)).hitSphere(this.grabbedSpheroid))this.scaleRot=1,c=this.qRot=og.math.Quaternion.getRotationBetweenVectors(c.normal(),this.grabbedPoint.normal()),d.eye=c.mulVec3(d.eye),d.v=c.mulVec3(d.v),d.u=c.mulVec3(d.u),d.n=c.mulVec3(d.n),d.update()}else this.scaleRot=0};
og.control.MouseNavigation.prototype.onMouseRightButtonClick=function(c){this.stopRotation();this.pointOnEarth=this.planet.getCartesianFromPixelTerrain({x:c.x,y:c.y});this.earthUp=this.pointOnEarth.normal()};
og.control.MouseNavigation.prototype.onMouseRightButtonDown=function(c){var d=this.renderer.activeCamera;if(this.renderer.events.mouseState.moving){var e=0.5/d.eye.distance(this.pointOnEarth)*d.lonLat.height*og.math.RADIANS;0.007<e&&(e=0.007);d.rotateHorizontal(e*(c.x-c.prev_x),!1,this.pointOnEarth,this.earthUp);d.rotateVertical(e*(c.y-c.prev_y),this.pointOnEarth)}};
og.control.MouseNavigation.prototype.onDraw=function(c){c=this.renderer;c.controlsBag.scaleRot=this.scaleRot;if(!c.events.mouseState.leftButtonDown)if(this.scaleRot-=this.inertia,0>=this.scaleRot)this.scaleRot=0;else{c=c.activeCamera;var d=this.qRot.slerp(og.math.Quaternion.IDENTITY,1-this.scaleRot*this.scaleRot).normalize();d.x||d.y||d.z||(this.scaleRot=0);c.eye=d.mulVec3(c.eye);c.v=d.mulVec3(c.v);c.u=d.mulVec3(c.u);c.n=d.mulVec3(c.n);c.update()}};og.shaderProgram.skybox=function(){return new og.shaderProgram.ShaderProgram("skybox",{uniforms:{uPMVMatrix:{type:og.shaderProgram.types.MAT4},uSampler:{type:og.shaderProgram.types.SAMPLERCUBE},pos:{type:og.shaderProgram.types.VEC3}},attributes:{aVertexPosition:{type:og.shaderProgram.types.VEC3,enableArray:!0}},vertexShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"skybox_vs.txt"),fragmentShader:og.utils.readTextFile(og.shaderProgram.SHADERS_URL+"skybox_fs.txt")})};og.node.SkyBox=function(c){og.inheritance.base(this,"skybox");this.params=c;this.texture=this.vertexPositionBuffer=null};og.inheritance.extend(og.node.SkyBox,og.node.RenderNode);og.node.SkyBox.prototype.initialization=function(){this.renderer.handler.addShaderProgram(og.shaderProgram.skybox(),!0);this.texture=this.renderer.handler.loadCubeMapTexture(this.params);this.createBuffers();this.drawMode=this.renderer.handler.gl.TRIANGLES};
og.node.SkyBox.prototype.frame=function(){var c=this.renderer.handler,d=c.gl,e=this.renderer.activeCamera;d.disable(c.gl.DEPTH_TEST);c.shaderPrograms.skybox.activate();sh=c.shaderPrograms.skybox._program;var f=sh.uniforms;d.uniformMatrix4fv(f.uPMVMatrix._pName,!1,e.pmvMatrix._m);d.uniform3fv(f.pos._pName,e.eye.toVec());d.activeTexture(d.TEXTURE0);d.bindTexture(d.TEXTURE_CUBE_MAP,this.texture);d.uniform1i(f.uSampler._pName,0);e=this.vertexPositionBuffer;d.bindBuffer(d.ARRAY_BUFFER,e);d.vertexAttribPointer(sh.attributes.aVertexPosition._pName,
e.itemSize,d.FLOAT,!1,0,0);d.drawArrays(this.drawMode,0,e.numItems);c.gl.enable(c.gl.DEPTH_TEST)};
og.node.SkyBox.prototype.createBuffers=function(){this.vertexPositionBuffer=this.renderer.handler.createArrayBuffer(new Float32Array([-100,100,-100,-100,-100,-100,100,-100,-100,100,-100,-100,100,100,-100,-100,100,-100,-100,-100,100,-100,-100,-100,-100,100,-100,-100,100,-100,-100,100,100,-100,-100,100,100,-100,-100,100,-100,100,100,100,100,100,100,100,100,100,-100,100,-100,-100,-100,-100,100,-100,100,100,100,100,100,100,100,100,100,-100,100,-100,-100,100,-100,100,-100,100,100,-100,100,100,100,100,
100,100,-100,100,100,-100,100,-100,-100,-100,-100,-100,-100,100,100,-100,-100,100,-100,-100,-100,-100,100,100,-100,100]),3,36)};og.all=function(){};
